SELECT 
    CASE
        WHEN TABLE_SCHEMA = 'DATAHUB_TARGET' THEN 'IPS'
        ELSE REPLACE(TABLE_SCHEMA, 'TARGET_', '')
    END AS "SOURCE",
    TABLE_NAME AS "TABLE"
FROM ${var.ENVIRONMENT}_WCC_DATAWAREHOUSE.INFORMATION_SCHEMA.TABLES
WHERE TABLE_TYPE = 'BASE TABLE' AND
    (TABLE_SCHEMA LIKE 'TARGET_%' OR TABLE_SCHEMA = 'DATAHUB_TARGET') AND
    TABLE_SCHEMA NOT LIKE '%HISTORY%' AND
    SOURCE = :source_system
UNION ALL
SELECT
    REPLACE(TABLE_SCHEMA, 'TARGET_', '') AS "SOURCE",
    TABLE_NAME AS "TABLE"
FROM WATERLAKE_${var.ENVIRONMENT}.INFORMATION_SCHEMA.TABLES
WHERE
    TABLE_TYPE = 'BASE TABLE' AND 
    TABLE_SCHEMA LIKE 'TARGET_%' AND
    TABLE_SCHEMA NOT LIKE '%HISTORY%' AND 
    SOURCE = :source_system
ORDER BY "SOURCE", "TABLE"