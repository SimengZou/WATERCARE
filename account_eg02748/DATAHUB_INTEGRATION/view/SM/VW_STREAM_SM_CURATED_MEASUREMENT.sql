CREATE OR REPLACE VIEW DATAHUB_INTEGRATION.VW_STREAM_SM_CURATED_MEASUREMENT(
	SRC,
	M_PLATFORM_ID,
	M_PLATFORM_TIME,
	M_PLATFORM_NAME,
	M_UNIT_ID,
	M_MANUFACTURER_NAME,
	M_PRODUCT_CLASS,
	M_RESOURCE_TYPE,
	M_RESOURCE_DESCRIPTION,
	M_METER_TIME,
	M_BILLING,
	M_UNIT,
	M_VALUE,
	M_ETL_JOB_ID1,
	M_ETL_JOB_ID2,
	M_CUSTOM_1,
	M_CUSTOM_2,
	ETL_LANDING_LOAD_DATETIME,
	ETL_LOAD_DATETIME,
	ETL_LOAD_METADATAFILENAME,
	ROWNUMBER
) as 
select
    $1 as SRC,
	$1:"m_platform_id"::TEXT AS m_platform_id,
	to_timestamp_ntz($1:"m_platform_time"::TEXT) AS m_platform_time,
	$1:"m_platform_name"::TEXT AS m_platform_name,
	$1:"m_unit_id"::TEXT AS m_unit_id,
	$1:"m_manufacturer_name"::TEXT AS m_manufacturer_name,
	$1:"m_product_class"::TEXT AS m_product_class,
	$1:"m_resource_type"::TEXT AS m_resource_type,
	$1:"m_resource_description"::TEXT AS m_resource_description,
	to_timestamp_ntz($1:"m_meter_time"::TEXT) AS m_meter_time,
	$1:"m_billing"::BOOLEAN AS m_billing,
	$1:"m_unit"::TEXT AS m_unit,
	$1:"m_value"::REAL AS m_value,
	$1:"m_etl_job_id1"::TEXT AS m_etl_job_id1,
	$1:"m_etl_job_id2"::TEXT AS m_etl_job_id2,
	$1:"m_custom_1"::TEXT AS m_custom_1,
	$1:"m_custom_2"::TEXT AS m_custom_2,
	ETL_LOAD_DATETIME AS ETL_LANDING_LOAD_DATETIME,
	CURRENT_TIMESTAMP() AS ETL_LOAD_DATETIME,
	ETL_LOAD_METADATAFILENAME AS ETL_LOAD_METADATAFILENAME,
	ROW_NUMBER() OVER (PARTITION BY
		to_timestamp_ntz($1:"m_meter_time"::TEXT),
		$1:"m_unit_id"::TEXT,
		$1:"m_resource_type"::TEXT,
		$1:"m_value"::REAL
	ORDER BY $1:"m_platform_id"::TEXT desc) as ROWNUMBER
from DATAHUB_INTEGRATION.STREAM_SM_CURATED_MEASUREMENT