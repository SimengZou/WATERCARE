create or replace procedure DATAHUB_INTEGRATION.SP_LN_WHINH430()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_WHINH430_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_WHINH430 as target using (SELECT * FROM (SELECT 
            strm.aclr, 
            strm.aclr_kw, 
            strm.adin, 
            strm.bolp, 
            strm.bolp_kw, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccty, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdun, 
            strm.cdun_ref_compnr, 
            strm.cham, 
            strm.cntr, 
            strm.compnr, 
            strm.corn, 
            strm.cpro, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.curr, 
            strm.curr_ref_compnr, 
            strm.cwun, 
            strm.cwun_ref_compnr, 
            strm.daby, 
            strm.daby_ref_compnr, 
            strm.dacc, 
            strm.dacc_kw, 
            strm.dadt, 
            strm.darq, 
            strm.darq_kw, 
            strm.delc, 
            strm.delc_ref_compnr, 
            strm.deleted, 
            strm.delp, 
            strm.delp_kw, 
            strm.depc, 
            strm.depc_ref_compnr, 
            strm.dlpt, 
            strm.dpth, 
            strm.eacu, 
            strm.eamt, 
            strm.erdt, 
            strm.exre, 
            strm.flsp, 
            strm.frsm, 
            strm.frsm_kw, 
            strm.fval, 
            strm.fxwt, 
            strm.fxwt_kw, 
            strm.hazm, 
            strm.hazm_kw, 
            strm.hght, 
            strm.hubc, 
            strm.hubc_kw, 
            strm.huid, 
            strm.huid_ref_compnr, 
            strm.ibpd, 
            strm.ibpd_kw, 
            strm.iedi, 
            strm.iedi_ref_compnr, 
            strm.incp, 
            strm.invd, 
            strm.invn, 
            strm.ispr, 
            strm.itbp, 
            strm.itbp_ref_compnr, 
            strm.koch, 
            strm.koch_kw, 
            strm.llsq, 
            strm.load, 
            strm.load_cntr_ref_compnr, 
            strm.load_ref_compnr, 
            strm.manl, 
            strm.manl_kw, 
            strm.mapr, 
            strm.mapr_kw, 
            strm.minv, 
            strm.minv_kw, 
            strm.motv, 
            strm.motv_ref_compnr, 
            strm.ntwt, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oshc, 
            strm.oshc_kw, 
            strm.pclp, 
            strm.pclp_kw, 
            strm.pcsp, 
            strm.pcsp_kw, 
            strm.pdat, 
            strm.pddt, 
            strm.pfpr, 
            strm.pfpr_kw, 
            strm.picm, 
            strm.pitm, 
            strm.pitm_ref_compnr, 
            strm.prdn, 
            strm.prdn_ref_compnr, 
            strm.prdt, 
            strm.psdd, 
            strm.psdd_kw, 
            strm.psde, 
            strm.psde_kw, 
            strm.psts, 
            strm.psts_kw, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qpac, 
            strm.refs, 
            strm.risk, 
            strm.rule, 
            strm.rule_ref_compnr, 
            strm.runn, 
            strm.saby, 
            strm.saby_ref_compnr, 
            strm.sacc, 
            strm.sacc_kw, 
            strm.sadt, 
            strm.sanl, 
            strm.sanl_kw, 
            strm.sarq, 
            strm.sarq_kw, 
            strm.scsh, 
            strm.scsh_kw, 
            strm.sdsh, 
            strm.sdsh_kw, 
            strm.sdtf, 
            strm.sdtt, 
            strm.sequencenumber, 
            strm.seri, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.sfco, 
            strm.sfcp, 
            strm.sflp, 
            strm.sflp_kw, 
            strm.sfsi, 
            strm.sfsi_ref_compnr, 
            strm.sfty, 
            strm.sfty_kw, 
            strm.shpm, 
            strm.shrf, 
            strm.shst, 
            strm.shst_kw, 
            strm.shvc, 
            strm.shvc_kw, 
            strm.shvd, 
            strm.shvl, 
            strm.shvl_kw, 
            strm.shvo, 
            strm.shvo_kw, 
            strm.slsh, 
            strm.slsh_kw, 
            strm.sqdl, 
            strm.sqdl_kw, 
            strm.sqdp, 
            strm.sqdp_kw, 
            strm.srsh, 
            strm.srsh_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stco, 
            strm.stcp, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stty, 
            strm.stty_kw, 
            strm.suba, 
            strm.suba_kw, 
            strm.taxp, 
            strm.taxs, 
            strm.tcap, 
            strm.tcap_kw, 
            strm.tccp, 
            strm.tccp_kw, 
            strm.text, 
            strm.text_ref_compnr, 
            strm.timestamp, 
            strm.trcd, 
            strm.trnr, 
            strm.ttyp, 
            strm.username, 
            strm.volm, 
            strm.wdep, 
            strm.wdth, 
            strm.wght, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.shpm ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_WHINH430 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.shpm=src.shpm) OR (target.shpm IS NULL AND src.shpm IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.aclr=src.aclr, 
                    target.aclr_kw=src.aclr_kw, 
                    target.adin=src.adin, 
                    target.bolp=src.bolp, 
                    target.bolp_kw=src.bolp_kw, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdun=src.cdun, 
                    target.cdun_ref_compnr=src.cdun_ref_compnr, 
                    target.cham=src.cham, 
                    target.cntr=src.cntr, 
                    target.compnr=src.compnr, 
                    target.corn=src.corn, 
                    target.cpro=src.cpro, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.curr=src.curr, 
                    target.curr_ref_compnr=src.curr_ref_compnr, 
                    target.cwun=src.cwun, 
                    target.cwun_ref_compnr=src.cwun_ref_compnr, 
                    target.daby=src.daby, 
                    target.daby_ref_compnr=src.daby_ref_compnr, 
                    target.dacc=src.dacc, 
                    target.dacc_kw=src.dacc_kw, 
                    target.dadt=src.dadt, 
                    target.darq=src.darq, 
                    target.darq_kw=src.darq_kw, 
                    target.delc=src.delc, 
                    target.delc_ref_compnr=src.delc_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.delp=src.delp, 
                    target.delp_kw=src.delp_kw, 
                    target.depc=src.depc, 
                    target.depc_ref_compnr=src.depc_ref_compnr, 
                    target.dlpt=src.dlpt, 
                    target.dpth=src.dpth, 
                    target.eacu=src.eacu, 
                    target.eamt=src.eamt, 
                    target.erdt=src.erdt, 
                    target.exre=src.exre, 
                    target.flsp=src.flsp, 
                    target.frsm=src.frsm, 
                    target.frsm_kw=src.frsm_kw, 
                    target.fval=src.fval, 
                    target.fxwt=src.fxwt, 
                    target.fxwt_kw=src.fxwt_kw, 
                    target.hazm=src.hazm, 
                    target.hazm_kw=src.hazm_kw, 
                    target.hght=src.hght, 
                    target.hubc=src.hubc, 
                    target.hubc_kw=src.hubc_kw, 
                    target.huid=src.huid, 
                    target.huid_ref_compnr=src.huid_ref_compnr, 
                    target.ibpd=src.ibpd, 
                    target.ibpd_kw=src.ibpd_kw, 
                    target.iedi=src.iedi, 
                    target.iedi_ref_compnr=src.iedi_ref_compnr, 
                    target.incp=src.incp, 
                    target.invd=src.invd, 
                    target.invn=src.invn, 
                    target.ispr=src.ispr, 
                    target.itbp=src.itbp, 
                    target.itbp_ref_compnr=src.itbp_ref_compnr, 
                    target.koch=src.koch, 
                    target.koch_kw=src.koch_kw, 
                    target.llsq=src.llsq, 
                    target.load=src.load, 
                    target.load_cntr_ref_compnr=src.load_cntr_ref_compnr, 
                    target.load_ref_compnr=src.load_ref_compnr, 
                    target.manl=src.manl, 
                    target.manl_kw=src.manl_kw, 
                    target.mapr=src.mapr, 
                    target.mapr_kw=src.mapr_kw, 
                    target.minv=src.minv, 
                    target.minv_kw=src.minv_kw, 
                    target.motv=src.motv, 
                    target.motv_ref_compnr=src.motv_ref_compnr, 
                    target.ntwt=src.ntwt, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oshc=src.oshc, 
                    target.oshc_kw=src.oshc_kw, 
                    target.pclp=src.pclp, 
                    target.pclp_kw=src.pclp_kw, 
                    target.pcsp=src.pcsp, 
                    target.pcsp_kw=src.pcsp_kw, 
                    target.pdat=src.pdat, 
                    target.pddt=src.pddt, 
                    target.pfpr=src.pfpr, 
                    target.pfpr_kw=src.pfpr_kw, 
                    target.picm=src.picm, 
                    target.pitm=src.pitm, 
                    target.pitm_ref_compnr=src.pitm_ref_compnr, 
                    target.prdn=src.prdn, 
                    target.prdn_ref_compnr=src.prdn_ref_compnr, 
                    target.prdt=src.prdt, 
                    target.psdd=src.psdd, 
                    target.psdd_kw=src.psdd_kw, 
                    target.psde=src.psde, 
                    target.psde_kw=src.psde_kw, 
                    target.psts=src.psts, 
                    target.psts_kw=src.psts_kw, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qpac=src.qpac, 
                    target.refs=src.refs, 
                    target.risk=src.risk, 
                    target.rule=src.rule, 
                    target.rule_ref_compnr=src.rule_ref_compnr, 
                    target.runn=src.runn, 
                    target.saby=src.saby, 
                    target.saby_ref_compnr=src.saby_ref_compnr, 
                    target.sacc=src.sacc, 
                    target.sacc_kw=src.sacc_kw, 
                    target.sadt=src.sadt, 
                    target.sanl=src.sanl, 
                    target.sanl_kw=src.sanl_kw, 
                    target.sarq=src.sarq, 
                    target.sarq_kw=src.sarq_kw, 
                    target.scsh=src.scsh, 
                    target.scsh_kw=src.scsh_kw, 
                    target.sdsh=src.sdsh, 
                    target.sdsh_kw=src.sdsh_kw, 
                    target.sdtf=src.sdtf, 
                    target.sdtt=src.sdtt, 
                    target.sequencenumber=src.sequencenumber, 
                    target.seri=src.seri, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.sfco=src.sfco, 
                    target.sfcp=src.sfcp, 
                    target.sflp=src.sflp, 
                    target.sflp_kw=src.sflp_kw, 
                    target.sfsi=src.sfsi, 
                    target.sfsi_ref_compnr=src.sfsi_ref_compnr, 
                    target.sfty=src.sfty, 
                    target.sfty_kw=src.sfty_kw, 
                    target.shpm=src.shpm, 
                    target.shrf=src.shrf, 
                    target.shst=src.shst, 
                    target.shst_kw=src.shst_kw, 
                    target.shvc=src.shvc, 
                    target.shvc_kw=src.shvc_kw, 
                    target.shvd=src.shvd, 
                    target.shvl=src.shvl, 
                    target.shvl_kw=src.shvl_kw, 
                    target.shvo=src.shvo, 
                    target.shvo_kw=src.shvo_kw, 
                    target.slsh=src.slsh, 
                    target.slsh_kw=src.slsh_kw, 
                    target.sqdl=src.sqdl, 
                    target.sqdl_kw=src.sqdl_kw, 
                    target.sqdp=src.sqdp, 
                    target.sqdp_kw=src.sqdp_kw, 
                    target.srsh=src.srsh, 
                    target.srsh_kw=src.srsh_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stco=src.stco, 
                    target.stcp=src.stcp, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stty=src.stty, 
                    target.stty_kw=src.stty_kw, 
                    target.suba=src.suba, 
                    target.suba_kw=src.suba_kw, 
                    target.taxp=src.taxp, 
                    target.taxs=src.taxs, 
                    target.tcap=src.tcap, 
                    target.tcap_kw=src.tcap_kw, 
                    target.tccp=src.tccp, 
                    target.tccp_kw=src.tccp_kw, 
                    target.text=src.text, 
                    target.text_ref_compnr=src.text_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.trcd=src.trcd, 
                    target.trnr=src.trnr, 
                    target.ttyp=src.ttyp, 
                    target.username=src.username, 
                    target.volm=src.volm, 
                    target.wdep=src.wdep, 
                    target.wdth=src.wdth, 
                    target.wght=src.wght, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    aclr, 
                    aclr_kw, 
                    adin, 
                    bolp, 
                    bolp_kw, 
                    bptc, 
                    bptc_ref_compnr, 
                    carr, 
                    carr_ref_compnr, 
                    ccty, 
                    ccty_ref_compnr, 
                    cdat, 
                    cdec, 
                    cdec_ref_compnr, 
                    cdun, 
                    cdun_ref_compnr, 
                    cham, 
                    cntr, 
                    compnr, 
                    corn, 
                    cpro, 
                    crte, 
                    crte_ref_compnr, 
                    curr, 
                    curr_ref_compnr, 
                    cwun, 
                    cwun_ref_compnr, 
                    daby, 
                    daby_ref_compnr, 
                    dacc, 
                    dacc_kw, 
                    dadt, 
                    darq, 
                    darq_kw, 
                    delc, 
                    delc_ref_compnr, 
                    deleted, 
                    delp, 
                    delp_kw, 
                    depc, 
                    depc_ref_compnr, 
                    dlpt, 
                    dpth, 
                    eacu, 
                    eamt, 
                    erdt, 
                    exre, 
                    flsp, 
                    frsm, 
                    frsm_kw, 
                    fval, 
                    fxwt, 
                    fxwt_kw, 
                    hazm, 
                    hazm_kw, 
                    hght, 
                    hubc, 
                    hubc_kw, 
                    huid, 
                    huid_ref_compnr, 
                    ibpd, 
                    ibpd_kw, 
                    iedi, 
                    iedi_ref_compnr, 
                    incp, 
                    invd, 
                    invn, 
                    ispr, 
                    itbp, 
                    itbp_ref_compnr, 
                    koch, 
                    koch_kw, 
                    llsq, 
                    load, 
                    load_cntr_ref_compnr, 
                    load_ref_compnr, 
                    manl, 
                    manl_kw, 
                    mapr, 
                    mapr_kw, 
                    minv, 
                    minv_kw, 
                    motv, 
                    motv_ref_compnr, 
                    ntwt, 
                    ofbp, 
                    ofbp_ref_compnr, 
                    oshc, 
                    oshc_kw, 
                    pclp, 
                    pclp_kw, 
                    pcsp, 
                    pcsp_kw, 
                    pdat, 
                    pddt, 
                    pfpr, 
                    pfpr_kw, 
                    picm, 
                    pitm, 
                    pitm_ref_compnr, 
                    prdn, 
                    prdn_ref_compnr, 
                    prdt, 
                    psdd, 
                    psdd_kw, 
                    psde, 
                    psde_kw, 
                    psts, 
                    psts_kw, 
                    ptpa, 
                    ptpa_ref_compnr, 
                    qpac, 
                    refs, 
                    risk, 
                    rule, 
                    rule_ref_compnr, 
                    runn, 
                    saby, 
                    saby_ref_compnr, 
                    sacc, 
                    sacc_kw, 
                    sadt, 
                    sanl, 
                    sanl_kw, 
                    sarq, 
                    sarq_kw, 
                    scsh, 
                    scsh_kw, 
                    sdsh, 
                    sdsh_kw, 
                    sdtf, 
                    sdtt, 
                    sequencenumber, 
                    seri, 
                    sfad, 
                    sfad_ref_compnr, 
                    sfco, 
                    sfcp, 
                    sflp, 
                    sflp_kw, 
                    sfsi, 
                    sfsi_ref_compnr, 
                    sfty, 
                    sfty_kw, 
                    shpm, 
                    shrf, 
                    shst, 
                    shst_kw, 
                    shvc, 
                    shvc_kw, 
                    shvd, 
                    shvl, 
                    shvl_kw, 
                    shvo, 
                    shvo_kw, 
                    slsh, 
                    slsh_kw, 
                    sqdl, 
                    sqdl_kw, 
                    sqdp, 
                    sqdp_kw, 
                    srsh, 
                    srsh_kw, 
                    stad, 
                    stad_dlpt_ref_compnr, 
                    stad_ref_compnr, 
                    stat, 
                    stat_kw, 
                    stco, 
                    stcp, 
                    stsi, 
                    stsi_ref_compnr, 
                    stty, 
                    stty_kw, 
                    suba, 
                    suba_kw, 
                    taxp, 
                    taxs, 
                    tcap, 
                    tcap_kw, 
                    tccp, 
                    tccp_kw, 
                    text, 
                    text_ref_compnr, 
                    timestamp, 
                    trcd, 
                    trnr, 
                    ttyp, 
                    username, 
                    volm, 
                    wdep, 
                    wdth, 
                    wght, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.aclr, 
                    src.aclr_kw, 
                    src.adin, 
                    src.bolp, 
                    src.bolp_kw, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccty, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdun, 
                    src.cdun_ref_compnr, 
                    src.cham, 
                    src.cntr, 
                    src.compnr, 
                    src.corn, 
                    src.cpro, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.curr, 
                    src.curr_ref_compnr, 
                    src.cwun, 
                    src.cwun_ref_compnr, 
                    src.daby, 
                    src.daby_ref_compnr, 
                    src.dacc, 
                    src.dacc_kw, 
                    src.dadt, 
                    src.darq, 
                    src.darq_kw, 
                    src.delc, 
                    src.delc_ref_compnr, 
                    src.deleted, 
                    src.delp, 
                    src.delp_kw, 
                    src.depc, 
                    src.depc_ref_compnr, 
                    src.dlpt, 
                    src.dpth, 
                    src.eacu, 
                    src.eamt, 
                    src.erdt, 
                    src.exre, 
                    src.flsp, 
                    src.frsm, 
                    src.frsm_kw, 
                    src.fval, 
                    src.fxwt, 
                    src.fxwt_kw, 
                    src.hazm, 
                    src.hazm_kw, 
                    src.hght, 
                    src.hubc, 
                    src.hubc_kw, 
                    src.huid, 
                    src.huid_ref_compnr, 
                    src.ibpd, 
                    src.ibpd_kw, 
                    src.iedi, 
                    src.iedi_ref_compnr, 
                    src.incp, 
                    src.invd, 
                    src.invn, 
                    src.ispr, 
                    src.itbp, 
                    src.itbp_ref_compnr, 
                    src.koch, 
                    src.koch_kw, 
                    src.llsq, 
                    src.load, 
                    src.load_cntr_ref_compnr, 
                    src.load_ref_compnr, 
                    src.manl, 
                    src.manl_kw, 
                    src.mapr, 
                    src.mapr_kw, 
                    src.minv, 
                    src.minv_kw, 
                    src.motv, 
                    src.motv_ref_compnr, 
                    src.ntwt, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oshc, 
                    src.oshc_kw, 
                    src.pclp, 
                    src.pclp_kw, 
                    src.pcsp, 
                    src.pcsp_kw, 
                    src.pdat, 
                    src.pddt, 
                    src.pfpr, 
                    src.pfpr_kw, 
                    src.picm, 
                    src.pitm, 
                    src.pitm_ref_compnr, 
                    src.prdn, 
                    src.prdn_ref_compnr, 
                    src.prdt, 
                    src.psdd, 
                    src.psdd_kw, 
                    src.psde, 
                    src.psde_kw, 
                    src.psts, 
                    src.psts_kw, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qpac, 
                    src.refs, 
                    src.risk, 
                    src.rule, 
                    src.rule_ref_compnr, 
                    src.runn, 
                    src.saby, 
                    src.saby_ref_compnr, 
                    src.sacc, 
                    src.sacc_kw, 
                    src.sadt, 
                    src.sanl, 
                    src.sanl_kw, 
                    src.sarq, 
                    src.sarq_kw, 
                    src.scsh, 
                    src.scsh_kw, 
                    src.sdsh, 
                    src.sdsh_kw, 
                    src.sdtf, 
                    src.sdtt, 
                    src.sequencenumber, 
                    src.seri, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.sfco, 
                    src.sfcp, 
                    src.sflp, 
                    src.sflp_kw, 
                    src.sfsi, 
                    src.sfsi_ref_compnr, 
                    src.sfty, 
                    src.sfty_kw, 
                    src.shpm, 
                    src.shrf, 
                    src.shst, 
                    src.shst_kw, 
                    src.shvc, 
                    src.shvc_kw, 
                    src.shvd, 
                    src.shvl, 
                    src.shvl_kw, 
                    src.shvo, 
                    src.shvo_kw, 
                    src.slsh, 
                    src.slsh_kw, 
                    src.sqdl, 
                    src.sqdl_kw, 
                    src.sqdp, 
                    src.sqdp_kw, 
                    src.srsh, 
                    src.srsh_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stco, 
                    src.stcp, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stty, 
                    src.stty_kw, 
                    src.suba, 
                    src.suba_kw, 
                    src.taxp, 
                    src.taxs, 
                    src.tcap, 
                    src.tcap_kw, 
                    src.tccp, 
                    src.tccp_kw, 
                    src.text, 
                    src.text_ref_compnr, 
                    src.timestamp, 
                    src.trcd, 
                    src.trnr, 
                    src.ttyp, 
                    src.username, 
                    src.volm, 
                    src.wdep, 
                    src.wdth, 
                    src.wght,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_WHINH430_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.aclr, 
            strm.aclr_kw, 
            strm.adin, 
            strm.bolp, 
            strm.bolp_kw, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccty, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdun, 
            strm.cdun_ref_compnr, 
            strm.cham, 
            strm.cntr, 
            strm.compnr, 
            strm.corn, 
            strm.cpro, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.curr, 
            strm.curr_ref_compnr, 
            strm.cwun, 
            strm.cwun_ref_compnr, 
            strm.daby, 
            strm.daby_ref_compnr, 
            strm.dacc, 
            strm.dacc_kw, 
            strm.dadt, 
            strm.darq, 
            strm.darq_kw, 
            strm.delc, 
            strm.delc_ref_compnr, 
            strm.deleted, 
            strm.delp, 
            strm.delp_kw, 
            strm.depc, 
            strm.depc_ref_compnr, 
            strm.dlpt, 
            strm.dpth, 
            strm.eacu, 
            strm.eamt, 
            strm.erdt, 
            strm.exre, 
            strm.flsp, 
            strm.frsm, 
            strm.frsm_kw, 
            strm.fval, 
            strm.fxwt, 
            strm.fxwt_kw, 
            strm.hazm, 
            strm.hazm_kw, 
            strm.hght, 
            strm.hubc, 
            strm.hubc_kw, 
            strm.huid, 
            strm.huid_ref_compnr, 
            strm.ibpd, 
            strm.ibpd_kw, 
            strm.iedi, 
            strm.iedi_ref_compnr, 
            strm.incp, 
            strm.invd, 
            strm.invn, 
            strm.ispr, 
            strm.itbp, 
            strm.itbp_ref_compnr, 
            strm.koch, 
            strm.koch_kw, 
            strm.llsq, 
            strm.load, 
            strm.load_cntr_ref_compnr, 
            strm.load_ref_compnr, 
            strm.manl, 
            strm.manl_kw, 
            strm.mapr, 
            strm.mapr_kw, 
            strm.minv, 
            strm.minv_kw, 
            strm.motv, 
            strm.motv_ref_compnr, 
            strm.ntwt, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oshc, 
            strm.oshc_kw, 
            strm.pclp, 
            strm.pclp_kw, 
            strm.pcsp, 
            strm.pcsp_kw, 
            strm.pdat, 
            strm.pddt, 
            strm.pfpr, 
            strm.pfpr_kw, 
            strm.picm, 
            strm.pitm, 
            strm.pitm_ref_compnr, 
            strm.prdn, 
            strm.prdn_ref_compnr, 
            strm.prdt, 
            strm.psdd, 
            strm.psdd_kw, 
            strm.psde, 
            strm.psde_kw, 
            strm.psts, 
            strm.psts_kw, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qpac, 
            strm.refs, 
            strm.risk, 
            strm.rule, 
            strm.rule_ref_compnr, 
            strm.runn, 
            strm.saby, 
            strm.saby_ref_compnr, 
            strm.sacc, 
            strm.sacc_kw, 
            strm.sadt, 
            strm.sanl, 
            strm.sanl_kw, 
            strm.sarq, 
            strm.sarq_kw, 
            strm.scsh, 
            strm.scsh_kw, 
            strm.sdsh, 
            strm.sdsh_kw, 
            strm.sdtf, 
            strm.sdtt, 
            strm.sequencenumber, 
            strm.seri, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.sfco, 
            strm.sfcp, 
            strm.sflp, 
            strm.sflp_kw, 
            strm.sfsi, 
            strm.sfsi_ref_compnr, 
            strm.sfty, 
            strm.sfty_kw, 
            strm.shpm, 
            strm.shrf, 
            strm.shst, 
            strm.shst_kw, 
            strm.shvc, 
            strm.shvc_kw, 
            strm.shvd, 
            strm.shvl, 
            strm.shvl_kw, 
            strm.shvo, 
            strm.shvo_kw, 
            strm.slsh, 
            strm.slsh_kw, 
            strm.sqdl, 
            strm.sqdl_kw, 
            strm.sqdp, 
            strm.sqdp_kw, 
            strm.srsh, 
            strm.srsh_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stco, 
            strm.stcp, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stty, 
            strm.stty_kw, 
            strm.suba, 
            strm.suba_kw, 
            strm.taxp, 
            strm.taxs, 
            strm.tcap, 
            strm.tcap_kw, 
            strm.tccp, 
            strm.tccp_kw, 
            strm.text, 
            strm.text_ref_compnr, 
            strm.timestamp, 
            strm.trcd, 
            strm.trnr, 
            strm.ttyp, 
            strm.username, 
            strm.volm, 
            strm.wdep, 
            strm.wdth, 
            strm.wght, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.shpm ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_WHINH430 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.shpm=src.shpm) OR (target.shpm IS NULL AND src.shpm IS NULL)) 
                when matched then update set
                    target.aclr=src.aclr, 
                    target.aclr_kw=src.aclr_kw, 
                    target.adin=src.adin, 
                    target.bolp=src.bolp, 
                    target.bolp_kw=src.bolp_kw, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdun=src.cdun, 
                    target.cdun_ref_compnr=src.cdun_ref_compnr, 
                    target.cham=src.cham, 
                    target.cntr=src.cntr, 
                    target.compnr=src.compnr, 
                    target.corn=src.corn, 
                    target.cpro=src.cpro, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.curr=src.curr, 
                    target.curr_ref_compnr=src.curr_ref_compnr, 
                    target.cwun=src.cwun, 
                    target.cwun_ref_compnr=src.cwun_ref_compnr, 
                    target.daby=src.daby, 
                    target.daby_ref_compnr=src.daby_ref_compnr, 
                    target.dacc=src.dacc, 
                    target.dacc_kw=src.dacc_kw, 
                    target.dadt=src.dadt, 
                    target.darq=src.darq, 
                    target.darq_kw=src.darq_kw, 
                    target.delc=src.delc, 
                    target.delc_ref_compnr=src.delc_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.delp=src.delp, 
                    target.delp_kw=src.delp_kw, 
                    target.depc=src.depc, 
                    target.depc_ref_compnr=src.depc_ref_compnr, 
                    target.dlpt=src.dlpt, 
                    target.dpth=src.dpth, 
                    target.eacu=src.eacu, 
                    target.eamt=src.eamt, 
                    target.erdt=src.erdt, 
                    target.exre=src.exre, 
                    target.flsp=src.flsp, 
                    target.frsm=src.frsm, 
                    target.frsm_kw=src.frsm_kw, 
                    target.fval=src.fval, 
                    target.fxwt=src.fxwt, 
                    target.fxwt_kw=src.fxwt_kw, 
                    target.hazm=src.hazm, 
                    target.hazm_kw=src.hazm_kw, 
                    target.hght=src.hght, 
                    target.hubc=src.hubc, 
                    target.hubc_kw=src.hubc_kw, 
                    target.huid=src.huid, 
                    target.huid_ref_compnr=src.huid_ref_compnr, 
                    target.ibpd=src.ibpd, 
                    target.ibpd_kw=src.ibpd_kw, 
                    target.iedi=src.iedi, 
                    target.iedi_ref_compnr=src.iedi_ref_compnr, 
                    target.incp=src.incp, 
                    target.invd=src.invd, 
                    target.invn=src.invn, 
                    target.ispr=src.ispr, 
                    target.itbp=src.itbp, 
                    target.itbp_ref_compnr=src.itbp_ref_compnr, 
                    target.koch=src.koch, 
                    target.koch_kw=src.koch_kw, 
                    target.llsq=src.llsq, 
                    target.load=src.load, 
                    target.load_cntr_ref_compnr=src.load_cntr_ref_compnr, 
                    target.load_ref_compnr=src.load_ref_compnr, 
                    target.manl=src.manl, 
                    target.manl_kw=src.manl_kw, 
                    target.mapr=src.mapr, 
                    target.mapr_kw=src.mapr_kw, 
                    target.minv=src.minv, 
                    target.minv_kw=src.minv_kw, 
                    target.motv=src.motv, 
                    target.motv_ref_compnr=src.motv_ref_compnr, 
                    target.ntwt=src.ntwt, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oshc=src.oshc, 
                    target.oshc_kw=src.oshc_kw, 
                    target.pclp=src.pclp, 
                    target.pclp_kw=src.pclp_kw, 
                    target.pcsp=src.pcsp, 
                    target.pcsp_kw=src.pcsp_kw, 
                    target.pdat=src.pdat, 
                    target.pddt=src.pddt, 
                    target.pfpr=src.pfpr, 
                    target.pfpr_kw=src.pfpr_kw, 
                    target.picm=src.picm, 
                    target.pitm=src.pitm, 
                    target.pitm_ref_compnr=src.pitm_ref_compnr, 
                    target.prdn=src.prdn, 
                    target.prdn_ref_compnr=src.prdn_ref_compnr, 
                    target.prdt=src.prdt, 
                    target.psdd=src.psdd, 
                    target.psdd_kw=src.psdd_kw, 
                    target.psde=src.psde, 
                    target.psde_kw=src.psde_kw, 
                    target.psts=src.psts, 
                    target.psts_kw=src.psts_kw, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qpac=src.qpac, 
                    target.refs=src.refs, 
                    target.risk=src.risk, 
                    target.rule=src.rule, 
                    target.rule_ref_compnr=src.rule_ref_compnr, 
                    target.runn=src.runn, 
                    target.saby=src.saby, 
                    target.saby_ref_compnr=src.saby_ref_compnr, 
                    target.sacc=src.sacc, 
                    target.sacc_kw=src.sacc_kw, 
                    target.sadt=src.sadt, 
                    target.sanl=src.sanl, 
                    target.sanl_kw=src.sanl_kw, 
                    target.sarq=src.sarq, 
                    target.sarq_kw=src.sarq_kw, 
                    target.scsh=src.scsh, 
                    target.scsh_kw=src.scsh_kw, 
                    target.sdsh=src.sdsh, 
                    target.sdsh_kw=src.sdsh_kw, 
                    target.sdtf=src.sdtf, 
                    target.sdtt=src.sdtt, 
                    target.sequencenumber=src.sequencenumber, 
                    target.seri=src.seri, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.sfco=src.sfco, 
                    target.sfcp=src.sfcp, 
                    target.sflp=src.sflp, 
                    target.sflp_kw=src.sflp_kw, 
                    target.sfsi=src.sfsi, 
                    target.sfsi_ref_compnr=src.sfsi_ref_compnr, 
                    target.sfty=src.sfty, 
                    target.sfty_kw=src.sfty_kw, 
                    target.shpm=src.shpm, 
                    target.shrf=src.shrf, 
                    target.shst=src.shst, 
                    target.shst_kw=src.shst_kw, 
                    target.shvc=src.shvc, 
                    target.shvc_kw=src.shvc_kw, 
                    target.shvd=src.shvd, 
                    target.shvl=src.shvl, 
                    target.shvl_kw=src.shvl_kw, 
                    target.shvo=src.shvo, 
                    target.shvo_kw=src.shvo_kw, 
                    target.slsh=src.slsh, 
                    target.slsh_kw=src.slsh_kw, 
                    target.sqdl=src.sqdl, 
                    target.sqdl_kw=src.sqdl_kw, 
                    target.sqdp=src.sqdp, 
                    target.sqdp_kw=src.sqdp_kw, 
                    target.srsh=src.srsh, 
                    target.srsh_kw=src.srsh_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stco=src.stco, 
                    target.stcp=src.stcp, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stty=src.stty, 
                    target.stty_kw=src.stty_kw, 
                    target.suba=src.suba, 
                    target.suba_kw=src.suba_kw, 
                    target.taxp=src.taxp, 
                    target.taxs=src.taxs, 
                    target.tcap=src.tcap, 
                    target.tcap_kw=src.tcap_kw, 
                    target.tccp=src.tccp, 
                    target.tccp_kw=src.tccp_kw, 
                    target.text=src.text, 
                    target.text_ref_compnr=src.text_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.trcd=src.trcd, 
                    target.trnr=src.trnr, 
                    target.ttyp=src.ttyp, 
                    target.username=src.username, 
                    target.volm=src.volm, 
                    target.wdep=src.wdep, 
                    target.wdth=src.wdth, 
                    target.wght=src.wght, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( aclr, aclr_kw, adin, bolp, bolp_kw, bptc, bptc_ref_compnr, carr, carr_ref_compnr, ccty, ccty_ref_compnr, cdat, cdec, cdec_ref_compnr, cdun, cdun_ref_compnr, cham, cntr, compnr, corn, cpro, crte, crte_ref_compnr, curr, curr_ref_compnr, cwun, cwun_ref_compnr, daby, daby_ref_compnr, dacc, dacc_kw, dadt, darq, darq_kw, delc, delc_ref_compnr, deleted, delp, delp_kw, depc, depc_ref_compnr, dlpt, dpth, eacu, eamt, erdt, exre, flsp, frsm, frsm_kw, fval, fxwt, fxwt_kw, hazm, hazm_kw, hght, hubc, hubc_kw, huid, huid_ref_compnr, ibpd, ibpd_kw, iedi, iedi_ref_compnr, incp, invd, invn, ispr, itbp, itbp_ref_compnr, koch, koch_kw, llsq, load, load_cntr_ref_compnr, load_ref_compnr, manl, manl_kw, mapr, mapr_kw, minv, minv_kw, motv, motv_ref_compnr, ntwt, ofbp, ofbp_ref_compnr, oshc, oshc_kw, pclp, pclp_kw, pcsp, pcsp_kw, pdat, pddt, pfpr, pfpr_kw, picm, pitm, pitm_ref_compnr, prdn, prdn_ref_compnr, prdt, psdd, psdd_kw, psde, psde_kw, psts, psts_kw, ptpa, ptpa_ref_compnr, qpac, refs, risk, rule, rule_ref_compnr, runn, saby, saby_ref_compnr, sacc, sacc_kw, sadt, sanl, sanl_kw, sarq, sarq_kw, scsh, scsh_kw, sdsh, sdsh_kw, sdtf, sdtt, sequencenumber, seri, sfad, sfad_ref_compnr, sfco, sfcp, sflp, sflp_kw, sfsi, sfsi_ref_compnr, sfty, sfty_kw, shpm, shrf, shst, shst_kw, shvc, shvc_kw, shvd, shvl, shvl_kw, shvo, shvo_kw, slsh, slsh_kw, sqdl, sqdl_kw, sqdp, sqdp_kw, srsh, srsh_kw, stad, stad_dlpt_ref_compnr, stad_ref_compnr, stat, stat_kw, stco, stcp, stsi, stsi_ref_compnr, stty, stty_kw, suba, suba_kw, taxp, taxs, tcap, tcap_kw, tccp, tccp_kw, text, text_ref_compnr, timestamp, trcd, trnr, ttyp, username, volm, wdep, wdth, wght, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.aclr, 
                    src.aclr_kw, 
                    src.adin, 
                    src.bolp, 
                    src.bolp_kw, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccty, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdun, 
                    src.cdun_ref_compnr, 
                    src.cham, 
                    src.cntr, 
                    src.compnr, 
                    src.corn, 
                    src.cpro, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.curr, 
                    src.curr_ref_compnr, 
                    src.cwun, 
                    src.cwun_ref_compnr, 
                    src.daby, 
                    src.daby_ref_compnr, 
                    src.dacc, 
                    src.dacc_kw, 
                    src.dadt, 
                    src.darq, 
                    src.darq_kw, 
                    src.delc, 
                    src.delc_ref_compnr, 
                    src.deleted, 
                    src.delp, 
                    src.delp_kw, 
                    src.depc, 
                    src.depc_ref_compnr, 
                    src.dlpt, 
                    src.dpth, 
                    src.eacu, 
                    src.eamt, 
                    src.erdt, 
                    src.exre, 
                    src.flsp, 
                    src.frsm, 
                    src.frsm_kw, 
                    src.fval, 
                    src.fxwt, 
                    src.fxwt_kw, 
                    src.hazm, 
                    src.hazm_kw, 
                    src.hght, 
                    src.hubc, 
                    src.hubc_kw, 
                    src.huid, 
                    src.huid_ref_compnr, 
                    src.ibpd, 
                    src.ibpd_kw, 
                    src.iedi, 
                    src.iedi_ref_compnr, 
                    src.incp, 
                    src.invd, 
                    src.invn, 
                    src.ispr, 
                    src.itbp, 
                    src.itbp_ref_compnr, 
                    src.koch, 
                    src.koch_kw, 
                    src.llsq, 
                    src.load, 
                    src.load_cntr_ref_compnr, 
                    src.load_ref_compnr, 
                    src.manl, 
                    src.manl_kw, 
                    src.mapr, 
                    src.mapr_kw, 
                    src.minv, 
                    src.minv_kw, 
                    src.motv, 
                    src.motv_ref_compnr, 
                    src.ntwt, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oshc, 
                    src.oshc_kw, 
                    src.pclp, 
                    src.pclp_kw, 
                    src.pcsp, 
                    src.pcsp_kw, 
                    src.pdat, 
                    src.pddt, 
                    src.pfpr, 
                    src.pfpr_kw, 
                    src.picm, 
                    src.pitm, 
                    src.pitm_ref_compnr, 
                    src.prdn, 
                    src.prdn_ref_compnr, 
                    src.prdt, 
                    src.psdd, 
                    src.psdd_kw, 
                    src.psde, 
                    src.psde_kw, 
                    src.psts, 
                    src.psts_kw, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qpac, 
                    src.refs, 
                    src.risk, 
                    src.rule, 
                    src.rule_ref_compnr, 
                    src.runn, 
                    src.saby, 
                    src.saby_ref_compnr, 
                    src.sacc, 
                    src.sacc_kw, 
                    src.sadt, 
                    src.sanl, 
                    src.sanl_kw, 
                    src.sarq, 
                    src.sarq_kw, 
                    src.scsh, 
                    src.scsh_kw, 
                    src.sdsh, 
                    src.sdsh_kw, 
                    src.sdtf, 
                    src.sdtt, 
                    src.sequencenumber, 
                    src.seri, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.sfco, 
                    src.sfcp, 
                    src.sflp, 
                    src.sflp_kw, 
                    src.sfsi, 
                    src.sfsi_ref_compnr, 
                    src.sfty, 
                    src.sfty_kw, 
                    src.shpm, 
                    src.shrf, 
                    src.shst, 
                    src.shst_kw, 
                    src.shvc, 
                    src.shvc_kw, 
                    src.shvd, 
                    src.shvl, 
                    src.shvl_kw, 
                    src.shvo, 
                    src.shvo_kw, 
                    src.slsh, 
                    src.slsh_kw, 
                    src.sqdl, 
                    src.sqdl_kw, 
                    src.sqdp, 
                    src.sqdp_kw, 
                    src.srsh, 
                    src.srsh_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stco, 
                    src.stcp, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stty, 
                    src.stty_kw, 
                    src.suba, 
                    src.suba_kw, 
                    src.taxp, 
                    src.taxs, 
                    src.tcap, 
                    src.tcap_kw, 
                    src.tccp, 
                    src.tccp_kw, 
                    src.text, 
                    src.text_ref_compnr, 
                    src.timestamp, 
                    src.trcd, 
                    src.trnr, 
                    src.ttyp, 
                    src.username, 
                    src.volm, 
                    src.wdep, 
                    src.wdth, 
                    src.wght,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;