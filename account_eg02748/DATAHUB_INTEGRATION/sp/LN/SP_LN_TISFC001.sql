create or replace procedure DATAHUB_INTEGRATION.SP_LN_TISFC001()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TISFC001_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TISFC001 as target using (SELECT * FROM (SELECT 
            strm.aapd, 
            strm.aapd_kw, 
            strm.adld, 
            strm.adld_actd, 
            strm.adld_deea, 
            strm.adld_dela, 
            strm.apdt, 
            strm.aprp, 
            strm.aprp_kw, 
            strm.asrp, 
            strm.asrp_kw, 
            strm.awtc, 
            strm.awtc_kw, 
            strm.bfep, 
            strm.bfep_kw, 
            strm.bfhr, 
            strm.bfhr_kw, 
            strm.bloc, 
            strm.bloc_kw, 
            strm.bmdl, 
            strm.bmrv, 
            strm.cada, 
            strm.cctt, 
            strm.cctt_kw, 
            strm.cdld, 
            strm.chel, 
            strm.chel_kw, 
            strm.clco, 
            strm.clco_fcmp, 
            strm.clco_ref_compnr, 
            strm.cldt, 
            strm.clot, 
            strm.clpd, 
            strm.clpd_kw, 
            strm.cmdt, 
            strm.cncd, 
            strm.compnr, 
            strm.covn, 
            strm.covn_kw, 
            strm.cpla, 
            strm.cpla_kw, 
            strm.cprj, 
            strm.cprj_ref_compnr, 
            strm.crpr_1, 
            strm.crpr_2, 
            strm.crpr_3, 
            strm.crpr_4, 
            strm.crpr_kw_1, 
            strm.crpr_kw_2, 
            strm.crpr_kw_3, 
            strm.crpr_kw_4, 
            strm.cutl, 
            strm.cutl_kw, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.defc, 
            strm.defc_kw, 
            strm.deleted, 
            strm.dstp, 
            strm.dstp_kw, 
            strm.efdt, 
            strm.fain, 
            strm.fain_kw, 
            strm.fres, 
            strm.fres_kw, 
            strm.grid, 
            strm.grid_ref_compnr, 
            strm.huid, 
            strm.huqt, 
            strm.insn, 
            strm.insn_kw, 
            strm.insp, 
            strm.insp_kw, 
            strm.irev, 
            strm.lbdv, 
            strm.lbid, 
            strm.lblo, 
            strm.lbnc, 
            strm.lbpb, 
            strm.lbpb_kw, 
            strm.lbpr, 
            strm.lbpr_kw, 
            strm.lbtp, 
            strm.lbtp_kw, 
            strm.matl, 
            strm.matl_kw, 
            strm.matn, 
            strm.matn_kw, 
            strm.mfre, 
            strm.mfre_kw, 
            strm.mitm, 
            strm.mitm_opro_rcmp, 
            strm.mitm_ref_compnr, 
            strm.mitm_site_ref_compnr, 
            strm.mmno, 
            strm.mmno_kw, 
            strm.mmpo, 
            strm.mmpo_kw, 
            strm.mocp, 
            strm.mocp_kw, 
            strm.odpr, 
            strm.odpr_kw, 
            strm.odpt, 
            strm.odpt_kw, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oprn, 
            strm.oprn_kw, 
            strm.opro, 
            strm.oprp, 
            strm.oprp_kw, 
            strm.osta, 
            strm.osta_kw, 
            strm.owns, 
            strm.owns_kw, 
            strm.pdno, 
            strm.pkdf, 
            strm.pldt, 
            strm.pldt_pltd, 
            strm.plgr, 
            strm.plid, 
            strm.plid_ref_compnr, 
            strm.poas, 
            strm.prcd, 
            strm.prdt, 
            strm.prlb, 
            strm.prlb_kw, 
            strm.qbfd, 
            strm.qbfd_buar, 
            strm.qbfd_buln, 
            strm.qbfd_bupc, 
            strm.qbfd_butm, 
            strm.qbfd_buvl, 
            strm.qbfd_buwg, 
            strm.qdlv, 
            strm.qdlv_buar, 
            strm.qdlv_buln, 
            strm.qdlv_bupc, 
            strm.qdlv_butm, 
            strm.qdlv_buvl, 
            strm.qdlv_buwg, 
            strm.qntl, 
            strm.qntl_buar, 
            strm.qntl_buln, 
            strm.qntl_bupc, 
            strm.qntl_butm, 
            strm.qntl_buvl, 
            strm.qntl_buwg, 
            strm.qoor, 
            strm.qqar, 
            strm.qqar_buar, 
            strm.qqar_buln, 
            strm.qqar_bupc, 
            strm.qqar_butm, 
            strm.qqar_buvl, 
            strm.qqar_buwg, 
            strm.qrdr, 
            strm.qrdr_buar, 
            strm.qrdr_buln, 
            strm.qrdr_bupc, 
            strm.qrdr_butm, 
            strm.qrdr_buvl, 
            strm.qrdr_buwg, 
            strm.qrjc, 
            strm.qrjc_buar, 
            strm.qrjc_buln, 
            strm.qrjc_bupc, 
            strm.qrjc_butm, 
            strm.qrjc_buvl, 
            strm.qrjc_buwg, 
            strm.qtbf, 
            strm.qtbf_buar, 
            strm.qtbf_buln, 
            strm.qtbf_bupc, 
            strm.qtbf_butm, 
            strm.qtbf_buvl, 
            strm.qtbf_buwg, 
            strm.qtdl, 
            strm.qtdl_buar, 
            strm.qtdl_buln, 
            strm.qtdl_bupc, 
            strm.qtdl_butm, 
            strm.qtdl_buvl, 
            strm.qtdl_buwg, 
            strm.qtor, 
            strm.qtor_buar, 
            strm.qtor_buln, 
            strm.qtor_bupc, 
            strm.qtor_butm, 
            strm.qtor_buvl, 
            strm.qtor_buwg, 
            strm.rdld, 
            strm.recn, 
            strm.recn_kw, 
            strm.reco, 
            strm.reco_ref_compnr, 
            strm.revi, 
            strm.rgrp, 
            strm.rgrp_ref_compnr, 
            strm.rorv, 
            strm.rouc, 
            strm.roul, 
            strm.roul_kw, 
            strm.rswc, 
            strm.rswc_kw, 
            strm.rwko, 
            strm.rwko_kw, 
            strm.rwtp, 
            strm.rwtp_kw, 
            strm.sawl, 
            strm.sawl_kw, 
            strm.schd, 
            strm.schd_kw, 
            strm.sequencenumber, 
            strm.sfpl, 
            strm.sfpl_ref_compnr, 
            strm.shsp, 
            strm.shsp_kw, 
            strm.site, 
            strm.site_plgr_ref_compnr, 
            strm.site_ref_compnr, 
            strm.smfs, 
            strm.smfs_kw, 
            strm.spcn, 
            strm.srnl, 
            strm.srnl_kw, 
            strm.subc, 
            strm.subc_kw, 
            strm.subn, 
            strm.subn_kw, 
            strm.timestamp, 
            strm.trcp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.vers, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.pdno ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TISFC001 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.pdno=src.pdno) OR (target.pdno IS NULL AND src.pdno IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.aapd=src.aapd, 
                    target.aapd_kw=src.aapd_kw, 
                    target.adld=src.adld, 
                    target.adld_actd=src.adld_actd, 
                    target.adld_deea=src.adld_deea, 
                    target.adld_dela=src.adld_dela, 
                    target.apdt=src.apdt, 
                    target.aprp=src.aprp, 
                    target.aprp_kw=src.aprp_kw, 
                    target.asrp=src.asrp, 
                    target.asrp_kw=src.asrp_kw, 
                    target.awtc=src.awtc, 
                    target.awtc_kw=src.awtc_kw, 
                    target.bfep=src.bfep, 
                    target.bfep_kw=src.bfep_kw, 
                    target.bfhr=src.bfhr, 
                    target.bfhr_kw=src.bfhr_kw, 
                    target.bloc=src.bloc, 
                    target.bloc_kw=src.bloc_kw, 
                    target.bmdl=src.bmdl, 
                    target.bmrv=src.bmrv, 
                    target.cada=src.cada, 
                    target.cctt=src.cctt, 
                    target.cctt_kw=src.cctt_kw, 
                    target.cdld=src.cdld, 
                    target.chel=src.chel, 
                    target.chel_kw=src.chel_kw, 
                    target.clco=src.clco, 
                    target.clco_fcmp=src.clco_fcmp, 
                    target.clco_ref_compnr=src.clco_ref_compnr, 
                    target.cldt=src.cldt, 
                    target.clot=src.clot, 
                    target.clpd=src.clpd, 
                    target.clpd_kw=src.clpd_kw, 
                    target.cmdt=src.cmdt, 
                    target.cncd=src.cncd, 
                    target.compnr=src.compnr, 
                    target.covn=src.covn, 
                    target.covn_kw=src.covn_kw, 
                    target.cpla=src.cpla, 
                    target.cpla_kw=src.cpla_kw, 
                    target.cprj=src.cprj, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.crpr_1=src.crpr_1, 
                    target.crpr_2=src.crpr_2, 
                    target.crpr_3=src.crpr_3, 
                    target.crpr_4=src.crpr_4, 
                    target.crpr_kw_1=src.crpr_kw_1, 
                    target.crpr_kw_2=src.crpr_kw_2, 
                    target.crpr_kw_3=src.crpr_kw_3, 
                    target.crpr_kw_4=src.crpr_kw_4, 
                    target.cutl=src.cutl, 
                    target.cutl_kw=src.cutl_kw, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.defc=src.defc, 
                    target.defc_kw=src.defc_kw, 
                    target.deleted=src.deleted, 
                    target.dstp=src.dstp, 
                    target.dstp_kw=src.dstp_kw, 
                    target.efdt=src.efdt, 
                    target.fain=src.fain, 
                    target.fain_kw=src.fain_kw, 
                    target.fres=src.fres, 
                    target.fres_kw=src.fres_kw, 
                    target.grid=src.grid, 
                    target.grid_ref_compnr=src.grid_ref_compnr, 
                    target.huid=src.huid, 
                    target.huqt=src.huqt, 
                    target.insn=src.insn, 
                    target.insn_kw=src.insn_kw, 
                    target.insp=src.insp, 
                    target.insp_kw=src.insp_kw, 
                    target.irev=src.irev, 
                    target.lbdv=src.lbdv, 
                    target.lbid=src.lbid, 
                    target.lblo=src.lblo, 
                    target.lbnc=src.lbnc, 
                    target.lbpb=src.lbpb, 
                    target.lbpb_kw=src.lbpb_kw, 
                    target.lbpr=src.lbpr, 
                    target.lbpr_kw=src.lbpr_kw, 
                    target.lbtp=src.lbtp, 
                    target.lbtp_kw=src.lbtp_kw, 
                    target.matl=src.matl, 
                    target.matl_kw=src.matl_kw, 
                    target.matn=src.matn, 
                    target.matn_kw=src.matn_kw, 
                    target.mfre=src.mfre, 
                    target.mfre_kw=src.mfre_kw, 
                    target.mitm=src.mitm, 
                    target.mitm_opro_rcmp=src.mitm_opro_rcmp, 
                    target.mitm_ref_compnr=src.mitm_ref_compnr, 
                    target.mitm_site_ref_compnr=src.mitm_site_ref_compnr, 
                    target.mmno=src.mmno, 
                    target.mmno_kw=src.mmno_kw, 
                    target.mmpo=src.mmpo, 
                    target.mmpo_kw=src.mmpo_kw, 
                    target.mocp=src.mocp, 
                    target.mocp_kw=src.mocp_kw, 
                    target.odpr=src.odpr, 
                    target.odpr_kw=src.odpr_kw, 
                    target.odpt=src.odpt, 
                    target.odpt_kw=src.odpt_kw, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oprn=src.oprn, 
                    target.oprn_kw=src.oprn_kw, 
                    target.opro=src.opro, 
                    target.oprp=src.oprp, 
                    target.oprp_kw=src.oprp_kw, 
                    target.osta=src.osta, 
                    target.osta_kw=src.osta_kw, 
                    target.owns=src.owns, 
                    target.owns_kw=src.owns_kw, 
                    target.pdno=src.pdno, 
                    target.pkdf=src.pkdf, 
                    target.pldt=src.pldt, 
                    target.pldt_pltd=src.pldt_pltd, 
                    target.plgr=src.plgr, 
                    target.plid=src.plid, 
                    target.plid_ref_compnr=src.plid_ref_compnr, 
                    target.poas=src.poas, 
                    target.prcd=src.prcd, 
                    target.prdt=src.prdt, 
                    target.prlb=src.prlb, 
                    target.prlb_kw=src.prlb_kw, 
                    target.qbfd=src.qbfd, 
                    target.qbfd_buar=src.qbfd_buar, 
                    target.qbfd_buln=src.qbfd_buln, 
                    target.qbfd_bupc=src.qbfd_bupc, 
                    target.qbfd_butm=src.qbfd_butm, 
                    target.qbfd_buvl=src.qbfd_buvl, 
                    target.qbfd_buwg=src.qbfd_buwg, 
                    target.qdlv=src.qdlv, 
                    target.qdlv_buar=src.qdlv_buar, 
                    target.qdlv_buln=src.qdlv_buln, 
                    target.qdlv_bupc=src.qdlv_bupc, 
                    target.qdlv_butm=src.qdlv_butm, 
                    target.qdlv_buvl=src.qdlv_buvl, 
                    target.qdlv_buwg=src.qdlv_buwg, 
                    target.qntl=src.qntl, 
                    target.qntl_buar=src.qntl_buar, 
                    target.qntl_buln=src.qntl_buln, 
                    target.qntl_bupc=src.qntl_bupc, 
                    target.qntl_butm=src.qntl_butm, 
                    target.qntl_buvl=src.qntl_buvl, 
                    target.qntl_buwg=src.qntl_buwg, 
                    target.qoor=src.qoor, 
                    target.qqar=src.qqar, 
                    target.qqar_buar=src.qqar_buar, 
                    target.qqar_buln=src.qqar_buln, 
                    target.qqar_bupc=src.qqar_bupc, 
                    target.qqar_butm=src.qqar_butm, 
                    target.qqar_buvl=src.qqar_buvl, 
                    target.qqar_buwg=src.qqar_buwg, 
                    target.qrdr=src.qrdr, 
                    target.qrdr_buar=src.qrdr_buar, 
                    target.qrdr_buln=src.qrdr_buln, 
                    target.qrdr_bupc=src.qrdr_bupc, 
                    target.qrdr_butm=src.qrdr_butm, 
                    target.qrdr_buvl=src.qrdr_buvl, 
                    target.qrdr_buwg=src.qrdr_buwg, 
                    target.qrjc=src.qrjc, 
                    target.qrjc_buar=src.qrjc_buar, 
                    target.qrjc_buln=src.qrjc_buln, 
                    target.qrjc_bupc=src.qrjc_bupc, 
                    target.qrjc_butm=src.qrjc_butm, 
                    target.qrjc_buvl=src.qrjc_buvl, 
                    target.qrjc_buwg=src.qrjc_buwg, 
                    target.qtbf=src.qtbf, 
                    target.qtbf_buar=src.qtbf_buar, 
                    target.qtbf_buln=src.qtbf_buln, 
                    target.qtbf_bupc=src.qtbf_bupc, 
                    target.qtbf_butm=src.qtbf_butm, 
                    target.qtbf_buvl=src.qtbf_buvl, 
                    target.qtbf_buwg=src.qtbf_buwg, 
                    target.qtdl=src.qtdl, 
                    target.qtdl_buar=src.qtdl_buar, 
                    target.qtdl_buln=src.qtdl_buln, 
                    target.qtdl_bupc=src.qtdl_bupc, 
                    target.qtdl_butm=src.qtdl_butm, 
                    target.qtdl_buvl=src.qtdl_buvl, 
                    target.qtdl_buwg=src.qtdl_buwg, 
                    target.qtor=src.qtor, 
                    target.qtor_buar=src.qtor_buar, 
                    target.qtor_buln=src.qtor_buln, 
                    target.qtor_bupc=src.qtor_bupc, 
                    target.qtor_butm=src.qtor_butm, 
                    target.qtor_buvl=src.qtor_buvl, 
                    target.qtor_buwg=src.qtor_buwg, 
                    target.rdld=src.rdld, 
                    target.recn=src.recn, 
                    target.recn_kw=src.recn_kw, 
                    target.reco=src.reco, 
                    target.reco_ref_compnr=src.reco_ref_compnr, 
                    target.revi=src.revi, 
                    target.rgrp=src.rgrp, 
                    target.rgrp_ref_compnr=src.rgrp_ref_compnr, 
                    target.rorv=src.rorv, 
                    target.rouc=src.rouc, 
                    target.roul=src.roul, 
                    target.roul_kw=src.roul_kw, 
                    target.rswc=src.rswc, 
                    target.rswc_kw=src.rswc_kw, 
                    target.rwko=src.rwko, 
                    target.rwko_kw=src.rwko_kw, 
                    target.rwtp=src.rwtp, 
                    target.rwtp_kw=src.rwtp_kw, 
                    target.sawl=src.sawl, 
                    target.sawl_kw=src.sawl_kw, 
                    target.schd=src.schd, 
                    target.schd_kw=src.schd_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfpl=src.sfpl, 
                    target.sfpl_ref_compnr=src.sfpl_ref_compnr, 
                    target.shsp=src.shsp, 
                    target.shsp_kw=src.shsp_kw, 
                    target.site=src.site, 
                    target.site_plgr_ref_compnr=src.site_plgr_ref_compnr, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.smfs=src.smfs, 
                    target.smfs_kw=src.smfs_kw, 
                    target.spcn=src.spcn, 
                    target.srnl=src.srnl, 
                    target.srnl_kw=src.srnl_kw, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.subn=src.subn, 
                    target.subn_kw=src.subn_kw, 
                    target.timestamp=src.timestamp, 
                    target.trcp=src.trcp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.vers=src.vers, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    aapd, 
                    aapd_kw, 
                    adld, 
                    adld_actd, 
                    adld_deea, 
                    adld_dela, 
                    apdt, 
                    aprp, 
                    aprp_kw, 
                    asrp, 
                    asrp_kw, 
                    awtc, 
                    awtc_kw, 
                    bfep, 
                    bfep_kw, 
                    bfhr, 
                    bfhr_kw, 
                    bloc, 
                    bloc_kw, 
                    bmdl, 
                    bmrv, 
                    cada, 
                    cctt, 
                    cctt_kw, 
                    cdld, 
                    chel, 
                    chel_kw, 
                    clco, 
                    clco_fcmp, 
                    clco_ref_compnr, 
                    cldt, 
                    clot, 
                    clpd, 
                    clpd_kw, 
                    cmdt, 
                    cncd, 
                    compnr, 
                    covn, 
                    covn_kw, 
                    cpla, 
                    cpla_kw, 
                    cprj, 
                    cprj_ref_compnr, 
                    crpr_1, 
                    crpr_2, 
                    crpr_3, 
                    crpr_4, 
                    crpr_kw_1, 
                    crpr_kw_2, 
                    crpr_kw_3, 
                    crpr_kw_4, 
                    cutl, 
                    cutl_kw, 
                    cwar, 
                    cwar_ref_compnr, 
                    defc, 
                    defc_kw, 
                    deleted, 
                    dstp, 
                    dstp_kw, 
                    efdt, 
                    fain, 
                    fain_kw, 
                    fres, 
                    fres_kw, 
                    grid, 
                    grid_ref_compnr, 
                    huid, 
                    huqt, 
                    insn, 
                    insn_kw, 
                    insp, 
                    insp_kw, 
                    irev, 
                    lbdv, 
                    lbid, 
                    lblo, 
                    lbnc, 
                    lbpb, 
                    lbpb_kw, 
                    lbpr, 
                    lbpr_kw, 
                    lbtp, 
                    lbtp_kw, 
                    matl, 
                    matl_kw, 
                    matn, 
                    matn_kw, 
                    mfre, 
                    mfre_kw, 
                    mitm, 
                    mitm_opro_rcmp, 
                    mitm_ref_compnr, 
                    mitm_site_ref_compnr, 
                    mmno, 
                    mmno_kw, 
                    mmpo, 
                    mmpo_kw, 
                    mocp, 
                    mocp_kw, 
                    odpr, 
                    odpr_kw, 
                    odpt, 
                    odpt_kw, 
                    ofbp, 
                    ofbp_ref_compnr, 
                    oprn, 
                    oprn_kw, 
                    opro, 
                    oprp, 
                    oprp_kw, 
                    osta, 
                    osta_kw, 
                    owns, 
                    owns_kw, 
                    pdno, 
                    pkdf, 
                    pldt, 
                    pldt_pltd, 
                    plgr, 
                    plid, 
                    plid_ref_compnr, 
                    poas, 
                    prcd, 
                    prdt, 
                    prlb, 
                    prlb_kw, 
                    qbfd, 
                    qbfd_buar, 
                    qbfd_buln, 
                    qbfd_bupc, 
                    qbfd_butm, 
                    qbfd_buvl, 
                    qbfd_buwg, 
                    qdlv, 
                    qdlv_buar, 
                    qdlv_buln, 
                    qdlv_bupc, 
                    qdlv_butm, 
                    qdlv_buvl, 
                    qdlv_buwg, 
                    qntl, 
                    qntl_buar, 
                    qntl_buln, 
                    qntl_bupc, 
                    qntl_butm, 
                    qntl_buvl, 
                    qntl_buwg, 
                    qoor, 
                    qqar, 
                    qqar_buar, 
                    qqar_buln, 
                    qqar_bupc, 
                    qqar_butm, 
                    qqar_buvl, 
                    qqar_buwg, 
                    qrdr, 
                    qrdr_buar, 
                    qrdr_buln, 
                    qrdr_bupc, 
                    qrdr_butm, 
                    qrdr_buvl, 
                    qrdr_buwg, 
                    qrjc, 
                    qrjc_buar, 
                    qrjc_buln, 
                    qrjc_bupc, 
                    qrjc_butm, 
                    qrjc_buvl, 
                    qrjc_buwg, 
                    qtbf, 
                    qtbf_buar, 
                    qtbf_buln, 
                    qtbf_bupc, 
                    qtbf_butm, 
                    qtbf_buvl, 
                    qtbf_buwg, 
                    qtdl, 
                    qtdl_buar, 
                    qtdl_buln, 
                    qtdl_bupc, 
                    qtdl_butm, 
                    qtdl_buvl, 
                    qtdl_buwg, 
                    qtor, 
                    qtor_buar, 
                    qtor_buln, 
                    qtor_bupc, 
                    qtor_butm, 
                    qtor_buvl, 
                    qtor_buwg, 
                    rdld, 
                    recn, 
                    recn_kw, 
                    reco, 
                    reco_ref_compnr, 
                    revi, 
                    rgrp, 
                    rgrp_ref_compnr, 
                    rorv, 
                    rouc, 
                    roul, 
                    roul_kw, 
                    rswc, 
                    rswc_kw, 
                    rwko, 
                    rwko_kw, 
                    rwtp, 
                    rwtp_kw, 
                    sawl, 
                    sawl_kw, 
                    schd, 
                    schd_kw, 
                    sequencenumber, 
                    sfpl, 
                    sfpl_ref_compnr, 
                    shsp, 
                    shsp_kw, 
                    site, 
                    site_plgr_ref_compnr, 
                    site_ref_compnr, 
                    smfs, 
                    smfs_kw, 
                    spcn, 
                    srnl, 
                    srnl_kw, 
                    subc, 
                    subc_kw, 
                    subn, 
                    subn_kw, 
                    timestamp, 
                    trcp, 
                    txta, 
                    txta_ref_compnr, 
                    username, 
                    vers, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.aapd, 
                    src.aapd_kw, 
                    src.adld, 
                    src.adld_actd, 
                    src.adld_deea, 
                    src.adld_dela, 
                    src.apdt, 
                    src.aprp, 
                    src.aprp_kw, 
                    src.asrp, 
                    src.asrp_kw, 
                    src.awtc, 
                    src.awtc_kw, 
                    src.bfep, 
                    src.bfep_kw, 
                    src.bfhr, 
                    src.bfhr_kw, 
                    src.bloc, 
                    src.bloc_kw, 
                    src.bmdl, 
                    src.bmrv, 
                    src.cada, 
                    src.cctt, 
                    src.cctt_kw, 
                    src.cdld, 
                    src.chel, 
                    src.chel_kw, 
                    src.clco, 
                    src.clco_fcmp, 
                    src.clco_ref_compnr, 
                    src.cldt, 
                    src.clot, 
                    src.clpd, 
                    src.clpd_kw, 
                    src.cmdt, 
                    src.cncd, 
                    src.compnr, 
                    src.covn, 
                    src.covn_kw, 
                    src.cpla, 
                    src.cpla_kw, 
                    src.cprj, 
                    src.cprj_ref_compnr, 
                    src.crpr_1, 
                    src.crpr_2, 
                    src.crpr_3, 
                    src.crpr_4, 
                    src.crpr_kw_1, 
                    src.crpr_kw_2, 
                    src.crpr_kw_3, 
                    src.crpr_kw_4, 
                    src.cutl, 
                    src.cutl_kw, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.defc, 
                    src.defc_kw, 
                    src.deleted, 
                    src.dstp, 
                    src.dstp_kw, 
                    src.efdt, 
                    src.fain, 
                    src.fain_kw, 
                    src.fres, 
                    src.fres_kw, 
                    src.grid, 
                    src.grid_ref_compnr, 
                    src.huid, 
                    src.huqt, 
                    src.insn, 
                    src.insn_kw, 
                    src.insp, 
                    src.insp_kw, 
                    src.irev, 
                    src.lbdv, 
                    src.lbid, 
                    src.lblo, 
                    src.lbnc, 
                    src.lbpb, 
                    src.lbpb_kw, 
                    src.lbpr, 
                    src.lbpr_kw, 
                    src.lbtp, 
                    src.lbtp_kw, 
                    src.matl, 
                    src.matl_kw, 
                    src.matn, 
                    src.matn_kw, 
                    src.mfre, 
                    src.mfre_kw, 
                    src.mitm, 
                    src.mitm_opro_rcmp, 
                    src.mitm_ref_compnr, 
                    src.mitm_site_ref_compnr, 
                    src.mmno, 
                    src.mmno_kw, 
                    src.mmpo, 
                    src.mmpo_kw, 
                    src.mocp, 
                    src.mocp_kw, 
                    src.odpr, 
                    src.odpr_kw, 
                    src.odpt, 
                    src.odpt_kw, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oprn, 
                    src.oprn_kw, 
                    src.opro, 
                    src.oprp, 
                    src.oprp_kw, 
                    src.osta, 
                    src.osta_kw, 
                    src.owns, 
                    src.owns_kw, 
                    src.pdno, 
                    src.pkdf, 
                    src.pldt, 
                    src.pldt_pltd, 
                    src.plgr, 
                    src.plid, 
                    src.plid_ref_compnr, 
                    src.poas, 
                    src.prcd, 
                    src.prdt, 
                    src.prlb, 
                    src.prlb_kw, 
                    src.qbfd, 
                    src.qbfd_buar, 
                    src.qbfd_buln, 
                    src.qbfd_bupc, 
                    src.qbfd_butm, 
                    src.qbfd_buvl, 
                    src.qbfd_buwg, 
                    src.qdlv, 
                    src.qdlv_buar, 
                    src.qdlv_buln, 
                    src.qdlv_bupc, 
                    src.qdlv_butm, 
                    src.qdlv_buvl, 
                    src.qdlv_buwg, 
                    src.qntl, 
                    src.qntl_buar, 
                    src.qntl_buln, 
                    src.qntl_bupc, 
                    src.qntl_butm, 
                    src.qntl_buvl, 
                    src.qntl_buwg, 
                    src.qoor, 
                    src.qqar, 
                    src.qqar_buar, 
                    src.qqar_buln, 
                    src.qqar_bupc, 
                    src.qqar_butm, 
                    src.qqar_buvl, 
                    src.qqar_buwg, 
                    src.qrdr, 
                    src.qrdr_buar, 
                    src.qrdr_buln, 
                    src.qrdr_bupc, 
                    src.qrdr_butm, 
                    src.qrdr_buvl, 
                    src.qrdr_buwg, 
                    src.qrjc, 
                    src.qrjc_buar, 
                    src.qrjc_buln, 
                    src.qrjc_bupc, 
                    src.qrjc_butm, 
                    src.qrjc_buvl, 
                    src.qrjc_buwg, 
                    src.qtbf, 
                    src.qtbf_buar, 
                    src.qtbf_buln, 
                    src.qtbf_bupc, 
                    src.qtbf_butm, 
                    src.qtbf_buvl, 
                    src.qtbf_buwg, 
                    src.qtdl, 
                    src.qtdl_buar, 
                    src.qtdl_buln, 
                    src.qtdl_bupc, 
                    src.qtdl_butm, 
                    src.qtdl_buvl, 
                    src.qtdl_buwg, 
                    src.qtor, 
                    src.qtor_buar, 
                    src.qtor_buln, 
                    src.qtor_bupc, 
                    src.qtor_butm, 
                    src.qtor_buvl, 
                    src.qtor_buwg, 
                    src.rdld, 
                    src.recn, 
                    src.recn_kw, 
                    src.reco, 
                    src.reco_ref_compnr, 
                    src.revi, 
                    src.rgrp, 
                    src.rgrp_ref_compnr, 
                    src.rorv, 
                    src.rouc, 
                    src.roul, 
                    src.roul_kw, 
                    src.rswc, 
                    src.rswc_kw, 
                    src.rwko, 
                    src.rwko_kw, 
                    src.rwtp, 
                    src.rwtp_kw, 
                    src.sawl, 
                    src.sawl_kw, 
                    src.schd, 
                    src.schd_kw, 
                    src.sequencenumber, 
                    src.sfpl, 
                    src.sfpl_ref_compnr, 
                    src.shsp, 
                    src.shsp_kw, 
                    src.site, 
                    src.site_plgr_ref_compnr, 
                    src.site_ref_compnr, 
                    src.smfs, 
                    src.smfs_kw, 
                    src.spcn, 
                    src.srnl, 
                    src.srnl_kw, 
                    src.subc, 
                    src.subc_kw, 
                    src.subn, 
                    src.subn_kw, 
                    src.timestamp, 
                    src.trcp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.vers,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TISFC001_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.aapd, 
            strm.aapd_kw, 
            strm.adld, 
            strm.adld_actd, 
            strm.adld_deea, 
            strm.adld_dela, 
            strm.apdt, 
            strm.aprp, 
            strm.aprp_kw, 
            strm.asrp, 
            strm.asrp_kw, 
            strm.awtc, 
            strm.awtc_kw, 
            strm.bfep, 
            strm.bfep_kw, 
            strm.bfhr, 
            strm.bfhr_kw, 
            strm.bloc, 
            strm.bloc_kw, 
            strm.bmdl, 
            strm.bmrv, 
            strm.cada, 
            strm.cctt, 
            strm.cctt_kw, 
            strm.cdld, 
            strm.chel, 
            strm.chel_kw, 
            strm.clco, 
            strm.clco_fcmp, 
            strm.clco_ref_compnr, 
            strm.cldt, 
            strm.clot, 
            strm.clpd, 
            strm.clpd_kw, 
            strm.cmdt, 
            strm.cncd, 
            strm.compnr, 
            strm.covn, 
            strm.covn_kw, 
            strm.cpla, 
            strm.cpla_kw, 
            strm.cprj, 
            strm.cprj_ref_compnr, 
            strm.crpr_1, 
            strm.crpr_2, 
            strm.crpr_3, 
            strm.crpr_4, 
            strm.crpr_kw_1, 
            strm.crpr_kw_2, 
            strm.crpr_kw_3, 
            strm.crpr_kw_4, 
            strm.cutl, 
            strm.cutl_kw, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.defc, 
            strm.defc_kw, 
            strm.deleted, 
            strm.dstp, 
            strm.dstp_kw, 
            strm.efdt, 
            strm.fain, 
            strm.fain_kw, 
            strm.fres, 
            strm.fres_kw, 
            strm.grid, 
            strm.grid_ref_compnr, 
            strm.huid, 
            strm.huqt, 
            strm.insn, 
            strm.insn_kw, 
            strm.insp, 
            strm.insp_kw, 
            strm.irev, 
            strm.lbdv, 
            strm.lbid, 
            strm.lblo, 
            strm.lbnc, 
            strm.lbpb, 
            strm.lbpb_kw, 
            strm.lbpr, 
            strm.lbpr_kw, 
            strm.lbtp, 
            strm.lbtp_kw, 
            strm.matl, 
            strm.matl_kw, 
            strm.matn, 
            strm.matn_kw, 
            strm.mfre, 
            strm.mfre_kw, 
            strm.mitm, 
            strm.mitm_opro_rcmp, 
            strm.mitm_ref_compnr, 
            strm.mitm_site_ref_compnr, 
            strm.mmno, 
            strm.mmno_kw, 
            strm.mmpo, 
            strm.mmpo_kw, 
            strm.mocp, 
            strm.mocp_kw, 
            strm.odpr, 
            strm.odpr_kw, 
            strm.odpt, 
            strm.odpt_kw, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oprn, 
            strm.oprn_kw, 
            strm.opro, 
            strm.oprp, 
            strm.oprp_kw, 
            strm.osta, 
            strm.osta_kw, 
            strm.owns, 
            strm.owns_kw, 
            strm.pdno, 
            strm.pkdf, 
            strm.pldt, 
            strm.pldt_pltd, 
            strm.plgr, 
            strm.plid, 
            strm.plid_ref_compnr, 
            strm.poas, 
            strm.prcd, 
            strm.prdt, 
            strm.prlb, 
            strm.prlb_kw, 
            strm.qbfd, 
            strm.qbfd_buar, 
            strm.qbfd_buln, 
            strm.qbfd_bupc, 
            strm.qbfd_butm, 
            strm.qbfd_buvl, 
            strm.qbfd_buwg, 
            strm.qdlv, 
            strm.qdlv_buar, 
            strm.qdlv_buln, 
            strm.qdlv_bupc, 
            strm.qdlv_butm, 
            strm.qdlv_buvl, 
            strm.qdlv_buwg, 
            strm.qntl, 
            strm.qntl_buar, 
            strm.qntl_buln, 
            strm.qntl_bupc, 
            strm.qntl_butm, 
            strm.qntl_buvl, 
            strm.qntl_buwg, 
            strm.qoor, 
            strm.qqar, 
            strm.qqar_buar, 
            strm.qqar_buln, 
            strm.qqar_bupc, 
            strm.qqar_butm, 
            strm.qqar_buvl, 
            strm.qqar_buwg, 
            strm.qrdr, 
            strm.qrdr_buar, 
            strm.qrdr_buln, 
            strm.qrdr_bupc, 
            strm.qrdr_butm, 
            strm.qrdr_buvl, 
            strm.qrdr_buwg, 
            strm.qrjc, 
            strm.qrjc_buar, 
            strm.qrjc_buln, 
            strm.qrjc_bupc, 
            strm.qrjc_butm, 
            strm.qrjc_buvl, 
            strm.qrjc_buwg, 
            strm.qtbf, 
            strm.qtbf_buar, 
            strm.qtbf_buln, 
            strm.qtbf_bupc, 
            strm.qtbf_butm, 
            strm.qtbf_buvl, 
            strm.qtbf_buwg, 
            strm.qtdl, 
            strm.qtdl_buar, 
            strm.qtdl_buln, 
            strm.qtdl_bupc, 
            strm.qtdl_butm, 
            strm.qtdl_buvl, 
            strm.qtdl_buwg, 
            strm.qtor, 
            strm.qtor_buar, 
            strm.qtor_buln, 
            strm.qtor_bupc, 
            strm.qtor_butm, 
            strm.qtor_buvl, 
            strm.qtor_buwg, 
            strm.rdld, 
            strm.recn, 
            strm.recn_kw, 
            strm.reco, 
            strm.reco_ref_compnr, 
            strm.revi, 
            strm.rgrp, 
            strm.rgrp_ref_compnr, 
            strm.rorv, 
            strm.rouc, 
            strm.roul, 
            strm.roul_kw, 
            strm.rswc, 
            strm.rswc_kw, 
            strm.rwko, 
            strm.rwko_kw, 
            strm.rwtp, 
            strm.rwtp_kw, 
            strm.sawl, 
            strm.sawl_kw, 
            strm.schd, 
            strm.schd_kw, 
            strm.sequencenumber, 
            strm.sfpl, 
            strm.sfpl_ref_compnr, 
            strm.shsp, 
            strm.shsp_kw, 
            strm.site, 
            strm.site_plgr_ref_compnr, 
            strm.site_ref_compnr, 
            strm.smfs, 
            strm.smfs_kw, 
            strm.spcn, 
            strm.srnl, 
            strm.srnl_kw, 
            strm.subc, 
            strm.subc_kw, 
            strm.subn, 
            strm.subn_kw, 
            strm.timestamp, 
            strm.trcp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.vers, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.pdno ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TISFC001 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.pdno=src.pdno) OR (target.pdno IS NULL AND src.pdno IS NULL)) 
                when matched then update set
                    target.aapd=src.aapd, 
                    target.aapd_kw=src.aapd_kw, 
                    target.adld=src.adld, 
                    target.adld_actd=src.adld_actd, 
                    target.adld_deea=src.adld_deea, 
                    target.adld_dela=src.adld_dela, 
                    target.apdt=src.apdt, 
                    target.aprp=src.aprp, 
                    target.aprp_kw=src.aprp_kw, 
                    target.asrp=src.asrp, 
                    target.asrp_kw=src.asrp_kw, 
                    target.awtc=src.awtc, 
                    target.awtc_kw=src.awtc_kw, 
                    target.bfep=src.bfep, 
                    target.bfep_kw=src.bfep_kw, 
                    target.bfhr=src.bfhr, 
                    target.bfhr_kw=src.bfhr_kw, 
                    target.bloc=src.bloc, 
                    target.bloc_kw=src.bloc_kw, 
                    target.bmdl=src.bmdl, 
                    target.bmrv=src.bmrv, 
                    target.cada=src.cada, 
                    target.cctt=src.cctt, 
                    target.cctt_kw=src.cctt_kw, 
                    target.cdld=src.cdld, 
                    target.chel=src.chel, 
                    target.chel_kw=src.chel_kw, 
                    target.clco=src.clco, 
                    target.clco_fcmp=src.clco_fcmp, 
                    target.clco_ref_compnr=src.clco_ref_compnr, 
                    target.cldt=src.cldt, 
                    target.clot=src.clot, 
                    target.clpd=src.clpd, 
                    target.clpd_kw=src.clpd_kw, 
                    target.cmdt=src.cmdt, 
                    target.cncd=src.cncd, 
                    target.compnr=src.compnr, 
                    target.covn=src.covn, 
                    target.covn_kw=src.covn_kw, 
                    target.cpla=src.cpla, 
                    target.cpla_kw=src.cpla_kw, 
                    target.cprj=src.cprj, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.crpr_1=src.crpr_1, 
                    target.crpr_2=src.crpr_2, 
                    target.crpr_3=src.crpr_3, 
                    target.crpr_4=src.crpr_4, 
                    target.crpr_kw_1=src.crpr_kw_1, 
                    target.crpr_kw_2=src.crpr_kw_2, 
                    target.crpr_kw_3=src.crpr_kw_3, 
                    target.crpr_kw_4=src.crpr_kw_4, 
                    target.cutl=src.cutl, 
                    target.cutl_kw=src.cutl_kw, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.defc=src.defc, 
                    target.defc_kw=src.defc_kw, 
                    target.deleted=src.deleted, 
                    target.dstp=src.dstp, 
                    target.dstp_kw=src.dstp_kw, 
                    target.efdt=src.efdt, 
                    target.fain=src.fain, 
                    target.fain_kw=src.fain_kw, 
                    target.fres=src.fres, 
                    target.fres_kw=src.fres_kw, 
                    target.grid=src.grid, 
                    target.grid_ref_compnr=src.grid_ref_compnr, 
                    target.huid=src.huid, 
                    target.huqt=src.huqt, 
                    target.insn=src.insn, 
                    target.insn_kw=src.insn_kw, 
                    target.insp=src.insp, 
                    target.insp_kw=src.insp_kw, 
                    target.irev=src.irev, 
                    target.lbdv=src.lbdv, 
                    target.lbid=src.lbid, 
                    target.lblo=src.lblo, 
                    target.lbnc=src.lbnc, 
                    target.lbpb=src.lbpb, 
                    target.lbpb_kw=src.lbpb_kw, 
                    target.lbpr=src.lbpr, 
                    target.lbpr_kw=src.lbpr_kw, 
                    target.lbtp=src.lbtp, 
                    target.lbtp_kw=src.lbtp_kw, 
                    target.matl=src.matl, 
                    target.matl_kw=src.matl_kw, 
                    target.matn=src.matn, 
                    target.matn_kw=src.matn_kw, 
                    target.mfre=src.mfre, 
                    target.mfre_kw=src.mfre_kw, 
                    target.mitm=src.mitm, 
                    target.mitm_opro_rcmp=src.mitm_opro_rcmp, 
                    target.mitm_ref_compnr=src.mitm_ref_compnr, 
                    target.mitm_site_ref_compnr=src.mitm_site_ref_compnr, 
                    target.mmno=src.mmno, 
                    target.mmno_kw=src.mmno_kw, 
                    target.mmpo=src.mmpo, 
                    target.mmpo_kw=src.mmpo_kw, 
                    target.mocp=src.mocp, 
                    target.mocp_kw=src.mocp_kw, 
                    target.odpr=src.odpr, 
                    target.odpr_kw=src.odpr_kw, 
                    target.odpt=src.odpt, 
                    target.odpt_kw=src.odpt_kw, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oprn=src.oprn, 
                    target.oprn_kw=src.oprn_kw, 
                    target.opro=src.opro, 
                    target.oprp=src.oprp, 
                    target.oprp_kw=src.oprp_kw, 
                    target.osta=src.osta, 
                    target.osta_kw=src.osta_kw, 
                    target.owns=src.owns, 
                    target.owns_kw=src.owns_kw, 
                    target.pdno=src.pdno, 
                    target.pkdf=src.pkdf, 
                    target.pldt=src.pldt, 
                    target.pldt_pltd=src.pldt_pltd, 
                    target.plgr=src.plgr, 
                    target.plid=src.plid, 
                    target.plid_ref_compnr=src.plid_ref_compnr, 
                    target.poas=src.poas, 
                    target.prcd=src.prcd, 
                    target.prdt=src.prdt, 
                    target.prlb=src.prlb, 
                    target.prlb_kw=src.prlb_kw, 
                    target.qbfd=src.qbfd, 
                    target.qbfd_buar=src.qbfd_buar, 
                    target.qbfd_buln=src.qbfd_buln, 
                    target.qbfd_bupc=src.qbfd_bupc, 
                    target.qbfd_butm=src.qbfd_butm, 
                    target.qbfd_buvl=src.qbfd_buvl, 
                    target.qbfd_buwg=src.qbfd_buwg, 
                    target.qdlv=src.qdlv, 
                    target.qdlv_buar=src.qdlv_buar, 
                    target.qdlv_buln=src.qdlv_buln, 
                    target.qdlv_bupc=src.qdlv_bupc, 
                    target.qdlv_butm=src.qdlv_butm, 
                    target.qdlv_buvl=src.qdlv_buvl, 
                    target.qdlv_buwg=src.qdlv_buwg, 
                    target.qntl=src.qntl, 
                    target.qntl_buar=src.qntl_buar, 
                    target.qntl_buln=src.qntl_buln, 
                    target.qntl_bupc=src.qntl_bupc, 
                    target.qntl_butm=src.qntl_butm, 
                    target.qntl_buvl=src.qntl_buvl, 
                    target.qntl_buwg=src.qntl_buwg, 
                    target.qoor=src.qoor, 
                    target.qqar=src.qqar, 
                    target.qqar_buar=src.qqar_buar, 
                    target.qqar_buln=src.qqar_buln, 
                    target.qqar_bupc=src.qqar_bupc, 
                    target.qqar_butm=src.qqar_butm, 
                    target.qqar_buvl=src.qqar_buvl, 
                    target.qqar_buwg=src.qqar_buwg, 
                    target.qrdr=src.qrdr, 
                    target.qrdr_buar=src.qrdr_buar, 
                    target.qrdr_buln=src.qrdr_buln, 
                    target.qrdr_bupc=src.qrdr_bupc, 
                    target.qrdr_butm=src.qrdr_butm, 
                    target.qrdr_buvl=src.qrdr_buvl, 
                    target.qrdr_buwg=src.qrdr_buwg, 
                    target.qrjc=src.qrjc, 
                    target.qrjc_buar=src.qrjc_buar, 
                    target.qrjc_buln=src.qrjc_buln, 
                    target.qrjc_bupc=src.qrjc_bupc, 
                    target.qrjc_butm=src.qrjc_butm, 
                    target.qrjc_buvl=src.qrjc_buvl, 
                    target.qrjc_buwg=src.qrjc_buwg, 
                    target.qtbf=src.qtbf, 
                    target.qtbf_buar=src.qtbf_buar, 
                    target.qtbf_buln=src.qtbf_buln, 
                    target.qtbf_bupc=src.qtbf_bupc, 
                    target.qtbf_butm=src.qtbf_butm, 
                    target.qtbf_buvl=src.qtbf_buvl, 
                    target.qtbf_buwg=src.qtbf_buwg, 
                    target.qtdl=src.qtdl, 
                    target.qtdl_buar=src.qtdl_buar, 
                    target.qtdl_buln=src.qtdl_buln, 
                    target.qtdl_bupc=src.qtdl_bupc, 
                    target.qtdl_butm=src.qtdl_butm, 
                    target.qtdl_buvl=src.qtdl_buvl, 
                    target.qtdl_buwg=src.qtdl_buwg, 
                    target.qtor=src.qtor, 
                    target.qtor_buar=src.qtor_buar, 
                    target.qtor_buln=src.qtor_buln, 
                    target.qtor_bupc=src.qtor_bupc, 
                    target.qtor_butm=src.qtor_butm, 
                    target.qtor_buvl=src.qtor_buvl, 
                    target.qtor_buwg=src.qtor_buwg, 
                    target.rdld=src.rdld, 
                    target.recn=src.recn, 
                    target.recn_kw=src.recn_kw, 
                    target.reco=src.reco, 
                    target.reco_ref_compnr=src.reco_ref_compnr, 
                    target.revi=src.revi, 
                    target.rgrp=src.rgrp, 
                    target.rgrp_ref_compnr=src.rgrp_ref_compnr, 
                    target.rorv=src.rorv, 
                    target.rouc=src.rouc, 
                    target.roul=src.roul, 
                    target.roul_kw=src.roul_kw, 
                    target.rswc=src.rswc, 
                    target.rswc_kw=src.rswc_kw, 
                    target.rwko=src.rwko, 
                    target.rwko_kw=src.rwko_kw, 
                    target.rwtp=src.rwtp, 
                    target.rwtp_kw=src.rwtp_kw, 
                    target.sawl=src.sawl, 
                    target.sawl_kw=src.sawl_kw, 
                    target.schd=src.schd, 
                    target.schd_kw=src.schd_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfpl=src.sfpl, 
                    target.sfpl_ref_compnr=src.sfpl_ref_compnr, 
                    target.shsp=src.shsp, 
                    target.shsp_kw=src.shsp_kw, 
                    target.site=src.site, 
                    target.site_plgr_ref_compnr=src.site_plgr_ref_compnr, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.smfs=src.smfs, 
                    target.smfs_kw=src.smfs_kw, 
                    target.spcn=src.spcn, 
                    target.srnl=src.srnl, 
                    target.srnl_kw=src.srnl_kw, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.subn=src.subn, 
                    target.subn_kw=src.subn_kw, 
                    target.timestamp=src.timestamp, 
                    target.trcp=src.trcp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.vers=src.vers, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( aapd, aapd_kw, adld, adld_actd, adld_deea, adld_dela, apdt, aprp, aprp_kw, asrp, asrp_kw, awtc, awtc_kw, bfep, bfep_kw, bfhr, bfhr_kw, bloc, bloc_kw, bmdl, bmrv, cada, cctt, cctt_kw, cdld, chel, chel_kw, clco, clco_fcmp, clco_ref_compnr, cldt, clot, clpd, clpd_kw, cmdt, cncd, compnr, covn, covn_kw, cpla, cpla_kw, cprj, cprj_ref_compnr, crpr_1, crpr_2, crpr_3, crpr_4, crpr_kw_1, crpr_kw_2, crpr_kw_3, crpr_kw_4, cutl, cutl_kw, cwar, cwar_ref_compnr, defc, defc_kw, deleted, dstp, dstp_kw, efdt, fain, fain_kw, fres, fres_kw, grid, grid_ref_compnr, huid, huqt, insn, insn_kw, insp, insp_kw, irev, lbdv, lbid, lblo, lbnc, lbpb, lbpb_kw, lbpr, lbpr_kw, lbtp, lbtp_kw, matl, matl_kw, matn, matn_kw, mfre, mfre_kw, mitm, mitm_opro_rcmp, mitm_ref_compnr, mitm_site_ref_compnr, mmno, mmno_kw, mmpo, mmpo_kw, mocp, mocp_kw, odpr, odpr_kw, odpt, odpt_kw, ofbp, ofbp_ref_compnr, oprn, oprn_kw, opro, oprp, oprp_kw, osta, osta_kw, owns, owns_kw, pdno, pkdf, pldt, pldt_pltd, plgr, plid, plid_ref_compnr, poas, prcd, prdt, prlb, prlb_kw, qbfd, qbfd_buar, qbfd_buln, qbfd_bupc, qbfd_butm, qbfd_buvl, qbfd_buwg, qdlv, qdlv_buar, qdlv_buln, qdlv_bupc, qdlv_butm, qdlv_buvl, qdlv_buwg, qntl, qntl_buar, qntl_buln, qntl_bupc, qntl_butm, qntl_buvl, qntl_buwg, qoor, qqar, qqar_buar, qqar_buln, qqar_bupc, qqar_butm, qqar_buvl, qqar_buwg, qrdr, qrdr_buar, qrdr_buln, qrdr_bupc, qrdr_butm, qrdr_buvl, qrdr_buwg, qrjc, qrjc_buar, qrjc_buln, qrjc_bupc, qrjc_butm, qrjc_buvl, qrjc_buwg, qtbf, qtbf_buar, qtbf_buln, qtbf_bupc, qtbf_butm, qtbf_buvl, qtbf_buwg, qtdl, qtdl_buar, qtdl_buln, qtdl_bupc, qtdl_butm, qtdl_buvl, qtdl_buwg, qtor, qtor_buar, qtor_buln, qtor_bupc, qtor_butm, qtor_buvl, qtor_buwg, rdld, recn, recn_kw, reco, reco_ref_compnr, revi, rgrp, rgrp_ref_compnr, rorv, rouc, roul, roul_kw, rswc, rswc_kw, rwko, rwko_kw, rwtp, rwtp_kw, sawl, sawl_kw, schd, schd_kw, sequencenumber, sfpl, sfpl_ref_compnr, shsp, shsp_kw, site, site_plgr_ref_compnr, site_ref_compnr, smfs, smfs_kw, spcn, srnl, srnl_kw, subc, subc_kw, subn, subn_kw, timestamp, trcp, txta, txta_ref_compnr, username, vers, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.aapd, 
                    src.aapd_kw, 
                    src.adld, 
                    src.adld_actd, 
                    src.adld_deea, 
                    src.adld_dela, 
                    src.apdt, 
                    src.aprp, 
                    src.aprp_kw, 
                    src.asrp, 
                    src.asrp_kw, 
                    src.awtc, 
                    src.awtc_kw, 
                    src.bfep, 
                    src.bfep_kw, 
                    src.bfhr, 
                    src.bfhr_kw, 
                    src.bloc, 
                    src.bloc_kw, 
                    src.bmdl, 
                    src.bmrv, 
                    src.cada, 
                    src.cctt, 
                    src.cctt_kw, 
                    src.cdld, 
                    src.chel, 
                    src.chel_kw, 
                    src.clco, 
                    src.clco_fcmp, 
                    src.clco_ref_compnr, 
                    src.cldt, 
                    src.clot, 
                    src.clpd, 
                    src.clpd_kw, 
                    src.cmdt, 
                    src.cncd, 
                    src.compnr, 
                    src.covn, 
                    src.covn_kw, 
                    src.cpla, 
                    src.cpla_kw, 
                    src.cprj, 
                    src.cprj_ref_compnr, 
                    src.crpr_1, 
                    src.crpr_2, 
                    src.crpr_3, 
                    src.crpr_4, 
                    src.crpr_kw_1, 
                    src.crpr_kw_2, 
                    src.crpr_kw_3, 
                    src.crpr_kw_4, 
                    src.cutl, 
                    src.cutl_kw, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.defc, 
                    src.defc_kw, 
                    src.deleted, 
                    src.dstp, 
                    src.dstp_kw, 
                    src.efdt, 
                    src.fain, 
                    src.fain_kw, 
                    src.fres, 
                    src.fres_kw, 
                    src.grid, 
                    src.grid_ref_compnr, 
                    src.huid, 
                    src.huqt, 
                    src.insn, 
                    src.insn_kw, 
                    src.insp, 
                    src.insp_kw, 
                    src.irev, 
                    src.lbdv, 
                    src.lbid, 
                    src.lblo, 
                    src.lbnc, 
                    src.lbpb, 
                    src.lbpb_kw, 
                    src.lbpr, 
                    src.lbpr_kw, 
                    src.lbtp, 
                    src.lbtp_kw, 
                    src.matl, 
                    src.matl_kw, 
                    src.matn, 
                    src.matn_kw, 
                    src.mfre, 
                    src.mfre_kw, 
                    src.mitm, 
                    src.mitm_opro_rcmp, 
                    src.mitm_ref_compnr, 
                    src.mitm_site_ref_compnr, 
                    src.mmno, 
                    src.mmno_kw, 
                    src.mmpo, 
                    src.mmpo_kw, 
                    src.mocp, 
                    src.mocp_kw, 
                    src.odpr, 
                    src.odpr_kw, 
                    src.odpt, 
                    src.odpt_kw, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oprn, 
                    src.oprn_kw, 
                    src.opro, 
                    src.oprp, 
                    src.oprp_kw, 
                    src.osta, 
                    src.osta_kw, 
                    src.owns, 
                    src.owns_kw, 
                    src.pdno, 
                    src.pkdf, 
                    src.pldt, 
                    src.pldt_pltd, 
                    src.plgr, 
                    src.plid, 
                    src.plid_ref_compnr, 
                    src.poas, 
                    src.prcd, 
                    src.prdt, 
                    src.prlb, 
                    src.prlb_kw, 
                    src.qbfd, 
                    src.qbfd_buar, 
                    src.qbfd_buln, 
                    src.qbfd_bupc, 
                    src.qbfd_butm, 
                    src.qbfd_buvl, 
                    src.qbfd_buwg, 
                    src.qdlv, 
                    src.qdlv_buar, 
                    src.qdlv_buln, 
                    src.qdlv_bupc, 
                    src.qdlv_butm, 
                    src.qdlv_buvl, 
                    src.qdlv_buwg, 
                    src.qntl, 
                    src.qntl_buar, 
                    src.qntl_buln, 
                    src.qntl_bupc, 
                    src.qntl_butm, 
                    src.qntl_buvl, 
                    src.qntl_buwg, 
                    src.qoor, 
                    src.qqar, 
                    src.qqar_buar, 
                    src.qqar_buln, 
                    src.qqar_bupc, 
                    src.qqar_butm, 
                    src.qqar_buvl, 
                    src.qqar_buwg, 
                    src.qrdr, 
                    src.qrdr_buar, 
                    src.qrdr_buln, 
                    src.qrdr_bupc, 
                    src.qrdr_butm, 
                    src.qrdr_buvl, 
                    src.qrdr_buwg, 
                    src.qrjc, 
                    src.qrjc_buar, 
                    src.qrjc_buln, 
                    src.qrjc_bupc, 
                    src.qrjc_butm, 
                    src.qrjc_buvl, 
                    src.qrjc_buwg, 
                    src.qtbf, 
                    src.qtbf_buar, 
                    src.qtbf_buln, 
                    src.qtbf_bupc, 
                    src.qtbf_butm, 
                    src.qtbf_buvl, 
                    src.qtbf_buwg, 
                    src.qtdl, 
                    src.qtdl_buar, 
                    src.qtdl_buln, 
                    src.qtdl_bupc, 
                    src.qtdl_butm, 
                    src.qtdl_buvl, 
                    src.qtdl_buwg, 
                    src.qtor, 
                    src.qtor_buar, 
                    src.qtor_buln, 
                    src.qtor_bupc, 
                    src.qtor_butm, 
                    src.qtor_buvl, 
                    src.qtor_buwg, 
                    src.rdld, 
                    src.recn, 
                    src.recn_kw, 
                    src.reco, 
                    src.reco_ref_compnr, 
                    src.revi, 
                    src.rgrp, 
                    src.rgrp_ref_compnr, 
                    src.rorv, 
                    src.rouc, 
                    src.roul, 
                    src.roul_kw, 
                    src.rswc, 
                    src.rswc_kw, 
                    src.rwko, 
                    src.rwko_kw, 
                    src.rwtp, 
                    src.rwtp_kw, 
                    src.sawl, 
                    src.sawl_kw, 
                    src.schd, 
                    src.schd_kw, 
                    src.sequencenumber, 
                    src.sfpl, 
                    src.sfpl_ref_compnr, 
                    src.shsp, 
                    src.shsp_kw, 
                    src.site, 
                    src.site_plgr_ref_compnr, 
                    src.site_ref_compnr, 
                    src.smfs, 
                    src.smfs_kw, 
                    src.spcn, 
                    src.srnl, 
                    src.srnl_kw, 
                    src.subc, 
                    src.subc_kw, 
                    src.subn, 
                    src.subn_kw, 
                    src.timestamp, 
                    src.trcp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.vers,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;