create or replace procedure DATAHUB_INTEGRATION.SP_LN_TFACP200()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TFACP200_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TFACP200 as target using (SELECT * FROM (SELECT 
            strm.adcd, 
            strm.adty, 
            strm.adty_kw, 
            strm.afpy, 
            strm.afpy_kw, 
            strm.amnt, 
            strm.amth_1, 
            strm.amth_2, 
            strm.amth_3, 
            strm.amth_dtwc, 
            strm.amth_rfrc, 
            strm.amti, 
            strm.appr, 
            strm.appr_kw, 
            strm.autm, 
            strm.autm_kw, 
            strm.baca_1, 
            strm.baca_2, 
            strm.baca_3, 
            strm.baca_dtwc, 
            strm.baca_invc, 
            strm.baca_rfrc, 
            strm.baco, 
            strm.bahc_1, 
            strm.bahc_2, 
            strm.bahc_3, 
            strm.bahc_dtwc, 
            strm.bahc_rfrc, 
            strm.bala, 
            strm.balc, 
            strm.balh_1, 
            strm.balh_2, 
            strm.balh_3, 
            strm.balh_dtwc, 
            strm.balh_rfrc, 
            strm.bank, 
            strm.basi, 
            strm.bdat, 
            strm.bdsp, 
            strm.bdsp_kw, 
            strm.bkrn, 
            strm.blac, 
            strm.blac_kw, 
            strm.bloc, 
            strm.bloc_ref_compnr, 
            strm.bpri, 
            strm.bref, 
            strm.bref_ref_compnr, 
            strm.btno, 
            strm.bust, 
            strm.bust_kw, 
            strm.ccrs, 
            strm.ccrs_ref_compnr, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdam_1, 
            strm.cdam_2, 
            strm.cdam_3, 
            strm.cdam_dtwc, 
            strm.cdam_invc, 
            strm.cdam_rfrc, 
            strm.cfrs, 
            strm.cfrs_ref_compnr, 
            strm.clus, 
            strm.compnr, 
            strm.cpay, 
            strm.cpay_ref_compnr, 
            strm.cvat, 
            strm.cvat_ref_compnr, 
            strm.dapr, 
            strm.dc1a, 
            strm.dc1h_1, 
            strm.dc1h_2, 
            strm.dc1h_3, 
            strm.dc1h_dtwc, 
            strm.dc1h_rfrc, 
            strm.dc1i, 
            strm.dc2a, 
            strm.dc2h_1, 
            strm.dc2h_2, 
            strm.dc2h_3, 
            strm.dc2h_dtwc, 
            strm.dc2h_rfrc, 
            strm.dc2i, 
            strm.dc3a, 
            strm.dc3h_1, 
            strm.dc3h_2, 
            strm.dc3h_3, 
            strm.dc3h_dtwc, 
            strm.dc3h_rfrc, 
            strm.dc3i, 
            strm.deleted, 
            strm.did1, 
            strm.did2, 
            strm.did3, 
            strm.dim1, 
            strm.dim2, 
            strm.dim3, 
            strm.dim4, 
            strm.dim5, 
            strm.dim6, 
            strm.dim7, 
            strm.dim8, 
            strm.dim9, 
            strm.dm10, 
            strm.dm11, 
            strm.dm12, 
            strm.doca, 
            strm.docd, 
            strm.docn, 
            strm.dued, 
            strm.edtp, 
            strm.edtp_kw, 
            strm.enia, 
            strm.enia_kw, 
            strm.iadr, 
            strm.iadr_ref_compnr, 
            strm.ifbp, 
            strm.ifbp_ref_compnr, 
            strm.ildp, 
            strm.ildp_kw, 
            strm.irdt, 
            strm.isup, 
            strm.lapa, 
            strm.laph_1, 
            strm.laph_2, 
            strm.laph_3, 
            strm.laph_dtwc, 
            strm.laph_rfrc, 
            strm.lapi, 
            strm.leac, 
            strm.leac_ref_compnr, 
            strm.line, 
            strm.link, 
            strm.lino, 
            strm.liqd, 
            strm.load, 
            strm.loco, 
            strm.lpdt, 
            strm.lvat, 
            strm.lvat_kw, 
            strm.ninv, 
            strm.oinv, 
            strm.optb, 
            strm.optb_ref_compnr, 
            strm.orno, 
            strm.osch, 
            strm.osup, 
            strm.otbp, 
            strm.otbp_ref_compnr, 
            strm.otyp, 
            strm.otyp_ref_compnr, 
            strm.pada, 
            strm.padh_1, 
            strm.padh_2, 
            strm.padh_3, 
            strm.padh_dtwc, 
            strm.padh_rfrc, 
            strm.padi, 
            strm.papr, 
            strm.papr_kw, 
            strm.paya, 
            strm.paya_ref_compnr, 
            strm.payd, 
            strm.payl, 
            strm.paym, 
            strm.paym_ref_compnr, 
            strm.payt, 
            strm.pcom, 
            strm.pdat, 
            strm.pdif, 
            strm.pdoc, 
            strm.pfre, 
            strm.pfre_kw, 
            strm.post, 
            strm.prin, 
            strm.prin_kw, 
            strm.prod, 
            strm.ptad, 
            strm.ptad_ref_compnr, 
            strm.ptbp, 
            strm.ptbp_bank_ref_compnr, 
            strm.ptbp_ref_compnr, 
            strm.ptyp, 
            strm.ptyp_ref_compnr, 
            strm.pysh, 
            strm.pysh_kw, 
            strm.rade, 
            strm.rade_kw, 
            strm.ragr, 
            strm.ratd, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rcpt, 
            strm.rcpt_kw, 
            strm.reas, 
            strm.reas_ref_compnr, 
            strm.refr, 
            strm.regc, 
            strm.regc_ref_compnr, 
            strm.rtyp, 
            strm.schn, 
            strm.sequencenumber, 
            strm.sgtp, 
            strm.sgtp_kw, 
            strm.shpi, 
            strm.shpm, 
            strm.stap, 
            strm.stap_kw, 
            strm.stat, 
            strm.stat_kw, 
            strm.step, 
            strm.step_kw, 
            strm.subc, 
            strm.subc_kw, 
            strm.svah_1, 
            strm.svah_2, 
            strm.svah_3, 
            strm.svam, 
            strm.tapr, 
            strm.tbrl, 
            strm.tdoc, 
            strm.tdoc_ref_compnr, 
            strm.text, 
            strm.text_ref_compnr, 
            strm.timestamp, 
            strm.tnpn, 
            strm.tore_1, 
            strm.tore_2, 
            strm.tore_3, 
            strm.tore_dtwc, 
            strm.tore_invc, 
            strm.tore_rfrc, 
            strm.tpay, 
            strm.tpay_kw, 
            strm.ttyp, 
            strm.ttyp_ref_compnr, 
            strm.txdt, 
            strm.txtb, 
            strm.txtb_ref_compnr, 
            strm.typa, 
            strm.typa_ref_compnr, 
            strm.user, 
            strm.username, 
            strm.vata, 
            strm.vatc, 
            strm.vatc_cvat_ref_compnr, 
            strm.vatc_ref_compnr, 
            strm.vath_1, 
            strm.vath_2, 
            strm.vath_3, 
            strm.vath_dtwc, 
            strm.vath_rfrc, 
            strm.vati, 
            strm.vatp, 
            strm.vaty, 
            strm.vrsm, 
            strm.whti, 
            strm.whti_kw, 
            strm.wtph_1, 
            strm.wtph_2, 
            strm.wtph_3, 
            strm.wtpi, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.ttyp,
            strm.ninv,
            strm.line,
            strm.tdoc,
            strm.docn,
            strm.lino ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TFACP200 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.ttyp=src.ttyp) OR (target.ttyp IS NULL AND src.ttyp IS NULL)) AND
            ((target.ninv=src.ninv) OR (target.ninv IS NULL AND src.ninv IS NULL)) AND
            ((target.line=src.line) OR (target.line IS NULL AND src.line IS NULL)) AND
            ((target.tdoc=src.tdoc) OR (target.tdoc IS NULL AND src.tdoc IS NULL)) AND
            ((target.docn=src.docn) OR (target.docn IS NULL AND src.docn IS NULL)) AND
            ((target.lino=src.lino) OR (target.lino IS NULL AND src.lino IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.adcd=src.adcd, 
                    target.adty=src.adty, 
                    target.adty_kw=src.adty_kw, 
                    target.afpy=src.afpy, 
                    target.afpy_kw=src.afpy_kw, 
                    target.amnt=src.amnt, 
                    target.amth_1=src.amth_1, 
                    target.amth_2=src.amth_2, 
                    target.amth_3=src.amth_3, 
                    target.amth_dtwc=src.amth_dtwc, 
                    target.amth_rfrc=src.amth_rfrc, 
                    target.amti=src.amti, 
                    target.appr=src.appr, 
                    target.appr_kw=src.appr_kw, 
                    target.autm=src.autm, 
                    target.autm_kw=src.autm_kw, 
                    target.baca_1=src.baca_1, 
                    target.baca_2=src.baca_2, 
                    target.baca_3=src.baca_3, 
                    target.baca_dtwc=src.baca_dtwc, 
                    target.baca_invc=src.baca_invc, 
                    target.baca_rfrc=src.baca_rfrc, 
                    target.baco=src.baco, 
                    target.bahc_1=src.bahc_1, 
                    target.bahc_2=src.bahc_2, 
                    target.bahc_3=src.bahc_3, 
                    target.bahc_dtwc=src.bahc_dtwc, 
                    target.bahc_rfrc=src.bahc_rfrc, 
                    target.bala=src.bala, 
                    target.balc=src.balc, 
                    target.balh_1=src.balh_1, 
                    target.balh_2=src.balh_2, 
                    target.balh_3=src.balh_3, 
                    target.balh_dtwc=src.balh_dtwc, 
                    target.balh_rfrc=src.balh_rfrc, 
                    target.bank=src.bank, 
                    target.basi=src.basi, 
                    target.bdat=src.bdat, 
                    target.bdsp=src.bdsp, 
                    target.bdsp_kw=src.bdsp_kw, 
                    target.bkrn=src.bkrn, 
                    target.blac=src.blac, 
                    target.blac_kw=src.blac_kw, 
                    target.bloc=src.bloc, 
                    target.bloc_ref_compnr=src.bloc_ref_compnr, 
                    target.bpri=src.bpri, 
                    target.bref=src.bref, 
                    target.bref_ref_compnr=src.bref_ref_compnr, 
                    target.btno=src.btno, 
                    target.bust=src.bust, 
                    target.bust_kw=src.bust_kw, 
                    target.ccrs=src.ccrs, 
                    target.ccrs_ref_compnr=src.ccrs_ref_compnr, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdam_1=src.cdam_1, 
                    target.cdam_2=src.cdam_2, 
                    target.cdam_3=src.cdam_3, 
                    target.cdam_dtwc=src.cdam_dtwc, 
                    target.cdam_invc=src.cdam_invc, 
                    target.cdam_rfrc=src.cdam_rfrc, 
                    target.cfrs=src.cfrs, 
                    target.cfrs_ref_compnr=src.cfrs_ref_compnr, 
                    target.clus=src.clus, 
                    target.compnr=src.compnr, 
                    target.cpay=src.cpay, 
                    target.cpay_ref_compnr=src.cpay_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvat_ref_compnr=src.cvat_ref_compnr, 
                    target.dapr=src.dapr, 
                    target.dc1a=src.dc1a, 
                    target.dc1h_1=src.dc1h_1, 
                    target.dc1h_2=src.dc1h_2, 
                    target.dc1h_3=src.dc1h_3, 
                    target.dc1h_dtwc=src.dc1h_dtwc, 
                    target.dc1h_rfrc=src.dc1h_rfrc, 
                    target.dc1i=src.dc1i, 
                    target.dc2a=src.dc2a, 
                    target.dc2h_1=src.dc2h_1, 
                    target.dc2h_2=src.dc2h_2, 
                    target.dc2h_3=src.dc2h_3, 
                    target.dc2h_dtwc=src.dc2h_dtwc, 
                    target.dc2h_rfrc=src.dc2h_rfrc, 
                    target.dc2i=src.dc2i, 
                    target.dc3a=src.dc3a, 
                    target.dc3h_1=src.dc3h_1, 
                    target.dc3h_2=src.dc3h_2, 
                    target.dc3h_3=src.dc3h_3, 
                    target.dc3h_dtwc=src.dc3h_dtwc, 
                    target.dc3h_rfrc=src.dc3h_rfrc, 
                    target.dc3i=src.dc3i, 
                    target.deleted=src.deleted, 
                    target.did1=src.did1, 
                    target.did2=src.did2, 
                    target.did3=src.did3, 
                    target.dim1=src.dim1, 
                    target.dim2=src.dim2, 
                    target.dim3=src.dim3, 
                    target.dim4=src.dim4, 
                    target.dim5=src.dim5, 
                    target.dim6=src.dim6, 
                    target.dim7=src.dim7, 
                    target.dim8=src.dim8, 
                    target.dim9=src.dim9, 
                    target.dm10=src.dm10, 
                    target.dm11=src.dm11, 
                    target.dm12=src.dm12, 
                    target.doca=src.doca, 
                    target.docd=src.docd, 
                    target.docn=src.docn, 
                    target.dued=src.dued, 
                    target.edtp=src.edtp, 
                    target.edtp_kw=src.edtp_kw, 
                    target.enia=src.enia, 
                    target.enia_kw=src.enia_kw, 
                    target.iadr=src.iadr, 
                    target.iadr_ref_compnr=src.iadr_ref_compnr, 
                    target.ifbp=src.ifbp, 
                    target.ifbp_ref_compnr=src.ifbp_ref_compnr, 
                    target.ildp=src.ildp, 
                    target.ildp_kw=src.ildp_kw, 
                    target.irdt=src.irdt, 
                    target.isup=src.isup, 
                    target.lapa=src.lapa, 
                    target.laph_1=src.laph_1, 
                    target.laph_2=src.laph_2, 
                    target.laph_3=src.laph_3, 
                    target.laph_dtwc=src.laph_dtwc, 
                    target.laph_rfrc=src.laph_rfrc, 
                    target.lapi=src.lapi, 
                    target.leac=src.leac, 
                    target.leac_ref_compnr=src.leac_ref_compnr, 
                    target.line=src.line, 
                    target.link=src.link, 
                    target.lino=src.lino, 
                    target.liqd=src.liqd, 
                    target.load=src.load, 
                    target.loco=src.loco, 
                    target.lpdt=src.lpdt, 
                    target.lvat=src.lvat, 
                    target.lvat_kw=src.lvat_kw, 
                    target.ninv=src.ninv, 
                    target.oinv=src.oinv, 
                    target.optb=src.optb, 
                    target.optb_ref_compnr=src.optb_ref_compnr, 
                    target.orno=src.orno, 
                    target.osch=src.osch, 
                    target.osup=src.osup, 
                    target.otbp=src.otbp, 
                    target.otbp_ref_compnr=src.otbp_ref_compnr, 
                    target.otyp=src.otyp, 
                    target.otyp_ref_compnr=src.otyp_ref_compnr, 
                    target.pada=src.pada, 
                    target.padh_1=src.padh_1, 
                    target.padh_2=src.padh_2, 
                    target.padh_3=src.padh_3, 
                    target.padh_dtwc=src.padh_dtwc, 
                    target.padh_rfrc=src.padh_rfrc, 
                    target.padi=src.padi, 
                    target.papr=src.papr, 
                    target.papr_kw=src.papr_kw, 
                    target.paya=src.paya, 
                    target.paya_ref_compnr=src.paya_ref_compnr, 
                    target.payd=src.payd, 
                    target.payl=src.payl, 
                    target.paym=src.paym, 
                    target.paym_ref_compnr=src.paym_ref_compnr, 
                    target.payt=src.payt, 
                    target.pcom=src.pcom, 
                    target.pdat=src.pdat, 
                    target.pdif=src.pdif, 
                    target.pdoc=src.pdoc, 
                    target.pfre=src.pfre, 
                    target.pfre_kw=src.pfre_kw, 
                    target.post=src.post, 
                    target.prin=src.prin, 
                    target.prin_kw=src.prin_kw, 
                    target.prod=src.prod, 
                    target.ptad=src.ptad, 
                    target.ptad_ref_compnr=src.ptad_ref_compnr, 
                    target.ptbp=src.ptbp, 
                    target.ptbp_bank_ref_compnr=src.ptbp_bank_ref_compnr, 
                    target.ptbp_ref_compnr=src.ptbp_ref_compnr, 
                    target.ptyp=src.ptyp, 
                    target.ptyp_ref_compnr=src.ptyp_ref_compnr, 
                    target.pysh=src.pysh, 
                    target.pysh_kw=src.pysh_kw, 
                    target.rade=src.rade, 
                    target.rade_kw=src.rade_kw, 
                    target.ragr=src.ragr, 
                    target.ratd=src.ratd, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rcpt=src.rcpt, 
                    target.rcpt_kw=src.rcpt_kw, 
                    target.reas=src.reas, 
                    target.reas_ref_compnr=src.reas_ref_compnr, 
                    target.refr=src.refr, 
                    target.regc=src.regc, 
                    target.regc_ref_compnr=src.regc_ref_compnr, 
                    target.rtyp=src.rtyp, 
                    target.schn=src.schn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sgtp=src.sgtp, 
                    target.sgtp_kw=src.sgtp_kw, 
                    target.shpi=src.shpi, 
                    target.shpm=src.shpm, 
                    target.stap=src.stap, 
                    target.stap_kw=src.stap_kw, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.step=src.step, 
                    target.step_kw=src.step_kw, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.svah_1=src.svah_1, 
                    target.svah_2=src.svah_2, 
                    target.svah_3=src.svah_3, 
                    target.svam=src.svam, 
                    target.tapr=src.tapr, 
                    target.tbrl=src.tbrl, 
                    target.tdoc=src.tdoc, 
                    target.tdoc_ref_compnr=src.tdoc_ref_compnr, 
                    target.text=src.text, 
                    target.text_ref_compnr=src.text_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tnpn=src.tnpn, 
                    target.tore_1=src.tore_1, 
                    target.tore_2=src.tore_2, 
                    target.tore_3=src.tore_3, 
                    target.tore_dtwc=src.tore_dtwc, 
                    target.tore_invc=src.tore_invc, 
                    target.tore_rfrc=src.tore_rfrc, 
                    target.tpay=src.tpay, 
                    target.tpay_kw=src.tpay_kw, 
                    target.ttyp=src.ttyp, 
                    target.ttyp_ref_compnr=src.ttyp_ref_compnr, 
                    target.txdt=src.txdt, 
                    target.txtb=src.txtb, 
                    target.txtb_ref_compnr=src.txtb_ref_compnr, 
                    target.typa=src.typa, 
                    target.typa_ref_compnr=src.typa_ref_compnr, 
                    target.user=src.user, 
                    target.username=src.username, 
                    target.vata=src.vata, 
                    target.vatc=src.vatc, 
                    target.vatc_cvat_ref_compnr=src.vatc_cvat_ref_compnr, 
                    target.vatc_ref_compnr=src.vatc_ref_compnr, 
                    target.vath_1=src.vath_1, 
                    target.vath_2=src.vath_2, 
                    target.vath_3=src.vath_3, 
                    target.vath_dtwc=src.vath_dtwc, 
                    target.vath_rfrc=src.vath_rfrc, 
                    target.vati=src.vati, 
                    target.vatp=src.vatp, 
                    target.vaty=src.vaty, 
                    target.vrsm=src.vrsm, 
                    target.whti=src.whti, 
                    target.whti_kw=src.whti_kw, 
                    target.wtph_1=src.wtph_1, 
                    target.wtph_2=src.wtph_2, 
                    target.wtph_3=src.wtph_3, 
                    target.wtpi=src.wtpi, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    adcd, 
                    adty, 
                    adty_kw, 
                    afpy, 
                    afpy_kw, 
                    amnt, 
                    amth_1, 
                    amth_2, 
                    amth_3, 
                    amth_dtwc, 
                    amth_rfrc, 
                    amti, 
                    appr, 
                    appr_kw, 
                    autm, 
                    autm_kw, 
                    baca_1, 
                    baca_2, 
                    baca_3, 
                    baca_dtwc, 
                    baca_invc, 
                    baca_rfrc, 
                    baco, 
                    bahc_1, 
                    bahc_2, 
                    bahc_3, 
                    bahc_dtwc, 
                    bahc_rfrc, 
                    bala, 
                    balc, 
                    balh_1, 
                    balh_2, 
                    balh_3, 
                    balh_dtwc, 
                    balh_rfrc, 
                    bank, 
                    basi, 
                    bdat, 
                    bdsp, 
                    bdsp_kw, 
                    bkrn, 
                    blac, 
                    blac_kw, 
                    bloc, 
                    bloc_ref_compnr, 
                    bpri, 
                    bref, 
                    bref_ref_compnr, 
                    btno, 
                    bust, 
                    bust_kw, 
                    ccrs, 
                    ccrs_ref_compnr, 
                    ccur, 
                    ccur_ref_compnr, 
                    cdam_1, 
                    cdam_2, 
                    cdam_3, 
                    cdam_dtwc, 
                    cdam_invc, 
                    cdam_rfrc, 
                    cfrs, 
                    cfrs_ref_compnr, 
                    clus, 
                    compnr, 
                    cpay, 
                    cpay_ref_compnr, 
                    cvat, 
                    cvat_ref_compnr, 
                    dapr, 
                    dc1a, 
                    dc1h_1, 
                    dc1h_2, 
                    dc1h_3, 
                    dc1h_dtwc, 
                    dc1h_rfrc, 
                    dc1i, 
                    dc2a, 
                    dc2h_1, 
                    dc2h_2, 
                    dc2h_3, 
                    dc2h_dtwc, 
                    dc2h_rfrc, 
                    dc2i, 
                    dc3a, 
                    dc3h_1, 
                    dc3h_2, 
                    dc3h_3, 
                    dc3h_dtwc, 
                    dc3h_rfrc, 
                    dc3i, 
                    deleted, 
                    did1, 
                    did2, 
                    did3, 
                    dim1, 
                    dim2, 
                    dim3, 
                    dim4, 
                    dim5, 
                    dim6, 
                    dim7, 
                    dim8, 
                    dim9, 
                    dm10, 
                    dm11, 
                    dm12, 
                    doca, 
                    docd, 
                    docn, 
                    dued, 
                    edtp, 
                    edtp_kw, 
                    enia, 
                    enia_kw, 
                    iadr, 
                    iadr_ref_compnr, 
                    ifbp, 
                    ifbp_ref_compnr, 
                    ildp, 
                    ildp_kw, 
                    irdt, 
                    isup, 
                    lapa, 
                    laph_1, 
                    laph_2, 
                    laph_3, 
                    laph_dtwc, 
                    laph_rfrc, 
                    lapi, 
                    leac, 
                    leac_ref_compnr, 
                    line, 
                    link, 
                    lino, 
                    liqd, 
                    load, 
                    loco, 
                    lpdt, 
                    lvat, 
                    lvat_kw, 
                    ninv, 
                    oinv, 
                    optb, 
                    optb_ref_compnr, 
                    orno, 
                    osch, 
                    osup, 
                    otbp, 
                    otbp_ref_compnr, 
                    otyp, 
                    otyp_ref_compnr, 
                    pada, 
                    padh_1, 
                    padh_2, 
                    padh_3, 
                    padh_dtwc, 
                    padh_rfrc, 
                    padi, 
                    papr, 
                    papr_kw, 
                    paya, 
                    paya_ref_compnr, 
                    payd, 
                    payl, 
                    paym, 
                    paym_ref_compnr, 
                    payt, 
                    pcom, 
                    pdat, 
                    pdif, 
                    pdoc, 
                    pfre, 
                    pfre_kw, 
                    post, 
                    prin, 
                    prin_kw, 
                    prod, 
                    ptad, 
                    ptad_ref_compnr, 
                    ptbp, 
                    ptbp_bank_ref_compnr, 
                    ptbp_ref_compnr, 
                    ptyp, 
                    ptyp_ref_compnr, 
                    pysh, 
                    pysh_kw, 
                    rade, 
                    rade_kw, 
                    ragr, 
                    ratd, 
                    rate_1, 
                    rate_2, 
                    rate_3, 
                    ratf_1, 
                    ratf_2, 
                    ratf_3, 
                    rcpt, 
                    rcpt_kw, 
                    reas, 
                    reas_ref_compnr, 
                    refr, 
                    regc, 
                    regc_ref_compnr, 
                    rtyp, 
                    schn, 
                    sequencenumber, 
                    sgtp, 
                    sgtp_kw, 
                    shpi, 
                    shpm, 
                    stap, 
                    stap_kw, 
                    stat, 
                    stat_kw, 
                    step, 
                    step_kw, 
                    subc, 
                    subc_kw, 
                    svah_1, 
                    svah_2, 
                    svah_3, 
                    svam, 
                    tapr, 
                    tbrl, 
                    tdoc, 
                    tdoc_ref_compnr, 
                    text, 
                    text_ref_compnr, 
                    timestamp, 
                    tnpn, 
                    tore_1, 
                    tore_2, 
                    tore_3, 
                    tore_dtwc, 
                    tore_invc, 
                    tore_rfrc, 
                    tpay, 
                    tpay_kw, 
                    ttyp, 
                    ttyp_ref_compnr, 
                    txdt, 
                    txtb, 
                    txtb_ref_compnr, 
                    typa, 
                    typa_ref_compnr, 
                    user, 
                    username, 
                    vata, 
                    vatc, 
                    vatc_cvat_ref_compnr, 
                    vatc_ref_compnr, 
                    vath_1, 
                    vath_2, 
                    vath_3, 
                    vath_dtwc, 
                    vath_rfrc, 
                    vati, 
                    vatp, 
                    vaty, 
                    vrsm, 
                    whti, 
                    whti_kw, 
                    wtph_1, 
                    wtph_2, 
                    wtph_3, 
                    wtpi, 
                    year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.adcd, 
                    src.adty, 
                    src.adty_kw, 
                    src.afpy, 
                    src.afpy_kw, 
                    src.amnt, 
                    src.amth_1, 
                    src.amth_2, 
                    src.amth_3, 
                    src.amth_dtwc, 
                    src.amth_rfrc, 
                    src.amti, 
                    src.appr, 
                    src.appr_kw, 
                    src.autm, 
                    src.autm_kw, 
                    src.baca_1, 
                    src.baca_2, 
                    src.baca_3, 
                    src.baca_dtwc, 
                    src.baca_invc, 
                    src.baca_rfrc, 
                    src.baco, 
                    src.bahc_1, 
                    src.bahc_2, 
                    src.bahc_3, 
                    src.bahc_dtwc, 
                    src.bahc_rfrc, 
                    src.bala, 
                    src.balc, 
                    src.balh_1, 
                    src.balh_2, 
                    src.balh_3, 
                    src.balh_dtwc, 
                    src.balh_rfrc, 
                    src.bank, 
                    src.basi, 
                    src.bdat, 
                    src.bdsp, 
                    src.bdsp_kw, 
                    src.bkrn, 
                    src.blac, 
                    src.blac_kw, 
                    src.bloc, 
                    src.bloc_ref_compnr, 
                    src.bpri, 
                    src.bref, 
                    src.bref_ref_compnr, 
                    src.btno, 
                    src.bust, 
                    src.bust_kw, 
                    src.ccrs, 
                    src.ccrs_ref_compnr, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdam_1, 
                    src.cdam_2, 
                    src.cdam_3, 
                    src.cdam_dtwc, 
                    src.cdam_invc, 
                    src.cdam_rfrc, 
                    src.cfrs, 
                    src.cfrs_ref_compnr, 
                    src.clus, 
                    src.compnr, 
                    src.cpay, 
                    src.cpay_ref_compnr, 
                    src.cvat, 
                    src.cvat_ref_compnr, 
                    src.dapr, 
                    src.dc1a, 
                    src.dc1h_1, 
                    src.dc1h_2, 
                    src.dc1h_3, 
                    src.dc1h_dtwc, 
                    src.dc1h_rfrc, 
                    src.dc1i, 
                    src.dc2a, 
                    src.dc2h_1, 
                    src.dc2h_2, 
                    src.dc2h_3, 
                    src.dc2h_dtwc, 
                    src.dc2h_rfrc, 
                    src.dc2i, 
                    src.dc3a, 
                    src.dc3h_1, 
                    src.dc3h_2, 
                    src.dc3h_3, 
                    src.dc3h_dtwc, 
                    src.dc3h_rfrc, 
                    src.dc3i, 
                    src.deleted, 
                    src.did1, 
                    src.did2, 
                    src.did3, 
                    src.dim1, 
                    src.dim2, 
                    src.dim3, 
                    src.dim4, 
                    src.dim5, 
                    src.dim6, 
                    src.dim7, 
                    src.dim8, 
                    src.dim9, 
                    src.dm10, 
                    src.dm11, 
                    src.dm12, 
                    src.doca, 
                    src.docd, 
                    src.docn, 
                    src.dued, 
                    src.edtp, 
                    src.edtp_kw, 
                    src.enia, 
                    src.enia_kw, 
                    src.iadr, 
                    src.iadr_ref_compnr, 
                    src.ifbp, 
                    src.ifbp_ref_compnr, 
                    src.ildp, 
                    src.ildp_kw, 
                    src.irdt, 
                    src.isup, 
                    src.lapa, 
                    src.laph_1, 
                    src.laph_2, 
                    src.laph_3, 
                    src.laph_dtwc, 
                    src.laph_rfrc, 
                    src.lapi, 
                    src.leac, 
                    src.leac_ref_compnr, 
                    src.line, 
                    src.link, 
                    src.lino, 
                    src.liqd, 
                    src.load, 
                    src.loco, 
                    src.lpdt, 
                    src.lvat, 
                    src.lvat_kw, 
                    src.ninv, 
                    src.oinv, 
                    src.optb, 
                    src.optb_ref_compnr, 
                    src.orno, 
                    src.osch, 
                    src.osup, 
                    src.otbp, 
                    src.otbp_ref_compnr, 
                    src.otyp, 
                    src.otyp_ref_compnr, 
                    src.pada, 
                    src.padh_1, 
                    src.padh_2, 
                    src.padh_3, 
                    src.padh_dtwc, 
                    src.padh_rfrc, 
                    src.padi, 
                    src.papr, 
                    src.papr_kw, 
                    src.paya, 
                    src.paya_ref_compnr, 
                    src.payd, 
                    src.payl, 
                    src.paym, 
                    src.paym_ref_compnr, 
                    src.payt, 
                    src.pcom, 
                    src.pdat, 
                    src.pdif, 
                    src.pdoc, 
                    src.pfre, 
                    src.pfre_kw, 
                    src.post, 
                    src.prin, 
                    src.prin_kw, 
                    src.prod, 
                    src.ptad, 
                    src.ptad_ref_compnr, 
                    src.ptbp, 
                    src.ptbp_bank_ref_compnr, 
                    src.ptbp_ref_compnr, 
                    src.ptyp, 
                    src.ptyp_ref_compnr, 
                    src.pysh, 
                    src.pysh_kw, 
                    src.rade, 
                    src.rade_kw, 
                    src.ragr, 
                    src.ratd, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rcpt, 
                    src.rcpt_kw, 
                    src.reas, 
                    src.reas_ref_compnr, 
                    src.refr, 
                    src.regc, 
                    src.regc_ref_compnr, 
                    src.rtyp, 
                    src.schn, 
                    src.sequencenumber, 
                    src.sgtp, 
                    src.sgtp_kw, 
                    src.shpi, 
                    src.shpm, 
                    src.stap, 
                    src.stap_kw, 
                    src.stat, 
                    src.stat_kw, 
                    src.step, 
                    src.step_kw, 
                    src.subc, 
                    src.subc_kw, 
                    src.svah_1, 
                    src.svah_2, 
                    src.svah_3, 
                    src.svam, 
                    src.tapr, 
                    src.tbrl, 
                    src.tdoc, 
                    src.tdoc_ref_compnr, 
                    src.text, 
                    src.text_ref_compnr, 
                    src.timestamp, 
                    src.tnpn, 
                    src.tore_1, 
                    src.tore_2, 
                    src.tore_3, 
                    src.tore_dtwc, 
                    src.tore_invc, 
                    src.tore_rfrc, 
                    src.tpay, 
                    src.tpay_kw, 
                    src.ttyp, 
                    src.ttyp_ref_compnr, 
                    src.txdt, 
                    src.txtb, 
                    src.txtb_ref_compnr, 
                    src.typa, 
                    src.typa_ref_compnr, 
                    src.user, 
                    src.username, 
                    src.vata, 
                    src.vatc, 
                    src.vatc_cvat_ref_compnr, 
                    src.vatc_ref_compnr, 
                    src.vath_1, 
                    src.vath_2, 
                    src.vath_3, 
                    src.vath_dtwc, 
                    src.vath_rfrc, 
                    src.vati, 
                    src.vatp, 
                    src.vaty, 
                    src.vrsm, 
                    src.whti, 
                    src.whti_kw, 
                    src.wtph_1, 
                    src.wtph_2, 
                    src.wtph_3, 
                    src.wtpi, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TFACP200_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.adcd, 
            strm.adty, 
            strm.adty_kw, 
            strm.afpy, 
            strm.afpy_kw, 
            strm.amnt, 
            strm.amth_1, 
            strm.amth_2, 
            strm.amth_3, 
            strm.amth_dtwc, 
            strm.amth_rfrc, 
            strm.amti, 
            strm.appr, 
            strm.appr_kw, 
            strm.autm, 
            strm.autm_kw, 
            strm.baca_1, 
            strm.baca_2, 
            strm.baca_3, 
            strm.baca_dtwc, 
            strm.baca_invc, 
            strm.baca_rfrc, 
            strm.baco, 
            strm.bahc_1, 
            strm.bahc_2, 
            strm.bahc_3, 
            strm.bahc_dtwc, 
            strm.bahc_rfrc, 
            strm.bala, 
            strm.balc, 
            strm.balh_1, 
            strm.balh_2, 
            strm.balh_3, 
            strm.balh_dtwc, 
            strm.balh_rfrc, 
            strm.bank, 
            strm.basi, 
            strm.bdat, 
            strm.bdsp, 
            strm.bdsp_kw, 
            strm.bkrn, 
            strm.blac, 
            strm.blac_kw, 
            strm.bloc, 
            strm.bloc_ref_compnr, 
            strm.bpri, 
            strm.bref, 
            strm.bref_ref_compnr, 
            strm.btno, 
            strm.bust, 
            strm.bust_kw, 
            strm.ccrs, 
            strm.ccrs_ref_compnr, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdam_1, 
            strm.cdam_2, 
            strm.cdam_3, 
            strm.cdam_dtwc, 
            strm.cdam_invc, 
            strm.cdam_rfrc, 
            strm.cfrs, 
            strm.cfrs_ref_compnr, 
            strm.clus, 
            strm.compnr, 
            strm.cpay, 
            strm.cpay_ref_compnr, 
            strm.cvat, 
            strm.cvat_ref_compnr, 
            strm.dapr, 
            strm.dc1a, 
            strm.dc1h_1, 
            strm.dc1h_2, 
            strm.dc1h_3, 
            strm.dc1h_dtwc, 
            strm.dc1h_rfrc, 
            strm.dc1i, 
            strm.dc2a, 
            strm.dc2h_1, 
            strm.dc2h_2, 
            strm.dc2h_3, 
            strm.dc2h_dtwc, 
            strm.dc2h_rfrc, 
            strm.dc2i, 
            strm.dc3a, 
            strm.dc3h_1, 
            strm.dc3h_2, 
            strm.dc3h_3, 
            strm.dc3h_dtwc, 
            strm.dc3h_rfrc, 
            strm.dc3i, 
            strm.deleted, 
            strm.did1, 
            strm.did2, 
            strm.did3, 
            strm.dim1, 
            strm.dim2, 
            strm.dim3, 
            strm.dim4, 
            strm.dim5, 
            strm.dim6, 
            strm.dim7, 
            strm.dim8, 
            strm.dim9, 
            strm.dm10, 
            strm.dm11, 
            strm.dm12, 
            strm.doca, 
            strm.docd, 
            strm.docn, 
            strm.dued, 
            strm.edtp, 
            strm.edtp_kw, 
            strm.enia, 
            strm.enia_kw, 
            strm.iadr, 
            strm.iadr_ref_compnr, 
            strm.ifbp, 
            strm.ifbp_ref_compnr, 
            strm.ildp, 
            strm.ildp_kw, 
            strm.irdt, 
            strm.isup, 
            strm.lapa, 
            strm.laph_1, 
            strm.laph_2, 
            strm.laph_3, 
            strm.laph_dtwc, 
            strm.laph_rfrc, 
            strm.lapi, 
            strm.leac, 
            strm.leac_ref_compnr, 
            strm.line, 
            strm.link, 
            strm.lino, 
            strm.liqd, 
            strm.load, 
            strm.loco, 
            strm.lpdt, 
            strm.lvat, 
            strm.lvat_kw, 
            strm.ninv, 
            strm.oinv, 
            strm.optb, 
            strm.optb_ref_compnr, 
            strm.orno, 
            strm.osch, 
            strm.osup, 
            strm.otbp, 
            strm.otbp_ref_compnr, 
            strm.otyp, 
            strm.otyp_ref_compnr, 
            strm.pada, 
            strm.padh_1, 
            strm.padh_2, 
            strm.padh_3, 
            strm.padh_dtwc, 
            strm.padh_rfrc, 
            strm.padi, 
            strm.papr, 
            strm.papr_kw, 
            strm.paya, 
            strm.paya_ref_compnr, 
            strm.payd, 
            strm.payl, 
            strm.paym, 
            strm.paym_ref_compnr, 
            strm.payt, 
            strm.pcom, 
            strm.pdat, 
            strm.pdif, 
            strm.pdoc, 
            strm.pfre, 
            strm.pfre_kw, 
            strm.post, 
            strm.prin, 
            strm.prin_kw, 
            strm.prod, 
            strm.ptad, 
            strm.ptad_ref_compnr, 
            strm.ptbp, 
            strm.ptbp_bank_ref_compnr, 
            strm.ptbp_ref_compnr, 
            strm.ptyp, 
            strm.ptyp_ref_compnr, 
            strm.pysh, 
            strm.pysh_kw, 
            strm.rade, 
            strm.rade_kw, 
            strm.ragr, 
            strm.ratd, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rcpt, 
            strm.rcpt_kw, 
            strm.reas, 
            strm.reas_ref_compnr, 
            strm.refr, 
            strm.regc, 
            strm.regc_ref_compnr, 
            strm.rtyp, 
            strm.schn, 
            strm.sequencenumber, 
            strm.sgtp, 
            strm.sgtp_kw, 
            strm.shpi, 
            strm.shpm, 
            strm.stap, 
            strm.stap_kw, 
            strm.stat, 
            strm.stat_kw, 
            strm.step, 
            strm.step_kw, 
            strm.subc, 
            strm.subc_kw, 
            strm.svah_1, 
            strm.svah_2, 
            strm.svah_3, 
            strm.svam, 
            strm.tapr, 
            strm.tbrl, 
            strm.tdoc, 
            strm.tdoc_ref_compnr, 
            strm.text, 
            strm.text_ref_compnr, 
            strm.timestamp, 
            strm.tnpn, 
            strm.tore_1, 
            strm.tore_2, 
            strm.tore_3, 
            strm.tore_dtwc, 
            strm.tore_invc, 
            strm.tore_rfrc, 
            strm.tpay, 
            strm.tpay_kw, 
            strm.ttyp, 
            strm.ttyp_ref_compnr, 
            strm.txdt, 
            strm.txtb, 
            strm.txtb_ref_compnr, 
            strm.typa, 
            strm.typa_ref_compnr, 
            strm.user, 
            strm.username, 
            strm.vata, 
            strm.vatc, 
            strm.vatc_cvat_ref_compnr, 
            strm.vatc_ref_compnr, 
            strm.vath_1, 
            strm.vath_2, 
            strm.vath_3, 
            strm.vath_dtwc, 
            strm.vath_rfrc, 
            strm.vati, 
            strm.vatp, 
            strm.vaty, 
            strm.vrsm, 
            strm.whti, 
            strm.whti_kw, 
            strm.wtph_1, 
            strm.wtph_2, 
            strm.wtph_3, 
            strm.wtpi, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.ttyp,
            strm.ninv,
            strm.line,
            strm.tdoc,
            strm.docn,
            strm.lino ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TFACP200 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.ttyp=src.ttyp) OR (target.ttyp IS NULL AND src.ttyp IS NULL)) AND
            ((target.ninv=src.ninv) OR (target.ninv IS NULL AND src.ninv IS NULL)) AND
            ((target.line=src.line) OR (target.line IS NULL AND src.line IS NULL)) AND
            ((target.tdoc=src.tdoc) OR (target.tdoc IS NULL AND src.tdoc IS NULL)) AND
            ((target.docn=src.docn) OR (target.docn IS NULL AND src.docn IS NULL)) AND
            ((target.lino=src.lino) OR (target.lino IS NULL AND src.lino IS NULL)) 
                when matched then update set
                    target.adcd=src.adcd, 
                    target.adty=src.adty, 
                    target.adty_kw=src.adty_kw, 
                    target.afpy=src.afpy, 
                    target.afpy_kw=src.afpy_kw, 
                    target.amnt=src.amnt, 
                    target.amth_1=src.amth_1, 
                    target.amth_2=src.amth_2, 
                    target.amth_3=src.amth_3, 
                    target.amth_dtwc=src.amth_dtwc, 
                    target.amth_rfrc=src.amth_rfrc, 
                    target.amti=src.amti, 
                    target.appr=src.appr, 
                    target.appr_kw=src.appr_kw, 
                    target.autm=src.autm, 
                    target.autm_kw=src.autm_kw, 
                    target.baca_1=src.baca_1, 
                    target.baca_2=src.baca_2, 
                    target.baca_3=src.baca_3, 
                    target.baca_dtwc=src.baca_dtwc, 
                    target.baca_invc=src.baca_invc, 
                    target.baca_rfrc=src.baca_rfrc, 
                    target.baco=src.baco, 
                    target.bahc_1=src.bahc_1, 
                    target.bahc_2=src.bahc_2, 
                    target.bahc_3=src.bahc_3, 
                    target.bahc_dtwc=src.bahc_dtwc, 
                    target.bahc_rfrc=src.bahc_rfrc, 
                    target.bala=src.bala, 
                    target.balc=src.balc, 
                    target.balh_1=src.balh_1, 
                    target.balh_2=src.balh_2, 
                    target.balh_3=src.balh_3, 
                    target.balh_dtwc=src.balh_dtwc, 
                    target.balh_rfrc=src.balh_rfrc, 
                    target.bank=src.bank, 
                    target.basi=src.basi, 
                    target.bdat=src.bdat, 
                    target.bdsp=src.bdsp, 
                    target.bdsp_kw=src.bdsp_kw, 
                    target.bkrn=src.bkrn, 
                    target.blac=src.blac, 
                    target.blac_kw=src.blac_kw, 
                    target.bloc=src.bloc, 
                    target.bloc_ref_compnr=src.bloc_ref_compnr, 
                    target.bpri=src.bpri, 
                    target.bref=src.bref, 
                    target.bref_ref_compnr=src.bref_ref_compnr, 
                    target.btno=src.btno, 
                    target.bust=src.bust, 
                    target.bust_kw=src.bust_kw, 
                    target.ccrs=src.ccrs, 
                    target.ccrs_ref_compnr=src.ccrs_ref_compnr, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdam_1=src.cdam_1, 
                    target.cdam_2=src.cdam_2, 
                    target.cdam_3=src.cdam_3, 
                    target.cdam_dtwc=src.cdam_dtwc, 
                    target.cdam_invc=src.cdam_invc, 
                    target.cdam_rfrc=src.cdam_rfrc, 
                    target.cfrs=src.cfrs, 
                    target.cfrs_ref_compnr=src.cfrs_ref_compnr, 
                    target.clus=src.clus, 
                    target.compnr=src.compnr, 
                    target.cpay=src.cpay, 
                    target.cpay_ref_compnr=src.cpay_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvat_ref_compnr=src.cvat_ref_compnr, 
                    target.dapr=src.dapr, 
                    target.dc1a=src.dc1a, 
                    target.dc1h_1=src.dc1h_1, 
                    target.dc1h_2=src.dc1h_2, 
                    target.dc1h_3=src.dc1h_3, 
                    target.dc1h_dtwc=src.dc1h_dtwc, 
                    target.dc1h_rfrc=src.dc1h_rfrc, 
                    target.dc1i=src.dc1i, 
                    target.dc2a=src.dc2a, 
                    target.dc2h_1=src.dc2h_1, 
                    target.dc2h_2=src.dc2h_2, 
                    target.dc2h_3=src.dc2h_3, 
                    target.dc2h_dtwc=src.dc2h_dtwc, 
                    target.dc2h_rfrc=src.dc2h_rfrc, 
                    target.dc2i=src.dc2i, 
                    target.dc3a=src.dc3a, 
                    target.dc3h_1=src.dc3h_1, 
                    target.dc3h_2=src.dc3h_2, 
                    target.dc3h_3=src.dc3h_3, 
                    target.dc3h_dtwc=src.dc3h_dtwc, 
                    target.dc3h_rfrc=src.dc3h_rfrc, 
                    target.dc3i=src.dc3i, 
                    target.deleted=src.deleted, 
                    target.did1=src.did1, 
                    target.did2=src.did2, 
                    target.did3=src.did3, 
                    target.dim1=src.dim1, 
                    target.dim2=src.dim2, 
                    target.dim3=src.dim3, 
                    target.dim4=src.dim4, 
                    target.dim5=src.dim5, 
                    target.dim6=src.dim6, 
                    target.dim7=src.dim7, 
                    target.dim8=src.dim8, 
                    target.dim9=src.dim9, 
                    target.dm10=src.dm10, 
                    target.dm11=src.dm11, 
                    target.dm12=src.dm12, 
                    target.doca=src.doca, 
                    target.docd=src.docd, 
                    target.docn=src.docn, 
                    target.dued=src.dued, 
                    target.edtp=src.edtp, 
                    target.edtp_kw=src.edtp_kw, 
                    target.enia=src.enia, 
                    target.enia_kw=src.enia_kw, 
                    target.iadr=src.iadr, 
                    target.iadr_ref_compnr=src.iadr_ref_compnr, 
                    target.ifbp=src.ifbp, 
                    target.ifbp_ref_compnr=src.ifbp_ref_compnr, 
                    target.ildp=src.ildp, 
                    target.ildp_kw=src.ildp_kw, 
                    target.irdt=src.irdt, 
                    target.isup=src.isup, 
                    target.lapa=src.lapa, 
                    target.laph_1=src.laph_1, 
                    target.laph_2=src.laph_2, 
                    target.laph_3=src.laph_3, 
                    target.laph_dtwc=src.laph_dtwc, 
                    target.laph_rfrc=src.laph_rfrc, 
                    target.lapi=src.lapi, 
                    target.leac=src.leac, 
                    target.leac_ref_compnr=src.leac_ref_compnr, 
                    target.line=src.line, 
                    target.link=src.link, 
                    target.lino=src.lino, 
                    target.liqd=src.liqd, 
                    target.load=src.load, 
                    target.loco=src.loco, 
                    target.lpdt=src.lpdt, 
                    target.lvat=src.lvat, 
                    target.lvat_kw=src.lvat_kw, 
                    target.ninv=src.ninv, 
                    target.oinv=src.oinv, 
                    target.optb=src.optb, 
                    target.optb_ref_compnr=src.optb_ref_compnr, 
                    target.orno=src.orno, 
                    target.osch=src.osch, 
                    target.osup=src.osup, 
                    target.otbp=src.otbp, 
                    target.otbp_ref_compnr=src.otbp_ref_compnr, 
                    target.otyp=src.otyp, 
                    target.otyp_ref_compnr=src.otyp_ref_compnr, 
                    target.pada=src.pada, 
                    target.padh_1=src.padh_1, 
                    target.padh_2=src.padh_2, 
                    target.padh_3=src.padh_3, 
                    target.padh_dtwc=src.padh_dtwc, 
                    target.padh_rfrc=src.padh_rfrc, 
                    target.padi=src.padi, 
                    target.papr=src.papr, 
                    target.papr_kw=src.papr_kw, 
                    target.paya=src.paya, 
                    target.paya_ref_compnr=src.paya_ref_compnr, 
                    target.payd=src.payd, 
                    target.payl=src.payl, 
                    target.paym=src.paym, 
                    target.paym_ref_compnr=src.paym_ref_compnr, 
                    target.payt=src.payt, 
                    target.pcom=src.pcom, 
                    target.pdat=src.pdat, 
                    target.pdif=src.pdif, 
                    target.pdoc=src.pdoc, 
                    target.pfre=src.pfre, 
                    target.pfre_kw=src.pfre_kw, 
                    target.post=src.post, 
                    target.prin=src.prin, 
                    target.prin_kw=src.prin_kw, 
                    target.prod=src.prod, 
                    target.ptad=src.ptad, 
                    target.ptad_ref_compnr=src.ptad_ref_compnr, 
                    target.ptbp=src.ptbp, 
                    target.ptbp_bank_ref_compnr=src.ptbp_bank_ref_compnr, 
                    target.ptbp_ref_compnr=src.ptbp_ref_compnr, 
                    target.ptyp=src.ptyp, 
                    target.ptyp_ref_compnr=src.ptyp_ref_compnr, 
                    target.pysh=src.pysh, 
                    target.pysh_kw=src.pysh_kw, 
                    target.rade=src.rade, 
                    target.rade_kw=src.rade_kw, 
                    target.ragr=src.ragr, 
                    target.ratd=src.ratd, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rcpt=src.rcpt, 
                    target.rcpt_kw=src.rcpt_kw, 
                    target.reas=src.reas, 
                    target.reas_ref_compnr=src.reas_ref_compnr, 
                    target.refr=src.refr, 
                    target.regc=src.regc, 
                    target.regc_ref_compnr=src.regc_ref_compnr, 
                    target.rtyp=src.rtyp, 
                    target.schn=src.schn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sgtp=src.sgtp, 
                    target.sgtp_kw=src.sgtp_kw, 
                    target.shpi=src.shpi, 
                    target.shpm=src.shpm, 
                    target.stap=src.stap, 
                    target.stap_kw=src.stap_kw, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.step=src.step, 
                    target.step_kw=src.step_kw, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.svah_1=src.svah_1, 
                    target.svah_2=src.svah_2, 
                    target.svah_3=src.svah_3, 
                    target.svam=src.svam, 
                    target.tapr=src.tapr, 
                    target.tbrl=src.tbrl, 
                    target.tdoc=src.tdoc, 
                    target.tdoc_ref_compnr=src.tdoc_ref_compnr, 
                    target.text=src.text, 
                    target.text_ref_compnr=src.text_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tnpn=src.tnpn, 
                    target.tore_1=src.tore_1, 
                    target.tore_2=src.tore_2, 
                    target.tore_3=src.tore_3, 
                    target.tore_dtwc=src.tore_dtwc, 
                    target.tore_invc=src.tore_invc, 
                    target.tore_rfrc=src.tore_rfrc, 
                    target.tpay=src.tpay, 
                    target.tpay_kw=src.tpay_kw, 
                    target.ttyp=src.ttyp, 
                    target.ttyp_ref_compnr=src.ttyp_ref_compnr, 
                    target.txdt=src.txdt, 
                    target.txtb=src.txtb, 
                    target.txtb_ref_compnr=src.txtb_ref_compnr, 
                    target.typa=src.typa, 
                    target.typa_ref_compnr=src.typa_ref_compnr, 
                    target.user=src.user, 
                    target.username=src.username, 
                    target.vata=src.vata, 
                    target.vatc=src.vatc, 
                    target.vatc_cvat_ref_compnr=src.vatc_cvat_ref_compnr, 
                    target.vatc_ref_compnr=src.vatc_ref_compnr, 
                    target.vath_1=src.vath_1, 
                    target.vath_2=src.vath_2, 
                    target.vath_3=src.vath_3, 
                    target.vath_dtwc=src.vath_dtwc, 
                    target.vath_rfrc=src.vath_rfrc, 
                    target.vati=src.vati, 
                    target.vatp=src.vatp, 
                    target.vaty=src.vaty, 
                    target.vrsm=src.vrsm, 
                    target.whti=src.whti, 
                    target.whti_kw=src.whti_kw, 
                    target.wtph_1=src.wtph_1, 
                    target.wtph_2=src.wtph_2, 
                    target.wtph_3=src.wtph_3, 
                    target.wtpi=src.wtpi, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( adcd, adty, adty_kw, afpy, afpy_kw, amnt, amth_1, amth_2, amth_3, amth_dtwc, amth_rfrc, amti, appr, appr_kw, autm, autm_kw, baca_1, baca_2, baca_3, baca_dtwc, baca_invc, baca_rfrc, baco, bahc_1, bahc_2, bahc_3, bahc_dtwc, bahc_rfrc, bala, balc, balh_1, balh_2, balh_3, balh_dtwc, balh_rfrc, bank, basi, bdat, bdsp, bdsp_kw, bkrn, blac, blac_kw, bloc, bloc_ref_compnr, bpri, bref, bref_ref_compnr, btno, bust, bust_kw, ccrs, ccrs_ref_compnr, ccur, ccur_ref_compnr, cdam_1, cdam_2, cdam_3, cdam_dtwc, cdam_invc, cdam_rfrc, cfrs, cfrs_ref_compnr, clus, compnr, cpay, cpay_ref_compnr, cvat, cvat_ref_compnr, dapr, dc1a, dc1h_1, dc1h_2, dc1h_3, dc1h_dtwc, dc1h_rfrc, dc1i, dc2a, dc2h_1, dc2h_2, dc2h_3, dc2h_dtwc, dc2h_rfrc, dc2i, dc3a, dc3h_1, dc3h_2, dc3h_3, dc3h_dtwc, dc3h_rfrc, dc3i, deleted, did1, did2, did3, dim1, dim2, dim3, dim4, dim5, dim6, dim7, dim8, dim9, dm10, dm11, dm12, doca, docd, docn, dued, edtp, edtp_kw, enia, enia_kw, iadr, iadr_ref_compnr, ifbp, ifbp_ref_compnr, ildp, ildp_kw, irdt, isup, lapa, laph_1, laph_2, laph_3, laph_dtwc, laph_rfrc, lapi, leac, leac_ref_compnr, line, link, lino, liqd, load, loco, lpdt, lvat, lvat_kw, ninv, oinv, optb, optb_ref_compnr, orno, osch, osup, otbp, otbp_ref_compnr, otyp, otyp_ref_compnr, pada, padh_1, padh_2, padh_3, padh_dtwc, padh_rfrc, padi, papr, papr_kw, paya, paya_ref_compnr, payd, payl, paym, paym_ref_compnr, payt, pcom, pdat, pdif, pdoc, pfre, pfre_kw, post, prin, prin_kw, prod, ptad, ptad_ref_compnr, ptbp, ptbp_bank_ref_compnr, ptbp_ref_compnr, ptyp, ptyp_ref_compnr, pysh, pysh_kw, rade, rade_kw, ragr, ratd, rate_1, rate_2, rate_3, ratf_1, ratf_2, ratf_3, rcpt, rcpt_kw, reas, reas_ref_compnr, refr, regc, regc_ref_compnr, rtyp, schn, sequencenumber, sgtp, sgtp_kw, shpi, shpm, stap, stap_kw, stat, stat_kw, step, step_kw, subc, subc_kw, svah_1, svah_2, svah_3, svam, tapr, tbrl, tdoc, tdoc_ref_compnr, text, text_ref_compnr, timestamp, tnpn, tore_1, tore_2, tore_3, tore_dtwc, tore_invc, tore_rfrc, tpay, tpay_kw, ttyp, ttyp_ref_compnr, txdt, txtb, txtb_ref_compnr, typa, typa_ref_compnr, user, username, vata, vatc, vatc_cvat_ref_compnr, vatc_ref_compnr, vath_1, vath_2, vath_3, vath_dtwc, vath_rfrc, vati, vatp, vaty, vrsm, whti, whti_kw, wtph_1, wtph_2, wtph_3, wtpi, year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.adcd, 
                    src.adty, 
                    src.adty_kw, 
                    src.afpy, 
                    src.afpy_kw, 
                    src.amnt, 
                    src.amth_1, 
                    src.amth_2, 
                    src.amth_3, 
                    src.amth_dtwc, 
                    src.amth_rfrc, 
                    src.amti, 
                    src.appr, 
                    src.appr_kw, 
                    src.autm, 
                    src.autm_kw, 
                    src.baca_1, 
                    src.baca_2, 
                    src.baca_3, 
                    src.baca_dtwc, 
                    src.baca_invc, 
                    src.baca_rfrc, 
                    src.baco, 
                    src.bahc_1, 
                    src.bahc_2, 
                    src.bahc_3, 
                    src.bahc_dtwc, 
                    src.bahc_rfrc, 
                    src.bala, 
                    src.balc, 
                    src.balh_1, 
                    src.balh_2, 
                    src.balh_3, 
                    src.balh_dtwc, 
                    src.balh_rfrc, 
                    src.bank, 
                    src.basi, 
                    src.bdat, 
                    src.bdsp, 
                    src.bdsp_kw, 
                    src.bkrn, 
                    src.blac, 
                    src.blac_kw, 
                    src.bloc, 
                    src.bloc_ref_compnr, 
                    src.bpri, 
                    src.bref, 
                    src.bref_ref_compnr, 
                    src.btno, 
                    src.bust, 
                    src.bust_kw, 
                    src.ccrs, 
                    src.ccrs_ref_compnr, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdam_1, 
                    src.cdam_2, 
                    src.cdam_3, 
                    src.cdam_dtwc, 
                    src.cdam_invc, 
                    src.cdam_rfrc, 
                    src.cfrs, 
                    src.cfrs_ref_compnr, 
                    src.clus, 
                    src.compnr, 
                    src.cpay, 
                    src.cpay_ref_compnr, 
                    src.cvat, 
                    src.cvat_ref_compnr, 
                    src.dapr, 
                    src.dc1a, 
                    src.dc1h_1, 
                    src.dc1h_2, 
                    src.dc1h_3, 
                    src.dc1h_dtwc, 
                    src.dc1h_rfrc, 
                    src.dc1i, 
                    src.dc2a, 
                    src.dc2h_1, 
                    src.dc2h_2, 
                    src.dc2h_3, 
                    src.dc2h_dtwc, 
                    src.dc2h_rfrc, 
                    src.dc2i, 
                    src.dc3a, 
                    src.dc3h_1, 
                    src.dc3h_2, 
                    src.dc3h_3, 
                    src.dc3h_dtwc, 
                    src.dc3h_rfrc, 
                    src.dc3i, 
                    src.deleted, 
                    src.did1, 
                    src.did2, 
                    src.did3, 
                    src.dim1, 
                    src.dim2, 
                    src.dim3, 
                    src.dim4, 
                    src.dim5, 
                    src.dim6, 
                    src.dim7, 
                    src.dim8, 
                    src.dim9, 
                    src.dm10, 
                    src.dm11, 
                    src.dm12, 
                    src.doca, 
                    src.docd, 
                    src.docn, 
                    src.dued, 
                    src.edtp, 
                    src.edtp_kw, 
                    src.enia, 
                    src.enia_kw, 
                    src.iadr, 
                    src.iadr_ref_compnr, 
                    src.ifbp, 
                    src.ifbp_ref_compnr, 
                    src.ildp, 
                    src.ildp_kw, 
                    src.irdt, 
                    src.isup, 
                    src.lapa, 
                    src.laph_1, 
                    src.laph_2, 
                    src.laph_3, 
                    src.laph_dtwc, 
                    src.laph_rfrc, 
                    src.lapi, 
                    src.leac, 
                    src.leac_ref_compnr, 
                    src.line, 
                    src.link, 
                    src.lino, 
                    src.liqd, 
                    src.load, 
                    src.loco, 
                    src.lpdt, 
                    src.lvat, 
                    src.lvat_kw, 
                    src.ninv, 
                    src.oinv, 
                    src.optb, 
                    src.optb_ref_compnr, 
                    src.orno, 
                    src.osch, 
                    src.osup, 
                    src.otbp, 
                    src.otbp_ref_compnr, 
                    src.otyp, 
                    src.otyp_ref_compnr, 
                    src.pada, 
                    src.padh_1, 
                    src.padh_2, 
                    src.padh_3, 
                    src.padh_dtwc, 
                    src.padh_rfrc, 
                    src.padi, 
                    src.papr, 
                    src.papr_kw, 
                    src.paya, 
                    src.paya_ref_compnr, 
                    src.payd, 
                    src.payl, 
                    src.paym, 
                    src.paym_ref_compnr, 
                    src.payt, 
                    src.pcom, 
                    src.pdat, 
                    src.pdif, 
                    src.pdoc, 
                    src.pfre, 
                    src.pfre_kw, 
                    src.post, 
                    src.prin, 
                    src.prin_kw, 
                    src.prod, 
                    src.ptad, 
                    src.ptad_ref_compnr, 
                    src.ptbp, 
                    src.ptbp_bank_ref_compnr, 
                    src.ptbp_ref_compnr, 
                    src.ptyp, 
                    src.ptyp_ref_compnr, 
                    src.pysh, 
                    src.pysh_kw, 
                    src.rade, 
                    src.rade_kw, 
                    src.ragr, 
                    src.ratd, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rcpt, 
                    src.rcpt_kw, 
                    src.reas, 
                    src.reas_ref_compnr, 
                    src.refr, 
                    src.regc, 
                    src.regc_ref_compnr, 
                    src.rtyp, 
                    src.schn, 
                    src.sequencenumber, 
                    src.sgtp, 
                    src.sgtp_kw, 
                    src.shpi, 
                    src.shpm, 
                    src.stap, 
                    src.stap_kw, 
                    src.stat, 
                    src.stat_kw, 
                    src.step, 
                    src.step_kw, 
                    src.subc, 
                    src.subc_kw, 
                    src.svah_1, 
                    src.svah_2, 
                    src.svah_3, 
                    src.svam, 
                    src.tapr, 
                    src.tbrl, 
                    src.tdoc, 
                    src.tdoc_ref_compnr, 
                    src.text, 
                    src.text_ref_compnr, 
                    src.timestamp, 
                    src.tnpn, 
                    src.tore_1, 
                    src.tore_2, 
                    src.tore_3, 
                    src.tore_dtwc, 
                    src.tore_invc, 
                    src.tore_rfrc, 
                    src.tpay, 
                    src.tpay_kw, 
                    src.ttyp, 
                    src.ttyp_ref_compnr, 
                    src.txdt, 
                    src.txtb, 
                    src.txtb_ref_compnr, 
                    src.typa, 
                    src.typa_ref_compnr, 
                    src.user, 
                    src.username, 
                    src.vata, 
                    src.vatc, 
                    src.vatc_cvat_ref_compnr, 
                    src.vatc_ref_compnr, 
                    src.vath_1, 
                    src.vath_2, 
                    src.vath_3, 
                    src.vath_dtwc, 
                    src.vath_rfrc, 
                    src.vati, 
                    src.vatp, 
                    src.vaty, 
                    src.vrsm, 
                    src.whti, 
                    src.whti_kw, 
                    src.wtph_1, 
                    src.wtph_2, 
                    src.wtph_3, 
                    src.wtpi, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;