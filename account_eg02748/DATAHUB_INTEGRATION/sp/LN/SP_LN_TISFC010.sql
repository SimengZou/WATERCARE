create or replace procedure DATAHUB_INTEGRATION.SP_LN_TISFC010()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TISFC010_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TISFC010 as target using (SELECT * FROM (SELECT 
            strm.ardt, 
            strm.asdt, 
            strm.bfls, 
            strm.bfls_kw, 
            strm.blcd, 
            strm.blcd_ref_compnr, 
            strm.bpid, 
            strm.bpid_ref_compnr, 
            strm.cctt, 
            strm.cctt_kw, 
            strm.cmdt, 
            strm.compnr, 
            strm.cont, 
            strm.copo, 
            strm.copo_kw, 
            strm.crem, 
            strm.cwoc, 
            strm.cwoc_ref_compnr, 
            strm.deleted, 
            strm.dmso, 
            strm.dmso_kw, 
            strm.esdt, 
            strm.fdur, 
            strm.fdur_kw, 
            strm.fidt, 
            strm.fxpd, 
            strm.fxpd_kw, 
            strm.fxsu, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.lfdt, 
            strm.maho, 
            strm.mcho, 
            strm.mcno, 
            strm.mcno_ref_compnr, 
            strm.mcoc, 
            strm.mnrs, 
            strm.mnrs_kw, 
            strm.mopr, 
            strm.most, 
            strm.mtyp, 
            strm.mtyp_ref_compnr, 
            strm.mvrd, 
            strm.mvtm, 
            strm.nnts, 
            strm.nomc, 
            strm.nopr, 
            strm.oopn, 
            strm.oopr, 
            strm.opno, 
            strm.opst, 
            strm.opst_kw, 
            strm.orcd, 
            strm.orrv, 
            strm.oset, 
            strm.pdno, 
            strm.pdno_ref_compnr, 
            strm.pfdt, 
            strm.phsp, 
            strm.phsp_buar, 
            strm.phsp_buln, 
            strm.phsp_bupc, 
            strm.phsp_butm, 
            strm.phsp_buvl, 
            strm.phsp_buwg, 
            strm.ploc, 
            strm.prdt, 
            strm.prrd, 
            strm.prte, 
            strm.prtm, 
            strm.psdt, 
            strm.qbfd, 
            strm.qbfd_buar, 
            strm.qbfd_buln, 
            strm.qbfd_bupc, 
            strm.qbfd_butm, 
            strm.qbfd_buvl, 
            strm.qbfd_buwg, 
            strm.qcmp, 
            strm.qpli, 
            strm.qplo, 
            strm.qpnt, 
            strm.qqar, 
            strm.qqar_buar, 
            strm.qqar_buln, 
            strm.qqar_bupc, 
            strm.qqar_butm, 
            strm.qqar_buvl, 
            strm.qqar_buwg, 
            strm.qrjc, 
            strm.qrjc_buar, 
            strm.qrjc_buln, 
            strm.qrjc_bupc, 
            strm.qrjc_butm, 
            strm.qrjc_buvl, 
            strm.qrjc_buwg, 
            strm.qsbc, 
            strm.qsbc_buar, 
            strm.qsbc_buln, 
            strm.qsbc_bupc, 
            strm.qsbc_butm, 
            strm.qsbc_buvl, 
            strm.qsbc_buwg, 
            strm.qtbf, 
            strm.qtbf_buar, 
            strm.qtbf_buln, 
            strm.qtbf_bupc, 
            strm.qtbf_butm, 
            strm.qtbf_buvl, 
            strm.qtbf_buwg, 
            strm.qtbi, 
            strm.qtbi_buar, 
            strm.qtbi_buln, 
            strm.qtbi_bupc, 
            strm.qtbi_butm, 
            strm.qtbi_buvl, 
            strm.qtbi_buwg, 
            strm.qtor, 
            strm.qtor_buar, 
            strm.qtor_buln, 
            strm.qtor_bupc, 
            strm.qtor_butm, 
            strm.qtor_buvl, 
            strm.qtor_buwg, 
            strm.qtrt, 
            strm.qutm, 
            strm.qxac, 
            strm.reco, 
            strm.reco_ref_compnr, 
            strm.refo, 
            strm.retm, 
            strm.rmch, 
            strm.rmch_kw, 
            strm.romt, 
            strm.rosi, 
            strm.rowc, 
            strm.rsdt, 
            strm.runi, 
            strm.rusd, 
            strm.rutm, 
            strm.scpq, 
            strm.scpq_buar, 
            strm.scpq_buln, 
            strm.scpq_bupc, 
            strm.scpq_butm, 
            strm.scpq_buvl, 
            strm.scpq_buwg, 
            strm.sctt, 
            strm.sctt_kw, 
            strm.sdoc, 
            strm.sdoc_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.sltm, 
            strm.sopr, 
            strm.sopr_kw, 
            strm.sptm, 
            strm.srit, 
            strm.sset, 
            strm.ssmd, 
            strm.ssmd_kw, 
            strm.sstm, 
            strm.suba, 
            strm.suba_ref_compnr, 
            strm.subr, 
            strm.subs, 
            strm.subs_ref_compnr, 
            strm.sutm, 
            strm.tano, 
            strm.tano_ref_compnr, 
            strm.timestamp, 
            strm.tlyn, 
            strm.tlyn_kw, 
            strm.trdf, 
            strm.trdl, 
            strm.trdt, 
            strm.trls, 
            strm.trno, 
            strm.tuni, 
            strm.tuni_kw, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.wcst, 
            strm.wcst_cwoc_mtyp_ref_compnr, 
            strm.whsa, 
            strm.whsa_ref_compnr, 
            strm.ydtp, 
            strm.ydtp_kw, 
            strm.yldp, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.pdno,
            strm.opno ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TISFC010 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.pdno=src.pdno) OR (target.pdno IS NULL AND src.pdno IS NULL)) AND
            ((target.opno=src.opno) OR (target.opno IS NULL AND src.opno IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.ardt=src.ardt, 
                    target.asdt=src.asdt, 
                    target.bfls=src.bfls, 
                    target.bfls_kw=src.bfls_kw, 
                    target.blcd=src.blcd, 
                    target.blcd_ref_compnr=src.blcd_ref_compnr, 
                    target.bpid=src.bpid, 
                    target.bpid_ref_compnr=src.bpid_ref_compnr, 
                    target.cctt=src.cctt, 
                    target.cctt_kw=src.cctt_kw, 
                    target.cmdt=src.cmdt, 
                    target.compnr=src.compnr, 
                    target.cont=src.cont, 
                    target.copo=src.copo, 
                    target.copo_kw=src.copo_kw, 
                    target.crem=src.crem, 
                    target.cwoc=src.cwoc, 
                    target.cwoc_ref_compnr=src.cwoc_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dmso=src.dmso, 
                    target.dmso_kw=src.dmso_kw, 
                    target.esdt=src.esdt, 
                    target.fdur=src.fdur, 
                    target.fdur_kw=src.fdur_kw, 
                    target.fidt=src.fidt, 
                    target.fxpd=src.fxpd, 
                    target.fxpd_kw=src.fxpd_kw, 
                    target.fxsu=src.fxsu, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.lfdt=src.lfdt, 
                    target.maho=src.maho, 
                    target.mcho=src.mcho, 
                    target.mcno=src.mcno, 
                    target.mcno_ref_compnr=src.mcno_ref_compnr, 
                    target.mcoc=src.mcoc, 
                    target.mnrs=src.mnrs, 
                    target.mnrs_kw=src.mnrs_kw, 
                    target.mopr=src.mopr, 
                    target.most=src.most, 
                    target.mtyp=src.mtyp, 
                    target.mtyp_ref_compnr=src.mtyp_ref_compnr, 
                    target.mvrd=src.mvrd, 
                    target.mvtm=src.mvtm, 
                    target.nnts=src.nnts, 
                    target.nomc=src.nomc, 
                    target.nopr=src.nopr, 
                    target.oopn=src.oopn, 
                    target.oopr=src.oopr, 
                    target.opno=src.opno, 
                    target.opst=src.opst, 
                    target.opst_kw=src.opst_kw, 
                    target.orcd=src.orcd, 
                    target.orrv=src.orrv, 
                    target.oset=src.oset, 
                    target.pdno=src.pdno, 
                    target.pdno_ref_compnr=src.pdno_ref_compnr, 
                    target.pfdt=src.pfdt, 
                    target.phsp=src.phsp, 
                    target.phsp_buar=src.phsp_buar, 
                    target.phsp_buln=src.phsp_buln, 
                    target.phsp_bupc=src.phsp_bupc, 
                    target.phsp_butm=src.phsp_butm, 
                    target.phsp_buvl=src.phsp_buvl, 
                    target.phsp_buwg=src.phsp_buwg, 
                    target.ploc=src.ploc, 
                    target.prdt=src.prdt, 
                    target.prrd=src.prrd, 
                    target.prte=src.prte, 
                    target.prtm=src.prtm, 
                    target.psdt=src.psdt, 
                    target.qbfd=src.qbfd, 
                    target.qbfd_buar=src.qbfd_buar, 
                    target.qbfd_buln=src.qbfd_buln, 
                    target.qbfd_bupc=src.qbfd_bupc, 
                    target.qbfd_butm=src.qbfd_butm, 
                    target.qbfd_buvl=src.qbfd_buvl, 
                    target.qbfd_buwg=src.qbfd_buwg, 
                    target.qcmp=src.qcmp, 
                    target.qpli=src.qpli, 
                    target.qplo=src.qplo, 
                    target.qpnt=src.qpnt, 
                    target.qqar=src.qqar, 
                    target.qqar_buar=src.qqar_buar, 
                    target.qqar_buln=src.qqar_buln, 
                    target.qqar_bupc=src.qqar_bupc, 
                    target.qqar_butm=src.qqar_butm, 
                    target.qqar_buvl=src.qqar_buvl, 
                    target.qqar_buwg=src.qqar_buwg, 
                    target.qrjc=src.qrjc, 
                    target.qrjc_buar=src.qrjc_buar, 
                    target.qrjc_buln=src.qrjc_buln, 
                    target.qrjc_bupc=src.qrjc_bupc, 
                    target.qrjc_butm=src.qrjc_butm, 
                    target.qrjc_buvl=src.qrjc_buvl, 
                    target.qrjc_buwg=src.qrjc_buwg, 
                    target.qsbc=src.qsbc, 
                    target.qsbc_buar=src.qsbc_buar, 
                    target.qsbc_buln=src.qsbc_buln, 
                    target.qsbc_bupc=src.qsbc_bupc, 
                    target.qsbc_butm=src.qsbc_butm, 
                    target.qsbc_buvl=src.qsbc_buvl, 
                    target.qsbc_buwg=src.qsbc_buwg, 
                    target.qtbf=src.qtbf, 
                    target.qtbf_buar=src.qtbf_buar, 
                    target.qtbf_buln=src.qtbf_buln, 
                    target.qtbf_bupc=src.qtbf_bupc, 
                    target.qtbf_butm=src.qtbf_butm, 
                    target.qtbf_buvl=src.qtbf_buvl, 
                    target.qtbf_buwg=src.qtbf_buwg, 
                    target.qtbi=src.qtbi, 
                    target.qtbi_buar=src.qtbi_buar, 
                    target.qtbi_buln=src.qtbi_buln, 
                    target.qtbi_bupc=src.qtbi_bupc, 
                    target.qtbi_butm=src.qtbi_butm, 
                    target.qtbi_buvl=src.qtbi_buvl, 
                    target.qtbi_buwg=src.qtbi_buwg, 
                    target.qtor=src.qtor, 
                    target.qtor_buar=src.qtor_buar, 
                    target.qtor_buln=src.qtor_buln, 
                    target.qtor_bupc=src.qtor_bupc, 
                    target.qtor_butm=src.qtor_butm, 
                    target.qtor_buvl=src.qtor_buvl, 
                    target.qtor_buwg=src.qtor_buwg, 
                    target.qtrt=src.qtrt, 
                    target.qutm=src.qutm, 
                    target.qxac=src.qxac, 
                    target.reco=src.reco, 
                    target.reco_ref_compnr=src.reco_ref_compnr, 
                    target.refo=src.refo, 
                    target.retm=src.retm, 
                    target.rmch=src.rmch, 
                    target.rmch_kw=src.rmch_kw, 
                    target.romt=src.romt, 
                    target.rosi=src.rosi, 
                    target.rowc=src.rowc, 
                    target.rsdt=src.rsdt, 
                    target.runi=src.runi, 
                    target.rusd=src.rusd, 
                    target.rutm=src.rutm, 
                    target.scpq=src.scpq, 
                    target.scpq_buar=src.scpq_buar, 
                    target.scpq_buln=src.scpq_buln, 
                    target.scpq_bupc=src.scpq_bupc, 
                    target.scpq_butm=src.scpq_butm, 
                    target.scpq_buvl=src.scpq_buvl, 
                    target.scpq_buwg=src.scpq_buwg, 
                    target.sctt=src.sctt, 
                    target.sctt_kw=src.sctt_kw, 
                    target.sdoc=src.sdoc, 
                    target.sdoc_kw=src.sdoc_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sltm=src.sltm, 
                    target.sopr=src.sopr, 
                    target.sopr_kw=src.sopr_kw, 
                    target.sptm=src.sptm, 
                    target.srit=src.srit, 
                    target.sset=src.sset, 
                    target.ssmd=src.ssmd, 
                    target.ssmd_kw=src.ssmd_kw, 
                    target.sstm=src.sstm, 
                    target.suba=src.suba, 
                    target.suba_ref_compnr=src.suba_ref_compnr, 
                    target.subr=src.subr, 
                    target.subs=src.subs, 
                    target.subs_ref_compnr=src.subs_ref_compnr, 
                    target.sutm=src.sutm, 
                    target.tano=src.tano, 
                    target.tano_ref_compnr=src.tano_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tlyn=src.tlyn, 
                    target.tlyn_kw=src.tlyn_kw, 
                    target.trdf=src.trdf, 
                    target.trdl=src.trdl, 
                    target.trdt=src.trdt, 
                    target.trls=src.trls, 
                    target.trno=src.trno, 
                    target.tuni=src.tuni, 
                    target.tuni_kw=src.tuni_kw, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.wcst=src.wcst, 
                    target.wcst_cwoc_mtyp_ref_compnr=src.wcst_cwoc_mtyp_ref_compnr, 
                    target.whsa=src.whsa, 
                    target.whsa_ref_compnr=src.whsa_ref_compnr, 
                    target.ydtp=src.ydtp, 
                    target.ydtp_kw=src.ydtp_kw, 
                    target.yldp=src.yldp, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    ardt, 
                    asdt, 
                    bfls, 
                    bfls_kw, 
                    blcd, 
                    blcd_ref_compnr, 
                    bpid, 
                    bpid_ref_compnr, 
                    cctt, 
                    cctt_kw, 
                    cmdt, 
                    compnr, 
                    cont, 
                    copo, 
                    copo_kw, 
                    crem, 
                    cwoc, 
                    cwoc_ref_compnr, 
                    deleted, 
                    dmso, 
                    dmso_kw, 
                    esdt, 
                    fdur, 
                    fdur_kw, 
                    fidt, 
                    fxpd, 
                    fxpd_kw, 
                    fxsu, 
                    item, 
                    item_ref_compnr, 
                    lfdt, 
                    maho, 
                    mcho, 
                    mcno, 
                    mcno_ref_compnr, 
                    mcoc, 
                    mnrs, 
                    mnrs_kw, 
                    mopr, 
                    most, 
                    mtyp, 
                    mtyp_ref_compnr, 
                    mvrd, 
                    mvtm, 
                    nnts, 
                    nomc, 
                    nopr, 
                    oopn, 
                    oopr, 
                    opno, 
                    opst, 
                    opst_kw, 
                    orcd, 
                    orrv, 
                    oset, 
                    pdno, 
                    pdno_ref_compnr, 
                    pfdt, 
                    phsp, 
                    phsp_buar, 
                    phsp_buln, 
                    phsp_bupc, 
                    phsp_butm, 
                    phsp_buvl, 
                    phsp_buwg, 
                    ploc, 
                    prdt, 
                    prrd, 
                    prte, 
                    prtm, 
                    psdt, 
                    qbfd, 
                    qbfd_buar, 
                    qbfd_buln, 
                    qbfd_bupc, 
                    qbfd_butm, 
                    qbfd_buvl, 
                    qbfd_buwg, 
                    qcmp, 
                    qpli, 
                    qplo, 
                    qpnt, 
                    qqar, 
                    qqar_buar, 
                    qqar_buln, 
                    qqar_bupc, 
                    qqar_butm, 
                    qqar_buvl, 
                    qqar_buwg, 
                    qrjc, 
                    qrjc_buar, 
                    qrjc_buln, 
                    qrjc_bupc, 
                    qrjc_butm, 
                    qrjc_buvl, 
                    qrjc_buwg, 
                    qsbc, 
                    qsbc_buar, 
                    qsbc_buln, 
                    qsbc_bupc, 
                    qsbc_butm, 
                    qsbc_buvl, 
                    qsbc_buwg, 
                    qtbf, 
                    qtbf_buar, 
                    qtbf_buln, 
                    qtbf_bupc, 
                    qtbf_butm, 
                    qtbf_buvl, 
                    qtbf_buwg, 
                    qtbi, 
                    qtbi_buar, 
                    qtbi_buln, 
                    qtbi_bupc, 
                    qtbi_butm, 
                    qtbi_buvl, 
                    qtbi_buwg, 
                    qtor, 
                    qtor_buar, 
                    qtor_buln, 
                    qtor_bupc, 
                    qtor_butm, 
                    qtor_buvl, 
                    qtor_buwg, 
                    qtrt, 
                    qutm, 
                    qxac, 
                    reco, 
                    reco_ref_compnr, 
                    refo, 
                    retm, 
                    rmch, 
                    rmch_kw, 
                    romt, 
                    rosi, 
                    rowc, 
                    rsdt, 
                    runi, 
                    rusd, 
                    rutm, 
                    scpq, 
                    scpq_buar, 
                    scpq_buln, 
                    scpq_bupc, 
                    scpq_butm, 
                    scpq_buvl, 
                    scpq_buwg, 
                    sctt, 
                    sctt_kw, 
                    sdoc, 
                    sdoc_kw, 
                    seqn, 
                    sequencenumber, 
                    sltm, 
                    sopr, 
                    sopr_kw, 
                    sptm, 
                    srit, 
                    sset, 
                    ssmd, 
                    ssmd_kw, 
                    sstm, 
                    suba, 
                    suba_ref_compnr, 
                    subr, 
                    subs, 
                    subs_ref_compnr, 
                    sutm, 
                    tano, 
                    tano_ref_compnr, 
                    timestamp, 
                    tlyn, 
                    tlyn_kw, 
                    trdf, 
                    trdl, 
                    trdt, 
                    trls, 
                    trno, 
                    tuni, 
                    tuni_kw, 
                    txta, 
                    txta_ref_compnr, 
                    username, 
                    wcst, 
                    wcst_cwoc_mtyp_ref_compnr, 
                    whsa, 
                    whsa_ref_compnr, 
                    ydtp, 
                    ydtp_kw, 
                    yldp, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.ardt, 
                    src.asdt, 
                    src.bfls, 
                    src.bfls_kw, 
                    src.blcd, 
                    src.blcd_ref_compnr, 
                    src.bpid, 
                    src.bpid_ref_compnr, 
                    src.cctt, 
                    src.cctt_kw, 
                    src.cmdt, 
                    src.compnr, 
                    src.cont, 
                    src.copo, 
                    src.copo_kw, 
                    src.crem, 
                    src.cwoc, 
                    src.cwoc_ref_compnr, 
                    src.deleted, 
                    src.dmso, 
                    src.dmso_kw, 
                    src.esdt, 
                    src.fdur, 
                    src.fdur_kw, 
                    src.fidt, 
                    src.fxpd, 
                    src.fxpd_kw, 
                    src.fxsu, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.lfdt, 
                    src.maho, 
                    src.mcho, 
                    src.mcno, 
                    src.mcno_ref_compnr, 
                    src.mcoc, 
                    src.mnrs, 
                    src.mnrs_kw, 
                    src.mopr, 
                    src.most, 
                    src.mtyp, 
                    src.mtyp_ref_compnr, 
                    src.mvrd, 
                    src.mvtm, 
                    src.nnts, 
                    src.nomc, 
                    src.nopr, 
                    src.oopn, 
                    src.oopr, 
                    src.opno, 
                    src.opst, 
                    src.opst_kw, 
                    src.orcd, 
                    src.orrv, 
                    src.oset, 
                    src.pdno, 
                    src.pdno_ref_compnr, 
                    src.pfdt, 
                    src.phsp, 
                    src.phsp_buar, 
                    src.phsp_buln, 
                    src.phsp_bupc, 
                    src.phsp_butm, 
                    src.phsp_buvl, 
                    src.phsp_buwg, 
                    src.ploc, 
                    src.prdt, 
                    src.prrd, 
                    src.prte, 
                    src.prtm, 
                    src.psdt, 
                    src.qbfd, 
                    src.qbfd_buar, 
                    src.qbfd_buln, 
                    src.qbfd_bupc, 
                    src.qbfd_butm, 
                    src.qbfd_buvl, 
                    src.qbfd_buwg, 
                    src.qcmp, 
                    src.qpli, 
                    src.qplo, 
                    src.qpnt, 
                    src.qqar, 
                    src.qqar_buar, 
                    src.qqar_buln, 
                    src.qqar_bupc, 
                    src.qqar_butm, 
                    src.qqar_buvl, 
                    src.qqar_buwg, 
                    src.qrjc, 
                    src.qrjc_buar, 
                    src.qrjc_buln, 
                    src.qrjc_bupc, 
                    src.qrjc_butm, 
                    src.qrjc_buvl, 
                    src.qrjc_buwg, 
                    src.qsbc, 
                    src.qsbc_buar, 
                    src.qsbc_buln, 
                    src.qsbc_bupc, 
                    src.qsbc_butm, 
                    src.qsbc_buvl, 
                    src.qsbc_buwg, 
                    src.qtbf, 
                    src.qtbf_buar, 
                    src.qtbf_buln, 
                    src.qtbf_bupc, 
                    src.qtbf_butm, 
                    src.qtbf_buvl, 
                    src.qtbf_buwg, 
                    src.qtbi, 
                    src.qtbi_buar, 
                    src.qtbi_buln, 
                    src.qtbi_bupc, 
                    src.qtbi_butm, 
                    src.qtbi_buvl, 
                    src.qtbi_buwg, 
                    src.qtor, 
                    src.qtor_buar, 
                    src.qtor_buln, 
                    src.qtor_bupc, 
                    src.qtor_butm, 
                    src.qtor_buvl, 
                    src.qtor_buwg, 
                    src.qtrt, 
                    src.qutm, 
                    src.qxac, 
                    src.reco, 
                    src.reco_ref_compnr, 
                    src.refo, 
                    src.retm, 
                    src.rmch, 
                    src.rmch_kw, 
                    src.romt, 
                    src.rosi, 
                    src.rowc, 
                    src.rsdt, 
                    src.runi, 
                    src.rusd, 
                    src.rutm, 
                    src.scpq, 
                    src.scpq_buar, 
                    src.scpq_buln, 
                    src.scpq_bupc, 
                    src.scpq_butm, 
                    src.scpq_buvl, 
                    src.scpq_buwg, 
                    src.sctt, 
                    src.sctt_kw, 
                    src.sdoc, 
                    src.sdoc_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.sltm, 
                    src.sopr, 
                    src.sopr_kw, 
                    src.sptm, 
                    src.srit, 
                    src.sset, 
                    src.ssmd, 
                    src.ssmd_kw, 
                    src.sstm, 
                    src.suba, 
                    src.suba_ref_compnr, 
                    src.subr, 
                    src.subs, 
                    src.subs_ref_compnr, 
                    src.sutm, 
                    src.tano, 
                    src.tano_ref_compnr, 
                    src.timestamp, 
                    src.tlyn, 
                    src.tlyn_kw, 
                    src.trdf, 
                    src.trdl, 
                    src.trdt, 
                    src.trls, 
                    src.trno, 
                    src.tuni, 
                    src.tuni_kw, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.wcst, 
                    src.wcst_cwoc_mtyp_ref_compnr, 
                    src.whsa, 
                    src.whsa_ref_compnr, 
                    src.ydtp, 
                    src.ydtp_kw, 
                    src.yldp,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TISFC010_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.ardt, 
            strm.asdt, 
            strm.bfls, 
            strm.bfls_kw, 
            strm.blcd, 
            strm.blcd_ref_compnr, 
            strm.bpid, 
            strm.bpid_ref_compnr, 
            strm.cctt, 
            strm.cctt_kw, 
            strm.cmdt, 
            strm.compnr, 
            strm.cont, 
            strm.copo, 
            strm.copo_kw, 
            strm.crem, 
            strm.cwoc, 
            strm.cwoc_ref_compnr, 
            strm.deleted, 
            strm.dmso, 
            strm.dmso_kw, 
            strm.esdt, 
            strm.fdur, 
            strm.fdur_kw, 
            strm.fidt, 
            strm.fxpd, 
            strm.fxpd_kw, 
            strm.fxsu, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.lfdt, 
            strm.maho, 
            strm.mcho, 
            strm.mcno, 
            strm.mcno_ref_compnr, 
            strm.mcoc, 
            strm.mnrs, 
            strm.mnrs_kw, 
            strm.mopr, 
            strm.most, 
            strm.mtyp, 
            strm.mtyp_ref_compnr, 
            strm.mvrd, 
            strm.mvtm, 
            strm.nnts, 
            strm.nomc, 
            strm.nopr, 
            strm.oopn, 
            strm.oopr, 
            strm.opno, 
            strm.opst, 
            strm.opst_kw, 
            strm.orcd, 
            strm.orrv, 
            strm.oset, 
            strm.pdno, 
            strm.pdno_ref_compnr, 
            strm.pfdt, 
            strm.phsp, 
            strm.phsp_buar, 
            strm.phsp_buln, 
            strm.phsp_bupc, 
            strm.phsp_butm, 
            strm.phsp_buvl, 
            strm.phsp_buwg, 
            strm.ploc, 
            strm.prdt, 
            strm.prrd, 
            strm.prte, 
            strm.prtm, 
            strm.psdt, 
            strm.qbfd, 
            strm.qbfd_buar, 
            strm.qbfd_buln, 
            strm.qbfd_bupc, 
            strm.qbfd_butm, 
            strm.qbfd_buvl, 
            strm.qbfd_buwg, 
            strm.qcmp, 
            strm.qpli, 
            strm.qplo, 
            strm.qpnt, 
            strm.qqar, 
            strm.qqar_buar, 
            strm.qqar_buln, 
            strm.qqar_bupc, 
            strm.qqar_butm, 
            strm.qqar_buvl, 
            strm.qqar_buwg, 
            strm.qrjc, 
            strm.qrjc_buar, 
            strm.qrjc_buln, 
            strm.qrjc_bupc, 
            strm.qrjc_butm, 
            strm.qrjc_buvl, 
            strm.qrjc_buwg, 
            strm.qsbc, 
            strm.qsbc_buar, 
            strm.qsbc_buln, 
            strm.qsbc_bupc, 
            strm.qsbc_butm, 
            strm.qsbc_buvl, 
            strm.qsbc_buwg, 
            strm.qtbf, 
            strm.qtbf_buar, 
            strm.qtbf_buln, 
            strm.qtbf_bupc, 
            strm.qtbf_butm, 
            strm.qtbf_buvl, 
            strm.qtbf_buwg, 
            strm.qtbi, 
            strm.qtbi_buar, 
            strm.qtbi_buln, 
            strm.qtbi_bupc, 
            strm.qtbi_butm, 
            strm.qtbi_buvl, 
            strm.qtbi_buwg, 
            strm.qtor, 
            strm.qtor_buar, 
            strm.qtor_buln, 
            strm.qtor_bupc, 
            strm.qtor_butm, 
            strm.qtor_buvl, 
            strm.qtor_buwg, 
            strm.qtrt, 
            strm.qutm, 
            strm.qxac, 
            strm.reco, 
            strm.reco_ref_compnr, 
            strm.refo, 
            strm.retm, 
            strm.rmch, 
            strm.rmch_kw, 
            strm.romt, 
            strm.rosi, 
            strm.rowc, 
            strm.rsdt, 
            strm.runi, 
            strm.rusd, 
            strm.rutm, 
            strm.scpq, 
            strm.scpq_buar, 
            strm.scpq_buln, 
            strm.scpq_bupc, 
            strm.scpq_butm, 
            strm.scpq_buvl, 
            strm.scpq_buwg, 
            strm.sctt, 
            strm.sctt_kw, 
            strm.sdoc, 
            strm.sdoc_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.sltm, 
            strm.sopr, 
            strm.sopr_kw, 
            strm.sptm, 
            strm.srit, 
            strm.sset, 
            strm.ssmd, 
            strm.ssmd_kw, 
            strm.sstm, 
            strm.suba, 
            strm.suba_ref_compnr, 
            strm.subr, 
            strm.subs, 
            strm.subs_ref_compnr, 
            strm.sutm, 
            strm.tano, 
            strm.tano_ref_compnr, 
            strm.timestamp, 
            strm.tlyn, 
            strm.tlyn_kw, 
            strm.trdf, 
            strm.trdl, 
            strm.trdt, 
            strm.trls, 
            strm.trno, 
            strm.tuni, 
            strm.tuni_kw, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.wcst, 
            strm.wcst_cwoc_mtyp_ref_compnr, 
            strm.whsa, 
            strm.whsa_ref_compnr, 
            strm.ydtp, 
            strm.ydtp_kw, 
            strm.yldp, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.pdno,
            strm.opno ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TISFC010 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.pdno=src.pdno) OR (target.pdno IS NULL AND src.pdno IS NULL)) AND
            ((target.opno=src.opno) OR (target.opno IS NULL AND src.opno IS NULL)) 
                when matched then update set
                    target.ardt=src.ardt, 
                    target.asdt=src.asdt, 
                    target.bfls=src.bfls, 
                    target.bfls_kw=src.bfls_kw, 
                    target.blcd=src.blcd, 
                    target.blcd_ref_compnr=src.blcd_ref_compnr, 
                    target.bpid=src.bpid, 
                    target.bpid_ref_compnr=src.bpid_ref_compnr, 
                    target.cctt=src.cctt, 
                    target.cctt_kw=src.cctt_kw, 
                    target.cmdt=src.cmdt, 
                    target.compnr=src.compnr, 
                    target.cont=src.cont, 
                    target.copo=src.copo, 
                    target.copo_kw=src.copo_kw, 
                    target.crem=src.crem, 
                    target.cwoc=src.cwoc, 
                    target.cwoc_ref_compnr=src.cwoc_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dmso=src.dmso, 
                    target.dmso_kw=src.dmso_kw, 
                    target.esdt=src.esdt, 
                    target.fdur=src.fdur, 
                    target.fdur_kw=src.fdur_kw, 
                    target.fidt=src.fidt, 
                    target.fxpd=src.fxpd, 
                    target.fxpd_kw=src.fxpd_kw, 
                    target.fxsu=src.fxsu, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.lfdt=src.lfdt, 
                    target.maho=src.maho, 
                    target.mcho=src.mcho, 
                    target.mcno=src.mcno, 
                    target.mcno_ref_compnr=src.mcno_ref_compnr, 
                    target.mcoc=src.mcoc, 
                    target.mnrs=src.mnrs, 
                    target.mnrs_kw=src.mnrs_kw, 
                    target.mopr=src.mopr, 
                    target.most=src.most, 
                    target.mtyp=src.mtyp, 
                    target.mtyp_ref_compnr=src.mtyp_ref_compnr, 
                    target.mvrd=src.mvrd, 
                    target.mvtm=src.mvtm, 
                    target.nnts=src.nnts, 
                    target.nomc=src.nomc, 
                    target.nopr=src.nopr, 
                    target.oopn=src.oopn, 
                    target.oopr=src.oopr, 
                    target.opno=src.opno, 
                    target.opst=src.opst, 
                    target.opst_kw=src.opst_kw, 
                    target.orcd=src.orcd, 
                    target.orrv=src.orrv, 
                    target.oset=src.oset, 
                    target.pdno=src.pdno, 
                    target.pdno_ref_compnr=src.pdno_ref_compnr, 
                    target.pfdt=src.pfdt, 
                    target.phsp=src.phsp, 
                    target.phsp_buar=src.phsp_buar, 
                    target.phsp_buln=src.phsp_buln, 
                    target.phsp_bupc=src.phsp_bupc, 
                    target.phsp_butm=src.phsp_butm, 
                    target.phsp_buvl=src.phsp_buvl, 
                    target.phsp_buwg=src.phsp_buwg, 
                    target.ploc=src.ploc, 
                    target.prdt=src.prdt, 
                    target.prrd=src.prrd, 
                    target.prte=src.prte, 
                    target.prtm=src.prtm, 
                    target.psdt=src.psdt, 
                    target.qbfd=src.qbfd, 
                    target.qbfd_buar=src.qbfd_buar, 
                    target.qbfd_buln=src.qbfd_buln, 
                    target.qbfd_bupc=src.qbfd_bupc, 
                    target.qbfd_butm=src.qbfd_butm, 
                    target.qbfd_buvl=src.qbfd_buvl, 
                    target.qbfd_buwg=src.qbfd_buwg, 
                    target.qcmp=src.qcmp, 
                    target.qpli=src.qpli, 
                    target.qplo=src.qplo, 
                    target.qpnt=src.qpnt, 
                    target.qqar=src.qqar, 
                    target.qqar_buar=src.qqar_buar, 
                    target.qqar_buln=src.qqar_buln, 
                    target.qqar_bupc=src.qqar_bupc, 
                    target.qqar_butm=src.qqar_butm, 
                    target.qqar_buvl=src.qqar_buvl, 
                    target.qqar_buwg=src.qqar_buwg, 
                    target.qrjc=src.qrjc, 
                    target.qrjc_buar=src.qrjc_buar, 
                    target.qrjc_buln=src.qrjc_buln, 
                    target.qrjc_bupc=src.qrjc_bupc, 
                    target.qrjc_butm=src.qrjc_butm, 
                    target.qrjc_buvl=src.qrjc_buvl, 
                    target.qrjc_buwg=src.qrjc_buwg, 
                    target.qsbc=src.qsbc, 
                    target.qsbc_buar=src.qsbc_buar, 
                    target.qsbc_buln=src.qsbc_buln, 
                    target.qsbc_bupc=src.qsbc_bupc, 
                    target.qsbc_butm=src.qsbc_butm, 
                    target.qsbc_buvl=src.qsbc_buvl, 
                    target.qsbc_buwg=src.qsbc_buwg, 
                    target.qtbf=src.qtbf, 
                    target.qtbf_buar=src.qtbf_buar, 
                    target.qtbf_buln=src.qtbf_buln, 
                    target.qtbf_bupc=src.qtbf_bupc, 
                    target.qtbf_butm=src.qtbf_butm, 
                    target.qtbf_buvl=src.qtbf_buvl, 
                    target.qtbf_buwg=src.qtbf_buwg, 
                    target.qtbi=src.qtbi, 
                    target.qtbi_buar=src.qtbi_buar, 
                    target.qtbi_buln=src.qtbi_buln, 
                    target.qtbi_bupc=src.qtbi_bupc, 
                    target.qtbi_butm=src.qtbi_butm, 
                    target.qtbi_buvl=src.qtbi_buvl, 
                    target.qtbi_buwg=src.qtbi_buwg, 
                    target.qtor=src.qtor, 
                    target.qtor_buar=src.qtor_buar, 
                    target.qtor_buln=src.qtor_buln, 
                    target.qtor_bupc=src.qtor_bupc, 
                    target.qtor_butm=src.qtor_butm, 
                    target.qtor_buvl=src.qtor_buvl, 
                    target.qtor_buwg=src.qtor_buwg, 
                    target.qtrt=src.qtrt, 
                    target.qutm=src.qutm, 
                    target.qxac=src.qxac, 
                    target.reco=src.reco, 
                    target.reco_ref_compnr=src.reco_ref_compnr, 
                    target.refo=src.refo, 
                    target.retm=src.retm, 
                    target.rmch=src.rmch, 
                    target.rmch_kw=src.rmch_kw, 
                    target.romt=src.romt, 
                    target.rosi=src.rosi, 
                    target.rowc=src.rowc, 
                    target.rsdt=src.rsdt, 
                    target.runi=src.runi, 
                    target.rusd=src.rusd, 
                    target.rutm=src.rutm, 
                    target.scpq=src.scpq, 
                    target.scpq_buar=src.scpq_buar, 
                    target.scpq_buln=src.scpq_buln, 
                    target.scpq_bupc=src.scpq_bupc, 
                    target.scpq_butm=src.scpq_butm, 
                    target.scpq_buvl=src.scpq_buvl, 
                    target.scpq_buwg=src.scpq_buwg, 
                    target.sctt=src.sctt, 
                    target.sctt_kw=src.sctt_kw, 
                    target.sdoc=src.sdoc, 
                    target.sdoc_kw=src.sdoc_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sltm=src.sltm, 
                    target.sopr=src.sopr, 
                    target.sopr_kw=src.sopr_kw, 
                    target.sptm=src.sptm, 
                    target.srit=src.srit, 
                    target.sset=src.sset, 
                    target.ssmd=src.ssmd, 
                    target.ssmd_kw=src.ssmd_kw, 
                    target.sstm=src.sstm, 
                    target.suba=src.suba, 
                    target.suba_ref_compnr=src.suba_ref_compnr, 
                    target.subr=src.subr, 
                    target.subs=src.subs, 
                    target.subs_ref_compnr=src.subs_ref_compnr, 
                    target.sutm=src.sutm, 
                    target.tano=src.tano, 
                    target.tano_ref_compnr=src.tano_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tlyn=src.tlyn, 
                    target.tlyn_kw=src.tlyn_kw, 
                    target.trdf=src.trdf, 
                    target.trdl=src.trdl, 
                    target.trdt=src.trdt, 
                    target.trls=src.trls, 
                    target.trno=src.trno, 
                    target.tuni=src.tuni, 
                    target.tuni_kw=src.tuni_kw, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.wcst=src.wcst, 
                    target.wcst_cwoc_mtyp_ref_compnr=src.wcst_cwoc_mtyp_ref_compnr, 
                    target.whsa=src.whsa, 
                    target.whsa_ref_compnr=src.whsa_ref_compnr, 
                    target.ydtp=src.ydtp, 
                    target.ydtp_kw=src.ydtp_kw, 
                    target.yldp=src.yldp, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( ardt, asdt, bfls, bfls_kw, blcd, blcd_ref_compnr, bpid, bpid_ref_compnr, cctt, cctt_kw, cmdt, compnr, cont, copo, copo_kw, crem, cwoc, cwoc_ref_compnr, deleted, dmso, dmso_kw, esdt, fdur, fdur_kw, fidt, fxpd, fxpd_kw, fxsu, item, item_ref_compnr, lfdt, maho, mcho, mcno, mcno_ref_compnr, mcoc, mnrs, mnrs_kw, mopr, most, mtyp, mtyp_ref_compnr, mvrd, mvtm, nnts, nomc, nopr, oopn, oopr, opno, opst, opst_kw, orcd, orrv, oset, pdno, pdno_ref_compnr, pfdt, phsp, phsp_buar, phsp_buln, phsp_bupc, phsp_butm, phsp_buvl, phsp_buwg, ploc, prdt, prrd, prte, prtm, psdt, qbfd, qbfd_buar, qbfd_buln, qbfd_bupc, qbfd_butm, qbfd_buvl, qbfd_buwg, qcmp, qpli, qplo, qpnt, qqar, qqar_buar, qqar_buln, qqar_bupc, qqar_butm, qqar_buvl, qqar_buwg, qrjc, qrjc_buar, qrjc_buln, qrjc_bupc, qrjc_butm, qrjc_buvl, qrjc_buwg, qsbc, qsbc_buar, qsbc_buln, qsbc_bupc, qsbc_butm, qsbc_buvl, qsbc_buwg, qtbf, qtbf_buar, qtbf_buln, qtbf_bupc, qtbf_butm, qtbf_buvl, qtbf_buwg, qtbi, qtbi_buar, qtbi_buln, qtbi_bupc, qtbi_butm, qtbi_buvl, qtbi_buwg, qtor, qtor_buar, qtor_buln, qtor_bupc, qtor_butm, qtor_buvl, qtor_buwg, qtrt, qutm, qxac, reco, reco_ref_compnr, refo, retm, rmch, rmch_kw, romt, rosi, rowc, rsdt, runi, rusd, rutm, scpq, scpq_buar, scpq_buln, scpq_bupc, scpq_butm, scpq_buvl, scpq_buwg, sctt, sctt_kw, sdoc, sdoc_kw, seqn, sequencenumber, sltm, sopr, sopr_kw, sptm, srit, sset, ssmd, ssmd_kw, sstm, suba, suba_ref_compnr, subr, subs, subs_ref_compnr, sutm, tano, tano_ref_compnr, timestamp, tlyn, tlyn_kw, trdf, trdl, trdt, trls, trno, tuni, tuni_kw, txta, txta_ref_compnr, username, wcst, wcst_cwoc_mtyp_ref_compnr, whsa, whsa_ref_compnr, ydtp, ydtp_kw, yldp, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.ardt, 
                    src.asdt, 
                    src.bfls, 
                    src.bfls_kw, 
                    src.blcd, 
                    src.blcd_ref_compnr, 
                    src.bpid, 
                    src.bpid_ref_compnr, 
                    src.cctt, 
                    src.cctt_kw, 
                    src.cmdt, 
                    src.compnr, 
                    src.cont, 
                    src.copo, 
                    src.copo_kw, 
                    src.crem, 
                    src.cwoc, 
                    src.cwoc_ref_compnr, 
                    src.deleted, 
                    src.dmso, 
                    src.dmso_kw, 
                    src.esdt, 
                    src.fdur, 
                    src.fdur_kw, 
                    src.fidt, 
                    src.fxpd, 
                    src.fxpd_kw, 
                    src.fxsu, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.lfdt, 
                    src.maho, 
                    src.mcho, 
                    src.mcno, 
                    src.mcno_ref_compnr, 
                    src.mcoc, 
                    src.mnrs, 
                    src.mnrs_kw, 
                    src.mopr, 
                    src.most, 
                    src.mtyp, 
                    src.mtyp_ref_compnr, 
                    src.mvrd, 
                    src.mvtm, 
                    src.nnts, 
                    src.nomc, 
                    src.nopr, 
                    src.oopn, 
                    src.oopr, 
                    src.opno, 
                    src.opst, 
                    src.opst_kw, 
                    src.orcd, 
                    src.orrv, 
                    src.oset, 
                    src.pdno, 
                    src.pdno_ref_compnr, 
                    src.pfdt, 
                    src.phsp, 
                    src.phsp_buar, 
                    src.phsp_buln, 
                    src.phsp_bupc, 
                    src.phsp_butm, 
                    src.phsp_buvl, 
                    src.phsp_buwg, 
                    src.ploc, 
                    src.prdt, 
                    src.prrd, 
                    src.prte, 
                    src.prtm, 
                    src.psdt, 
                    src.qbfd, 
                    src.qbfd_buar, 
                    src.qbfd_buln, 
                    src.qbfd_bupc, 
                    src.qbfd_butm, 
                    src.qbfd_buvl, 
                    src.qbfd_buwg, 
                    src.qcmp, 
                    src.qpli, 
                    src.qplo, 
                    src.qpnt, 
                    src.qqar, 
                    src.qqar_buar, 
                    src.qqar_buln, 
                    src.qqar_bupc, 
                    src.qqar_butm, 
                    src.qqar_buvl, 
                    src.qqar_buwg, 
                    src.qrjc, 
                    src.qrjc_buar, 
                    src.qrjc_buln, 
                    src.qrjc_bupc, 
                    src.qrjc_butm, 
                    src.qrjc_buvl, 
                    src.qrjc_buwg, 
                    src.qsbc, 
                    src.qsbc_buar, 
                    src.qsbc_buln, 
                    src.qsbc_bupc, 
                    src.qsbc_butm, 
                    src.qsbc_buvl, 
                    src.qsbc_buwg, 
                    src.qtbf, 
                    src.qtbf_buar, 
                    src.qtbf_buln, 
                    src.qtbf_bupc, 
                    src.qtbf_butm, 
                    src.qtbf_buvl, 
                    src.qtbf_buwg, 
                    src.qtbi, 
                    src.qtbi_buar, 
                    src.qtbi_buln, 
                    src.qtbi_bupc, 
                    src.qtbi_butm, 
                    src.qtbi_buvl, 
                    src.qtbi_buwg, 
                    src.qtor, 
                    src.qtor_buar, 
                    src.qtor_buln, 
                    src.qtor_bupc, 
                    src.qtor_butm, 
                    src.qtor_buvl, 
                    src.qtor_buwg, 
                    src.qtrt, 
                    src.qutm, 
                    src.qxac, 
                    src.reco, 
                    src.reco_ref_compnr, 
                    src.refo, 
                    src.retm, 
                    src.rmch, 
                    src.rmch_kw, 
                    src.romt, 
                    src.rosi, 
                    src.rowc, 
                    src.rsdt, 
                    src.runi, 
                    src.rusd, 
                    src.rutm, 
                    src.scpq, 
                    src.scpq_buar, 
                    src.scpq_buln, 
                    src.scpq_bupc, 
                    src.scpq_butm, 
                    src.scpq_buvl, 
                    src.scpq_buwg, 
                    src.sctt, 
                    src.sctt_kw, 
                    src.sdoc, 
                    src.sdoc_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.sltm, 
                    src.sopr, 
                    src.sopr_kw, 
                    src.sptm, 
                    src.srit, 
                    src.sset, 
                    src.ssmd, 
                    src.ssmd_kw, 
                    src.sstm, 
                    src.suba, 
                    src.suba_ref_compnr, 
                    src.subr, 
                    src.subs, 
                    src.subs_ref_compnr, 
                    src.sutm, 
                    src.tano, 
                    src.tano_ref_compnr, 
                    src.timestamp, 
                    src.tlyn, 
                    src.tlyn_kw, 
                    src.trdf, 
                    src.trdl, 
                    src.trdt, 
                    src.trls, 
                    src.trno, 
                    src.tuni, 
                    src.tuni_kw, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.wcst, 
                    src.wcst_cwoc_mtyp_ref_compnr, 
                    src.whsa, 
                    src.whsa_ref_compnr, 
                    src.ydtp, 
                    src.ydtp_kw, 
                    src.yldp,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;