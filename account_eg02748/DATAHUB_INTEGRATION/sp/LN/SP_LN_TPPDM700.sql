create or replace procedure DATAHUB_INTEGRATION.SP_LN_TPPDM700()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TPPDM700_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TPPDM700 as target using (SELECT * FROM (SELECT 
            strm.acpn, 
            strm.acpn_kw, 
            strm.adin, 
            strm.amts, 
            strm.amts_cntc, 
            strm.amts_dwhc, 
            strm.amts_homc, 
            strm.amts_prjc, 
            strm.amts_refc, 
            strm.amts_rpc1, 
            strm.amts_rpc2, 
            strm.aqan, 
            strm.baor, 
            strm.baor_kw, 
            strm.bgrb, 
            strm.bgrb_kw, 
            strm.bgrq, 
            strm.bgrq_kw, 
            strm.blck, 
            strm.blck_kw, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.bqan, 
            strm.buni, 
            strm.buni_ref_compnr, 
            strm.cact, 
            strm.camt, 
            strm.camt_cntc, 
            strm.camt_dwhc, 
            strm.camt_homc, 
            strm.camt_prjc, 
            strm.camt_refc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccco, 
            strm.ccco_ref_compnr, 
            strm.ccfm, 
            strm.ccfm_kw, 
            strm.ccty, 
            strm.ccty_ref_compnr, 
            strm.cddt, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.ceno, 
            strm.citt, 
            strm.citt_ref_compnr, 
            strm.clot, 
            strm.cnac, 
            strm.cncd, 
            strm.cnel, 
            strm.cnln, 
            strm.cnpl, 
            strm.cnpr, 
            strm.cnpr_cnel_ref_compnr, 
            strm.cnpr_cnpl_cnac_ref_compnr, 
            strm.cnpr_ref_compnr, 
            strm.cocu, 
            strm.cocu_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_cnln_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.cpay, 
            strm.cpay_ref_compnr, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_cpla_cact_ref_compnr, 
            strm.cprj_cpla_milt_ref_compnr, 
            strm.cprj_cpla_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_cstl_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cpva, 
            strm.cqan, 
            strm.crbn, 
            strm.crbn_kw, 
            strm.crby, 
            strm.crdt, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.cspa, 
            strm.cspg, 
            strm.cspg_kw, 
            strm.cstl, 
            strm.cstv, 
            strm.cstv_cntc, 
            strm.cstv_dwhc, 
            strm.cstv_homc, 
            strm.cstv_prjc, 
            strm.cstv_refc, 
            strm.cstv_rpc1, 
            strm.cstv_rpc2, 
            strm.cuni, 
            strm.cuni_ref_compnr, 
            strm.cvat, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.delt, 
            strm.delt_kw, 
            strm.disc, 
            strm.dlor, 
            strm.dlor_kw, 
            strm.dlpt, 
            strm.dlvr, 
            strm.dorg, 
            strm.dorg_kw, 
            strm.dspr, 
            strm.dspr_kw, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.exrs, 
            strm.exrs_ref_compnr, 
            strm.iddt, 
            strm.inst, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.lcrq, 
            strm.lcrq_kw, 
            strm.ldam, 
            strm.lmdt, 
            strm.lmus, 
            strm.loco, 
            strm.lssn, 
            strm.lssn_ref_compnr, 
            strm.ltsl, 
            strm.ltsl_kw, 
            strm.milt, 
            strm.mrlc, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oqan, 
            strm.orno, 
            strm.osch, 
            strm.ouni, 
            strm.ouni_ref_compnr, 
            strm.pass, 
            strm.pass_kw, 
            strm.paym, 
            strm.pddt, 
            strm.pono, 
            strm.porg, 
            strm.porg_kw, 
            strm.prdt, 
            strm.pric, 
            strm.pris, 
            strm.prsg, 
            strm.prsg_ref_compnr, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.rddt, 
            strm.rfcu, 
            strm.rfdl, 
            strm.rfic, 
            strm.rfid, 
            strm.rfit, 
            strm.rfsc, 
            strm.rfsh, 
            strm.rlcu, 
            strm.rown, 
            strm.rown_kw, 
            strm.rqan, 
            strm.rrsn, 
            strm.rrsn_ref_compnr, 
            strm.rtcc_1, 
            strm.rtcc_2, 
            strm.rtcc_3, 
            strm.rtcs_1, 
            strm.rtcs_2, 
            strm.rtcs_3, 
            strm.rtfc_1, 
            strm.rtfc_2, 
            strm.rtfc_3, 
            strm.rtfs_1, 
            strm.rtfs_2, 
            strm.rtfs_3, 
            strm.rtor, 
            strm.rtor_kw, 
            strm.sacu, 
            strm.sacu_ref_compnr, 
            strm.samt, 
            strm.samt_cntc, 
            strm.samt_dwhc, 
            strm.samt_homc, 
            strm.samt_prjc, 
            strm.samt_refc, 
            strm.samt_rpc1, 
            strm.samt_rpc2, 
            strm.schd, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.serl, 
            strm.sern, 
            strm.serv, 
            strm.serv_ref_compnr, 
            strm.shcn, 
            strm.shcn_kw, 
            strm.sign, 
            strm.sign_kw, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.sqan, 
            strm.srsl, 
            strm.srsl_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.suni, 
            strm.suni_ref_compnr, 
            strm.tact, 
            strm.tatd, 
            strm.tatd_ref_compnr, 
            strm.tcco, 
            strm.tcco_ref_compnr, 
            strm.tcff, 
            strm.tcff_kw, 
            strm.tcst, 
            strm.tcst_kw, 
            strm.tdel, 
            strm.tdel_kw, 
            strm.timestamp, 
            strm.tpla, 
            strm.tprj, 
            strm.tprj_ref_compnr, 
            strm.tprj_tpla_ref_compnr, 
            strm.tprj_tpla_tact_ref_compnr, 
            strm.tprj_tspa_ref_compnr, 
            strm.tprj_tstl_ref_compnr, 
            strm.tspa, 
            strm.tstl, 
            strm.twar, 
            strm.twar_ref_compnr, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.unbd, 
            strm.unbd_kw, 
            strm.username, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.cnln,
            strm.dlvr,
            strm.schd,
            strm.cprj,
            strm.cspa,
            strm.cpla,
            strm.cact,
            strm.sern ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPDM700 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.cnln=src.cnln) OR (target.cnln IS NULL AND src.cnln IS NULL)) AND
            ((target.dlvr=src.dlvr) OR (target.dlvr IS NULL AND src.dlvr IS NULL)) AND
            ((target.schd=src.schd) OR (target.schd IS NULL AND src.schd IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.cspa=src.cspa) OR (target.cspa IS NULL AND src.cspa IS NULL)) AND
            ((target.cpla=src.cpla) OR (target.cpla IS NULL AND src.cpla IS NULL)) AND
            ((target.cact=src.cact) OR (target.cact IS NULL AND src.cact IS NULL)) AND
            ((target.sern=src.sern) OR (target.sern IS NULL AND src.sern IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.acpn=src.acpn, 
                    target.acpn_kw=src.acpn_kw, 
                    target.adin=src.adin, 
                    target.amts=src.amts, 
                    target.amts_cntc=src.amts_cntc, 
                    target.amts_dwhc=src.amts_dwhc, 
                    target.amts_homc=src.amts_homc, 
                    target.amts_prjc=src.amts_prjc, 
                    target.amts_refc=src.amts_refc, 
                    target.amts_rpc1=src.amts_rpc1, 
                    target.amts_rpc2=src.amts_rpc2, 
                    target.aqan=src.aqan, 
                    target.baor=src.baor, 
                    target.baor_kw=src.baor_kw, 
                    target.bgrb=src.bgrb, 
                    target.bgrb_kw=src.bgrb_kw, 
                    target.bgrq=src.bgrq, 
                    target.bgrq_kw=src.bgrq_kw, 
                    target.blck=src.blck, 
                    target.blck_kw=src.blck_kw, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.bqan=src.bqan, 
                    target.buni=src.buni, 
                    target.buni_ref_compnr=src.buni_ref_compnr, 
                    target.cact=src.cact, 
                    target.camt=src.camt, 
                    target.camt_cntc=src.camt_cntc, 
                    target.camt_dwhc=src.camt_dwhc, 
                    target.camt_homc=src.camt_homc, 
                    target.camt_prjc=src.camt_prjc, 
                    target.camt_refc=src.camt_refc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccco=src.ccco, 
                    target.ccco_ref_compnr=src.ccco_ref_compnr, 
                    target.ccfm=src.ccfm, 
                    target.ccfm_kw=src.ccfm_kw, 
                    target.ccty=src.ccty, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cddt=src.cddt, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.ceno=src.ceno, 
                    target.citt=src.citt, 
                    target.citt_ref_compnr=src.citt_ref_compnr, 
                    target.clot=src.clot, 
                    target.cnac=src.cnac, 
                    target.cncd=src.cncd, 
                    target.cnel=src.cnel, 
                    target.cnln=src.cnln, 
                    target.cnpl=src.cnpl, 
                    target.cnpr=src.cnpr, 
                    target.cnpr_cnel_ref_compnr=src.cnpr_cnel_ref_compnr, 
                    target.cnpr_cnpl_cnac_ref_compnr=src.cnpr_cnpl_cnac_ref_compnr, 
                    target.cnpr_ref_compnr=src.cnpr_ref_compnr, 
                    target.cocu=src.cocu, 
                    target.cocu_ref_compnr=src.cocu_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_cnln_ref_compnr=src.cono_cnln_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.cpay=src.cpay, 
                    target.cpay_ref_compnr=src.cpay_ref_compnr, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_cpla_cact_ref_compnr=src.cprj_cpla_cact_ref_compnr, 
                    target.cprj_cpla_milt_ref_compnr=src.cprj_cpla_milt_ref_compnr, 
                    target.cprj_cpla_ref_compnr=src.cprj_cpla_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_cstl_ref_compnr=src.cprj_cstl_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cpva=src.cpva, 
                    target.cqan=src.cqan, 
                    target.crbn=src.crbn, 
                    target.crbn_kw=src.crbn_kw, 
                    target.crby=src.crby, 
                    target.crdt=src.crdt, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cspg=src.cspg, 
                    target.cspg_kw=src.cspg_kw, 
                    target.cstl=src.cstl, 
                    target.cstv=src.cstv, 
                    target.cstv_cntc=src.cstv_cntc, 
                    target.cstv_dwhc=src.cstv_dwhc, 
                    target.cstv_homc=src.cstv_homc, 
                    target.cstv_prjc=src.cstv_prjc, 
                    target.cstv_refc=src.cstv_refc, 
                    target.cstv_rpc1=src.cstv_rpc1, 
                    target.cstv_rpc2=src.cstv_rpc2, 
                    target.cuni=src.cuni, 
                    target.cuni_ref_compnr=src.cuni_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.delt=src.delt, 
                    target.delt_kw=src.delt_kw, 
                    target.disc=src.disc, 
                    target.dlor=src.dlor, 
                    target.dlor_kw=src.dlor_kw, 
                    target.dlpt=src.dlpt, 
                    target.dlvr=src.dlvr, 
                    target.dorg=src.dorg, 
                    target.dorg_kw=src.dorg_kw, 
                    target.dspr=src.dspr, 
                    target.dspr_kw=src.dspr_kw, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.exrs=src.exrs, 
                    target.exrs_ref_compnr=src.exrs_ref_compnr, 
                    target.iddt=src.iddt, 
                    target.inst=src.inst, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.lcrq=src.lcrq, 
                    target.lcrq_kw=src.lcrq_kw, 
                    target.ldam=src.ldam, 
                    target.lmdt=src.lmdt, 
                    target.lmus=src.lmus, 
                    target.loco=src.loco, 
                    target.lssn=src.lssn, 
                    target.lssn_ref_compnr=src.lssn_ref_compnr, 
                    target.ltsl=src.ltsl, 
                    target.ltsl_kw=src.ltsl_kw, 
                    target.milt=src.milt, 
                    target.mrlc=src.mrlc, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oqan=src.oqan, 
                    target.orno=src.orno, 
                    target.osch=src.osch, 
                    target.ouni=src.ouni, 
                    target.ouni_ref_compnr=src.ouni_ref_compnr, 
                    target.pass=src.pass, 
                    target.pass_kw=src.pass_kw, 
                    target.paym=src.paym, 
                    target.pddt=src.pddt, 
                    target.pono=src.pono, 
                    target.porg=src.porg, 
                    target.porg_kw=src.porg_kw, 
                    target.prdt=src.prdt, 
                    target.pric=src.pric, 
                    target.pris=src.pris, 
                    target.prsg=src.prsg, 
                    target.prsg_ref_compnr=src.prsg_ref_compnr, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.rddt=src.rddt, 
                    target.rfcu=src.rfcu, 
                    target.rfdl=src.rfdl, 
                    target.rfic=src.rfic, 
                    target.rfid=src.rfid, 
                    target.rfit=src.rfit, 
                    target.rfsc=src.rfsc, 
                    target.rfsh=src.rfsh, 
                    target.rlcu=src.rlcu, 
                    target.rown=src.rown, 
                    target.rown_kw=src.rown_kw, 
                    target.rqan=src.rqan, 
                    target.rrsn=src.rrsn, 
                    target.rrsn_ref_compnr=src.rrsn_ref_compnr, 
                    target.rtcc_1=src.rtcc_1, 
                    target.rtcc_2=src.rtcc_2, 
                    target.rtcc_3=src.rtcc_3, 
                    target.rtcs_1=src.rtcs_1, 
                    target.rtcs_2=src.rtcs_2, 
                    target.rtcs_3=src.rtcs_3, 
                    target.rtfc_1=src.rtfc_1, 
                    target.rtfc_2=src.rtfc_2, 
                    target.rtfc_3=src.rtfc_3, 
                    target.rtfs_1=src.rtfs_1, 
                    target.rtfs_2=src.rtfs_2, 
                    target.rtfs_3=src.rtfs_3, 
                    target.rtor=src.rtor, 
                    target.rtor_kw=src.rtor_kw, 
                    target.sacu=src.sacu, 
                    target.sacu_ref_compnr=src.sacu_ref_compnr, 
                    target.samt=src.samt, 
                    target.samt_cntc=src.samt_cntc, 
                    target.samt_dwhc=src.samt_dwhc, 
                    target.samt_homc=src.samt_homc, 
                    target.samt_prjc=src.samt_prjc, 
                    target.samt_refc=src.samt_refc, 
                    target.samt_rpc1=src.samt_rpc1, 
                    target.samt_rpc2=src.samt_rpc2, 
                    target.schd=src.schd, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serl=src.serl, 
                    target.sern=src.sern, 
                    target.serv=src.serv, 
                    target.serv_ref_compnr=src.serv_ref_compnr, 
                    target.shcn=src.shcn, 
                    target.shcn_kw=src.shcn_kw, 
                    target.sign=src.sign, 
                    target.sign_kw=src.sign_kw, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.sqan=src.sqan, 
                    target.srsl=src.srsl, 
                    target.srsl_kw=src.srsl_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.suni=src.suni, 
                    target.suni_ref_compnr=src.suni_ref_compnr, 
                    target.tact=src.tact, 
                    target.tatd=src.tatd, 
                    target.tatd_ref_compnr=src.tatd_ref_compnr, 
                    target.tcco=src.tcco, 
                    target.tcco_ref_compnr=src.tcco_ref_compnr, 
                    target.tcff=src.tcff, 
                    target.tcff_kw=src.tcff_kw, 
                    target.tcst=src.tcst, 
                    target.tcst_kw=src.tcst_kw, 
                    target.tdel=src.tdel, 
                    target.tdel_kw=src.tdel_kw, 
                    target.timestamp=src.timestamp, 
                    target.tpla=src.tpla, 
                    target.tprj=src.tprj, 
                    target.tprj_ref_compnr=src.tprj_ref_compnr, 
                    target.tprj_tpla_ref_compnr=src.tprj_tpla_ref_compnr, 
                    target.tprj_tpla_tact_ref_compnr=src.tprj_tpla_tact_ref_compnr, 
                    target.tprj_tspa_ref_compnr=src.tprj_tspa_ref_compnr, 
                    target.tprj_tstl_ref_compnr=src.tprj_tstl_ref_compnr, 
                    target.tspa=src.tspa, 
                    target.tstl=src.tstl, 
                    target.twar=src.twar, 
                    target.twar_ref_compnr=src.twar_ref_compnr, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.unbd=src.unbd, 
                    target.unbd_kw=src.unbd_kw, 
                    target.username=src.username, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    acpn, 
                    acpn_kw, 
                    adin, 
                    amts, 
                    amts_cntc, 
                    amts_dwhc, 
                    amts_homc, 
                    amts_prjc, 
                    amts_refc, 
                    amts_rpc1, 
                    amts_rpc2, 
                    aqan, 
                    baor, 
                    baor_kw, 
                    bgrb, 
                    bgrb_kw, 
                    bgrq, 
                    bgrq_kw, 
                    blck, 
                    blck_kw, 
                    bpcl, 
                    bpcl_ref_compnr, 
                    bptc, 
                    bptc_ref_compnr, 
                    bqan, 
                    buni, 
                    buni_ref_compnr, 
                    cact, 
                    camt, 
                    camt_cntc, 
                    camt_dwhc, 
                    camt_homc, 
                    camt_prjc, 
                    camt_refc, 
                    camt_rpc1, 
                    camt_rpc2, 
                    carr, 
                    carr_ref_compnr, 
                    ccco, 
                    ccco_ref_compnr, 
                    ccfm, 
                    ccfm_kw, 
                    ccty, 
                    ccty_ref_compnr, 
                    cddt, 
                    cdec, 
                    cdec_ref_compnr, 
                    ceno, 
                    citt, 
                    citt_ref_compnr, 
                    clot, 
                    cnac, 
                    cncd, 
                    cnel, 
                    cnln, 
                    cnpl, 
                    cnpr, 
                    cnpr_cnel_ref_compnr, 
                    cnpr_cnpl_cnac_ref_compnr, 
                    cnpr_ref_compnr, 
                    cocu, 
                    cocu_ref_compnr, 
                    compnr, 
                    cono, 
                    cono_cnln_ref_compnr, 
                    cono_ref_compnr, 
                    cpay, 
                    cpay_ref_compnr, 
                    cpla, 
                    cprj, 
                    cprj_cpla_cact_ref_compnr, 
                    cprj_cpla_milt_ref_compnr, 
                    cprj_cpla_ref_compnr, 
                    cprj_cspa_ref_compnr, 
                    cprj_cstl_ref_compnr, 
                    cprj_ref_compnr, 
                    cpva, 
                    cqan, 
                    crbn, 
                    crbn_kw, 
                    crby, 
                    crdt, 
                    crte, 
                    crte_ref_compnr, 
                    cspa, 
                    cspg, 
                    cspg_kw, 
                    cstl, 
                    cstv, 
                    cstv_cntc, 
                    cstv_dwhc, 
                    cstv_homc, 
                    cstv_prjc, 
                    cstv_refc, 
                    cstv_rpc1, 
                    cstv_rpc2, 
                    cuni, 
                    cuni_ref_compnr, 
                    cvat, 
                    cwar, 
                    cwar_ref_compnr, 
                    deleted, 
                    delt, 
                    delt_kw, 
                    disc, 
                    dlor, 
                    dlor_kw, 
                    dlpt, 
                    dlvr, 
                    dorg, 
                    dorg_kw, 
                    dspr, 
                    dspr_kw, 
                    effn, 
                    effn_ref_compnr, 
                    exmt, 
                    exmt_kw, 
                    exrs, 
                    exrs_ref_compnr, 
                    iddt, 
                    inst, 
                    item, 
                    item_ref_compnr, 
                    item_site_ref_compnr, 
                    lcrq, 
                    lcrq_kw, 
                    ldam, 
                    lmdt, 
                    lmus, 
                    loco, 
                    lssn, 
                    lssn_ref_compnr, 
                    ltsl, 
                    ltsl_kw, 
                    milt, 
                    mrlc, 
                    ofbp, 
                    ofbp_ref_compnr, 
                    oqan, 
                    orno, 
                    osch, 
                    ouni, 
                    ouni_ref_compnr, 
                    pass, 
                    pass_kw, 
                    paym, 
                    pddt, 
                    pono, 
                    porg, 
                    porg_kw, 
                    prdt, 
                    pric, 
                    pris, 
                    prsg, 
                    prsg_ref_compnr, 
                    ptpa, 
                    ptpa_ref_compnr, 
                    rddt, 
                    rfcu, 
                    rfdl, 
                    rfic, 
                    rfid, 
                    rfit, 
                    rfsc, 
                    rfsh, 
                    rlcu, 
                    rown, 
                    rown_kw, 
                    rqan, 
                    rrsn, 
                    rrsn_ref_compnr, 
                    rtcc_1, 
                    rtcc_2, 
                    rtcc_3, 
                    rtcs_1, 
                    rtcs_2, 
                    rtcs_3, 
                    rtfc_1, 
                    rtfc_2, 
                    rtfc_3, 
                    rtfs_1, 
                    rtfs_2, 
                    rtfs_3, 
                    rtor, 
                    rtor_kw, 
                    sacu, 
                    sacu_ref_compnr, 
                    samt, 
                    samt_cntc, 
                    samt_dwhc, 
                    samt_homc, 
                    samt_prjc, 
                    samt_refc, 
                    samt_rpc1, 
                    samt_rpc2, 
                    schd, 
                    sdsc, 
                    sdsc_kw, 
                    seqn, 
                    sequencenumber, 
                    serl, 
                    sern, 
                    serv, 
                    serv_ref_compnr, 
                    shcn, 
                    shcn_kw, 
                    sign, 
                    sign_kw, 
                    site, 
                    site_ref_compnr, 
                    sqan, 
                    srsl, 
                    srsl_kw, 
                    stad, 
                    stad_dlpt_ref_compnr, 
                    stat, 
                    stat_kw, 
                    stbp, 
                    stbp_ref_compnr, 
                    stcn, 
                    stcn_ref_compnr, 
                    suni, 
                    suni_ref_compnr, 
                    tact, 
                    tatd, 
                    tatd_ref_compnr, 
                    tcco, 
                    tcco_ref_compnr, 
                    tcff, 
                    tcff_kw, 
                    tcst, 
                    tcst_kw, 
                    tdel, 
                    tdel_kw, 
                    timestamp, 
                    tpla, 
                    tprj, 
                    tprj_ref_compnr, 
                    tprj_tpla_ref_compnr, 
                    tprj_tpla_tact_ref_compnr, 
                    tprj_tspa_ref_compnr, 
                    tprj_tstl_ref_compnr, 
                    tspa, 
                    tstl, 
                    twar, 
                    twar_ref_compnr, 
                    txta, 
                    txta_ref_compnr, 
                    unbd, 
                    unbd_kw, 
                    username, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.acpn, 
                    src.acpn_kw, 
                    src.adin, 
                    src.amts, 
                    src.amts_cntc, 
                    src.amts_dwhc, 
                    src.amts_homc, 
                    src.amts_prjc, 
                    src.amts_refc, 
                    src.amts_rpc1, 
                    src.amts_rpc2, 
                    src.aqan, 
                    src.baor, 
                    src.baor_kw, 
                    src.bgrb, 
                    src.bgrb_kw, 
                    src.bgrq, 
                    src.bgrq_kw, 
                    src.blck, 
                    src.blck_kw, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.bqan, 
                    src.buni, 
                    src.buni_ref_compnr, 
                    src.cact, 
                    src.camt, 
                    src.camt_cntc, 
                    src.camt_dwhc, 
                    src.camt_homc, 
                    src.camt_prjc, 
                    src.camt_refc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccco, 
                    src.ccco_ref_compnr, 
                    src.ccfm, 
                    src.ccfm_kw, 
                    src.ccty, 
                    src.ccty_ref_compnr, 
                    src.cddt, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.ceno, 
                    src.citt, 
                    src.citt_ref_compnr, 
                    src.clot, 
                    src.cnac, 
                    src.cncd, 
                    src.cnel, 
                    src.cnln, 
                    src.cnpl, 
                    src.cnpr, 
                    src.cnpr_cnel_ref_compnr, 
                    src.cnpr_cnpl_cnac_ref_compnr, 
                    src.cnpr_ref_compnr, 
                    src.cocu, 
                    src.cocu_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_cnln_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.cpay, 
                    src.cpay_ref_compnr, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_cpla_cact_ref_compnr, 
                    src.cprj_cpla_milt_ref_compnr, 
                    src.cprj_cpla_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_cstl_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cpva, 
                    src.cqan, 
                    src.crbn, 
                    src.crbn_kw, 
                    src.crby, 
                    src.crdt, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.cspa, 
                    src.cspg, 
                    src.cspg_kw, 
                    src.cstl, 
                    src.cstv, 
                    src.cstv_cntc, 
                    src.cstv_dwhc, 
                    src.cstv_homc, 
                    src.cstv_prjc, 
                    src.cstv_refc, 
                    src.cstv_rpc1, 
                    src.cstv_rpc2, 
                    src.cuni, 
                    src.cuni_ref_compnr, 
                    src.cvat, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.delt, 
                    src.delt_kw, 
                    src.disc, 
                    src.dlor, 
                    src.dlor_kw, 
                    src.dlpt, 
                    src.dlvr, 
                    src.dorg, 
                    src.dorg_kw, 
                    src.dspr, 
                    src.dspr_kw, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.exrs, 
                    src.exrs_ref_compnr, 
                    src.iddt, 
                    src.inst, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.lcrq, 
                    src.lcrq_kw, 
                    src.ldam, 
                    src.lmdt, 
                    src.lmus, 
                    src.loco, 
                    src.lssn, 
                    src.lssn_ref_compnr, 
                    src.ltsl, 
                    src.ltsl_kw, 
                    src.milt, 
                    src.mrlc, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oqan, 
                    src.orno, 
                    src.osch, 
                    src.ouni, 
                    src.ouni_ref_compnr, 
                    src.pass, 
                    src.pass_kw, 
                    src.paym, 
                    src.pddt, 
                    src.pono, 
                    src.porg, 
                    src.porg_kw, 
                    src.prdt, 
                    src.pric, 
                    src.pris, 
                    src.prsg, 
                    src.prsg_ref_compnr, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.rddt, 
                    src.rfcu, 
                    src.rfdl, 
                    src.rfic, 
                    src.rfid, 
                    src.rfit, 
                    src.rfsc, 
                    src.rfsh, 
                    src.rlcu, 
                    src.rown, 
                    src.rown_kw, 
                    src.rqan, 
                    src.rrsn, 
                    src.rrsn_ref_compnr, 
                    src.rtcc_1, 
                    src.rtcc_2, 
                    src.rtcc_3, 
                    src.rtcs_1, 
                    src.rtcs_2, 
                    src.rtcs_3, 
                    src.rtfc_1, 
                    src.rtfc_2, 
                    src.rtfc_3, 
                    src.rtfs_1, 
                    src.rtfs_2, 
                    src.rtfs_3, 
                    src.rtor, 
                    src.rtor_kw, 
                    src.sacu, 
                    src.sacu_ref_compnr, 
                    src.samt, 
                    src.samt_cntc, 
                    src.samt_dwhc, 
                    src.samt_homc, 
                    src.samt_prjc, 
                    src.samt_refc, 
                    src.samt_rpc1, 
                    src.samt_rpc2, 
                    src.schd, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.serl, 
                    src.sern, 
                    src.serv, 
                    src.serv_ref_compnr, 
                    src.shcn, 
                    src.shcn_kw, 
                    src.sign, 
                    src.sign_kw, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.sqan, 
                    src.srsl, 
                    src.srsl_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.suni, 
                    src.suni_ref_compnr, 
                    src.tact, 
                    src.tatd, 
                    src.tatd_ref_compnr, 
                    src.tcco, 
                    src.tcco_ref_compnr, 
                    src.tcff, 
                    src.tcff_kw, 
                    src.tcst, 
                    src.tcst_kw, 
                    src.tdel, 
                    src.tdel_kw, 
                    src.timestamp, 
                    src.tpla, 
                    src.tprj, 
                    src.tprj_ref_compnr, 
                    src.tprj_tpla_ref_compnr, 
                    src.tprj_tpla_tact_ref_compnr, 
                    src.tprj_tspa_ref_compnr, 
                    src.tprj_tstl_ref_compnr, 
                    src.tspa, 
                    src.tstl, 
                    src.twar, 
                    src.twar_ref_compnr, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.unbd, 
                    src.unbd_kw, 
                    src.username,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TPPDM700_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.acpn, 
            strm.acpn_kw, 
            strm.adin, 
            strm.amts, 
            strm.amts_cntc, 
            strm.amts_dwhc, 
            strm.amts_homc, 
            strm.amts_prjc, 
            strm.amts_refc, 
            strm.amts_rpc1, 
            strm.amts_rpc2, 
            strm.aqan, 
            strm.baor, 
            strm.baor_kw, 
            strm.bgrb, 
            strm.bgrb_kw, 
            strm.bgrq, 
            strm.bgrq_kw, 
            strm.blck, 
            strm.blck_kw, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.bqan, 
            strm.buni, 
            strm.buni_ref_compnr, 
            strm.cact, 
            strm.camt, 
            strm.camt_cntc, 
            strm.camt_dwhc, 
            strm.camt_homc, 
            strm.camt_prjc, 
            strm.camt_refc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccco, 
            strm.ccco_ref_compnr, 
            strm.ccfm, 
            strm.ccfm_kw, 
            strm.ccty, 
            strm.ccty_ref_compnr, 
            strm.cddt, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.ceno, 
            strm.citt, 
            strm.citt_ref_compnr, 
            strm.clot, 
            strm.cnac, 
            strm.cncd, 
            strm.cnel, 
            strm.cnln, 
            strm.cnpl, 
            strm.cnpr, 
            strm.cnpr_cnel_ref_compnr, 
            strm.cnpr_cnpl_cnac_ref_compnr, 
            strm.cnpr_ref_compnr, 
            strm.cocu, 
            strm.cocu_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_cnln_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.cpay, 
            strm.cpay_ref_compnr, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_cpla_cact_ref_compnr, 
            strm.cprj_cpla_milt_ref_compnr, 
            strm.cprj_cpla_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_cstl_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cpva, 
            strm.cqan, 
            strm.crbn, 
            strm.crbn_kw, 
            strm.crby, 
            strm.crdt, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.cspa, 
            strm.cspg, 
            strm.cspg_kw, 
            strm.cstl, 
            strm.cstv, 
            strm.cstv_cntc, 
            strm.cstv_dwhc, 
            strm.cstv_homc, 
            strm.cstv_prjc, 
            strm.cstv_refc, 
            strm.cstv_rpc1, 
            strm.cstv_rpc2, 
            strm.cuni, 
            strm.cuni_ref_compnr, 
            strm.cvat, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.delt, 
            strm.delt_kw, 
            strm.disc, 
            strm.dlor, 
            strm.dlor_kw, 
            strm.dlpt, 
            strm.dlvr, 
            strm.dorg, 
            strm.dorg_kw, 
            strm.dspr, 
            strm.dspr_kw, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.exrs, 
            strm.exrs_ref_compnr, 
            strm.iddt, 
            strm.inst, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.lcrq, 
            strm.lcrq_kw, 
            strm.ldam, 
            strm.lmdt, 
            strm.lmus, 
            strm.loco, 
            strm.lssn, 
            strm.lssn_ref_compnr, 
            strm.ltsl, 
            strm.ltsl_kw, 
            strm.milt, 
            strm.mrlc, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.oqan, 
            strm.orno, 
            strm.osch, 
            strm.ouni, 
            strm.ouni_ref_compnr, 
            strm.pass, 
            strm.pass_kw, 
            strm.paym, 
            strm.pddt, 
            strm.pono, 
            strm.porg, 
            strm.porg_kw, 
            strm.prdt, 
            strm.pric, 
            strm.pris, 
            strm.prsg, 
            strm.prsg_ref_compnr, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.rddt, 
            strm.rfcu, 
            strm.rfdl, 
            strm.rfic, 
            strm.rfid, 
            strm.rfit, 
            strm.rfsc, 
            strm.rfsh, 
            strm.rlcu, 
            strm.rown, 
            strm.rown_kw, 
            strm.rqan, 
            strm.rrsn, 
            strm.rrsn_ref_compnr, 
            strm.rtcc_1, 
            strm.rtcc_2, 
            strm.rtcc_3, 
            strm.rtcs_1, 
            strm.rtcs_2, 
            strm.rtcs_3, 
            strm.rtfc_1, 
            strm.rtfc_2, 
            strm.rtfc_3, 
            strm.rtfs_1, 
            strm.rtfs_2, 
            strm.rtfs_3, 
            strm.rtor, 
            strm.rtor_kw, 
            strm.sacu, 
            strm.sacu_ref_compnr, 
            strm.samt, 
            strm.samt_cntc, 
            strm.samt_dwhc, 
            strm.samt_homc, 
            strm.samt_prjc, 
            strm.samt_refc, 
            strm.samt_rpc1, 
            strm.samt_rpc2, 
            strm.schd, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.serl, 
            strm.sern, 
            strm.serv, 
            strm.serv_ref_compnr, 
            strm.shcn, 
            strm.shcn_kw, 
            strm.sign, 
            strm.sign_kw, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.sqan, 
            strm.srsl, 
            strm.srsl_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.suni, 
            strm.suni_ref_compnr, 
            strm.tact, 
            strm.tatd, 
            strm.tatd_ref_compnr, 
            strm.tcco, 
            strm.tcco_ref_compnr, 
            strm.tcff, 
            strm.tcff_kw, 
            strm.tcst, 
            strm.tcst_kw, 
            strm.tdel, 
            strm.tdel_kw, 
            strm.timestamp, 
            strm.tpla, 
            strm.tprj, 
            strm.tprj_ref_compnr, 
            strm.tprj_tpla_ref_compnr, 
            strm.tprj_tpla_tact_ref_compnr, 
            strm.tprj_tspa_ref_compnr, 
            strm.tprj_tstl_ref_compnr, 
            strm.tspa, 
            strm.tstl, 
            strm.twar, 
            strm.twar_ref_compnr, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.unbd, 
            strm.unbd_kw, 
            strm.username, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.cnln,
            strm.dlvr,
            strm.schd,
            strm.cprj,
            strm.cspa,
            strm.cpla,
            strm.cact,
            strm.sern ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPDM700 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.cnln=src.cnln) OR (target.cnln IS NULL AND src.cnln IS NULL)) AND
            ((target.dlvr=src.dlvr) OR (target.dlvr IS NULL AND src.dlvr IS NULL)) AND
            ((target.schd=src.schd) OR (target.schd IS NULL AND src.schd IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.cspa=src.cspa) OR (target.cspa IS NULL AND src.cspa IS NULL)) AND
            ((target.cpla=src.cpla) OR (target.cpla IS NULL AND src.cpla IS NULL)) AND
            ((target.cact=src.cact) OR (target.cact IS NULL AND src.cact IS NULL)) AND
            ((target.sern=src.sern) OR (target.sern IS NULL AND src.sern IS NULL)) 
                when matched then update set
                    target.acpn=src.acpn, 
                    target.acpn_kw=src.acpn_kw, 
                    target.adin=src.adin, 
                    target.amts=src.amts, 
                    target.amts_cntc=src.amts_cntc, 
                    target.amts_dwhc=src.amts_dwhc, 
                    target.amts_homc=src.amts_homc, 
                    target.amts_prjc=src.amts_prjc, 
                    target.amts_refc=src.amts_refc, 
                    target.amts_rpc1=src.amts_rpc1, 
                    target.amts_rpc2=src.amts_rpc2, 
                    target.aqan=src.aqan, 
                    target.baor=src.baor, 
                    target.baor_kw=src.baor_kw, 
                    target.bgrb=src.bgrb, 
                    target.bgrb_kw=src.bgrb_kw, 
                    target.bgrq=src.bgrq, 
                    target.bgrq_kw=src.bgrq_kw, 
                    target.blck=src.blck, 
                    target.blck_kw=src.blck_kw, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.bqan=src.bqan, 
                    target.buni=src.buni, 
                    target.buni_ref_compnr=src.buni_ref_compnr, 
                    target.cact=src.cact, 
                    target.camt=src.camt, 
                    target.camt_cntc=src.camt_cntc, 
                    target.camt_dwhc=src.camt_dwhc, 
                    target.camt_homc=src.camt_homc, 
                    target.camt_prjc=src.camt_prjc, 
                    target.camt_refc=src.camt_refc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccco=src.ccco, 
                    target.ccco_ref_compnr=src.ccco_ref_compnr, 
                    target.ccfm=src.ccfm, 
                    target.ccfm_kw=src.ccfm_kw, 
                    target.ccty=src.ccty, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cddt=src.cddt, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.ceno=src.ceno, 
                    target.citt=src.citt, 
                    target.citt_ref_compnr=src.citt_ref_compnr, 
                    target.clot=src.clot, 
                    target.cnac=src.cnac, 
                    target.cncd=src.cncd, 
                    target.cnel=src.cnel, 
                    target.cnln=src.cnln, 
                    target.cnpl=src.cnpl, 
                    target.cnpr=src.cnpr, 
                    target.cnpr_cnel_ref_compnr=src.cnpr_cnel_ref_compnr, 
                    target.cnpr_cnpl_cnac_ref_compnr=src.cnpr_cnpl_cnac_ref_compnr, 
                    target.cnpr_ref_compnr=src.cnpr_ref_compnr, 
                    target.cocu=src.cocu, 
                    target.cocu_ref_compnr=src.cocu_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_cnln_ref_compnr=src.cono_cnln_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.cpay=src.cpay, 
                    target.cpay_ref_compnr=src.cpay_ref_compnr, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_cpla_cact_ref_compnr=src.cprj_cpla_cact_ref_compnr, 
                    target.cprj_cpla_milt_ref_compnr=src.cprj_cpla_milt_ref_compnr, 
                    target.cprj_cpla_ref_compnr=src.cprj_cpla_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_cstl_ref_compnr=src.cprj_cstl_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cpva=src.cpva, 
                    target.cqan=src.cqan, 
                    target.crbn=src.crbn, 
                    target.crbn_kw=src.crbn_kw, 
                    target.crby=src.crby, 
                    target.crdt=src.crdt, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cspg=src.cspg, 
                    target.cspg_kw=src.cspg_kw, 
                    target.cstl=src.cstl, 
                    target.cstv=src.cstv, 
                    target.cstv_cntc=src.cstv_cntc, 
                    target.cstv_dwhc=src.cstv_dwhc, 
                    target.cstv_homc=src.cstv_homc, 
                    target.cstv_prjc=src.cstv_prjc, 
                    target.cstv_refc=src.cstv_refc, 
                    target.cstv_rpc1=src.cstv_rpc1, 
                    target.cstv_rpc2=src.cstv_rpc2, 
                    target.cuni=src.cuni, 
                    target.cuni_ref_compnr=src.cuni_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.delt=src.delt, 
                    target.delt_kw=src.delt_kw, 
                    target.disc=src.disc, 
                    target.dlor=src.dlor, 
                    target.dlor_kw=src.dlor_kw, 
                    target.dlpt=src.dlpt, 
                    target.dlvr=src.dlvr, 
                    target.dorg=src.dorg, 
                    target.dorg_kw=src.dorg_kw, 
                    target.dspr=src.dspr, 
                    target.dspr_kw=src.dspr_kw, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.exrs=src.exrs, 
                    target.exrs_ref_compnr=src.exrs_ref_compnr, 
                    target.iddt=src.iddt, 
                    target.inst=src.inst, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.lcrq=src.lcrq, 
                    target.lcrq_kw=src.lcrq_kw, 
                    target.ldam=src.ldam, 
                    target.lmdt=src.lmdt, 
                    target.lmus=src.lmus, 
                    target.loco=src.loco, 
                    target.lssn=src.lssn, 
                    target.lssn_ref_compnr=src.lssn_ref_compnr, 
                    target.ltsl=src.ltsl, 
                    target.ltsl_kw=src.ltsl_kw, 
                    target.milt=src.milt, 
                    target.mrlc=src.mrlc, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.oqan=src.oqan, 
                    target.orno=src.orno, 
                    target.osch=src.osch, 
                    target.ouni=src.ouni, 
                    target.ouni_ref_compnr=src.ouni_ref_compnr, 
                    target.pass=src.pass, 
                    target.pass_kw=src.pass_kw, 
                    target.paym=src.paym, 
                    target.pddt=src.pddt, 
                    target.pono=src.pono, 
                    target.porg=src.porg, 
                    target.porg_kw=src.porg_kw, 
                    target.prdt=src.prdt, 
                    target.pric=src.pric, 
                    target.pris=src.pris, 
                    target.prsg=src.prsg, 
                    target.prsg_ref_compnr=src.prsg_ref_compnr, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.rddt=src.rddt, 
                    target.rfcu=src.rfcu, 
                    target.rfdl=src.rfdl, 
                    target.rfic=src.rfic, 
                    target.rfid=src.rfid, 
                    target.rfit=src.rfit, 
                    target.rfsc=src.rfsc, 
                    target.rfsh=src.rfsh, 
                    target.rlcu=src.rlcu, 
                    target.rown=src.rown, 
                    target.rown_kw=src.rown_kw, 
                    target.rqan=src.rqan, 
                    target.rrsn=src.rrsn, 
                    target.rrsn_ref_compnr=src.rrsn_ref_compnr, 
                    target.rtcc_1=src.rtcc_1, 
                    target.rtcc_2=src.rtcc_2, 
                    target.rtcc_3=src.rtcc_3, 
                    target.rtcs_1=src.rtcs_1, 
                    target.rtcs_2=src.rtcs_2, 
                    target.rtcs_3=src.rtcs_3, 
                    target.rtfc_1=src.rtfc_1, 
                    target.rtfc_2=src.rtfc_2, 
                    target.rtfc_3=src.rtfc_3, 
                    target.rtfs_1=src.rtfs_1, 
                    target.rtfs_2=src.rtfs_2, 
                    target.rtfs_3=src.rtfs_3, 
                    target.rtor=src.rtor, 
                    target.rtor_kw=src.rtor_kw, 
                    target.sacu=src.sacu, 
                    target.sacu_ref_compnr=src.sacu_ref_compnr, 
                    target.samt=src.samt, 
                    target.samt_cntc=src.samt_cntc, 
                    target.samt_dwhc=src.samt_dwhc, 
                    target.samt_homc=src.samt_homc, 
                    target.samt_prjc=src.samt_prjc, 
                    target.samt_refc=src.samt_refc, 
                    target.samt_rpc1=src.samt_rpc1, 
                    target.samt_rpc2=src.samt_rpc2, 
                    target.schd=src.schd, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serl=src.serl, 
                    target.sern=src.sern, 
                    target.serv=src.serv, 
                    target.serv_ref_compnr=src.serv_ref_compnr, 
                    target.shcn=src.shcn, 
                    target.shcn_kw=src.shcn_kw, 
                    target.sign=src.sign, 
                    target.sign_kw=src.sign_kw, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.sqan=src.sqan, 
                    target.srsl=src.srsl, 
                    target.srsl_kw=src.srsl_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.suni=src.suni, 
                    target.suni_ref_compnr=src.suni_ref_compnr, 
                    target.tact=src.tact, 
                    target.tatd=src.tatd, 
                    target.tatd_ref_compnr=src.tatd_ref_compnr, 
                    target.tcco=src.tcco, 
                    target.tcco_ref_compnr=src.tcco_ref_compnr, 
                    target.tcff=src.tcff, 
                    target.tcff_kw=src.tcff_kw, 
                    target.tcst=src.tcst, 
                    target.tcst_kw=src.tcst_kw, 
                    target.tdel=src.tdel, 
                    target.tdel_kw=src.tdel_kw, 
                    target.timestamp=src.timestamp, 
                    target.tpla=src.tpla, 
                    target.tprj=src.tprj, 
                    target.tprj_ref_compnr=src.tprj_ref_compnr, 
                    target.tprj_tpla_ref_compnr=src.tprj_tpla_ref_compnr, 
                    target.tprj_tpla_tact_ref_compnr=src.tprj_tpla_tact_ref_compnr, 
                    target.tprj_tspa_ref_compnr=src.tprj_tspa_ref_compnr, 
                    target.tprj_tstl_ref_compnr=src.tprj_tstl_ref_compnr, 
                    target.tspa=src.tspa, 
                    target.tstl=src.tstl, 
                    target.twar=src.twar, 
                    target.twar_ref_compnr=src.twar_ref_compnr, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.unbd=src.unbd, 
                    target.unbd_kw=src.unbd_kw, 
                    target.username=src.username, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( acpn, acpn_kw, adin, amts, amts_cntc, amts_dwhc, amts_homc, amts_prjc, amts_refc, amts_rpc1, amts_rpc2, aqan, baor, baor_kw, bgrb, bgrb_kw, bgrq, bgrq_kw, blck, blck_kw, bpcl, bpcl_ref_compnr, bptc, bptc_ref_compnr, bqan, buni, buni_ref_compnr, cact, camt, camt_cntc, camt_dwhc, camt_homc, camt_prjc, camt_refc, camt_rpc1, camt_rpc2, carr, carr_ref_compnr, ccco, ccco_ref_compnr, ccfm, ccfm_kw, ccty, ccty_ref_compnr, cddt, cdec, cdec_ref_compnr, ceno, citt, citt_ref_compnr, clot, cnac, cncd, cnel, cnln, cnpl, cnpr, cnpr_cnel_ref_compnr, cnpr_cnpl_cnac_ref_compnr, cnpr_ref_compnr, cocu, cocu_ref_compnr, compnr, cono, cono_cnln_ref_compnr, cono_ref_compnr, cpay, cpay_ref_compnr, cpla, cprj, cprj_cpla_cact_ref_compnr, cprj_cpla_milt_ref_compnr, cprj_cpla_ref_compnr, cprj_cspa_ref_compnr, cprj_cstl_ref_compnr, cprj_ref_compnr, cpva, cqan, crbn, crbn_kw, crby, crdt, crte, crte_ref_compnr, cspa, cspg, cspg_kw, cstl, cstv, cstv_cntc, cstv_dwhc, cstv_homc, cstv_prjc, cstv_refc, cstv_rpc1, cstv_rpc2, cuni, cuni_ref_compnr, cvat, cwar, cwar_ref_compnr, deleted, delt, delt_kw, disc, dlor, dlor_kw, dlpt, dlvr, dorg, dorg_kw, dspr, dspr_kw, effn, effn_ref_compnr, exmt, exmt_kw, exrs, exrs_ref_compnr, iddt, inst, item, item_ref_compnr, item_site_ref_compnr, lcrq, lcrq_kw, ldam, lmdt, lmus, loco, lssn, lssn_ref_compnr, ltsl, ltsl_kw, milt, mrlc, ofbp, ofbp_ref_compnr, oqan, orno, osch, ouni, ouni_ref_compnr, pass, pass_kw, paym, pddt, pono, porg, porg_kw, prdt, pric, pris, prsg, prsg_ref_compnr, ptpa, ptpa_ref_compnr, rddt, rfcu, rfdl, rfic, rfid, rfit, rfsc, rfsh, rlcu, rown, rown_kw, rqan, rrsn, rrsn_ref_compnr, rtcc_1, rtcc_2, rtcc_3, rtcs_1, rtcs_2, rtcs_3, rtfc_1, rtfc_2, rtfc_3, rtfs_1, rtfs_2, rtfs_3, rtor, rtor_kw, sacu, sacu_ref_compnr, samt, samt_cntc, samt_dwhc, samt_homc, samt_prjc, samt_refc, samt_rpc1, samt_rpc2, schd, sdsc, sdsc_kw, seqn, sequencenumber, serl, sern, serv, serv_ref_compnr, shcn, shcn_kw, sign, sign_kw, site, site_ref_compnr, sqan, srsl, srsl_kw, stad, stad_dlpt_ref_compnr, stat, stat_kw, stbp, stbp_ref_compnr, stcn, stcn_ref_compnr, suni, suni_ref_compnr, tact, tatd, tatd_ref_compnr, tcco, tcco_ref_compnr, tcff, tcff_kw, tcst, tcst_kw, tdel, tdel_kw, timestamp, tpla, tprj, tprj_ref_compnr, tprj_tpla_ref_compnr, tprj_tpla_tact_ref_compnr, tprj_tspa_ref_compnr, tprj_tstl_ref_compnr, tspa, tstl, twar, twar_ref_compnr, txta, txta_ref_compnr, unbd, unbd_kw, username, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.acpn, 
                    src.acpn_kw, 
                    src.adin, 
                    src.amts, 
                    src.amts_cntc, 
                    src.amts_dwhc, 
                    src.amts_homc, 
                    src.amts_prjc, 
                    src.amts_refc, 
                    src.amts_rpc1, 
                    src.amts_rpc2, 
                    src.aqan, 
                    src.baor, 
                    src.baor_kw, 
                    src.bgrb, 
                    src.bgrb_kw, 
                    src.bgrq, 
                    src.bgrq_kw, 
                    src.blck, 
                    src.blck_kw, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.bqan, 
                    src.buni, 
                    src.buni_ref_compnr, 
                    src.cact, 
                    src.camt, 
                    src.camt_cntc, 
                    src.camt_dwhc, 
                    src.camt_homc, 
                    src.camt_prjc, 
                    src.camt_refc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccco, 
                    src.ccco_ref_compnr, 
                    src.ccfm, 
                    src.ccfm_kw, 
                    src.ccty, 
                    src.ccty_ref_compnr, 
                    src.cddt, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.ceno, 
                    src.citt, 
                    src.citt_ref_compnr, 
                    src.clot, 
                    src.cnac, 
                    src.cncd, 
                    src.cnel, 
                    src.cnln, 
                    src.cnpl, 
                    src.cnpr, 
                    src.cnpr_cnel_ref_compnr, 
                    src.cnpr_cnpl_cnac_ref_compnr, 
                    src.cnpr_ref_compnr, 
                    src.cocu, 
                    src.cocu_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_cnln_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.cpay, 
                    src.cpay_ref_compnr, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_cpla_cact_ref_compnr, 
                    src.cprj_cpla_milt_ref_compnr, 
                    src.cprj_cpla_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_cstl_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cpva, 
                    src.cqan, 
                    src.crbn, 
                    src.crbn_kw, 
                    src.crby, 
                    src.crdt, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.cspa, 
                    src.cspg, 
                    src.cspg_kw, 
                    src.cstl, 
                    src.cstv, 
                    src.cstv_cntc, 
                    src.cstv_dwhc, 
                    src.cstv_homc, 
                    src.cstv_prjc, 
                    src.cstv_refc, 
                    src.cstv_rpc1, 
                    src.cstv_rpc2, 
                    src.cuni, 
                    src.cuni_ref_compnr, 
                    src.cvat, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.delt, 
                    src.delt_kw, 
                    src.disc, 
                    src.dlor, 
                    src.dlor_kw, 
                    src.dlpt, 
                    src.dlvr, 
                    src.dorg, 
                    src.dorg_kw, 
                    src.dspr, 
                    src.dspr_kw, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.exrs, 
                    src.exrs_ref_compnr, 
                    src.iddt, 
                    src.inst, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.lcrq, 
                    src.lcrq_kw, 
                    src.ldam, 
                    src.lmdt, 
                    src.lmus, 
                    src.loco, 
                    src.lssn, 
                    src.lssn_ref_compnr, 
                    src.ltsl, 
                    src.ltsl_kw, 
                    src.milt, 
                    src.mrlc, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.oqan, 
                    src.orno, 
                    src.osch, 
                    src.ouni, 
                    src.ouni_ref_compnr, 
                    src.pass, 
                    src.pass_kw, 
                    src.paym, 
                    src.pddt, 
                    src.pono, 
                    src.porg, 
                    src.porg_kw, 
                    src.prdt, 
                    src.pric, 
                    src.pris, 
                    src.prsg, 
                    src.prsg_ref_compnr, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.rddt, 
                    src.rfcu, 
                    src.rfdl, 
                    src.rfic, 
                    src.rfid, 
                    src.rfit, 
                    src.rfsc, 
                    src.rfsh, 
                    src.rlcu, 
                    src.rown, 
                    src.rown_kw, 
                    src.rqan, 
                    src.rrsn, 
                    src.rrsn_ref_compnr, 
                    src.rtcc_1, 
                    src.rtcc_2, 
                    src.rtcc_3, 
                    src.rtcs_1, 
                    src.rtcs_2, 
                    src.rtcs_3, 
                    src.rtfc_1, 
                    src.rtfc_2, 
                    src.rtfc_3, 
                    src.rtfs_1, 
                    src.rtfs_2, 
                    src.rtfs_3, 
                    src.rtor, 
                    src.rtor_kw, 
                    src.sacu, 
                    src.sacu_ref_compnr, 
                    src.samt, 
                    src.samt_cntc, 
                    src.samt_dwhc, 
                    src.samt_homc, 
                    src.samt_prjc, 
                    src.samt_refc, 
                    src.samt_rpc1, 
                    src.samt_rpc2, 
                    src.schd, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.serl, 
                    src.sern, 
                    src.serv, 
                    src.serv_ref_compnr, 
                    src.shcn, 
                    src.shcn_kw, 
                    src.sign, 
                    src.sign_kw, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.sqan, 
                    src.srsl, 
                    src.srsl_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.suni, 
                    src.suni_ref_compnr, 
                    src.tact, 
                    src.tatd, 
                    src.tatd_ref_compnr, 
                    src.tcco, 
                    src.tcco_ref_compnr, 
                    src.tcff, 
                    src.tcff_kw, 
                    src.tcst, 
                    src.tcst_kw, 
                    src.tdel, 
                    src.tdel_kw, 
                    src.timestamp, 
                    src.tpla, 
                    src.tprj, 
                    src.tprj_ref_compnr, 
                    src.tprj_tpla_ref_compnr, 
                    src.tprj_tpla_tact_ref_compnr, 
                    src.tprj_tspa_ref_compnr, 
                    src.tprj_tstl_ref_compnr, 
                    src.tspa, 
                    src.tstl, 
                    src.twar, 
                    src.twar_ref_compnr, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.unbd, 
                    src.unbd_kw, 
                    src.username,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;