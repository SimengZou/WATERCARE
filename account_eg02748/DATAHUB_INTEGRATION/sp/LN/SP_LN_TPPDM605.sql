create or replace procedure DATAHUB_INTEGRATION.SP_LN_TPPDM605()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TPPDM605_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TPPDM605 as target using (SELECT * FROM (SELECT 
            strm.abpp, 
            strm.abpp_kw, 
            strm.abrf, 
            strm.abrf_kw, 
            strm.acgm, 
            strm.acgm_kw, 
            strm.acmp, 
            strm.acmp_kw, 
            strm.acpc, 
            strm.aerf, 
            strm.aext, 
            strm.agty, 
            strm.agty_kw, 
            strm.anbr, 
            strm.aprp, 
            strm.arpc, 
            strm.arrl, 
            strm.arrm, 
            strm.arrm_kw, 
            strm.arrt, 
            strm.ascd, 
            strm.avtp, 
            strm.avtp_ref_compnr, 
            strm.bdmt, 
            strm.bdmt_kw, 
            strm.bfpp, 
            strm.bfpp_kw, 
            strm.bfrf, 
            strm.bfrf_kw, 
            strm.btco, 
            strm.btco_kw, 
            strm.btdt, 
            strm.btpr, 
            strm.btpr_kw, 
            strm.capp, 
            strm.capp_kw, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccal, 
            strm.ccam, 
            strm.ccam_ref_compnr, 
            strm.ccat, 
            strm.ccat_ref_compnr, 
            strm.ccdt, 
            strm.ccot, 
            strm.ccot_ref_compnr, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdis, 
            strm.cdis_ref_compnr, 
            strm.cfac, 
            strm.cfac_ref_compnr, 
            strm.cfpr, 
            strm.cfye, 
            strm.cldr, 
            strm.cldr_ref_compnr, 
            strm.cmog, 
            strm.cmog_kw, 
            strm.cmpc, 
            strm.cmpc_kw, 
            strm.cmud, 
            strm.cmud_ref_compnr, 
            strm.cobs, 
            strm.cobs_ref_compnr, 
            strm.cogc, 
            strm.cogs, 
            strm.cogs_kw, 
            strm.compnr, 
            strm.copr, 
            strm.coty, 
            strm.coty_kw, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_ccal_ref_compnr, 
            strm.cprj_cpla_ref_compnr, 
            strm.cprj_cpla_rsac_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cprq, 
            strm.cprq_kw, 
            strm.creg, 
            strm.creg_ref_compnr, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.crtp, 
            strm.crtp_ref_compnr, 
            strm.csec, 
            strm.csec_ref_compnr, 
            strm.cspa, 
            strm.cstg, 
            strm.cstg_ref_compnr, 
            strm.cuni, 
            strm.cuni_ref_compnr, 
            strm.deleted, 
            strm.dlau, 
            strm.dldt, 
            strm.dsca, 
            strm.dscb, 
            strm.dscc, 
            strm.dscd, 
            strm.dwar, 
            strm.dwar_ref_compnr, 
            strm.earf, 
            strm.entu, 
            strm.espt, 
            strm.fddt, 
            strm.guid, 
            strm.hbpc, 
            strm.hdat, 
            strm.hsts, 
            strm.hsts_kw, 
            strm.husr, 
            strm.igcd, 
            strm.igcd_kw, 
            strm.inst, 
            strm.intp, 
            strm.intp_kw, 
            strm.invm, 
            strm.invm_kw, 
            strm.invr, 
            strm.invr_kw, 
            strm.ipin, 
            strm.ipin_kw, 
            strm.kopr, 
            strm.kopr_kw, 
            strm.kptm, 
            strm.kptm_kw, 
            strm.lcdt, 
            strm.lcla, 
            strm.lclg, 
            strm.lmdt, 
            strm.lmus, 
            strm.logc, 
            strm.logh, 
            strm.lpdt, 
            strm.ltrc, 
            strm.ltrs, 
            strm.lwha, 
            strm.lwha_kw, 
            strm.lwhb, 
            strm.lwhb_kw, 
            strm.lwhc, 
            strm.lwhc_kw, 
            strm.lwhd, 
            strm.lwhd_kw, 
            strm.lwta, 
            strm.lwta_kw, 
            strm.lwtb, 
            strm.lwtb_kw, 
            strm.lwtc, 
            strm.lwtc_kw, 
            strm.mprj, 
            strm.ncmp, 
            strm.njsp, 
            strm.ofes, 
            strm.ofes_ref_compnr, 
            strm.ofpr, 
            strm.ofpr_ref_compnr, 
            strm.padr, 
            strm.padr_ref_compnr, 
            strm.pcba, 
            strm.pceq, 
            strm.pcic, 
            strm.pcit, 
            strm.pcmp, 
            strm.pcrd, 
            strm.pcsb, 
            strm.pcts, 
            strm.pcwa, 
            strm.peri, 
            strm.plcd, 
            strm.plcd_kw, 
            strm.plgr, 
            strm.plgr_ref_compnr, 
            strm.pmfc, 
            strm.pmfc_ref_compnr, 
            strm.pmng, 
            strm.pmng_ref_compnr, 
            strm.potp, 
            strm.potp_ref_compnr, 
            strm.preq, 
            strm.preq_kw, 
            strm.prgm, 
            strm.prgm_ref_compnr, 
            strm.pric, 
            strm.pric_kw, 
            strm.prit, 
            strm.prit_kw, 
            strm.pror, 
            strm.pror_kw, 
            strm.prpc, 
            strm.prre, 
            strm.prre_kw, 
            strm.prsb, 
            strm.prsb_kw, 
            strm.prts, 
            strm.prts_kw, 
            strm.pscd, 
            strm.pseq, 
            strm.psic, 
            strm.psit, 
            strm.pssc, 
            strm.psta, 
            strm.pstf, 
            strm.pstf_kw, 
            strm.psts, 
            strm.psts_kw, 
            strm.ptcs, 
            strm.pwar, 
            strm.pwar_ref_compnr, 
            strm.ratc, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rats, 
            strm.rcmc_1, 
            strm.rcmc_2, 
            strm.rcmc_3, 
            strm.rdat, 
            strm.revl, 
            strm.revr, 
            strm.revr_kw, 
            strm.revt, 
            strm.rfcu, 
            strm.ripr, 
            strm.ripr_ref_compnr, 
            strm.rjct, 
            strm.rjct_kw, 
            strm.rrtp, 
            strm.rrtp_ref_compnr, 
            strm.rsac, 
            strm.rsip, 
            strm.rsmc_1, 
            strm.rsmc_2, 
            strm.rsmc_3, 
            strm.rsrv, 
            strm.rtyp, 
            strm.rtyp_ref_compnr, 
            strm.sadr, 
            strm.sadr_ref_compnr, 
            strm.seak, 
            strm.sequencenumber, 
            strm.stdt, 
            strm.stus, 
            strm.stus_kw, 
            strm.tbdg, 
            strm.tbdg_kw, 
            strm.timestamp, 
            strm.tmpl, 
            strm.tmpl_kw, 
            strm.tpac, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.uobs, 
            strm.uobs_kw, 
            strm.upal, 
            strm.upal_kw, 
            strm.user, 
            strm.username, 
            strm.ussu, 
            strm.ussu_kw, 
            strm.wipc, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cprj,
            strm.hdat ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPDM605 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.hdat=src.hdat) OR (target.hdat IS NULL AND src.hdat IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.abpp=src.abpp, 
                    target.abpp_kw=src.abpp_kw, 
                    target.abrf=src.abrf, 
                    target.abrf_kw=src.abrf_kw, 
                    target.acgm=src.acgm, 
                    target.acgm_kw=src.acgm_kw, 
                    target.acmp=src.acmp, 
                    target.acmp_kw=src.acmp_kw, 
                    target.acpc=src.acpc, 
                    target.aerf=src.aerf, 
                    target.aext=src.aext, 
                    target.agty=src.agty, 
                    target.agty_kw=src.agty_kw, 
                    target.anbr=src.anbr, 
                    target.aprp=src.aprp, 
                    target.arpc=src.arpc, 
                    target.arrl=src.arrl, 
                    target.arrm=src.arrm, 
                    target.arrm_kw=src.arrm_kw, 
                    target.arrt=src.arrt, 
                    target.ascd=src.ascd, 
                    target.avtp=src.avtp, 
                    target.avtp_ref_compnr=src.avtp_ref_compnr, 
                    target.bdmt=src.bdmt, 
                    target.bdmt_kw=src.bdmt_kw, 
                    target.bfpp=src.bfpp, 
                    target.bfpp_kw=src.bfpp_kw, 
                    target.bfrf=src.bfrf, 
                    target.bfrf_kw=src.bfrf_kw, 
                    target.btco=src.btco, 
                    target.btco_kw=src.btco_kw, 
                    target.btdt=src.btdt, 
                    target.btpr=src.btpr, 
                    target.btpr_kw=src.btpr_kw, 
                    target.capp=src.capp, 
                    target.capp_kw=src.capp_kw, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccal=src.ccal, 
                    target.ccam=src.ccam, 
                    target.ccam_ref_compnr=src.ccam_ref_compnr, 
                    target.ccat=src.ccat, 
                    target.ccat_ref_compnr=src.ccat_ref_compnr, 
                    target.ccdt=src.ccdt, 
                    target.ccot=src.ccot, 
                    target.ccot_ref_compnr=src.ccot_ref_compnr, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdis=src.cdis, 
                    target.cdis_ref_compnr=src.cdis_ref_compnr, 
                    target.cfac=src.cfac, 
                    target.cfac_ref_compnr=src.cfac_ref_compnr, 
                    target.cfpr=src.cfpr, 
                    target.cfye=src.cfye, 
                    target.cldr=src.cldr, 
                    target.cldr_ref_compnr=src.cldr_ref_compnr, 
                    target.cmog=src.cmog, 
                    target.cmog_kw=src.cmog_kw, 
                    target.cmpc=src.cmpc, 
                    target.cmpc_kw=src.cmpc_kw, 
                    target.cmud=src.cmud, 
                    target.cmud_ref_compnr=src.cmud_ref_compnr, 
                    target.cobs=src.cobs, 
                    target.cobs_ref_compnr=src.cobs_ref_compnr, 
                    target.cogc=src.cogc, 
                    target.cogs=src.cogs, 
                    target.cogs_kw=src.cogs_kw, 
                    target.compnr=src.compnr, 
                    target.copr=src.copr, 
                    target.coty=src.coty, 
                    target.coty_kw=src.coty_kw, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_ccal_ref_compnr=src.cprj_ccal_ref_compnr, 
                    target.cprj_cpla_ref_compnr=src.cprj_cpla_ref_compnr, 
                    target.cprj_cpla_rsac_ref_compnr=src.cprj_cpla_rsac_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprq=src.cprq, 
                    target.cprq_kw=src.cprq_kw, 
                    target.creg=src.creg, 
                    target.creg_ref_compnr=src.creg_ref_compnr, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.crtp=src.crtp, 
                    target.crtp_ref_compnr=src.crtp_ref_compnr, 
                    target.csec=src.csec, 
                    target.csec_ref_compnr=src.csec_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cstg=src.cstg, 
                    target.cstg_ref_compnr=src.cstg_ref_compnr, 
                    target.cuni=src.cuni, 
                    target.cuni_ref_compnr=src.cuni_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dlau=src.dlau, 
                    target.dldt=src.dldt, 
                    target.dsca=src.dsca, 
                    target.dscb=src.dscb, 
                    target.dscc=src.dscc, 
                    target.dscd=src.dscd, 
                    target.dwar=src.dwar, 
                    target.dwar_ref_compnr=src.dwar_ref_compnr, 
                    target.earf=src.earf, 
                    target.entu=src.entu, 
                    target.espt=src.espt, 
                    target.fddt=src.fddt, 
                    target.guid=src.guid, 
                    target.hbpc=src.hbpc, 
                    target.hdat=src.hdat, 
                    target.hsts=src.hsts, 
                    target.hsts_kw=src.hsts_kw, 
                    target.husr=src.husr, 
                    target.igcd=src.igcd, 
                    target.igcd_kw=src.igcd_kw, 
                    target.inst=src.inst, 
                    target.intp=src.intp, 
                    target.intp_kw=src.intp_kw, 
                    target.invm=src.invm, 
                    target.invm_kw=src.invm_kw, 
                    target.invr=src.invr, 
                    target.invr_kw=src.invr_kw, 
                    target.ipin=src.ipin, 
                    target.ipin_kw=src.ipin_kw, 
                    target.kopr=src.kopr, 
                    target.kopr_kw=src.kopr_kw, 
                    target.kptm=src.kptm, 
                    target.kptm_kw=src.kptm_kw, 
                    target.lcdt=src.lcdt, 
                    target.lcla=src.lcla, 
                    target.lclg=src.lclg, 
                    target.lmdt=src.lmdt, 
                    target.lmus=src.lmus, 
                    target.logc=src.logc, 
                    target.logh=src.logh, 
                    target.lpdt=src.lpdt, 
                    target.ltrc=src.ltrc, 
                    target.ltrs=src.ltrs, 
                    target.lwha=src.lwha, 
                    target.lwha_kw=src.lwha_kw, 
                    target.lwhb=src.lwhb, 
                    target.lwhb_kw=src.lwhb_kw, 
                    target.lwhc=src.lwhc, 
                    target.lwhc_kw=src.lwhc_kw, 
                    target.lwhd=src.lwhd, 
                    target.lwhd_kw=src.lwhd_kw, 
                    target.lwta=src.lwta, 
                    target.lwta_kw=src.lwta_kw, 
                    target.lwtb=src.lwtb, 
                    target.lwtb_kw=src.lwtb_kw, 
                    target.lwtc=src.lwtc, 
                    target.lwtc_kw=src.lwtc_kw, 
                    target.mprj=src.mprj, 
                    target.ncmp=src.ncmp, 
                    target.njsp=src.njsp, 
                    target.ofes=src.ofes, 
                    target.ofes_ref_compnr=src.ofes_ref_compnr, 
                    target.ofpr=src.ofpr, 
                    target.ofpr_ref_compnr=src.ofpr_ref_compnr, 
                    target.padr=src.padr, 
                    target.padr_ref_compnr=src.padr_ref_compnr, 
                    target.pcba=src.pcba, 
                    target.pceq=src.pceq, 
                    target.pcic=src.pcic, 
                    target.pcit=src.pcit, 
                    target.pcmp=src.pcmp, 
                    target.pcrd=src.pcrd, 
                    target.pcsb=src.pcsb, 
                    target.pcts=src.pcts, 
                    target.pcwa=src.pcwa, 
                    target.peri=src.peri, 
                    target.plcd=src.plcd, 
                    target.plcd_kw=src.plcd_kw, 
                    target.plgr=src.plgr, 
                    target.plgr_ref_compnr=src.plgr_ref_compnr, 
                    target.pmfc=src.pmfc, 
                    target.pmfc_ref_compnr=src.pmfc_ref_compnr, 
                    target.pmng=src.pmng, 
                    target.pmng_ref_compnr=src.pmng_ref_compnr, 
                    target.potp=src.potp, 
                    target.potp_ref_compnr=src.potp_ref_compnr, 
                    target.preq=src.preq, 
                    target.preq_kw=src.preq_kw, 
                    target.prgm=src.prgm, 
                    target.prgm_ref_compnr=src.prgm_ref_compnr, 
                    target.pric=src.pric, 
                    target.pric_kw=src.pric_kw, 
                    target.prit=src.prit, 
                    target.prit_kw=src.prit_kw, 
                    target.pror=src.pror, 
                    target.pror_kw=src.pror_kw, 
                    target.prpc=src.prpc, 
                    target.prre=src.prre, 
                    target.prre_kw=src.prre_kw, 
                    target.prsb=src.prsb, 
                    target.prsb_kw=src.prsb_kw, 
                    target.prts=src.prts, 
                    target.prts_kw=src.prts_kw, 
                    target.pscd=src.pscd, 
                    target.pseq=src.pseq, 
                    target.psic=src.psic, 
                    target.psit=src.psit, 
                    target.pssc=src.pssc, 
                    target.psta=src.psta, 
                    target.pstf=src.pstf, 
                    target.pstf_kw=src.pstf_kw, 
                    target.psts=src.psts, 
                    target.psts_kw=src.psts_kw, 
                    target.ptcs=src.ptcs, 
                    target.pwar=src.pwar, 
                    target.pwar_ref_compnr=src.pwar_ref_compnr, 
                    target.ratc=src.ratc, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rats=src.rats, 
                    target.rcmc_1=src.rcmc_1, 
                    target.rcmc_2=src.rcmc_2, 
                    target.rcmc_3=src.rcmc_3, 
                    target.rdat=src.rdat, 
                    target.revl=src.revl, 
                    target.revr=src.revr, 
                    target.revr_kw=src.revr_kw, 
                    target.revt=src.revt, 
                    target.rfcu=src.rfcu, 
                    target.ripr=src.ripr, 
                    target.ripr_ref_compnr=src.ripr_ref_compnr, 
                    target.rjct=src.rjct, 
                    target.rjct_kw=src.rjct_kw, 
                    target.rrtp=src.rrtp, 
                    target.rrtp_ref_compnr=src.rrtp_ref_compnr, 
                    target.rsac=src.rsac, 
                    target.rsip=src.rsip, 
                    target.rsmc_1=src.rsmc_1, 
                    target.rsmc_2=src.rsmc_2, 
                    target.rsmc_3=src.rsmc_3, 
                    target.rsrv=src.rsrv, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_ref_compnr=src.rtyp_ref_compnr, 
                    target.sadr=src.sadr, 
                    target.sadr_ref_compnr=src.sadr_ref_compnr, 
                    target.seak=src.seak, 
                    target.sequencenumber=src.sequencenumber, 
                    target.stdt=src.stdt, 
                    target.stus=src.stus, 
                    target.stus_kw=src.stus_kw, 
                    target.tbdg=src.tbdg, 
                    target.tbdg_kw=src.tbdg_kw, 
                    target.timestamp=src.timestamp, 
                    target.tmpl=src.tmpl, 
                    target.tmpl_kw=src.tmpl_kw, 
                    target.tpac=src.tpac, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.uobs=src.uobs, 
                    target.uobs_kw=src.uobs_kw, 
                    target.upal=src.upal, 
                    target.upal_kw=src.upal_kw, 
                    target.user=src.user, 
                    target.username=src.username, 
                    target.ussu=src.ussu, 
                    target.ussu_kw=src.ussu_kw, 
                    target.wipc=src.wipc, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    abpp, 
                    abpp_kw, 
                    abrf, 
                    abrf_kw, 
                    acgm, 
                    acgm_kw, 
                    acmp, 
                    acmp_kw, 
                    acpc, 
                    aerf, 
                    aext, 
                    agty, 
                    agty_kw, 
                    anbr, 
                    aprp, 
                    arpc, 
                    arrl, 
                    arrm, 
                    arrm_kw, 
                    arrt, 
                    ascd, 
                    avtp, 
                    avtp_ref_compnr, 
                    bdmt, 
                    bdmt_kw, 
                    bfpp, 
                    bfpp_kw, 
                    bfrf, 
                    bfrf_kw, 
                    btco, 
                    btco_kw, 
                    btdt, 
                    btpr, 
                    btpr_kw, 
                    capp, 
                    capp_kw, 
                    carr, 
                    carr_ref_compnr, 
                    ccal, 
                    ccam, 
                    ccam_ref_compnr, 
                    ccat, 
                    ccat_ref_compnr, 
                    ccdt, 
                    ccot, 
                    ccot_ref_compnr, 
                    ccur, 
                    ccur_ref_compnr, 
                    cdis, 
                    cdis_ref_compnr, 
                    cfac, 
                    cfac_ref_compnr, 
                    cfpr, 
                    cfye, 
                    cldr, 
                    cldr_ref_compnr, 
                    cmog, 
                    cmog_kw, 
                    cmpc, 
                    cmpc_kw, 
                    cmud, 
                    cmud_ref_compnr, 
                    cobs, 
                    cobs_ref_compnr, 
                    cogc, 
                    cogs, 
                    cogs_kw, 
                    compnr, 
                    copr, 
                    coty, 
                    coty_kw, 
                    cpla, 
                    cprj, 
                    cprj_ccal_ref_compnr, 
                    cprj_cpla_ref_compnr, 
                    cprj_cpla_rsac_ref_compnr, 
                    cprj_cspa_ref_compnr, 
                    cprj_ref_compnr, 
                    cprq, 
                    cprq_kw, 
                    creg, 
                    creg_ref_compnr, 
                    crte, 
                    crte_ref_compnr, 
                    crtp, 
                    crtp_ref_compnr, 
                    csec, 
                    csec_ref_compnr, 
                    cspa, 
                    cstg, 
                    cstg_ref_compnr, 
                    cuni, 
                    cuni_ref_compnr, 
                    deleted, 
                    dlau, 
                    dldt, 
                    dsca, 
                    dscb, 
                    dscc, 
                    dscd, 
                    dwar, 
                    dwar_ref_compnr, 
                    earf, 
                    entu, 
                    espt, 
                    fddt, 
                    guid, 
                    hbpc, 
                    hdat, 
                    hsts, 
                    hsts_kw, 
                    husr, 
                    igcd, 
                    igcd_kw, 
                    inst, 
                    intp, 
                    intp_kw, 
                    invm, 
                    invm_kw, 
                    invr, 
                    invr_kw, 
                    ipin, 
                    ipin_kw, 
                    kopr, 
                    kopr_kw, 
                    kptm, 
                    kptm_kw, 
                    lcdt, 
                    lcla, 
                    lclg, 
                    lmdt, 
                    lmus, 
                    logc, 
                    logh, 
                    lpdt, 
                    ltrc, 
                    ltrs, 
                    lwha, 
                    lwha_kw, 
                    lwhb, 
                    lwhb_kw, 
                    lwhc, 
                    lwhc_kw, 
                    lwhd, 
                    lwhd_kw, 
                    lwta, 
                    lwta_kw, 
                    lwtb, 
                    lwtb_kw, 
                    lwtc, 
                    lwtc_kw, 
                    mprj, 
                    ncmp, 
                    njsp, 
                    ofes, 
                    ofes_ref_compnr, 
                    ofpr, 
                    ofpr_ref_compnr, 
                    padr, 
                    padr_ref_compnr, 
                    pcba, 
                    pceq, 
                    pcic, 
                    pcit, 
                    pcmp, 
                    pcrd, 
                    pcsb, 
                    pcts, 
                    pcwa, 
                    peri, 
                    plcd, 
                    plcd_kw, 
                    plgr, 
                    plgr_ref_compnr, 
                    pmfc, 
                    pmfc_ref_compnr, 
                    pmng, 
                    pmng_ref_compnr, 
                    potp, 
                    potp_ref_compnr, 
                    preq, 
                    preq_kw, 
                    prgm, 
                    prgm_ref_compnr, 
                    pric, 
                    pric_kw, 
                    prit, 
                    prit_kw, 
                    pror, 
                    pror_kw, 
                    prpc, 
                    prre, 
                    prre_kw, 
                    prsb, 
                    prsb_kw, 
                    prts, 
                    prts_kw, 
                    pscd, 
                    pseq, 
                    psic, 
                    psit, 
                    pssc, 
                    psta, 
                    pstf, 
                    pstf_kw, 
                    psts, 
                    psts_kw, 
                    ptcs, 
                    pwar, 
                    pwar_ref_compnr, 
                    ratc, 
                    rate_1, 
                    rate_2, 
                    rate_3, 
                    ratf_1, 
                    ratf_2, 
                    ratf_3, 
                    rats, 
                    rcmc_1, 
                    rcmc_2, 
                    rcmc_3, 
                    rdat, 
                    revl, 
                    revr, 
                    revr_kw, 
                    revt, 
                    rfcu, 
                    ripr, 
                    ripr_ref_compnr, 
                    rjct, 
                    rjct_kw, 
                    rrtp, 
                    rrtp_ref_compnr, 
                    rsac, 
                    rsip, 
                    rsmc_1, 
                    rsmc_2, 
                    rsmc_3, 
                    rsrv, 
                    rtyp, 
                    rtyp_ref_compnr, 
                    sadr, 
                    sadr_ref_compnr, 
                    seak, 
                    sequencenumber, 
                    stdt, 
                    stus, 
                    stus_kw, 
                    tbdg, 
                    tbdg_kw, 
                    timestamp, 
                    tmpl, 
                    tmpl_kw, 
                    tpac, 
                    txta, 
                    txta_ref_compnr, 
                    uobs, 
                    uobs_kw, 
                    upal, 
                    upal_kw, 
                    user, 
                    username, 
                    ussu, 
                    ussu_kw, 
                    wipc, 
                    year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.abpp, 
                    src.abpp_kw, 
                    src.abrf, 
                    src.abrf_kw, 
                    src.acgm, 
                    src.acgm_kw, 
                    src.acmp, 
                    src.acmp_kw, 
                    src.acpc, 
                    src.aerf, 
                    src.aext, 
                    src.agty, 
                    src.agty_kw, 
                    src.anbr, 
                    src.aprp, 
                    src.arpc, 
                    src.arrl, 
                    src.arrm, 
                    src.arrm_kw, 
                    src.arrt, 
                    src.ascd, 
                    src.avtp, 
                    src.avtp_ref_compnr, 
                    src.bdmt, 
                    src.bdmt_kw, 
                    src.bfpp, 
                    src.bfpp_kw, 
                    src.bfrf, 
                    src.bfrf_kw, 
                    src.btco, 
                    src.btco_kw, 
                    src.btdt, 
                    src.btpr, 
                    src.btpr_kw, 
                    src.capp, 
                    src.capp_kw, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccal, 
                    src.ccam, 
                    src.ccam_ref_compnr, 
                    src.ccat, 
                    src.ccat_ref_compnr, 
                    src.ccdt, 
                    src.ccot, 
                    src.ccot_ref_compnr, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdis, 
                    src.cdis_ref_compnr, 
                    src.cfac, 
                    src.cfac_ref_compnr, 
                    src.cfpr, 
                    src.cfye, 
                    src.cldr, 
                    src.cldr_ref_compnr, 
                    src.cmog, 
                    src.cmog_kw, 
                    src.cmpc, 
                    src.cmpc_kw, 
                    src.cmud, 
                    src.cmud_ref_compnr, 
                    src.cobs, 
                    src.cobs_ref_compnr, 
                    src.cogc, 
                    src.cogs, 
                    src.cogs_kw, 
                    src.compnr, 
                    src.copr, 
                    src.coty, 
                    src.coty_kw, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_ccal_ref_compnr, 
                    src.cprj_cpla_ref_compnr, 
                    src.cprj_cpla_rsac_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cprq, 
                    src.cprq_kw, 
                    src.creg, 
                    src.creg_ref_compnr, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.crtp, 
                    src.crtp_ref_compnr, 
                    src.csec, 
                    src.csec_ref_compnr, 
                    src.cspa, 
                    src.cstg, 
                    src.cstg_ref_compnr, 
                    src.cuni, 
                    src.cuni_ref_compnr, 
                    src.deleted, 
                    src.dlau, 
                    src.dldt, 
                    src.dsca, 
                    src.dscb, 
                    src.dscc, 
                    src.dscd, 
                    src.dwar, 
                    src.dwar_ref_compnr, 
                    src.earf, 
                    src.entu, 
                    src.espt, 
                    src.fddt, 
                    src.guid, 
                    src.hbpc, 
                    src.hdat, 
                    src.hsts, 
                    src.hsts_kw, 
                    src.husr, 
                    src.igcd, 
                    src.igcd_kw, 
                    src.inst, 
                    src.intp, 
                    src.intp_kw, 
                    src.invm, 
                    src.invm_kw, 
                    src.invr, 
                    src.invr_kw, 
                    src.ipin, 
                    src.ipin_kw, 
                    src.kopr, 
                    src.kopr_kw, 
                    src.kptm, 
                    src.kptm_kw, 
                    src.lcdt, 
                    src.lcla, 
                    src.lclg, 
                    src.lmdt, 
                    src.lmus, 
                    src.logc, 
                    src.logh, 
                    src.lpdt, 
                    src.ltrc, 
                    src.ltrs, 
                    src.lwha, 
                    src.lwha_kw, 
                    src.lwhb, 
                    src.lwhb_kw, 
                    src.lwhc, 
                    src.lwhc_kw, 
                    src.lwhd, 
                    src.lwhd_kw, 
                    src.lwta, 
                    src.lwta_kw, 
                    src.lwtb, 
                    src.lwtb_kw, 
                    src.lwtc, 
                    src.lwtc_kw, 
                    src.mprj, 
                    src.ncmp, 
                    src.njsp, 
                    src.ofes, 
                    src.ofes_ref_compnr, 
                    src.ofpr, 
                    src.ofpr_ref_compnr, 
                    src.padr, 
                    src.padr_ref_compnr, 
                    src.pcba, 
                    src.pceq, 
                    src.pcic, 
                    src.pcit, 
                    src.pcmp, 
                    src.pcrd, 
                    src.pcsb, 
                    src.pcts, 
                    src.pcwa, 
                    src.peri, 
                    src.plcd, 
                    src.plcd_kw, 
                    src.plgr, 
                    src.plgr_ref_compnr, 
                    src.pmfc, 
                    src.pmfc_ref_compnr, 
                    src.pmng, 
                    src.pmng_ref_compnr, 
                    src.potp, 
                    src.potp_ref_compnr, 
                    src.preq, 
                    src.preq_kw, 
                    src.prgm, 
                    src.prgm_ref_compnr, 
                    src.pric, 
                    src.pric_kw, 
                    src.prit, 
                    src.prit_kw, 
                    src.pror, 
                    src.pror_kw, 
                    src.prpc, 
                    src.prre, 
                    src.prre_kw, 
                    src.prsb, 
                    src.prsb_kw, 
                    src.prts, 
                    src.prts_kw, 
                    src.pscd, 
                    src.pseq, 
                    src.psic, 
                    src.psit, 
                    src.pssc, 
                    src.psta, 
                    src.pstf, 
                    src.pstf_kw, 
                    src.psts, 
                    src.psts_kw, 
                    src.ptcs, 
                    src.pwar, 
                    src.pwar_ref_compnr, 
                    src.ratc, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rats, 
                    src.rcmc_1, 
                    src.rcmc_2, 
                    src.rcmc_3, 
                    src.rdat, 
                    src.revl, 
                    src.revr, 
                    src.revr_kw, 
                    src.revt, 
                    src.rfcu, 
                    src.ripr, 
                    src.ripr_ref_compnr, 
                    src.rjct, 
                    src.rjct_kw, 
                    src.rrtp, 
                    src.rrtp_ref_compnr, 
                    src.rsac, 
                    src.rsip, 
                    src.rsmc_1, 
                    src.rsmc_2, 
                    src.rsmc_3, 
                    src.rsrv, 
                    src.rtyp, 
                    src.rtyp_ref_compnr, 
                    src.sadr, 
                    src.sadr_ref_compnr, 
                    src.seak, 
                    src.sequencenumber, 
                    src.stdt, 
                    src.stus, 
                    src.stus_kw, 
                    src.tbdg, 
                    src.tbdg_kw, 
                    src.timestamp, 
                    src.tmpl, 
                    src.tmpl_kw, 
                    src.tpac, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.uobs, 
                    src.uobs_kw, 
                    src.upal, 
                    src.upal_kw, 
                    src.user, 
                    src.username, 
                    src.ussu, 
                    src.ussu_kw, 
                    src.wipc, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TPPDM605_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.abpp, 
            strm.abpp_kw, 
            strm.abrf, 
            strm.abrf_kw, 
            strm.acgm, 
            strm.acgm_kw, 
            strm.acmp, 
            strm.acmp_kw, 
            strm.acpc, 
            strm.aerf, 
            strm.aext, 
            strm.agty, 
            strm.agty_kw, 
            strm.anbr, 
            strm.aprp, 
            strm.arpc, 
            strm.arrl, 
            strm.arrm, 
            strm.arrm_kw, 
            strm.arrt, 
            strm.ascd, 
            strm.avtp, 
            strm.avtp_ref_compnr, 
            strm.bdmt, 
            strm.bdmt_kw, 
            strm.bfpp, 
            strm.bfpp_kw, 
            strm.bfrf, 
            strm.bfrf_kw, 
            strm.btco, 
            strm.btco_kw, 
            strm.btdt, 
            strm.btpr, 
            strm.btpr_kw, 
            strm.capp, 
            strm.capp_kw, 
            strm.carr, 
            strm.carr_ref_compnr, 
            strm.ccal, 
            strm.ccam, 
            strm.ccam_ref_compnr, 
            strm.ccat, 
            strm.ccat_ref_compnr, 
            strm.ccdt, 
            strm.ccot, 
            strm.ccot_ref_compnr, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdis, 
            strm.cdis_ref_compnr, 
            strm.cfac, 
            strm.cfac_ref_compnr, 
            strm.cfpr, 
            strm.cfye, 
            strm.cldr, 
            strm.cldr_ref_compnr, 
            strm.cmog, 
            strm.cmog_kw, 
            strm.cmpc, 
            strm.cmpc_kw, 
            strm.cmud, 
            strm.cmud_ref_compnr, 
            strm.cobs, 
            strm.cobs_ref_compnr, 
            strm.cogc, 
            strm.cogs, 
            strm.cogs_kw, 
            strm.compnr, 
            strm.copr, 
            strm.coty, 
            strm.coty_kw, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_ccal_ref_compnr, 
            strm.cprj_cpla_ref_compnr, 
            strm.cprj_cpla_rsac_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cprq, 
            strm.cprq_kw, 
            strm.creg, 
            strm.creg_ref_compnr, 
            strm.crte, 
            strm.crte_ref_compnr, 
            strm.crtp, 
            strm.crtp_ref_compnr, 
            strm.csec, 
            strm.csec_ref_compnr, 
            strm.cspa, 
            strm.cstg, 
            strm.cstg_ref_compnr, 
            strm.cuni, 
            strm.cuni_ref_compnr, 
            strm.deleted, 
            strm.dlau, 
            strm.dldt, 
            strm.dsca, 
            strm.dscb, 
            strm.dscc, 
            strm.dscd, 
            strm.dwar, 
            strm.dwar_ref_compnr, 
            strm.earf, 
            strm.entu, 
            strm.espt, 
            strm.fddt, 
            strm.guid, 
            strm.hbpc, 
            strm.hdat, 
            strm.hsts, 
            strm.hsts_kw, 
            strm.husr, 
            strm.igcd, 
            strm.igcd_kw, 
            strm.inst, 
            strm.intp, 
            strm.intp_kw, 
            strm.invm, 
            strm.invm_kw, 
            strm.invr, 
            strm.invr_kw, 
            strm.ipin, 
            strm.ipin_kw, 
            strm.kopr, 
            strm.kopr_kw, 
            strm.kptm, 
            strm.kptm_kw, 
            strm.lcdt, 
            strm.lcla, 
            strm.lclg, 
            strm.lmdt, 
            strm.lmus, 
            strm.logc, 
            strm.logh, 
            strm.lpdt, 
            strm.ltrc, 
            strm.ltrs, 
            strm.lwha, 
            strm.lwha_kw, 
            strm.lwhb, 
            strm.lwhb_kw, 
            strm.lwhc, 
            strm.lwhc_kw, 
            strm.lwhd, 
            strm.lwhd_kw, 
            strm.lwta, 
            strm.lwta_kw, 
            strm.lwtb, 
            strm.lwtb_kw, 
            strm.lwtc, 
            strm.lwtc_kw, 
            strm.mprj, 
            strm.ncmp, 
            strm.njsp, 
            strm.ofes, 
            strm.ofes_ref_compnr, 
            strm.ofpr, 
            strm.ofpr_ref_compnr, 
            strm.padr, 
            strm.padr_ref_compnr, 
            strm.pcba, 
            strm.pceq, 
            strm.pcic, 
            strm.pcit, 
            strm.pcmp, 
            strm.pcrd, 
            strm.pcsb, 
            strm.pcts, 
            strm.pcwa, 
            strm.peri, 
            strm.plcd, 
            strm.plcd_kw, 
            strm.plgr, 
            strm.plgr_ref_compnr, 
            strm.pmfc, 
            strm.pmfc_ref_compnr, 
            strm.pmng, 
            strm.pmng_ref_compnr, 
            strm.potp, 
            strm.potp_ref_compnr, 
            strm.preq, 
            strm.preq_kw, 
            strm.prgm, 
            strm.prgm_ref_compnr, 
            strm.pric, 
            strm.pric_kw, 
            strm.prit, 
            strm.prit_kw, 
            strm.pror, 
            strm.pror_kw, 
            strm.prpc, 
            strm.prre, 
            strm.prre_kw, 
            strm.prsb, 
            strm.prsb_kw, 
            strm.prts, 
            strm.prts_kw, 
            strm.pscd, 
            strm.pseq, 
            strm.psic, 
            strm.psit, 
            strm.pssc, 
            strm.psta, 
            strm.pstf, 
            strm.pstf_kw, 
            strm.psts, 
            strm.psts_kw, 
            strm.ptcs, 
            strm.pwar, 
            strm.pwar_ref_compnr, 
            strm.ratc, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rats, 
            strm.rcmc_1, 
            strm.rcmc_2, 
            strm.rcmc_3, 
            strm.rdat, 
            strm.revl, 
            strm.revr, 
            strm.revr_kw, 
            strm.revt, 
            strm.rfcu, 
            strm.ripr, 
            strm.ripr_ref_compnr, 
            strm.rjct, 
            strm.rjct_kw, 
            strm.rrtp, 
            strm.rrtp_ref_compnr, 
            strm.rsac, 
            strm.rsip, 
            strm.rsmc_1, 
            strm.rsmc_2, 
            strm.rsmc_3, 
            strm.rsrv, 
            strm.rtyp, 
            strm.rtyp_ref_compnr, 
            strm.sadr, 
            strm.sadr_ref_compnr, 
            strm.seak, 
            strm.sequencenumber, 
            strm.stdt, 
            strm.stus, 
            strm.stus_kw, 
            strm.tbdg, 
            strm.tbdg_kw, 
            strm.timestamp, 
            strm.tmpl, 
            strm.tmpl_kw, 
            strm.tpac, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.uobs, 
            strm.uobs_kw, 
            strm.upal, 
            strm.upal_kw, 
            strm.user, 
            strm.username, 
            strm.ussu, 
            strm.ussu_kw, 
            strm.wipc, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cprj,
            strm.hdat ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPDM605 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.hdat=src.hdat) OR (target.hdat IS NULL AND src.hdat IS NULL)) 
                when matched then update set
                    target.abpp=src.abpp, 
                    target.abpp_kw=src.abpp_kw, 
                    target.abrf=src.abrf, 
                    target.abrf_kw=src.abrf_kw, 
                    target.acgm=src.acgm, 
                    target.acgm_kw=src.acgm_kw, 
                    target.acmp=src.acmp, 
                    target.acmp_kw=src.acmp_kw, 
                    target.acpc=src.acpc, 
                    target.aerf=src.aerf, 
                    target.aext=src.aext, 
                    target.agty=src.agty, 
                    target.agty_kw=src.agty_kw, 
                    target.anbr=src.anbr, 
                    target.aprp=src.aprp, 
                    target.arpc=src.arpc, 
                    target.arrl=src.arrl, 
                    target.arrm=src.arrm, 
                    target.arrm_kw=src.arrm_kw, 
                    target.arrt=src.arrt, 
                    target.ascd=src.ascd, 
                    target.avtp=src.avtp, 
                    target.avtp_ref_compnr=src.avtp_ref_compnr, 
                    target.bdmt=src.bdmt, 
                    target.bdmt_kw=src.bdmt_kw, 
                    target.bfpp=src.bfpp, 
                    target.bfpp_kw=src.bfpp_kw, 
                    target.bfrf=src.bfrf, 
                    target.bfrf_kw=src.bfrf_kw, 
                    target.btco=src.btco, 
                    target.btco_kw=src.btco_kw, 
                    target.btdt=src.btdt, 
                    target.btpr=src.btpr, 
                    target.btpr_kw=src.btpr_kw, 
                    target.capp=src.capp, 
                    target.capp_kw=src.capp_kw, 
                    target.carr=src.carr, 
                    target.carr_ref_compnr=src.carr_ref_compnr, 
                    target.ccal=src.ccal, 
                    target.ccam=src.ccam, 
                    target.ccam_ref_compnr=src.ccam_ref_compnr, 
                    target.ccat=src.ccat, 
                    target.ccat_ref_compnr=src.ccat_ref_compnr, 
                    target.ccdt=src.ccdt, 
                    target.ccot=src.ccot, 
                    target.ccot_ref_compnr=src.ccot_ref_compnr, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdis=src.cdis, 
                    target.cdis_ref_compnr=src.cdis_ref_compnr, 
                    target.cfac=src.cfac, 
                    target.cfac_ref_compnr=src.cfac_ref_compnr, 
                    target.cfpr=src.cfpr, 
                    target.cfye=src.cfye, 
                    target.cldr=src.cldr, 
                    target.cldr_ref_compnr=src.cldr_ref_compnr, 
                    target.cmog=src.cmog, 
                    target.cmog_kw=src.cmog_kw, 
                    target.cmpc=src.cmpc, 
                    target.cmpc_kw=src.cmpc_kw, 
                    target.cmud=src.cmud, 
                    target.cmud_ref_compnr=src.cmud_ref_compnr, 
                    target.cobs=src.cobs, 
                    target.cobs_ref_compnr=src.cobs_ref_compnr, 
                    target.cogc=src.cogc, 
                    target.cogs=src.cogs, 
                    target.cogs_kw=src.cogs_kw, 
                    target.compnr=src.compnr, 
                    target.copr=src.copr, 
                    target.coty=src.coty, 
                    target.coty_kw=src.coty_kw, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_ccal_ref_compnr=src.cprj_ccal_ref_compnr, 
                    target.cprj_cpla_ref_compnr=src.cprj_cpla_ref_compnr, 
                    target.cprj_cpla_rsac_ref_compnr=src.cprj_cpla_rsac_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprq=src.cprq, 
                    target.cprq_kw=src.cprq_kw, 
                    target.creg=src.creg, 
                    target.creg_ref_compnr=src.creg_ref_compnr, 
                    target.crte=src.crte, 
                    target.crte_ref_compnr=src.crte_ref_compnr, 
                    target.crtp=src.crtp, 
                    target.crtp_ref_compnr=src.crtp_ref_compnr, 
                    target.csec=src.csec, 
                    target.csec_ref_compnr=src.csec_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cstg=src.cstg, 
                    target.cstg_ref_compnr=src.cstg_ref_compnr, 
                    target.cuni=src.cuni, 
                    target.cuni_ref_compnr=src.cuni_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dlau=src.dlau, 
                    target.dldt=src.dldt, 
                    target.dsca=src.dsca, 
                    target.dscb=src.dscb, 
                    target.dscc=src.dscc, 
                    target.dscd=src.dscd, 
                    target.dwar=src.dwar, 
                    target.dwar_ref_compnr=src.dwar_ref_compnr, 
                    target.earf=src.earf, 
                    target.entu=src.entu, 
                    target.espt=src.espt, 
                    target.fddt=src.fddt, 
                    target.guid=src.guid, 
                    target.hbpc=src.hbpc, 
                    target.hdat=src.hdat, 
                    target.hsts=src.hsts, 
                    target.hsts_kw=src.hsts_kw, 
                    target.husr=src.husr, 
                    target.igcd=src.igcd, 
                    target.igcd_kw=src.igcd_kw, 
                    target.inst=src.inst, 
                    target.intp=src.intp, 
                    target.intp_kw=src.intp_kw, 
                    target.invm=src.invm, 
                    target.invm_kw=src.invm_kw, 
                    target.invr=src.invr, 
                    target.invr_kw=src.invr_kw, 
                    target.ipin=src.ipin, 
                    target.ipin_kw=src.ipin_kw, 
                    target.kopr=src.kopr, 
                    target.kopr_kw=src.kopr_kw, 
                    target.kptm=src.kptm, 
                    target.kptm_kw=src.kptm_kw, 
                    target.lcdt=src.lcdt, 
                    target.lcla=src.lcla, 
                    target.lclg=src.lclg, 
                    target.lmdt=src.lmdt, 
                    target.lmus=src.lmus, 
                    target.logc=src.logc, 
                    target.logh=src.logh, 
                    target.lpdt=src.lpdt, 
                    target.ltrc=src.ltrc, 
                    target.ltrs=src.ltrs, 
                    target.lwha=src.lwha, 
                    target.lwha_kw=src.lwha_kw, 
                    target.lwhb=src.lwhb, 
                    target.lwhb_kw=src.lwhb_kw, 
                    target.lwhc=src.lwhc, 
                    target.lwhc_kw=src.lwhc_kw, 
                    target.lwhd=src.lwhd, 
                    target.lwhd_kw=src.lwhd_kw, 
                    target.lwta=src.lwta, 
                    target.lwta_kw=src.lwta_kw, 
                    target.lwtb=src.lwtb, 
                    target.lwtb_kw=src.lwtb_kw, 
                    target.lwtc=src.lwtc, 
                    target.lwtc_kw=src.lwtc_kw, 
                    target.mprj=src.mprj, 
                    target.ncmp=src.ncmp, 
                    target.njsp=src.njsp, 
                    target.ofes=src.ofes, 
                    target.ofes_ref_compnr=src.ofes_ref_compnr, 
                    target.ofpr=src.ofpr, 
                    target.ofpr_ref_compnr=src.ofpr_ref_compnr, 
                    target.padr=src.padr, 
                    target.padr_ref_compnr=src.padr_ref_compnr, 
                    target.pcba=src.pcba, 
                    target.pceq=src.pceq, 
                    target.pcic=src.pcic, 
                    target.pcit=src.pcit, 
                    target.pcmp=src.pcmp, 
                    target.pcrd=src.pcrd, 
                    target.pcsb=src.pcsb, 
                    target.pcts=src.pcts, 
                    target.pcwa=src.pcwa, 
                    target.peri=src.peri, 
                    target.plcd=src.plcd, 
                    target.plcd_kw=src.plcd_kw, 
                    target.plgr=src.plgr, 
                    target.plgr_ref_compnr=src.plgr_ref_compnr, 
                    target.pmfc=src.pmfc, 
                    target.pmfc_ref_compnr=src.pmfc_ref_compnr, 
                    target.pmng=src.pmng, 
                    target.pmng_ref_compnr=src.pmng_ref_compnr, 
                    target.potp=src.potp, 
                    target.potp_ref_compnr=src.potp_ref_compnr, 
                    target.preq=src.preq, 
                    target.preq_kw=src.preq_kw, 
                    target.prgm=src.prgm, 
                    target.prgm_ref_compnr=src.prgm_ref_compnr, 
                    target.pric=src.pric, 
                    target.pric_kw=src.pric_kw, 
                    target.prit=src.prit, 
                    target.prit_kw=src.prit_kw, 
                    target.pror=src.pror, 
                    target.pror_kw=src.pror_kw, 
                    target.prpc=src.prpc, 
                    target.prre=src.prre, 
                    target.prre_kw=src.prre_kw, 
                    target.prsb=src.prsb, 
                    target.prsb_kw=src.prsb_kw, 
                    target.prts=src.prts, 
                    target.prts_kw=src.prts_kw, 
                    target.pscd=src.pscd, 
                    target.pseq=src.pseq, 
                    target.psic=src.psic, 
                    target.psit=src.psit, 
                    target.pssc=src.pssc, 
                    target.psta=src.psta, 
                    target.pstf=src.pstf, 
                    target.pstf_kw=src.pstf_kw, 
                    target.psts=src.psts, 
                    target.psts_kw=src.psts_kw, 
                    target.ptcs=src.ptcs, 
                    target.pwar=src.pwar, 
                    target.pwar_ref_compnr=src.pwar_ref_compnr, 
                    target.ratc=src.ratc, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rats=src.rats, 
                    target.rcmc_1=src.rcmc_1, 
                    target.rcmc_2=src.rcmc_2, 
                    target.rcmc_3=src.rcmc_3, 
                    target.rdat=src.rdat, 
                    target.revl=src.revl, 
                    target.revr=src.revr, 
                    target.revr_kw=src.revr_kw, 
                    target.revt=src.revt, 
                    target.rfcu=src.rfcu, 
                    target.ripr=src.ripr, 
                    target.ripr_ref_compnr=src.ripr_ref_compnr, 
                    target.rjct=src.rjct, 
                    target.rjct_kw=src.rjct_kw, 
                    target.rrtp=src.rrtp, 
                    target.rrtp_ref_compnr=src.rrtp_ref_compnr, 
                    target.rsac=src.rsac, 
                    target.rsip=src.rsip, 
                    target.rsmc_1=src.rsmc_1, 
                    target.rsmc_2=src.rsmc_2, 
                    target.rsmc_3=src.rsmc_3, 
                    target.rsrv=src.rsrv, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_ref_compnr=src.rtyp_ref_compnr, 
                    target.sadr=src.sadr, 
                    target.sadr_ref_compnr=src.sadr_ref_compnr, 
                    target.seak=src.seak, 
                    target.sequencenumber=src.sequencenumber, 
                    target.stdt=src.stdt, 
                    target.stus=src.stus, 
                    target.stus_kw=src.stus_kw, 
                    target.tbdg=src.tbdg, 
                    target.tbdg_kw=src.tbdg_kw, 
                    target.timestamp=src.timestamp, 
                    target.tmpl=src.tmpl, 
                    target.tmpl_kw=src.tmpl_kw, 
                    target.tpac=src.tpac, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.uobs=src.uobs, 
                    target.uobs_kw=src.uobs_kw, 
                    target.upal=src.upal, 
                    target.upal_kw=src.upal_kw, 
                    target.user=src.user, 
                    target.username=src.username, 
                    target.ussu=src.ussu, 
                    target.ussu_kw=src.ussu_kw, 
                    target.wipc=src.wipc, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( abpp, abpp_kw, abrf, abrf_kw, acgm, acgm_kw, acmp, acmp_kw, acpc, aerf, aext, agty, agty_kw, anbr, aprp, arpc, arrl, arrm, arrm_kw, arrt, ascd, avtp, avtp_ref_compnr, bdmt, bdmt_kw, bfpp, bfpp_kw, bfrf, bfrf_kw, btco, btco_kw, btdt, btpr, btpr_kw, capp, capp_kw, carr, carr_ref_compnr, ccal, ccam, ccam_ref_compnr, ccat, ccat_ref_compnr, ccdt, ccot, ccot_ref_compnr, ccur, ccur_ref_compnr, cdis, cdis_ref_compnr, cfac, cfac_ref_compnr, cfpr, cfye, cldr, cldr_ref_compnr, cmog, cmog_kw, cmpc, cmpc_kw, cmud, cmud_ref_compnr, cobs, cobs_ref_compnr, cogc, cogs, cogs_kw, compnr, copr, coty, coty_kw, cpla, cprj, cprj_ccal_ref_compnr, cprj_cpla_ref_compnr, cprj_cpla_rsac_ref_compnr, cprj_cspa_ref_compnr, cprj_ref_compnr, cprq, cprq_kw, creg, creg_ref_compnr, crte, crte_ref_compnr, crtp, crtp_ref_compnr, csec, csec_ref_compnr, cspa, cstg, cstg_ref_compnr, cuni, cuni_ref_compnr, deleted, dlau, dldt, dsca, dscb, dscc, dscd, dwar, dwar_ref_compnr, earf, entu, espt, fddt, guid, hbpc, hdat, hsts, hsts_kw, husr, igcd, igcd_kw, inst, intp, intp_kw, invm, invm_kw, invr, invr_kw, ipin, ipin_kw, kopr, kopr_kw, kptm, kptm_kw, lcdt, lcla, lclg, lmdt, lmus, logc, logh, lpdt, ltrc, ltrs, lwha, lwha_kw, lwhb, lwhb_kw, lwhc, lwhc_kw, lwhd, lwhd_kw, lwta, lwta_kw, lwtb, lwtb_kw, lwtc, lwtc_kw, mprj, ncmp, njsp, ofes, ofes_ref_compnr, ofpr, ofpr_ref_compnr, padr, padr_ref_compnr, pcba, pceq, pcic, pcit, pcmp, pcrd, pcsb, pcts, pcwa, peri, plcd, plcd_kw, plgr, plgr_ref_compnr, pmfc, pmfc_ref_compnr, pmng, pmng_ref_compnr, potp, potp_ref_compnr, preq, preq_kw, prgm, prgm_ref_compnr, pric, pric_kw, prit, prit_kw, pror, pror_kw, prpc, prre, prre_kw, prsb, prsb_kw, prts, prts_kw, pscd, pseq, psic, psit, pssc, psta, pstf, pstf_kw, psts, psts_kw, ptcs, pwar, pwar_ref_compnr, ratc, rate_1, rate_2, rate_3, ratf_1, ratf_2, ratf_3, rats, rcmc_1, rcmc_2, rcmc_3, rdat, revl, revr, revr_kw, revt, rfcu, ripr, ripr_ref_compnr, rjct, rjct_kw, rrtp, rrtp_ref_compnr, rsac, rsip, rsmc_1, rsmc_2, rsmc_3, rsrv, rtyp, rtyp_ref_compnr, sadr, sadr_ref_compnr, seak, sequencenumber, stdt, stus, stus_kw, tbdg, tbdg_kw, timestamp, tmpl, tmpl_kw, tpac, txta, txta_ref_compnr, uobs, uobs_kw, upal, upal_kw, user, username, ussu, ussu_kw, wipc, year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.abpp, 
                    src.abpp_kw, 
                    src.abrf, 
                    src.abrf_kw, 
                    src.acgm, 
                    src.acgm_kw, 
                    src.acmp, 
                    src.acmp_kw, 
                    src.acpc, 
                    src.aerf, 
                    src.aext, 
                    src.agty, 
                    src.agty_kw, 
                    src.anbr, 
                    src.aprp, 
                    src.arpc, 
                    src.arrl, 
                    src.arrm, 
                    src.arrm_kw, 
                    src.arrt, 
                    src.ascd, 
                    src.avtp, 
                    src.avtp_ref_compnr, 
                    src.bdmt, 
                    src.bdmt_kw, 
                    src.bfpp, 
                    src.bfpp_kw, 
                    src.bfrf, 
                    src.bfrf_kw, 
                    src.btco, 
                    src.btco_kw, 
                    src.btdt, 
                    src.btpr, 
                    src.btpr_kw, 
                    src.capp, 
                    src.capp_kw, 
                    src.carr, 
                    src.carr_ref_compnr, 
                    src.ccal, 
                    src.ccam, 
                    src.ccam_ref_compnr, 
                    src.ccat, 
                    src.ccat_ref_compnr, 
                    src.ccdt, 
                    src.ccot, 
                    src.ccot_ref_compnr, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdis, 
                    src.cdis_ref_compnr, 
                    src.cfac, 
                    src.cfac_ref_compnr, 
                    src.cfpr, 
                    src.cfye, 
                    src.cldr, 
                    src.cldr_ref_compnr, 
                    src.cmog, 
                    src.cmog_kw, 
                    src.cmpc, 
                    src.cmpc_kw, 
                    src.cmud, 
                    src.cmud_ref_compnr, 
                    src.cobs, 
                    src.cobs_ref_compnr, 
                    src.cogc, 
                    src.cogs, 
                    src.cogs_kw, 
                    src.compnr, 
                    src.copr, 
                    src.coty, 
                    src.coty_kw, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_ccal_ref_compnr, 
                    src.cprj_cpla_ref_compnr, 
                    src.cprj_cpla_rsac_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cprq, 
                    src.cprq_kw, 
                    src.creg, 
                    src.creg_ref_compnr, 
                    src.crte, 
                    src.crte_ref_compnr, 
                    src.crtp, 
                    src.crtp_ref_compnr, 
                    src.csec, 
                    src.csec_ref_compnr, 
                    src.cspa, 
                    src.cstg, 
                    src.cstg_ref_compnr, 
                    src.cuni, 
                    src.cuni_ref_compnr, 
                    src.deleted, 
                    src.dlau, 
                    src.dldt, 
                    src.dsca, 
                    src.dscb, 
                    src.dscc, 
                    src.dscd, 
                    src.dwar, 
                    src.dwar_ref_compnr, 
                    src.earf, 
                    src.entu, 
                    src.espt, 
                    src.fddt, 
                    src.guid, 
                    src.hbpc, 
                    src.hdat, 
                    src.hsts, 
                    src.hsts_kw, 
                    src.husr, 
                    src.igcd, 
                    src.igcd_kw, 
                    src.inst, 
                    src.intp, 
                    src.intp_kw, 
                    src.invm, 
                    src.invm_kw, 
                    src.invr, 
                    src.invr_kw, 
                    src.ipin, 
                    src.ipin_kw, 
                    src.kopr, 
                    src.kopr_kw, 
                    src.kptm, 
                    src.kptm_kw, 
                    src.lcdt, 
                    src.lcla, 
                    src.lclg, 
                    src.lmdt, 
                    src.lmus, 
                    src.logc, 
                    src.logh, 
                    src.lpdt, 
                    src.ltrc, 
                    src.ltrs, 
                    src.lwha, 
                    src.lwha_kw, 
                    src.lwhb, 
                    src.lwhb_kw, 
                    src.lwhc, 
                    src.lwhc_kw, 
                    src.lwhd, 
                    src.lwhd_kw, 
                    src.lwta, 
                    src.lwta_kw, 
                    src.lwtb, 
                    src.lwtb_kw, 
                    src.lwtc, 
                    src.lwtc_kw, 
                    src.mprj, 
                    src.ncmp, 
                    src.njsp, 
                    src.ofes, 
                    src.ofes_ref_compnr, 
                    src.ofpr, 
                    src.ofpr_ref_compnr, 
                    src.padr, 
                    src.padr_ref_compnr, 
                    src.pcba, 
                    src.pceq, 
                    src.pcic, 
                    src.pcit, 
                    src.pcmp, 
                    src.pcrd, 
                    src.pcsb, 
                    src.pcts, 
                    src.pcwa, 
                    src.peri, 
                    src.plcd, 
                    src.plcd_kw, 
                    src.plgr, 
                    src.plgr_ref_compnr, 
                    src.pmfc, 
                    src.pmfc_ref_compnr, 
                    src.pmng, 
                    src.pmng_ref_compnr, 
                    src.potp, 
                    src.potp_ref_compnr, 
                    src.preq, 
                    src.preq_kw, 
                    src.prgm, 
                    src.prgm_ref_compnr, 
                    src.pric, 
                    src.pric_kw, 
                    src.prit, 
                    src.prit_kw, 
                    src.pror, 
                    src.pror_kw, 
                    src.prpc, 
                    src.prre, 
                    src.prre_kw, 
                    src.prsb, 
                    src.prsb_kw, 
                    src.prts, 
                    src.prts_kw, 
                    src.pscd, 
                    src.pseq, 
                    src.psic, 
                    src.psit, 
                    src.pssc, 
                    src.psta, 
                    src.pstf, 
                    src.pstf_kw, 
                    src.psts, 
                    src.psts_kw, 
                    src.ptcs, 
                    src.pwar, 
                    src.pwar_ref_compnr, 
                    src.ratc, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rats, 
                    src.rcmc_1, 
                    src.rcmc_2, 
                    src.rcmc_3, 
                    src.rdat, 
                    src.revl, 
                    src.revr, 
                    src.revr_kw, 
                    src.revt, 
                    src.rfcu, 
                    src.ripr, 
                    src.ripr_ref_compnr, 
                    src.rjct, 
                    src.rjct_kw, 
                    src.rrtp, 
                    src.rrtp_ref_compnr, 
                    src.rsac, 
                    src.rsip, 
                    src.rsmc_1, 
                    src.rsmc_2, 
                    src.rsmc_3, 
                    src.rsrv, 
                    src.rtyp, 
                    src.rtyp_ref_compnr, 
                    src.sadr, 
                    src.sadr_ref_compnr, 
                    src.seak, 
                    src.sequencenumber, 
                    src.stdt, 
                    src.stus, 
                    src.stus_kw, 
                    src.tbdg, 
                    src.tbdg_kw, 
                    src.timestamp, 
                    src.tmpl, 
                    src.tmpl_kw, 
                    src.tpac, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.uobs, 
                    src.uobs_kw, 
                    src.upal, 
                    src.upal_kw, 
                    src.user, 
                    src.username, 
                    src.ussu, 
                    src.ussu_kw, 
                    src.wipc, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;