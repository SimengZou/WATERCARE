create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5ORDERLINES()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5ORDERLINES_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5ORDERLINES as target using (SELECT * FROM (SELECT 
            strm.ORL_ACD, 
            strm.ORL_ACT, 
            strm.ORL_ACTIVE, 
            strm.ORL_ALLOWPREPAYMENT, 
            strm.ORL_ATTENTIONTO, 
            strm.ORL_BLANKETLINE, 
            strm.ORL_BLANKETORDER, 
            strm.ORL_CONTRACT, 
            strm.ORL_COSTCODE, 
            strm.ORL_CURR, 
            strm.ORL_DCKRECVQTY, 
            strm.ORL_DELADDRESS, 
            strm.ORL_DISCPERC, 
            strm.ORL_DUE, 
            strm.ORL_EVENT, 
            strm.ORL_EXCH, 
            strm.ORL_EXCHFIX, 
            strm.ORL_EXCHFROMDUAL, 
            strm.ORL_EXCHTODUAL, 
            strm.ORL_GLTRANSFER, 
            strm.ORL_GLTRANSFERFLAG, 
            strm.ORL_INSPECT, 
            strm.ORL_INTERFACE, 
            strm.ORL_INVCALCTAXAMOUNT, 
            strm.ORL_INVQTY, 
            strm.ORL_INVVALUE, 
            strm.ORL_IPCURRPRICE, 
            strm.ORL_IPERROR, 
            strm.ORL_IPERRORMESSAGE, 
            strm.ORL_IPLASTUPDATE, 
            strm.ORL_IPTRANSMITTED, 
            strm.ORL_IPUPDATESTATUS, 
            strm.ORL_JECATEGORY, 
            strm.ORL_JESOURCE, 
            strm.ORL_LASTSAVED, 
            strm.ORL_LONGDESCRIPTION, 
            strm.ORL_MANUFACTPART, 
            strm.ORL_MANUFACTURER, 
            strm.ORL_MULTIPLY, 
            strm.ORL_NOTE, 
            strm.ORL_ORDER, 
            strm.ORL_ORDER_ORG, 
            strm.ORL_ORDLINE, 
            strm.ORL_ORDQTY, 
            strm.ORL_PACKAGETRACKINGNUMBER, 
            strm.ORL_PART, 
            strm.ORL_PART_ORG, 
            strm.ORL_PAYMENTNUMBER, 
            strm.ORL_PRICE, 
            strm.ORL_PROJBUD, 
            strm.ORL_PROJECT, 
            strm.ORL_PURUOM, 
            strm.ORL_QUOTID, 
            strm.ORL_QUOTLINE, 
            strm.ORL_RECVQTY, 
            strm.ORL_RECVTASKQTY, 
            strm.ORL_RECVVALUE, 
            strm.ORL_REF, 
            strm.ORL_RELATEDWO, 
            strm.ORL_REQ, 
            strm.ORL_REQLINE, 
            strm.ORL_REVISED, 
            strm.ORL_REVISION, 
            strm.ORL_RSTATUS, 
            strm.ORL_RTYPE, 
            strm.ORL_SCRAPQTY, 
            strm.ORL_SOURCECODE, 
            strm.ORL_SOURCESYSTEM, 
            strm.ORL_STATUS, 
            strm.ORL_STORE, 
            strm.ORL_SUPPLIER, 
            strm.ORL_SUPPLIER_ORG, 
            strm.ORL_TASK, 
            strm.ORL_TASKQTY, 
            strm.ORL_TASKREV, 
            strm.ORL_TAX, 
            strm.ORL_TAX2, 
            strm.ORL_TOTEXTRA, 
            strm.ORL_TOTTAXAMOUNT, 
            strm.ORL_TRADE, 
            strm.ORL_TYPE, 
            strm.ORL_UDFCHAR01, 
            strm.ORL_UDFCHAR02, 
            strm.ORL_UDFCHAR03, 
            strm.ORL_UDFCHAR04, 
            strm.ORL_UDFCHAR05, 
            strm.ORL_UDFCHAR06, 
            strm.ORL_UDFCHAR07, 
            strm.ORL_UDFCHAR08, 
            strm.ORL_UDFCHAR09, 
            strm.ORL_UDFCHAR10, 
            strm.ORL_UDFCHAR11, 
            strm.ORL_UDFCHAR12, 
            strm.ORL_UDFCHAR13, 
            strm.ORL_UDFCHAR14, 
            strm.ORL_UDFCHAR15, 
            strm.ORL_UDFCHAR16, 
            strm.ORL_UDFCHAR17, 
            strm.ORL_UDFCHAR18, 
            strm.ORL_UDFCHAR19, 
            strm.ORL_UDFCHAR20, 
            strm.ORL_UDFCHAR21, 
            strm.ORL_UDFCHAR22, 
            strm.ORL_UDFCHAR23, 
            strm.ORL_UDFCHAR24, 
            strm.ORL_UDFCHAR25, 
            strm.ORL_UDFCHAR26, 
            strm.ORL_UDFCHAR27, 
            strm.ORL_UDFCHAR28, 
            strm.ORL_UDFCHAR29, 
            strm.ORL_UDFCHAR30, 
            strm.ORL_UDFCHKBOX01, 
            strm.ORL_UDFCHKBOX02, 
            strm.ORL_UDFCHKBOX03, 
            strm.ORL_UDFCHKBOX04, 
            strm.ORL_UDFCHKBOX05, 
            strm.ORL_UDFDATE01, 
            strm.ORL_UDFDATE02, 
            strm.ORL_UDFDATE03, 
            strm.ORL_UDFDATE04, 
            strm.ORL_UDFDATE05, 
            strm.ORL_UDFNUM01, 
            strm.ORL_UDFNUM02, 
            strm.ORL_UDFNUM03, 
            strm.ORL_UDFNUM04, 
            strm.ORL_UDFNUM05, 
            strm.ORL_UNSPSCCODE, 
            strm.ORL_UPDATECOUNT, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ORL_ORDER,
            strm.ORL_ORDER_ORG,
            strm.ORL_ORDLINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ORDERLINES as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ORL_ORDER=src.ORL_ORDER) OR (target.ORL_ORDER IS NULL AND src.ORL_ORDER IS NULL)) AND
            ((target.ORL_ORDER_ORG=src.ORL_ORDER_ORG) OR (target.ORL_ORDER_ORG IS NULL AND src.ORL_ORDER_ORG IS NULL)) AND
            ((target.ORL_ORDLINE=src.ORL_ORDLINE) OR (target.ORL_ORDLINE IS NULL AND src.ORL_ORDLINE IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.ORL_ACD=src.ORL_ACD, 
                    target.ORL_ACT=src.ORL_ACT, 
                    target.ORL_ACTIVE=src.ORL_ACTIVE, 
                    target.ORL_ALLOWPREPAYMENT=src.ORL_ALLOWPREPAYMENT, 
                    target.ORL_ATTENTIONTO=src.ORL_ATTENTIONTO, 
                    target.ORL_BLANKETLINE=src.ORL_BLANKETLINE, 
                    target.ORL_BLANKETORDER=src.ORL_BLANKETORDER, 
                    target.ORL_CONTRACT=src.ORL_CONTRACT, 
                    target.ORL_COSTCODE=src.ORL_COSTCODE, 
                    target.ORL_CURR=src.ORL_CURR, 
                    target.ORL_DCKRECVQTY=src.ORL_DCKRECVQTY, 
                    target.ORL_DELADDRESS=src.ORL_DELADDRESS, 
                    target.ORL_DISCPERC=src.ORL_DISCPERC, 
                    target.ORL_DUE=src.ORL_DUE, 
                    target.ORL_EVENT=src.ORL_EVENT, 
                    target.ORL_EXCH=src.ORL_EXCH, 
                    target.ORL_EXCHFIX=src.ORL_EXCHFIX, 
                    target.ORL_EXCHFROMDUAL=src.ORL_EXCHFROMDUAL, 
                    target.ORL_EXCHTODUAL=src.ORL_EXCHTODUAL, 
                    target.ORL_GLTRANSFER=src.ORL_GLTRANSFER, 
                    target.ORL_GLTRANSFERFLAG=src.ORL_GLTRANSFERFLAG, 
                    target.ORL_INSPECT=src.ORL_INSPECT, 
                    target.ORL_INTERFACE=src.ORL_INTERFACE, 
                    target.ORL_INVCALCTAXAMOUNT=src.ORL_INVCALCTAXAMOUNT, 
                    target.ORL_INVQTY=src.ORL_INVQTY, 
                    target.ORL_INVVALUE=src.ORL_INVVALUE, 
                    target.ORL_IPCURRPRICE=src.ORL_IPCURRPRICE, 
                    target.ORL_IPERROR=src.ORL_IPERROR, 
                    target.ORL_IPERRORMESSAGE=src.ORL_IPERRORMESSAGE, 
                    target.ORL_IPLASTUPDATE=src.ORL_IPLASTUPDATE, 
                    target.ORL_IPTRANSMITTED=src.ORL_IPTRANSMITTED, 
                    target.ORL_IPUPDATESTATUS=src.ORL_IPUPDATESTATUS, 
                    target.ORL_JECATEGORY=src.ORL_JECATEGORY, 
                    target.ORL_JESOURCE=src.ORL_JESOURCE, 
                    target.ORL_LASTSAVED=src.ORL_LASTSAVED, 
                    target.ORL_LONGDESCRIPTION=src.ORL_LONGDESCRIPTION, 
                    target.ORL_MANUFACTPART=src.ORL_MANUFACTPART, 
                    target.ORL_MANUFACTURER=src.ORL_MANUFACTURER, 
                    target.ORL_MULTIPLY=src.ORL_MULTIPLY, 
                    target.ORL_NOTE=src.ORL_NOTE, 
                    target.ORL_ORDER=src.ORL_ORDER, 
                    target.ORL_ORDER_ORG=src.ORL_ORDER_ORG, 
                    target.ORL_ORDLINE=src.ORL_ORDLINE, 
                    target.ORL_ORDQTY=src.ORL_ORDQTY, 
                    target.ORL_PACKAGETRACKINGNUMBER=src.ORL_PACKAGETRACKINGNUMBER, 
                    target.ORL_PART=src.ORL_PART, 
                    target.ORL_PART_ORG=src.ORL_PART_ORG, 
                    target.ORL_PAYMENTNUMBER=src.ORL_PAYMENTNUMBER, 
                    target.ORL_PRICE=src.ORL_PRICE, 
                    target.ORL_PROJBUD=src.ORL_PROJBUD, 
                    target.ORL_PROJECT=src.ORL_PROJECT, 
                    target.ORL_PURUOM=src.ORL_PURUOM, 
                    target.ORL_QUOTID=src.ORL_QUOTID, 
                    target.ORL_QUOTLINE=src.ORL_QUOTLINE, 
                    target.ORL_RECVQTY=src.ORL_RECVQTY, 
                    target.ORL_RECVTASKQTY=src.ORL_RECVTASKQTY, 
                    target.ORL_RECVVALUE=src.ORL_RECVVALUE, 
                    target.ORL_REF=src.ORL_REF, 
                    target.ORL_RELATEDWO=src.ORL_RELATEDWO, 
                    target.ORL_REQ=src.ORL_REQ, 
                    target.ORL_REQLINE=src.ORL_REQLINE, 
                    target.ORL_REVISED=src.ORL_REVISED, 
                    target.ORL_REVISION=src.ORL_REVISION, 
                    target.ORL_RSTATUS=src.ORL_RSTATUS, 
                    target.ORL_RTYPE=src.ORL_RTYPE, 
                    target.ORL_SCRAPQTY=src.ORL_SCRAPQTY, 
                    target.ORL_SOURCECODE=src.ORL_SOURCECODE, 
                    target.ORL_SOURCESYSTEM=src.ORL_SOURCESYSTEM, 
                    target.ORL_STATUS=src.ORL_STATUS, 
                    target.ORL_STORE=src.ORL_STORE, 
                    target.ORL_SUPPLIER=src.ORL_SUPPLIER, 
                    target.ORL_SUPPLIER_ORG=src.ORL_SUPPLIER_ORG, 
                    target.ORL_TASK=src.ORL_TASK, 
                    target.ORL_TASKQTY=src.ORL_TASKQTY, 
                    target.ORL_TASKREV=src.ORL_TASKREV, 
                    target.ORL_TAX=src.ORL_TAX, 
                    target.ORL_TAX2=src.ORL_TAX2, 
                    target.ORL_TOTEXTRA=src.ORL_TOTEXTRA, 
                    target.ORL_TOTTAXAMOUNT=src.ORL_TOTTAXAMOUNT, 
                    target.ORL_TRADE=src.ORL_TRADE, 
                    target.ORL_TYPE=src.ORL_TYPE, 
                    target.ORL_UDFCHAR01=src.ORL_UDFCHAR01, 
                    target.ORL_UDFCHAR02=src.ORL_UDFCHAR02, 
                    target.ORL_UDFCHAR03=src.ORL_UDFCHAR03, 
                    target.ORL_UDFCHAR04=src.ORL_UDFCHAR04, 
                    target.ORL_UDFCHAR05=src.ORL_UDFCHAR05, 
                    target.ORL_UDFCHAR06=src.ORL_UDFCHAR06, 
                    target.ORL_UDFCHAR07=src.ORL_UDFCHAR07, 
                    target.ORL_UDFCHAR08=src.ORL_UDFCHAR08, 
                    target.ORL_UDFCHAR09=src.ORL_UDFCHAR09, 
                    target.ORL_UDFCHAR10=src.ORL_UDFCHAR10, 
                    target.ORL_UDFCHAR11=src.ORL_UDFCHAR11, 
                    target.ORL_UDFCHAR12=src.ORL_UDFCHAR12, 
                    target.ORL_UDFCHAR13=src.ORL_UDFCHAR13, 
                    target.ORL_UDFCHAR14=src.ORL_UDFCHAR14, 
                    target.ORL_UDFCHAR15=src.ORL_UDFCHAR15, 
                    target.ORL_UDFCHAR16=src.ORL_UDFCHAR16, 
                    target.ORL_UDFCHAR17=src.ORL_UDFCHAR17, 
                    target.ORL_UDFCHAR18=src.ORL_UDFCHAR18, 
                    target.ORL_UDFCHAR19=src.ORL_UDFCHAR19, 
                    target.ORL_UDFCHAR20=src.ORL_UDFCHAR20, 
                    target.ORL_UDFCHAR21=src.ORL_UDFCHAR21, 
                    target.ORL_UDFCHAR22=src.ORL_UDFCHAR22, 
                    target.ORL_UDFCHAR23=src.ORL_UDFCHAR23, 
                    target.ORL_UDFCHAR24=src.ORL_UDFCHAR24, 
                    target.ORL_UDFCHAR25=src.ORL_UDFCHAR25, 
                    target.ORL_UDFCHAR26=src.ORL_UDFCHAR26, 
                    target.ORL_UDFCHAR27=src.ORL_UDFCHAR27, 
                    target.ORL_UDFCHAR28=src.ORL_UDFCHAR28, 
                    target.ORL_UDFCHAR29=src.ORL_UDFCHAR29, 
                    target.ORL_UDFCHAR30=src.ORL_UDFCHAR30, 
                    target.ORL_UDFCHKBOX01=src.ORL_UDFCHKBOX01, 
                    target.ORL_UDFCHKBOX02=src.ORL_UDFCHKBOX02, 
                    target.ORL_UDFCHKBOX03=src.ORL_UDFCHKBOX03, 
                    target.ORL_UDFCHKBOX04=src.ORL_UDFCHKBOX04, 
                    target.ORL_UDFCHKBOX05=src.ORL_UDFCHKBOX05, 
                    target.ORL_UDFDATE01=src.ORL_UDFDATE01, 
                    target.ORL_UDFDATE02=src.ORL_UDFDATE02, 
                    target.ORL_UDFDATE03=src.ORL_UDFDATE03, 
                    target.ORL_UDFDATE04=src.ORL_UDFDATE04, 
                    target.ORL_UDFDATE05=src.ORL_UDFDATE05, 
                    target.ORL_UDFNUM01=src.ORL_UDFNUM01, 
                    target.ORL_UDFNUM02=src.ORL_UDFNUM02, 
                    target.ORL_UDFNUM03=src.ORL_UDFNUM03, 
                    target.ORL_UDFNUM04=src.ORL_UDFNUM04, 
                    target.ORL_UDFNUM05=src.ORL_UDFNUM05, 
                    target.ORL_UNSPSCCODE=src.ORL_UNSPSCCODE, 
                    target.ORL_UPDATECOUNT=src.ORL_UPDATECOUNT, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    ORL_ACD, 
                    ORL_ACT, 
                    ORL_ACTIVE, 
                    ORL_ALLOWPREPAYMENT, 
                    ORL_ATTENTIONTO, 
                    ORL_BLANKETLINE, 
                    ORL_BLANKETORDER, 
                    ORL_CONTRACT, 
                    ORL_COSTCODE, 
                    ORL_CURR, 
                    ORL_DCKRECVQTY, 
                    ORL_DELADDRESS, 
                    ORL_DISCPERC, 
                    ORL_DUE, 
                    ORL_EVENT, 
                    ORL_EXCH, 
                    ORL_EXCHFIX, 
                    ORL_EXCHFROMDUAL, 
                    ORL_EXCHTODUAL, 
                    ORL_GLTRANSFER, 
                    ORL_GLTRANSFERFLAG, 
                    ORL_INSPECT, 
                    ORL_INTERFACE, 
                    ORL_INVCALCTAXAMOUNT, 
                    ORL_INVQTY, 
                    ORL_INVVALUE, 
                    ORL_IPCURRPRICE, 
                    ORL_IPERROR, 
                    ORL_IPERRORMESSAGE, 
                    ORL_IPLASTUPDATE, 
                    ORL_IPTRANSMITTED, 
                    ORL_IPUPDATESTATUS, 
                    ORL_JECATEGORY, 
                    ORL_JESOURCE, 
                    ORL_LASTSAVED, 
                    ORL_LONGDESCRIPTION, 
                    ORL_MANUFACTPART, 
                    ORL_MANUFACTURER, 
                    ORL_MULTIPLY, 
                    ORL_NOTE, 
                    ORL_ORDER, 
                    ORL_ORDER_ORG, 
                    ORL_ORDLINE, 
                    ORL_ORDQTY, 
                    ORL_PACKAGETRACKINGNUMBER, 
                    ORL_PART, 
                    ORL_PART_ORG, 
                    ORL_PAYMENTNUMBER, 
                    ORL_PRICE, 
                    ORL_PROJBUD, 
                    ORL_PROJECT, 
                    ORL_PURUOM, 
                    ORL_QUOTID, 
                    ORL_QUOTLINE, 
                    ORL_RECVQTY, 
                    ORL_RECVTASKQTY, 
                    ORL_RECVVALUE, 
                    ORL_REF, 
                    ORL_RELATEDWO, 
                    ORL_REQ, 
                    ORL_REQLINE, 
                    ORL_REVISED, 
                    ORL_REVISION, 
                    ORL_RSTATUS, 
                    ORL_RTYPE, 
                    ORL_SCRAPQTY, 
                    ORL_SOURCECODE, 
                    ORL_SOURCESYSTEM, 
                    ORL_STATUS, 
                    ORL_STORE, 
                    ORL_SUPPLIER, 
                    ORL_SUPPLIER_ORG, 
                    ORL_TASK, 
                    ORL_TASKQTY, 
                    ORL_TASKREV, 
                    ORL_TAX, 
                    ORL_TAX2, 
                    ORL_TOTEXTRA, 
                    ORL_TOTTAXAMOUNT, 
                    ORL_TRADE, 
                    ORL_TYPE, 
                    ORL_UDFCHAR01, 
                    ORL_UDFCHAR02, 
                    ORL_UDFCHAR03, 
                    ORL_UDFCHAR04, 
                    ORL_UDFCHAR05, 
                    ORL_UDFCHAR06, 
                    ORL_UDFCHAR07, 
                    ORL_UDFCHAR08, 
                    ORL_UDFCHAR09, 
                    ORL_UDFCHAR10, 
                    ORL_UDFCHAR11, 
                    ORL_UDFCHAR12, 
                    ORL_UDFCHAR13, 
                    ORL_UDFCHAR14, 
                    ORL_UDFCHAR15, 
                    ORL_UDFCHAR16, 
                    ORL_UDFCHAR17, 
                    ORL_UDFCHAR18, 
                    ORL_UDFCHAR19, 
                    ORL_UDFCHAR20, 
                    ORL_UDFCHAR21, 
                    ORL_UDFCHAR22, 
                    ORL_UDFCHAR23, 
                    ORL_UDFCHAR24, 
                    ORL_UDFCHAR25, 
                    ORL_UDFCHAR26, 
                    ORL_UDFCHAR27, 
                    ORL_UDFCHAR28, 
                    ORL_UDFCHAR29, 
                    ORL_UDFCHAR30, 
                    ORL_UDFCHKBOX01, 
                    ORL_UDFCHKBOX02, 
                    ORL_UDFCHKBOX03, 
                    ORL_UDFCHKBOX04, 
                    ORL_UDFCHKBOX05, 
                    ORL_UDFDATE01, 
                    ORL_UDFDATE02, 
                    ORL_UDFDATE03, 
                    ORL_UDFDATE04, 
                    ORL_UDFDATE05, 
                    ORL_UDFNUM01, 
                    ORL_UDFNUM02, 
                    ORL_UDFNUM03, 
                    ORL_UDFNUM04, 
                    ORL_UDFNUM05, 
                    ORL_UNSPSCCODE, 
                    ORL_UPDATECOUNT, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.ORL_ACD, 
                    src.ORL_ACT, 
                    src.ORL_ACTIVE, 
                    src.ORL_ALLOWPREPAYMENT, 
                    src.ORL_ATTENTIONTO, 
                    src.ORL_BLANKETLINE, 
                    src.ORL_BLANKETORDER, 
                    src.ORL_CONTRACT, 
                    src.ORL_COSTCODE, 
                    src.ORL_CURR, 
                    src.ORL_DCKRECVQTY, 
                    src.ORL_DELADDRESS, 
                    src.ORL_DISCPERC, 
                    src.ORL_DUE, 
                    src.ORL_EVENT, 
                    src.ORL_EXCH, 
                    src.ORL_EXCHFIX, 
                    src.ORL_EXCHFROMDUAL, 
                    src.ORL_EXCHTODUAL, 
                    src.ORL_GLTRANSFER, 
                    src.ORL_GLTRANSFERFLAG, 
                    src.ORL_INSPECT, 
                    src.ORL_INTERFACE, 
                    src.ORL_INVCALCTAXAMOUNT, 
                    src.ORL_INVQTY, 
                    src.ORL_INVVALUE, 
                    src.ORL_IPCURRPRICE, 
                    src.ORL_IPERROR, 
                    src.ORL_IPERRORMESSAGE, 
                    src.ORL_IPLASTUPDATE, 
                    src.ORL_IPTRANSMITTED, 
                    src.ORL_IPUPDATESTATUS, 
                    src.ORL_JECATEGORY, 
                    src.ORL_JESOURCE, 
                    src.ORL_LASTSAVED, 
                    src.ORL_LONGDESCRIPTION, 
                    src.ORL_MANUFACTPART, 
                    src.ORL_MANUFACTURER, 
                    src.ORL_MULTIPLY, 
                    src.ORL_NOTE, 
                    src.ORL_ORDER, 
                    src.ORL_ORDER_ORG, 
                    src.ORL_ORDLINE, 
                    src.ORL_ORDQTY, 
                    src.ORL_PACKAGETRACKINGNUMBER, 
                    src.ORL_PART, 
                    src.ORL_PART_ORG, 
                    src.ORL_PAYMENTNUMBER, 
                    src.ORL_PRICE, 
                    src.ORL_PROJBUD, 
                    src.ORL_PROJECT, 
                    src.ORL_PURUOM, 
                    src.ORL_QUOTID, 
                    src.ORL_QUOTLINE, 
                    src.ORL_RECVQTY, 
                    src.ORL_RECVTASKQTY, 
                    src.ORL_RECVVALUE, 
                    src.ORL_REF, 
                    src.ORL_RELATEDWO, 
                    src.ORL_REQ, 
                    src.ORL_REQLINE, 
                    src.ORL_REVISED, 
                    src.ORL_REVISION, 
                    src.ORL_RSTATUS, 
                    src.ORL_RTYPE, 
                    src.ORL_SCRAPQTY, 
                    src.ORL_SOURCECODE, 
                    src.ORL_SOURCESYSTEM, 
                    src.ORL_STATUS, 
                    src.ORL_STORE, 
                    src.ORL_SUPPLIER, 
                    src.ORL_SUPPLIER_ORG, 
                    src.ORL_TASK, 
                    src.ORL_TASKQTY, 
                    src.ORL_TASKREV, 
                    src.ORL_TAX, 
                    src.ORL_TAX2, 
                    src.ORL_TOTEXTRA, 
                    src.ORL_TOTTAXAMOUNT, 
                    src.ORL_TRADE, 
                    src.ORL_TYPE, 
                    src.ORL_UDFCHAR01, 
                    src.ORL_UDFCHAR02, 
                    src.ORL_UDFCHAR03, 
                    src.ORL_UDFCHAR04, 
                    src.ORL_UDFCHAR05, 
                    src.ORL_UDFCHAR06, 
                    src.ORL_UDFCHAR07, 
                    src.ORL_UDFCHAR08, 
                    src.ORL_UDFCHAR09, 
                    src.ORL_UDFCHAR10, 
                    src.ORL_UDFCHAR11, 
                    src.ORL_UDFCHAR12, 
                    src.ORL_UDFCHAR13, 
                    src.ORL_UDFCHAR14, 
                    src.ORL_UDFCHAR15, 
                    src.ORL_UDFCHAR16, 
                    src.ORL_UDFCHAR17, 
                    src.ORL_UDFCHAR18, 
                    src.ORL_UDFCHAR19, 
                    src.ORL_UDFCHAR20, 
                    src.ORL_UDFCHAR21, 
                    src.ORL_UDFCHAR22, 
                    src.ORL_UDFCHAR23, 
                    src.ORL_UDFCHAR24, 
                    src.ORL_UDFCHAR25, 
                    src.ORL_UDFCHAR26, 
                    src.ORL_UDFCHAR27, 
                    src.ORL_UDFCHAR28, 
                    src.ORL_UDFCHAR29, 
                    src.ORL_UDFCHAR30, 
                    src.ORL_UDFCHKBOX01, 
                    src.ORL_UDFCHKBOX02, 
                    src.ORL_UDFCHKBOX03, 
                    src.ORL_UDFCHKBOX04, 
                    src.ORL_UDFCHKBOX05, 
                    src.ORL_UDFDATE01, 
                    src.ORL_UDFDATE02, 
                    src.ORL_UDFDATE03, 
                    src.ORL_UDFDATE04, 
                    src.ORL_UDFDATE05, 
                    src.ORL_UDFNUM01, 
                    src.ORL_UDFNUM02, 
                    src.ORL_UDFNUM03, 
                    src.ORL_UDFNUM04, 
                    src.ORL_UDFNUM05, 
                    src.ORL_UNSPSCCODE, 
                    src.ORL_UPDATECOUNT, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5ORDERLINES_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.ORL_ACD, 
            strm.ORL_ACT, 
            strm.ORL_ACTIVE, 
            strm.ORL_ALLOWPREPAYMENT, 
            strm.ORL_ATTENTIONTO, 
            strm.ORL_BLANKETLINE, 
            strm.ORL_BLANKETORDER, 
            strm.ORL_CONTRACT, 
            strm.ORL_COSTCODE, 
            strm.ORL_CURR, 
            strm.ORL_DCKRECVQTY, 
            strm.ORL_DELADDRESS, 
            strm.ORL_DISCPERC, 
            strm.ORL_DUE, 
            strm.ORL_EVENT, 
            strm.ORL_EXCH, 
            strm.ORL_EXCHFIX, 
            strm.ORL_EXCHFROMDUAL, 
            strm.ORL_EXCHTODUAL, 
            strm.ORL_GLTRANSFER, 
            strm.ORL_GLTRANSFERFLAG, 
            strm.ORL_INSPECT, 
            strm.ORL_INTERFACE, 
            strm.ORL_INVCALCTAXAMOUNT, 
            strm.ORL_INVQTY, 
            strm.ORL_INVVALUE, 
            strm.ORL_IPCURRPRICE, 
            strm.ORL_IPERROR, 
            strm.ORL_IPERRORMESSAGE, 
            strm.ORL_IPLASTUPDATE, 
            strm.ORL_IPTRANSMITTED, 
            strm.ORL_IPUPDATESTATUS, 
            strm.ORL_JECATEGORY, 
            strm.ORL_JESOURCE, 
            strm.ORL_LASTSAVED, 
            strm.ORL_LONGDESCRIPTION, 
            strm.ORL_MANUFACTPART, 
            strm.ORL_MANUFACTURER, 
            strm.ORL_MULTIPLY, 
            strm.ORL_NOTE, 
            strm.ORL_ORDER, 
            strm.ORL_ORDER_ORG, 
            strm.ORL_ORDLINE, 
            strm.ORL_ORDQTY, 
            strm.ORL_PACKAGETRACKINGNUMBER, 
            strm.ORL_PART, 
            strm.ORL_PART_ORG, 
            strm.ORL_PAYMENTNUMBER, 
            strm.ORL_PRICE, 
            strm.ORL_PROJBUD, 
            strm.ORL_PROJECT, 
            strm.ORL_PURUOM, 
            strm.ORL_QUOTID, 
            strm.ORL_QUOTLINE, 
            strm.ORL_RECVQTY, 
            strm.ORL_RECVTASKQTY, 
            strm.ORL_RECVVALUE, 
            strm.ORL_REF, 
            strm.ORL_RELATEDWO, 
            strm.ORL_REQ, 
            strm.ORL_REQLINE, 
            strm.ORL_REVISED, 
            strm.ORL_REVISION, 
            strm.ORL_RSTATUS, 
            strm.ORL_RTYPE, 
            strm.ORL_SCRAPQTY, 
            strm.ORL_SOURCECODE, 
            strm.ORL_SOURCESYSTEM, 
            strm.ORL_STATUS, 
            strm.ORL_STORE, 
            strm.ORL_SUPPLIER, 
            strm.ORL_SUPPLIER_ORG, 
            strm.ORL_TASK, 
            strm.ORL_TASKQTY, 
            strm.ORL_TASKREV, 
            strm.ORL_TAX, 
            strm.ORL_TAX2, 
            strm.ORL_TOTEXTRA, 
            strm.ORL_TOTTAXAMOUNT, 
            strm.ORL_TRADE, 
            strm.ORL_TYPE, 
            strm.ORL_UDFCHAR01, 
            strm.ORL_UDFCHAR02, 
            strm.ORL_UDFCHAR03, 
            strm.ORL_UDFCHAR04, 
            strm.ORL_UDFCHAR05, 
            strm.ORL_UDFCHAR06, 
            strm.ORL_UDFCHAR07, 
            strm.ORL_UDFCHAR08, 
            strm.ORL_UDFCHAR09, 
            strm.ORL_UDFCHAR10, 
            strm.ORL_UDFCHAR11, 
            strm.ORL_UDFCHAR12, 
            strm.ORL_UDFCHAR13, 
            strm.ORL_UDFCHAR14, 
            strm.ORL_UDFCHAR15, 
            strm.ORL_UDFCHAR16, 
            strm.ORL_UDFCHAR17, 
            strm.ORL_UDFCHAR18, 
            strm.ORL_UDFCHAR19, 
            strm.ORL_UDFCHAR20, 
            strm.ORL_UDFCHAR21, 
            strm.ORL_UDFCHAR22, 
            strm.ORL_UDFCHAR23, 
            strm.ORL_UDFCHAR24, 
            strm.ORL_UDFCHAR25, 
            strm.ORL_UDFCHAR26, 
            strm.ORL_UDFCHAR27, 
            strm.ORL_UDFCHAR28, 
            strm.ORL_UDFCHAR29, 
            strm.ORL_UDFCHAR30, 
            strm.ORL_UDFCHKBOX01, 
            strm.ORL_UDFCHKBOX02, 
            strm.ORL_UDFCHKBOX03, 
            strm.ORL_UDFCHKBOX04, 
            strm.ORL_UDFCHKBOX05, 
            strm.ORL_UDFDATE01, 
            strm.ORL_UDFDATE02, 
            strm.ORL_UDFDATE03, 
            strm.ORL_UDFDATE04, 
            strm.ORL_UDFDATE05, 
            strm.ORL_UDFNUM01, 
            strm.ORL_UDFNUM02, 
            strm.ORL_UDFNUM03, 
            strm.ORL_UDFNUM04, 
            strm.ORL_UDFNUM05, 
            strm.ORL_UNSPSCCODE, 
            strm.ORL_UPDATECOUNT, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ORL_ORDER,
            strm.ORL_ORDER_ORG,
            strm.ORL_ORDLINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ORDERLINES as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ORL_ORDER=src.ORL_ORDER) OR (target.ORL_ORDER IS NULL AND src.ORL_ORDER IS NULL)) AND
            ((target.ORL_ORDER_ORG=src.ORL_ORDER_ORG) OR (target.ORL_ORDER_ORG IS NULL AND src.ORL_ORDER_ORG IS NULL)) AND
            ((target.ORL_ORDLINE=src.ORL_ORDLINE) OR (target.ORL_ORDLINE IS NULL AND src.ORL_ORDLINE IS NULL)) 
                when matched then update set
                    target.ORL_ACD=src.ORL_ACD, 
                    target.ORL_ACT=src.ORL_ACT, 
                    target.ORL_ACTIVE=src.ORL_ACTIVE, 
                    target.ORL_ALLOWPREPAYMENT=src.ORL_ALLOWPREPAYMENT, 
                    target.ORL_ATTENTIONTO=src.ORL_ATTENTIONTO, 
                    target.ORL_BLANKETLINE=src.ORL_BLANKETLINE, 
                    target.ORL_BLANKETORDER=src.ORL_BLANKETORDER, 
                    target.ORL_CONTRACT=src.ORL_CONTRACT, 
                    target.ORL_COSTCODE=src.ORL_COSTCODE, 
                    target.ORL_CURR=src.ORL_CURR, 
                    target.ORL_DCKRECVQTY=src.ORL_DCKRECVQTY, 
                    target.ORL_DELADDRESS=src.ORL_DELADDRESS, 
                    target.ORL_DISCPERC=src.ORL_DISCPERC, 
                    target.ORL_DUE=src.ORL_DUE, 
                    target.ORL_EVENT=src.ORL_EVENT, 
                    target.ORL_EXCH=src.ORL_EXCH, 
                    target.ORL_EXCHFIX=src.ORL_EXCHFIX, 
                    target.ORL_EXCHFROMDUAL=src.ORL_EXCHFROMDUAL, 
                    target.ORL_EXCHTODUAL=src.ORL_EXCHTODUAL, 
                    target.ORL_GLTRANSFER=src.ORL_GLTRANSFER, 
                    target.ORL_GLTRANSFERFLAG=src.ORL_GLTRANSFERFLAG, 
                    target.ORL_INSPECT=src.ORL_INSPECT, 
                    target.ORL_INTERFACE=src.ORL_INTERFACE, 
                    target.ORL_INVCALCTAXAMOUNT=src.ORL_INVCALCTAXAMOUNT, 
                    target.ORL_INVQTY=src.ORL_INVQTY, 
                    target.ORL_INVVALUE=src.ORL_INVVALUE, 
                    target.ORL_IPCURRPRICE=src.ORL_IPCURRPRICE, 
                    target.ORL_IPERROR=src.ORL_IPERROR, 
                    target.ORL_IPERRORMESSAGE=src.ORL_IPERRORMESSAGE, 
                    target.ORL_IPLASTUPDATE=src.ORL_IPLASTUPDATE, 
                    target.ORL_IPTRANSMITTED=src.ORL_IPTRANSMITTED, 
                    target.ORL_IPUPDATESTATUS=src.ORL_IPUPDATESTATUS, 
                    target.ORL_JECATEGORY=src.ORL_JECATEGORY, 
                    target.ORL_JESOURCE=src.ORL_JESOURCE, 
                    target.ORL_LASTSAVED=src.ORL_LASTSAVED, 
                    target.ORL_LONGDESCRIPTION=src.ORL_LONGDESCRIPTION, 
                    target.ORL_MANUFACTPART=src.ORL_MANUFACTPART, 
                    target.ORL_MANUFACTURER=src.ORL_MANUFACTURER, 
                    target.ORL_MULTIPLY=src.ORL_MULTIPLY, 
                    target.ORL_NOTE=src.ORL_NOTE, 
                    target.ORL_ORDER=src.ORL_ORDER, 
                    target.ORL_ORDER_ORG=src.ORL_ORDER_ORG, 
                    target.ORL_ORDLINE=src.ORL_ORDLINE, 
                    target.ORL_ORDQTY=src.ORL_ORDQTY, 
                    target.ORL_PACKAGETRACKINGNUMBER=src.ORL_PACKAGETRACKINGNUMBER, 
                    target.ORL_PART=src.ORL_PART, 
                    target.ORL_PART_ORG=src.ORL_PART_ORG, 
                    target.ORL_PAYMENTNUMBER=src.ORL_PAYMENTNUMBER, 
                    target.ORL_PRICE=src.ORL_PRICE, 
                    target.ORL_PROJBUD=src.ORL_PROJBUD, 
                    target.ORL_PROJECT=src.ORL_PROJECT, 
                    target.ORL_PURUOM=src.ORL_PURUOM, 
                    target.ORL_QUOTID=src.ORL_QUOTID, 
                    target.ORL_QUOTLINE=src.ORL_QUOTLINE, 
                    target.ORL_RECVQTY=src.ORL_RECVQTY, 
                    target.ORL_RECVTASKQTY=src.ORL_RECVTASKQTY, 
                    target.ORL_RECVVALUE=src.ORL_RECVVALUE, 
                    target.ORL_REF=src.ORL_REF, 
                    target.ORL_RELATEDWO=src.ORL_RELATEDWO, 
                    target.ORL_REQ=src.ORL_REQ, 
                    target.ORL_REQLINE=src.ORL_REQLINE, 
                    target.ORL_REVISED=src.ORL_REVISED, 
                    target.ORL_REVISION=src.ORL_REVISION, 
                    target.ORL_RSTATUS=src.ORL_RSTATUS, 
                    target.ORL_RTYPE=src.ORL_RTYPE, 
                    target.ORL_SCRAPQTY=src.ORL_SCRAPQTY, 
                    target.ORL_SOURCECODE=src.ORL_SOURCECODE, 
                    target.ORL_SOURCESYSTEM=src.ORL_SOURCESYSTEM, 
                    target.ORL_STATUS=src.ORL_STATUS, 
                    target.ORL_STORE=src.ORL_STORE, 
                    target.ORL_SUPPLIER=src.ORL_SUPPLIER, 
                    target.ORL_SUPPLIER_ORG=src.ORL_SUPPLIER_ORG, 
                    target.ORL_TASK=src.ORL_TASK, 
                    target.ORL_TASKQTY=src.ORL_TASKQTY, 
                    target.ORL_TASKREV=src.ORL_TASKREV, 
                    target.ORL_TAX=src.ORL_TAX, 
                    target.ORL_TAX2=src.ORL_TAX2, 
                    target.ORL_TOTEXTRA=src.ORL_TOTEXTRA, 
                    target.ORL_TOTTAXAMOUNT=src.ORL_TOTTAXAMOUNT, 
                    target.ORL_TRADE=src.ORL_TRADE, 
                    target.ORL_TYPE=src.ORL_TYPE, 
                    target.ORL_UDFCHAR01=src.ORL_UDFCHAR01, 
                    target.ORL_UDFCHAR02=src.ORL_UDFCHAR02, 
                    target.ORL_UDFCHAR03=src.ORL_UDFCHAR03, 
                    target.ORL_UDFCHAR04=src.ORL_UDFCHAR04, 
                    target.ORL_UDFCHAR05=src.ORL_UDFCHAR05, 
                    target.ORL_UDFCHAR06=src.ORL_UDFCHAR06, 
                    target.ORL_UDFCHAR07=src.ORL_UDFCHAR07, 
                    target.ORL_UDFCHAR08=src.ORL_UDFCHAR08, 
                    target.ORL_UDFCHAR09=src.ORL_UDFCHAR09, 
                    target.ORL_UDFCHAR10=src.ORL_UDFCHAR10, 
                    target.ORL_UDFCHAR11=src.ORL_UDFCHAR11, 
                    target.ORL_UDFCHAR12=src.ORL_UDFCHAR12, 
                    target.ORL_UDFCHAR13=src.ORL_UDFCHAR13, 
                    target.ORL_UDFCHAR14=src.ORL_UDFCHAR14, 
                    target.ORL_UDFCHAR15=src.ORL_UDFCHAR15, 
                    target.ORL_UDFCHAR16=src.ORL_UDFCHAR16, 
                    target.ORL_UDFCHAR17=src.ORL_UDFCHAR17, 
                    target.ORL_UDFCHAR18=src.ORL_UDFCHAR18, 
                    target.ORL_UDFCHAR19=src.ORL_UDFCHAR19, 
                    target.ORL_UDFCHAR20=src.ORL_UDFCHAR20, 
                    target.ORL_UDFCHAR21=src.ORL_UDFCHAR21, 
                    target.ORL_UDFCHAR22=src.ORL_UDFCHAR22, 
                    target.ORL_UDFCHAR23=src.ORL_UDFCHAR23, 
                    target.ORL_UDFCHAR24=src.ORL_UDFCHAR24, 
                    target.ORL_UDFCHAR25=src.ORL_UDFCHAR25, 
                    target.ORL_UDFCHAR26=src.ORL_UDFCHAR26, 
                    target.ORL_UDFCHAR27=src.ORL_UDFCHAR27, 
                    target.ORL_UDFCHAR28=src.ORL_UDFCHAR28, 
                    target.ORL_UDFCHAR29=src.ORL_UDFCHAR29, 
                    target.ORL_UDFCHAR30=src.ORL_UDFCHAR30, 
                    target.ORL_UDFCHKBOX01=src.ORL_UDFCHKBOX01, 
                    target.ORL_UDFCHKBOX02=src.ORL_UDFCHKBOX02, 
                    target.ORL_UDFCHKBOX03=src.ORL_UDFCHKBOX03, 
                    target.ORL_UDFCHKBOX04=src.ORL_UDFCHKBOX04, 
                    target.ORL_UDFCHKBOX05=src.ORL_UDFCHKBOX05, 
                    target.ORL_UDFDATE01=src.ORL_UDFDATE01, 
                    target.ORL_UDFDATE02=src.ORL_UDFDATE02, 
                    target.ORL_UDFDATE03=src.ORL_UDFDATE03, 
                    target.ORL_UDFDATE04=src.ORL_UDFDATE04, 
                    target.ORL_UDFDATE05=src.ORL_UDFDATE05, 
                    target.ORL_UDFNUM01=src.ORL_UDFNUM01, 
                    target.ORL_UDFNUM02=src.ORL_UDFNUM02, 
                    target.ORL_UDFNUM03=src.ORL_UDFNUM03, 
                    target.ORL_UDFNUM04=src.ORL_UDFNUM04, 
                    target.ORL_UDFNUM05=src.ORL_UDFNUM05, 
                    target.ORL_UNSPSCCODE=src.ORL_UNSPSCCODE, 
                    target.ORL_UPDATECOUNT=src.ORL_UPDATECOUNT, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( ORL_ACD, ORL_ACT, ORL_ACTIVE, ORL_ALLOWPREPAYMENT, ORL_ATTENTIONTO, ORL_BLANKETLINE, ORL_BLANKETORDER, ORL_CONTRACT, ORL_COSTCODE, ORL_CURR, ORL_DCKRECVQTY, ORL_DELADDRESS, ORL_DISCPERC, ORL_DUE, ORL_EVENT, ORL_EXCH, ORL_EXCHFIX, ORL_EXCHFROMDUAL, ORL_EXCHTODUAL, ORL_GLTRANSFER, ORL_GLTRANSFERFLAG, ORL_INSPECT, ORL_INTERFACE, ORL_INVCALCTAXAMOUNT, ORL_INVQTY, ORL_INVVALUE, ORL_IPCURRPRICE, ORL_IPERROR, ORL_IPERRORMESSAGE, ORL_IPLASTUPDATE, ORL_IPTRANSMITTED, ORL_IPUPDATESTATUS, ORL_JECATEGORY, ORL_JESOURCE, ORL_LASTSAVED, ORL_LONGDESCRIPTION, ORL_MANUFACTPART, ORL_MANUFACTURER, ORL_MULTIPLY, ORL_NOTE, ORL_ORDER, ORL_ORDER_ORG, ORL_ORDLINE, ORL_ORDQTY, ORL_PACKAGETRACKINGNUMBER, ORL_PART, ORL_PART_ORG, ORL_PAYMENTNUMBER, ORL_PRICE, ORL_PROJBUD, ORL_PROJECT, ORL_PURUOM, ORL_QUOTID, ORL_QUOTLINE, ORL_RECVQTY, ORL_RECVTASKQTY, ORL_RECVVALUE, ORL_REF, ORL_RELATEDWO, ORL_REQ, ORL_REQLINE, ORL_REVISED, ORL_REVISION, ORL_RSTATUS, ORL_RTYPE, ORL_SCRAPQTY, ORL_SOURCECODE, ORL_SOURCESYSTEM, ORL_STATUS, ORL_STORE, ORL_SUPPLIER, ORL_SUPPLIER_ORG, ORL_TASK, ORL_TASKQTY, ORL_TASKREV, ORL_TAX, ORL_TAX2, ORL_TOTEXTRA, ORL_TOTTAXAMOUNT, ORL_TRADE, ORL_TYPE, ORL_UDFCHAR01, ORL_UDFCHAR02, ORL_UDFCHAR03, ORL_UDFCHAR04, ORL_UDFCHAR05, ORL_UDFCHAR06, ORL_UDFCHAR07, ORL_UDFCHAR08, ORL_UDFCHAR09, ORL_UDFCHAR10, ORL_UDFCHAR11, ORL_UDFCHAR12, ORL_UDFCHAR13, ORL_UDFCHAR14, ORL_UDFCHAR15, ORL_UDFCHAR16, ORL_UDFCHAR17, ORL_UDFCHAR18, ORL_UDFCHAR19, ORL_UDFCHAR20, ORL_UDFCHAR21, ORL_UDFCHAR22, ORL_UDFCHAR23, ORL_UDFCHAR24, ORL_UDFCHAR25, ORL_UDFCHAR26, ORL_UDFCHAR27, ORL_UDFCHAR28, ORL_UDFCHAR29, ORL_UDFCHAR30, ORL_UDFCHKBOX01, ORL_UDFCHKBOX02, ORL_UDFCHKBOX03, ORL_UDFCHKBOX04, ORL_UDFCHKBOX05, ORL_UDFDATE01, ORL_UDFDATE02, ORL_UDFDATE03, ORL_UDFDATE04, ORL_UDFDATE05, ORL_UDFNUM01, ORL_UDFNUM02, ORL_UDFNUM03, ORL_UDFNUM04, ORL_UDFNUM05, ORL_UNSPSCCODE, ORL_UPDATECOUNT, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.ORL_ACD, 
                    src.ORL_ACT, 
                    src.ORL_ACTIVE, 
                    src.ORL_ALLOWPREPAYMENT, 
                    src.ORL_ATTENTIONTO, 
                    src.ORL_BLANKETLINE, 
                    src.ORL_BLANKETORDER, 
                    src.ORL_CONTRACT, 
                    src.ORL_COSTCODE, 
                    src.ORL_CURR, 
                    src.ORL_DCKRECVQTY, 
                    src.ORL_DELADDRESS, 
                    src.ORL_DISCPERC, 
                    src.ORL_DUE, 
                    src.ORL_EVENT, 
                    src.ORL_EXCH, 
                    src.ORL_EXCHFIX, 
                    src.ORL_EXCHFROMDUAL, 
                    src.ORL_EXCHTODUAL, 
                    src.ORL_GLTRANSFER, 
                    src.ORL_GLTRANSFERFLAG, 
                    src.ORL_INSPECT, 
                    src.ORL_INTERFACE, 
                    src.ORL_INVCALCTAXAMOUNT, 
                    src.ORL_INVQTY, 
                    src.ORL_INVVALUE, 
                    src.ORL_IPCURRPRICE, 
                    src.ORL_IPERROR, 
                    src.ORL_IPERRORMESSAGE, 
                    src.ORL_IPLASTUPDATE, 
                    src.ORL_IPTRANSMITTED, 
                    src.ORL_IPUPDATESTATUS, 
                    src.ORL_JECATEGORY, 
                    src.ORL_JESOURCE, 
                    src.ORL_LASTSAVED, 
                    src.ORL_LONGDESCRIPTION, 
                    src.ORL_MANUFACTPART, 
                    src.ORL_MANUFACTURER, 
                    src.ORL_MULTIPLY, 
                    src.ORL_NOTE, 
                    src.ORL_ORDER, 
                    src.ORL_ORDER_ORG, 
                    src.ORL_ORDLINE, 
                    src.ORL_ORDQTY, 
                    src.ORL_PACKAGETRACKINGNUMBER, 
                    src.ORL_PART, 
                    src.ORL_PART_ORG, 
                    src.ORL_PAYMENTNUMBER, 
                    src.ORL_PRICE, 
                    src.ORL_PROJBUD, 
                    src.ORL_PROJECT, 
                    src.ORL_PURUOM, 
                    src.ORL_QUOTID, 
                    src.ORL_QUOTLINE, 
                    src.ORL_RECVQTY, 
                    src.ORL_RECVTASKQTY, 
                    src.ORL_RECVVALUE, 
                    src.ORL_REF, 
                    src.ORL_RELATEDWO, 
                    src.ORL_REQ, 
                    src.ORL_REQLINE, 
                    src.ORL_REVISED, 
                    src.ORL_REVISION, 
                    src.ORL_RSTATUS, 
                    src.ORL_RTYPE, 
                    src.ORL_SCRAPQTY, 
                    src.ORL_SOURCECODE, 
                    src.ORL_SOURCESYSTEM, 
                    src.ORL_STATUS, 
                    src.ORL_STORE, 
                    src.ORL_SUPPLIER, 
                    src.ORL_SUPPLIER_ORG, 
                    src.ORL_TASK, 
                    src.ORL_TASKQTY, 
                    src.ORL_TASKREV, 
                    src.ORL_TAX, 
                    src.ORL_TAX2, 
                    src.ORL_TOTEXTRA, 
                    src.ORL_TOTTAXAMOUNT, 
                    src.ORL_TRADE, 
                    src.ORL_TYPE, 
                    src.ORL_UDFCHAR01, 
                    src.ORL_UDFCHAR02, 
                    src.ORL_UDFCHAR03, 
                    src.ORL_UDFCHAR04, 
                    src.ORL_UDFCHAR05, 
                    src.ORL_UDFCHAR06, 
                    src.ORL_UDFCHAR07, 
                    src.ORL_UDFCHAR08, 
                    src.ORL_UDFCHAR09, 
                    src.ORL_UDFCHAR10, 
                    src.ORL_UDFCHAR11, 
                    src.ORL_UDFCHAR12, 
                    src.ORL_UDFCHAR13, 
                    src.ORL_UDFCHAR14, 
                    src.ORL_UDFCHAR15, 
                    src.ORL_UDFCHAR16, 
                    src.ORL_UDFCHAR17, 
                    src.ORL_UDFCHAR18, 
                    src.ORL_UDFCHAR19, 
                    src.ORL_UDFCHAR20, 
                    src.ORL_UDFCHAR21, 
                    src.ORL_UDFCHAR22, 
                    src.ORL_UDFCHAR23, 
                    src.ORL_UDFCHAR24, 
                    src.ORL_UDFCHAR25, 
                    src.ORL_UDFCHAR26, 
                    src.ORL_UDFCHAR27, 
                    src.ORL_UDFCHAR28, 
                    src.ORL_UDFCHAR29, 
                    src.ORL_UDFCHAR30, 
                    src.ORL_UDFCHKBOX01, 
                    src.ORL_UDFCHKBOX02, 
                    src.ORL_UDFCHKBOX03, 
                    src.ORL_UDFCHKBOX04, 
                    src.ORL_UDFCHKBOX05, 
                    src.ORL_UDFDATE01, 
                    src.ORL_UDFDATE02, 
                    src.ORL_UDFDATE03, 
                    src.ORL_UDFDATE04, 
                    src.ORL_UDFDATE05, 
                    src.ORL_UDFNUM01, 
                    src.ORL_UDFNUM02, 
                    src.ORL_UDFNUM03, 
                    src.ORL_UDFNUM04, 
                    src.ORL_UDFNUM05, 
                    src.ORL_UNSPSCCODE, 
                    src.ORL_UPDATECOUNT, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;