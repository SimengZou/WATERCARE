create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5TRANSLINES()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5TRANSLINES_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5TRANSLINES as target using (SELECT * FROM (SELECT 
            strm.TRL_ACD, 
            strm.TRL_ACT, 
            strm.TRL_ALLOCATE, 
            strm.TRL_ATTACH, 
            strm.TRL_ATTACHTO, 
            strm.TRL_ATTACHTO_ORG, 
            strm.TRL_AVGPRICE, 
            strm.TRL_BILLSUBLINE, 
            strm.TRL_BIN, 
            strm.TRL_CALOTHERCOST, 
            strm.TRL_CONSIGNMENT, 
            strm.TRL_CONSIGNSUPPLIER, 
            strm.TRL_CONSIGNSUPPLIER_ORG, 
            strm.TRL_CORERETURNPRINTQTY, 
            strm.TRL_COSTCODE, 
            strm.TRL_CREATED, 
            strm.TRL_DATE, 
            strm.TRL_DCKCODE, 
            strm.TRL_DCKLINE, 
            strm.TRL_DESC, 
            strm.TRL_EVENT, 
            strm.TRL_EVTALIAS, 
            strm.TRL_FLEETCHECKED, 
            strm.TRL_FLEETMARKUP, 
            strm.TRL_GLTRANSFER, 
            strm.TRL_GLTRANSFERFLAG, 
            strm.TRL_HELDITEM, 
            strm.TRL_INTERFACE, 
            strm.TRL_INVOICE, 
            strm.TRL_INVOICELINE, 
            strm.TRL_INVOICE_ORG, 
            strm.TRL_INVOICE_REVISION, 
            strm.TRL_IO, 
            strm.TRL_ISSUEDPART, 
            strm.TRL_JECATEGORY, 
            strm.TRL_JESOURCE, 
            strm.TRL_LASTSAVED, 
            strm.TRL_LEAK, 
            strm.TRL_LINE, 
            strm.TRL_LOT, 
            strm.TRL_MANUFACTPART, 
            strm.TRL_MANUFACTURER, 
            strm.TRL_MULTIPLY, 
            strm.TRL_NEWCOSTCODE, 
            strm.TRL_NEWMANUFACT, 
            strm.TRL_NEWMRC, 
            strm.TRL_OBJECT, 
            strm.TRL_OBJECT_ORG, 
            strm.TRL_OBRTYPE, 
            strm.TRL_OBTYPE, 
            strm.TRL_ORDER, 
            strm.TRL_ORDER_ORG, 
            strm.TRL_ORDLINE, 
            strm.TRL_ORIGQTY, 
            strm.TRL_PACKAGE, 
            strm.TRL_PART, 
            strm.TRL_PARTLOCATION, 
            strm.TRL_PART_ORG, 
            strm.TRL_PICKLIST, 
            strm.TRL_POEXTRACHARGES, 
            strm.TRL_POTAXAMOUNT, 
            strm.TRL_PRICE, 
            strm.TRL_PRICEUPDATE, 
            strm.TRL_PRINTQTY, 
            strm.TRL_PROJBUD, 
            strm.TRL_PROJECT, 
            strm.TRL_QTY, 
            strm.TRL_REJECTREASON, 
            strm.TRL_REPAIRPRICE, 
            strm.TRL_REQ, 
            strm.TRL_REQLINE, 
            strm.TRL_ROUTEREC, 
            strm.TRL_RTYPE, 
            strm.TRL_SCRAPOBJECT, 
            strm.TRL_SCRAPOBJECT_ORG, 
            strm.TRL_SCRAPQTY, 
            strm.TRL_SOURCECODE, 
            strm.TRL_SOURCESYSTEM, 
            strm.TRL_SPLITTRANS, 
            strm.TRL_STOCKPRICE, 
            strm.TRL_STORE, 
            strm.TRL_SUPPLIER, 
            strm.TRL_SUPPLIER_ORG, 
            strm.TRL_TAXJURISDICTION, 
            strm.TRL_TRANS, 
            strm.TRL_TRANSCODE, 
            strm.TRL_TRANSGROUP, 
            strm.TRL_TRANSORGID, 
            strm.TRL_TYPE, 
            strm.TRL_UDFCHAR01, 
            strm.TRL_UDFCHAR02, 
            strm.TRL_UDFCHAR03, 
            strm.TRL_UDFCHAR04, 
            strm.TRL_UDFCHAR05, 
            strm.TRL_UDFCHAR06, 
            strm.TRL_UDFCHAR07, 
            strm.TRL_UDFCHAR08, 
            strm.TRL_UDFCHAR09, 
            strm.TRL_UDFCHAR10, 
            strm.TRL_UDFCHAR11, 
            strm.TRL_UDFCHAR12, 
            strm.TRL_UDFCHAR13, 
            strm.TRL_UDFCHAR14, 
            strm.TRL_UDFCHAR15, 
            strm.TRL_UDFCHAR16, 
            strm.TRL_UDFCHAR17, 
            strm.TRL_UDFCHAR18, 
            strm.TRL_UDFCHAR19, 
            strm.TRL_UDFCHAR20, 
            strm.TRL_UDFCHAR21, 
            strm.TRL_UDFCHAR22, 
            strm.TRL_UDFCHAR23, 
            strm.TRL_UDFCHAR24, 
            strm.TRL_UDFCHAR25, 
            strm.TRL_UDFCHAR26, 
            strm.TRL_UDFCHAR27, 
            strm.TRL_UDFCHAR28, 
            strm.TRL_UDFCHAR29, 
            strm.TRL_UDFCHAR30, 
            strm.TRL_UDFCHKBOX01, 
            strm.TRL_UDFCHKBOX02, 
            strm.TRL_UDFCHKBOX03, 
            strm.TRL_UDFCHKBOX04, 
            strm.TRL_UDFCHKBOX05, 
            strm.TRL_UDFDATE01, 
            strm.TRL_UDFDATE02, 
            strm.TRL_UDFDATE03, 
            strm.TRL_UDFDATE04, 
            strm.TRL_UDFDATE05, 
            strm.TRL_UDFNUM01, 
            strm.TRL_UDFNUM02, 
            strm.TRL_UDFNUM03, 
            strm.TRL_UDFNUM04, 
            strm.TRL_UDFNUM05, 
            strm.TRL_UPDATECOUNT, 
            strm.TRL_UPDATED, 
            strm.TRL_WARRANTY, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.TRL_TRANS,
            strm.TRL_LINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5TRANSLINES as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.TRL_TRANS=src.TRL_TRANS) OR (target.TRL_TRANS IS NULL AND src.TRL_TRANS IS NULL)) AND
            ((target.TRL_LINE=src.TRL_LINE) OR (target.TRL_LINE IS NULL AND src.TRL_LINE IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.TRL_ACD=src.TRL_ACD, 
                    target.TRL_ACT=src.TRL_ACT, 
                    target.TRL_ALLOCATE=src.TRL_ALLOCATE, 
                    target.TRL_ATTACH=src.TRL_ATTACH, 
                    target.TRL_ATTACHTO=src.TRL_ATTACHTO, 
                    target.TRL_ATTACHTO_ORG=src.TRL_ATTACHTO_ORG, 
                    target.TRL_AVGPRICE=src.TRL_AVGPRICE, 
                    target.TRL_BILLSUBLINE=src.TRL_BILLSUBLINE, 
                    target.TRL_BIN=src.TRL_BIN, 
                    target.TRL_CALOTHERCOST=src.TRL_CALOTHERCOST, 
                    target.TRL_CONSIGNMENT=src.TRL_CONSIGNMENT, 
                    target.TRL_CONSIGNSUPPLIER=src.TRL_CONSIGNSUPPLIER, 
                    target.TRL_CONSIGNSUPPLIER_ORG=src.TRL_CONSIGNSUPPLIER_ORG, 
                    target.TRL_CORERETURNPRINTQTY=src.TRL_CORERETURNPRINTQTY, 
                    target.TRL_COSTCODE=src.TRL_COSTCODE, 
                    target.TRL_CREATED=src.TRL_CREATED, 
                    target.TRL_DATE=src.TRL_DATE, 
                    target.TRL_DCKCODE=src.TRL_DCKCODE, 
                    target.TRL_DCKLINE=src.TRL_DCKLINE, 
                    target.TRL_DESC=src.TRL_DESC, 
                    target.TRL_EVENT=src.TRL_EVENT, 
                    target.TRL_EVTALIAS=src.TRL_EVTALIAS, 
                    target.TRL_FLEETCHECKED=src.TRL_FLEETCHECKED, 
                    target.TRL_FLEETMARKUP=src.TRL_FLEETMARKUP, 
                    target.TRL_GLTRANSFER=src.TRL_GLTRANSFER, 
                    target.TRL_GLTRANSFERFLAG=src.TRL_GLTRANSFERFLAG, 
                    target.TRL_HELDITEM=src.TRL_HELDITEM, 
                    target.TRL_INTERFACE=src.TRL_INTERFACE, 
                    target.TRL_INVOICE=src.TRL_INVOICE, 
                    target.TRL_INVOICELINE=src.TRL_INVOICELINE, 
                    target.TRL_INVOICE_ORG=src.TRL_INVOICE_ORG, 
                    target.TRL_INVOICE_REVISION=src.TRL_INVOICE_REVISION, 
                    target.TRL_IO=src.TRL_IO, 
                    target.TRL_ISSUEDPART=src.TRL_ISSUEDPART, 
                    target.TRL_JECATEGORY=src.TRL_JECATEGORY, 
                    target.TRL_JESOURCE=src.TRL_JESOURCE, 
                    target.TRL_LASTSAVED=src.TRL_LASTSAVED, 
                    target.TRL_LEAK=src.TRL_LEAK, 
                    target.TRL_LINE=src.TRL_LINE, 
                    target.TRL_LOT=src.TRL_LOT, 
                    target.TRL_MANUFACTPART=src.TRL_MANUFACTPART, 
                    target.TRL_MANUFACTURER=src.TRL_MANUFACTURER, 
                    target.TRL_MULTIPLY=src.TRL_MULTIPLY, 
                    target.TRL_NEWCOSTCODE=src.TRL_NEWCOSTCODE, 
                    target.TRL_NEWMANUFACT=src.TRL_NEWMANUFACT, 
                    target.TRL_NEWMRC=src.TRL_NEWMRC, 
                    target.TRL_OBJECT=src.TRL_OBJECT, 
                    target.TRL_OBJECT_ORG=src.TRL_OBJECT_ORG, 
                    target.TRL_OBRTYPE=src.TRL_OBRTYPE, 
                    target.TRL_OBTYPE=src.TRL_OBTYPE, 
                    target.TRL_ORDER=src.TRL_ORDER, 
                    target.TRL_ORDER_ORG=src.TRL_ORDER_ORG, 
                    target.TRL_ORDLINE=src.TRL_ORDLINE, 
                    target.TRL_ORIGQTY=src.TRL_ORIGQTY, 
                    target.TRL_PACKAGE=src.TRL_PACKAGE, 
                    target.TRL_PART=src.TRL_PART, 
                    target.TRL_PARTLOCATION=src.TRL_PARTLOCATION, 
                    target.TRL_PART_ORG=src.TRL_PART_ORG, 
                    target.TRL_PICKLIST=src.TRL_PICKLIST, 
                    target.TRL_POEXTRACHARGES=src.TRL_POEXTRACHARGES, 
                    target.TRL_POTAXAMOUNT=src.TRL_POTAXAMOUNT, 
                    target.TRL_PRICE=src.TRL_PRICE, 
                    target.TRL_PRICEUPDATE=src.TRL_PRICEUPDATE, 
                    target.TRL_PRINTQTY=src.TRL_PRINTQTY, 
                    target.TRL_PROJBUD=src.TRL_PROJBUD, 
                    target.TRL_PROJECT=src.TRL_PROJECT, 
                    target.TRL_QTY=src.TRL_QTY, 
                    target.TRL_REJECTREASON=src.TRL_REJECTREASON, 
                    target.TRL_REPAIRPRICE=src.TRL_REPAIRPRICE, 
                    target.TRL_REQ=src.TRL_REQ, 
                    target.TRL_REQLINE=src.TRL_REQLINE, 
                    target.TRL_ROUTEREC=src.TRL_ROUTEREC, 
                    target.TRL_RTYPE=src.TRL_RTYPE, 
                    target.TRL_SCRAPOBJECT=src.TRL_SCRAPOBJECT, 
                    target.TRL_SCRAPOBJECT_ORG=src.TRL_SCRAPOBJECT_ORG, 
                    target.TRL_SCRAPQTY=src.TRL_SCRAPQTY, 
                    target.TRL_SOURCECODE=src.TRL_SOURCECODE, 
                    target.TRL_SOURCESYSTEM=src.TRL_SOURCESYSTEM, 
                    target.TRL_SPLITTRANS=src.TRL_SPLITTRANS, 
                    target.TRL_STOCKPRICE=src.TRL_STOCKPRICE, 
                    target.TRL_STORE=src.TRL_STORE, 
                    target.TRL_SUPPLIER=src.TRL_SUPPLIER, 
                    target.TRL_SUPPLIER_ORG=src.TRL_SUPPLIER_ORG, 
                    target.TRL_TAXJURISDICTION=src.TRL_TAXJURISDICTION, 
                    target.TRL_TRANS=src.TRL_TRANS, 
                    target.TRL_TRANSCODE=src.TRL_TRANSCODE, 
                    target.TRL_TRANSGROUP=src.TRL_TRANSGROUP, 
                    target.TRL_TRANSORGID=src.TRL_TRANSORGID, 
                    target.TRL_TYPE=src.TRL_TYPE, 
                    target.TRL_UDFCHAR01=src.TRL_UDFCHAR01, 
                    target.TRL_UDFCHAR02=src.TRL_UDFCHAR02, 
                    target.TRL_UDFCHAR03=src.TRL_UDFCHAR03, 
                    target.TRL_UDFCHAR04=src.TRL_UDFCHAR04, 
                    target.TRL_UDFCHAR05=src.TRL_UDFCHAR05, 
                    target.TRL_UDFCHAR06=src.TRL_UDFCHAR06, 
                    target.TRL_UDFCHAR07=src.TRL_UDFCHAR07, 
                    target.TRL_UDFCHAR08=src.TRL_UDFCHAR08, 
                    target.TRL_UDFCHAR09=src.TRL_UDFCHAR09, 
                    target.TRL_UDFCHAR10=src.TRL_UDFCHAR10, 
                    target.TRL_UDFCHAR11=src.TRL_UDFCHAR11, 
                    target.TRL_UDFCHAR12=src.TRL_UDFCHAR12, 
                    target.TRL_UDFCHAR13=src.TRL_UDFCHAR13, 
                    target.TRL_UDFCHAR14=src.TRL_UDFCHAR14, 
                    target.TRL_UDFCHAR15=src.TRL_UDFCHAR15, 
                    target.TRL_UDFCHAR16=src.TRL_UDFCHAR16, 
                    target.TRL_UDFCHAR17=src.TRL_UDFCHAR17, 
                    target.TRL_UDFCHAR18=src.TRL_UDFCHAR18, 
                    target.TRL_UDFCHAR19=src.TRL_UDFCHAR19, 
                    target.TRL_UDFCHAR20=src.TRL_UDFCHAR20, 
                    target.TRL_UDFCHAR21=src.TRL_UDFCHAR21, 
                    target.TRL_UDFCHAR22=src.TRL_UDFCHAR22, 
                    target.TRL_UDFCHAR23=src.TRL_UDFCHAR23, 
                    target.TRL_UDFCHAR24=src.TRL_UDFCHAR24, 
                    target.TRL_UDFCHAR25=src.TRL_UDFCHAR25, 
                    target.TRL_UDFCHAR26=src.TRL_UDFCHAR26, 
                    target.TRL_UDFCHAR27=src.TRL_UDFCHAR27, 
                    target.TRL_UDFCHAR28=src.TRL_UDFCHAR28, 
                    target.TRL_UDFCHAR29=src.TRL_UDFCHAR29, 
                    target.TRL_UDFCHAR30=src.TRL_UDFCHAR30, 
                    target.TRL_UDFCHKBOX01=src.TRL_UDFCHKBOX01, 
                    target.TRL_UDFCHKBOX02=src.TRL_UDFCHKBOX02, 
                    target.TRL_UDFCHKBOX03=src.TRL_UDFCHKBOX03, 
                    target.TRL_UDFCHKBOX04=src.TRL_UDFCHKBOX04, 
                    target.TRL_UDFCHKBOX05=src.TRL_UDFCHKBOX05, 
                    target.TRL_UDFDATE01=src.TRL_UDFDATE01, 
                    target.TRL_UDFDATE02=src.TRL_UDFDATE02, 
                    target.TRL_UDFDATE03=src.TRL_UDFDATE03, 
                    target.TRL_UDFDATE04=src.TRL_UDFDATE04, 
                    target.TRL_UDFDATE05=src.TRL_UDFDATE05, 
                    target.TRL_UDFNUM01=src.TRL_UDFNUM01, 
                    target.TRL_UDFNUM02=src.TRL_UDFNUM02, 
                    target.TRL_UDFNUM03=src.TRL_UDFNUM03, 
                    target.TRL_UDFNUM04=src.TRL_UDFNUM04, 
                    target.TRL_UDFNUM05=src.TRL_UDFNUM05, 
                    target.TRL_UPDATECOUNT=src.TRL_UPDATECOUNT, 
                    target.TRL_UPDATED=src.TRL_UPDATED, 
                    target.TRL_WARRANTY=src.TRL_WARRANTY, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    TRL_ACD, 
                    TRL_ACT, 
                    TRL_ALLOCATE, 
                    TRL_ATTACH, 
                    TRL_ATTACHTO, 
                    TRL_ATTACHTO_ORG, 
                    TRL_AVGPRICE, 
                    TRL_BILLSUBLINE, 
                    TRL_BIN, 
                    TRL_CALOTHERCOST, 
                    TRL_CONSIGNMENT, 
                    TRL_CONSIGNSUPPLIER, 
                    TRL_CONSIGNSUPPLIER_ORG, 
                    TRL_CORERETURNPRINTQTY, 
                    TRL_COSTCODE, 
                    TRL_CREATED, 
                    TRL_DATE, 
                    TRL_DCKCODE, 
                    TRL_DCKLINE, 
                    TRL_DESC, 
                    TRL_EVENT, 
                    TRL_EVTALIAS, 
                    TRL_FLEETCHECKED, 
                    TRL_FLEETMARKUP, 
                    TRL_GLTRANSFER, 
                    TRL_GLTRANSFERFLAG, 
                    TRL_HELDITEM, 
                    TRL_INTERFACE, 
                    TRL_INVOICE, 
                    TRL_INVOICELINE, 
                    TRL_INVOICE_ORG, 
                    TRL_INVOICE_REVISION, 
                    TRL_IO, 
                    TRL_ISSUEDPART, 
                    TRL_JECATEGORY, 
                    TRL_JESOURCE, 
                    TRL_LASTSAVED, 
                    TRL_LEAK, 
                    TRL_LINE, 
                    TRL_LOT, 
                    TRL_MANUFACTPART, 
                    TRL_MANUFACTURER, 
                    TRL_MULTIPLY, 
                    TRL_NEWCOSTCODE, 
                    TRL_NEWMANUFACT, 
                    TRL_NEWMRC, 
                    TRL_OBJECT, 
                    TRL_OBJECT_ORG, 
                    TRL_OBRTYPE, 
                    TRL_OBTYPE, 
                    TRL_ORDER, 
                    TRL_ORDER_ORG, 
                    TRL_ORDLINE, 
                    TRL_ORIGQTY, 
                    TRL_PACKAGE, 
                    TRL_PART, 
                    TRL_PARTLOCATION, 
                    TRL_PART_ORG, 
                    TRL_PICKLIST, 
                    TRL_POEXTRACHARGES, 
                    TRL_POTAXAMOUNT, 
                    TRL_PRICE, 
                    TRL_PRICEUPDATE, 
                    TRL_PRINTQTY, 
                    TRL_PROJBUD, 
                    TRL_PROJECT, 
                    TRL_QTY, 
                    TRL_REJECTREASON, 
                    TRL_REPAIRPRICE, 
                    TRL_REQ, 
                    TRL_REQLINE, 
                    TRL_ROUTEREC, 
                    TRL_RTYPE, 
                    TRL_SCRAPOBJECT, 
                    TRL_SCRAPOBJECT_ORG, 
                    TRL_SCRAPQTY, 
                    TRL_SOURCECODE, 
                    TRL_SOURCESYSTEM, 
                    TRL_SPLITTRANS, 
                    TRL_STOCKPRICE, 
                    TRL_STORE, 
                    TRL_SUPPLIER, 
                    TRL_SUPPLIER_ORG, 
                    TRL_TAXJURISDICTION, 
                    TRL_TRANS, 
                    TRL_TRANSCODE, 
                    TRL_TRANSGROUP, 
                    TRL_TRANSORGID, 
                    TRL_TYPE, 
                    TRL_UDFCHAR01, 
                    TRL_UDFCHAR02, 
                    TRL_UDFCHAR03, 
                    TRL_UDFCHAR04, 
                    TRL_UDFCHAR05, 
                    TRL_UDFCHAR06, 
                    TRL_UDFCHAR07, 
                    TRL_UDFCHAR08, 
                    TRL_UDFCHAR09, 
                    TRL_UDFCHAR10, 
                    TRL_UDFCHAR11, 
                    TRL_UDFCHAR12, 
                    TRL_UDFCHAR13, 
                    TRL_UDFCHAR14, 
                    TRL_UDFCHAR15, 
                    TRL_UDFCHAR16, 
                    TRL_UDFCHAR17, 
                    TRL_UDFCHAR18, 
                    TRL_UDFCHAR19, 
                    TRL_UDFCHAR20, 
                    TRL_UDFCHAR21, 
                    TRL_UDFCHAR22, 
                    TRL_UDFCHAR23, 
                    TRL_UDFCHAR24, 
                    TRL_UDFCHAR25, 
                    TRL_UDFCHAR26, 
                    TRL_UDFCHAR27, 
                    TRL_UDFCHAR28, 
                    TRL_UDFCHAR29, 
                    TRL_UDFCHAR30, 
                    TRL_UDFCHKBOX01, 
                    TRL_UDFCHKBOX02, 
                    TRL_UDFCHKBOX03, 
                    TRL_UDFCHKBOX04, 
                    TRL_UDFCHKBOX05, 
                    TRL_UDFDATE01, 
                    TRL_UDFDATE02, 
                    TRL_UDFDATE03, 
                    TRL_UDFDATE04, 
                    TRL_UDFDATE05, 
                    TRL_UDFNUM01, 
                    TRL_UDFNUM02, 
                    TRL_UDFNUM03, 
                    TRL_UDFNUM04, 
                    TRL_UDFNUM05, 
                    TRL_UPDATECOUNT, 
                    TRL_UPDATED, 
                    TRL_WARRANTY, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.TRL_ACD, 
                    src.TRL_ACT, 
                    src.TRL_ALLOCATE, 
                    src.TRL_ATTACH, 
                    src.TRL_ATTACHTO, 
                    src.TRL_ATTACHTO_ORG, 
                    src.TRL_AVGPRICE, 
                    src.TRL_BILLSUBLINE, 
                    src.TRL_BIN, 
                    src.TRL_CALOTHERCOST, 
                    src.TRL_CONSIGNMENT, 
                    src.TRL_CONSIGNSUPPLIER, 
                    src.TRL_CONSIGNSUPPLIER_ORG, 
                    src.TRL_CORERETURNPRINTQTY, 
                    src.TRL_COSTCODE, 
                    src.TRL_CREATED, 
                    src.TRL_DATE, 
                    src.TRL_DCKCODE, 
                    src.TRL_DCKLINE, 
                    src.TRL_DESC, 
                    src.TRL_EVENT, 
                    src.TRL_EVTALIAS, 
                    src.TRL_FLEETCHECKED, 
                    src.TRL_FLEETMARKUP, 
                    src.TRL_GLTRANSFER, 
                    src.TRL_GLTRANSFERFLAG, 
                    src.TRL_HELDITEM, 
                    src.TRL_INTERFACE, 
                    src.TRL_INVOICE, 
                    src.TRL_INVOICELINE, 
                    src.TRL_INVOICE_ORG, 
                    src.TRL_INVOICE_REVISION, 
                    src.TRL_IO, 
                    src.TRL_ISSUEDPART, 
                    src.TRL_JECATEGORY, 
                    src.TRL_JESOURCE, 
                    src.TRL_LASTSAVED, 
                    src.TRL_LEAK, 
                    src.TRL_LINE, 
                    src.TRL_LOT, 
                    src.TRL_MANUFACTPART, 
                    src.TRL_MANUFACTURER, 
                    src.TRL_MULTIPLY, 
                    src.TRL_NEWCOSTCODE, 
                    src.TRL_NEWMANUFACT, 
                    src.TRL_NEWMRC, 
                    src.TRL_OBJECT, 
                    src.TRL_OBJECT_ORG, 
                    src.TRL_OBRTYPE, 
                    src.TRL_OBTYPE, 
                    src.TRL_ORDER, 
                    src.TRL_ORDER_ORG, 
                    src.TRL_ORDLINE, 
                    src.TRL_ORIGQTY, 
                    src.TRL_PACKAGE, 
                    src.TRL_PART, 
                    src.TRL_PARTLOCATION, 
                    src.TRL_PART_ORG, 
                    src.TRL_PICKLIST, 
                    src.TRL_POEXTRACHARGES, 
                    src.TRL_POTAXAMOUNT, 
                    src.TRL_PRICE, 
                    src.TRL_PRICEUPDATE, 
                    src.TRL_PRINTQTY, 
                    src.TRL_PROJBUD, 
                    src.TRL_PROJECT, 
                    src.TRL_QTY, 
                    src.TRL_REJECTREASON, 
                    src.TRL_REPAIRPRICE, 
                    src.TRL_REQ, 
                    src.TRL_REQLINE, 
                    src.TRL_ROUTEREC, 
                    src.TRL_RTYPE, 
                    src.TRL_SCRAPOBJECT, 
                    src.TRL_SCRAPOBJECT_ORG, 
                    src.TRL_SCRAPQTY, 
                    src.TRL_SOURCECODE, 
                    src.TRL_SOURCESYSTEM, 
                    src.TRL_SPLITTRANS, 
                    src.TRL_STOCKPRICE, 
                    src.TRL_STORE, 
                    src.TRL_SUPPLIER, 
                    src.TRL_SUPPLIER_ORG, 
                    src.TRL_TAXJURISDICTION, 
                    src.TRL_TRANS, 
                    src.TRL_TRANSCODE, 
                    src.TRL_TRANSGROUP, 
                    src.TRL_TRANSORGID, 
                    src.TRL_TYPE, 
                    src.TRL_UDFCHAR01, 
                    src.TRL_UDFCHAR02, 
                    src.TRL_UDFCHAR03, 
                    src.TRL_UDFCHAR04, 
                    src.TRL_UDFCHAR05, 
                    src.TRL_UDFCHAR06, 
                    src.TRL_UDFCHAR07, 
                    src.TRL_UDFCHAR08, 
                    src.TRL_UDFCHAR09, 
                    src.TRL_UDFCHAR10, 
                    src.TRL_UDFCHAR11, 
                    src.TRL_UDFCHAR12, 
                    src.TRL_UDFCHAR13, 
                    src.TRL_UDFCHAR14, 
                    src.TRL_UDFCHAR15, 
                    src.TRL_UDFCHAR16, 
                    src.TRL_UDFCHAR17, 
                    src.TRL_UDFCHAR18, 
                    src.TRL_UDFCHAR19, 
                    src.TRL_UDFCHAR20, 
                    src.TRL_UDFCHAR21, 
                    src.TRL_UDFCHAR22, 
                    src.TRL_UDFCHAR23, 
                    src.TRL_UDFCHAR24, 
                    src.TRL_UDFCHAR25, 
                    src.TRL_UDFCHAR26, 
                    src.TRL_UDFCHAR27, 
                    src.TRL_UDFCHAR28, 
                    src.TRL_UDFCHAR29, 
                    src.TRL_UDFCHAR30, 
                    src.TRL_UDFCHKBOX01, 
                    src.TRL_UDFCHKBOX02, 
                    src.TRL_UDFCHKBOX03, 
                    src.TRL_UDFCHKBOX04, 
                    src.TRL_UDFCHKBOX05, 
                    src.TRL_UDFDATE01, 
                    src.TRL_UDFDATE02, 
                    src.TRL_UDFDATE03, 
                    src.TRL_UDFDATE04, 
                    src.TRL_UDFDATE05, 
                    src.TRL_UDFNUM01, 
                    src.TRL_UDFNUM02, 
                    src.TRL_UDFNUM03, 
                    src.TRL_UDFNUM04, 
                    src.TRL_UDFNUM05, 
                    src.TRL_UPDATECOUNT, 
                    src.TRL_UPDATED, 
                    src.TRL_WARRANTY, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5TRANSLINES_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.TRL_ACD, 
            strm.TRL_ACT, 
            strm.TRL_ALLOCATE, 
            strm.TRL_ATTACH, 
            strm.TRL_ATTACHTO, 
            strm.TRL_ATTACHTO_ORG, 
            strm.TRL_AVGPRICE, 
            strm.TRL_BILLSUBLINE, 
            strm.TRL_BIN, 
            strm.TRL_CALOTHERCOST, 
            strm.TRL_CONSIGNMENT, 
            strm.TRL_CONSIGNSUPPLIER, 
            strm.TRL_CONSIGNSUPPLIER_ORG, 
            strm.TRL_CORERETURNPRINTQTY, 
            strm.TRL_COSTCODE, 
            strm.TRL_CREATED, 
            strm.TRL_DATE, 
            strm.TRL_DCKCODE, 
            strm.TRL_DCKLINE, 
            strm.TRL_DESC, 
            strm.TRL_EVENT, 
            strm.TRL_EVTALIAS, 
            strm.TRL_FLEETCHECKED, 
            strm.TRL_FLEETMARKUP, 
            strm.TRL_GLTRANSFER, 
            strm.TRL_GLTRANSFERFLAG, 
            strm.TRL_HELDITEM, 
            strm.TRL_INTERFACE, 
            strm.TRL_INVOICE, 
            strm.TRL_INVOICELINE, 
            strm.TRL_INVOICE_ORG, 
            strm.TRL_INVOICE_REVISION, 
            strm.TRL_IO, 
            strm.TRL_ISSUEDPART, 
            strm.TRL_JECATEGORY, 
            strm.TRL_JESOURCE, 
            strm.TRL_LASTSAVED, 
            strm.TRL_LEAK, 
            strm.TRL_LINE, 
            strm.TRL_LOT, 
            strm.TRL_MANUFACTPART, 
            strm.TRL_MANUFACTURER, 
            strm.TRL_MULTIPLY, 
            strm.TRL_NEWCOSTCODE, 
            strm.TRL_NEWMANUFACT, 
            strm.TRL_NEWMRC, 
            strm.TRL_OBJECT, 
            strm.TRL_OBJECT_ORG, 
            strm.TRL_OBRTYPE, 
            strm.TRL_OBTYPE, 
            strm.TRL_ORDER, 
            strm.TRL_ORDER_ORG, 
            strm.TRL_ORDLINE, 
            strm.TRL_ORIGQTY, 
            strm.TRL_PACKAGE, 
            strm.TRL_PART, 
            strm.TRL_PARTLOCATION, 
            strm.TRL_PART_ORG, 
            strm.TRL_PICKLIST, 
            strm.TRL_POEXTRACHARGES, 
            strm.TRL_POTAXAMOUNT, 
            strm.TRL_PRICE, 
            strm.TRL_PRICEUPDATE, 
            strm.TRL_PRINTQTY, 
            strm.TRL_PROJBUD, 
            strm.TRL_PROJECT, 
            strm.TRL_QTY, 
            strm.TRL_REJECTREASON, 
            strm.TRL_REPAIRPRICE, 
            strm.TRL_REQ, 
            strm.TRL_REQLINE, 
            strm.TRL_ROUTEREC, 
            strm.TRL_RTYPE, 
            strm.TRL_SCRAPOBJECT, 
            strm.TRL_SCRAPOBJECT_ORG, 
            strm.TRL_SCRAPQTY, 
            strm.TRL_SOURCECODE, 
            strm.TRL_SOURCESYSTEM, 
            strm.TRL_SPLITTRANS, 
            strm.TRL_STOCKPRICE, 
            strm.TRL_STORE, 
            strm.TRL_SUPPLIER, 
            strm.TRL_SUPPLIER_ORG, 
            strm.TRL_TAXJURISDICTION, 
            strm.TRL_TRANS, 
            strm.TRL_TRANSCODE, 
            strm.TRL_TRANSGROUP, 
            strm.TRL_TRANSORGID, 
            strm.TRL_TYPE, 
            strm.TRL_UDFCHAR01, 
            strm.TRL_UDFCHAR02, 
            strm.TRL_UDFCHAR03, 
            strm.TRL_UDFCHAR04, 
            strm.TRL_UDFCHAR05, 
            strm.TRL_UDFCHAR06, 
            strm.TRL_UDFCHAR07, 
            strm.TRL_UDFCHAR08, 
            strm.TRL_UDFCHAR09, 
            strm.TRL_UDFCHAR10, 
            strm.TRL_UDFCHAR11, 
            strm.TRL_UDFCHAR12, 
            strm.TRL_UDFCHAR13, 
            strm.TRL_UDFCHAR14, 
            strm.TRL_UDFCHAR15, 
            strm.TRL_UDFCHAR16, 
            strm.TRL_UDFCHAR17, 
            strm.TRL_UDFCHAR18, 
            strm.TRL_UDFCHAR19, 
            strm.TRL_UDFCHAR20, 
            strm.TRL_UDFCHAR21, 
            strm.TRL_UDFCHAR22, 
            strm.TRL_UDFCHAR23, 
            strm.TRL_UDFCHAR24, 
            strm.TRL_UDFCHAR25, 
            strm.TRL_UDFCHAR26, 
            strm.TRL_UDFCHAR27, 
            strm.TRL_UDFCHAR28, 
            strm.TRL_UDFCHAR29, 
            strm.TRL_UDFCHAR30, 
            strm.TRL_UDFCHKBOX01, 
            strm.TRL_UDFCHKBOX02, 
            strm.TRL_UDFCHKBOX03, 
            strm.TRL_UDFCHKBOX04, 
            strm.TRL_UDFCHKBOX05, 
            strm.TRL_UDFDATE01, 
            strm.TRL_UDFDATE02, 
            strm.TRL_UDFDATE03, 
            strm.TRL_UDFDATE04, 
            strm.TRL_UDFDATE05, 
            strm.TRL_UDFNUM01, 
            strm.TRL_UDFNUM02, 
            strm.TRL_UDFNUM03, 
            strm.TRL_UDFNUM04, 
            strm.TRL_UDFNUM05, 
            strm.TRL_UPDATECOUNT, 
            strm.TRL_UPDATED, 
            strm.TRL_WARRANTY, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.TRL_TRANS,
            strm.TRL_LINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5TRANSLINES as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.TRL_TRANS=src.TRL_TRANS) OR (target.TRL_TRANS IS NULL AND src.TRL_TRANS IS NULL)) AND
            ((target.TRL_LINE=src.TRL_LINE) OR (target.TRL_LINE IS NULL AND src.TRL_LINE IS NULL)) 
                when matched then update set
                    target.TRL_ACD=src.TRL_ACD, 
                    target.TRL_ACT=src.TRL_ACT, 
                    target.TRL_ALLOCATE=src.TRL_ALLOCATE, 
                    target.TRL_ATTACH=src.TRL_ATTACH, 
                    target.TRL_ATTACHTO=src.TRL_ATTACHTO, 
                    target.TRL_ATTACHTO_ORG=src.TRL_ATTACHTO_ORG, 
                    target.TRL_AVGPRICE=src.TRL_AVGPRICE, 
                    target.TRL_BILLSUBLINE=src.TRL_BILLSUBLINE, 
                    target.TRL_BIN=src.TRL_BIN, 
                    target.TRL_CALOTHERCOST=src.TRL_CALOTHERCOST, 
                    target.TRL_CONSIGNMENT=src.TRL_CONSIGNMENT, 
                    target.TRL_CONSIGNSUPPLIER=src.TRL_CONSIGNSUPPLIER, 
                    target.TRL_CONSIGNSUPPLIER_ORG=src.TRL_CONSIGNSUPPLIER_ORG, 
                    target.TRL_CORERETURNPRINTQTY=src.TRL_CORERETURNPRINTQTY, 
                    target.TRL_COSTCODE=src.TRL_COSTCODE, 
                    target.TRL_CREATED=src.TRL_CREATED, 
                    target.TRL_DATE=src.TRL_DATE, 
                    target.TRL_DCKCODE=src.TRL_DCKCODE, 
                    target.TRL_DCKLINE=src.TRL_DCKLINE, 
                    target.TRL_DESC=src.TRL_DESC, 
                    target.TRL_EVENT=src.TRL_EVENT, 
                    target.TRL_EVTALIAS=src.TRL_EVTALIAS, 
                    target.TRL_FLEETCHECKED=src.TRL_FLEETCHECKED, 
                    target.TRL_FLEETMARKUP=src.TRL_FLEETMARKUP, 
                    target.TRL_GLTRANSFER=src.TRL_GLTRANSFER, 
                    target.TRL_GLTRANSFERFLAG=src.TRL_GLTRANSFERFLAG, 
                    target.TRL_HELDITEM=src.TRL_HELDITEM, 
                    target.TRL_INTERFACE=src.TRL_INTERFACE, 
                    target.TRL_INVOICE=src.TRL_INVOICE, 
                    target.TRL_INVOICELINE=src.TRL_INVOICELINE, 
                    target.TRL_INVOICE_ORG=src.TRL_INVOICE_ORG, 
                    target.TRL_INVOICE_REVISION=src.TRL_INVOICE_REVISION, 
                    target.TRL_IO=src.TRL_IO, 
                    target.TRL_ISSUEDPART=src.TRL_ISSUEDPART, 
                    target.TRL_JECATEGORY=src.TRL_JECATEGORY, 
                    target.TRL_JESOURCE=src.TRL_JESOURCE, 
                    target.TRL_LASTSAVED=src.TRL_LASTSAVED, 
                    target.TRL_LEAK=src.TRL_LEAK, 
                    target.TRL_LINE=src.TRL_LINE, 
                    target.TRL_LOT=src.TRL_LOT, 
                    target.TRL_MANUFACTPART=src.TRL_MANUFACTPART, 
                    target.TRL_MANUFACTURER=src.TRL_MANUFACTURER, 
                    target.TRL_MULTIPLY=src.TRL_MULTIPLY, 
                    target.TRL_NEWCOSTCODE=src.TRL_NEWCOSTCODE, 
                    target.TRL_NEWMANUFACT=src.TRL_NEWMANUFACT, 
                    target.TRL_NEWMRC=src.TRL_NEWMRC, 
                    target.TRL_OBJECT=src.TRL_OBJECT, 
                    target.TRL_OBJECT_ORG=src.TRL_OBJECT_ORG, 
                    target.TRL_OBRTYPE=src.TRL_OBRTYPE, 
                    target.TRL_OBTYPE=src.TRL_OBTYPE, 
                    target.TRL_ORDER=src.TRL_ORDER, 
                    target.TRL_ORDER_ORG=src.TRL_ORDER_ORG, 
                    target.TRL_ORDLINE=src.TRL_ORDLINE, 
                    target.TRL_ORIGQTY=src.TRL_ORIGQTY, 
                    target.TRL_PACKAGE=src.TRL_PACKAGE, 
                    target.TRL_PART=src.TRL_PART, 
                    target.TRL_PARTLOCATION=src.TRL_PARTLOCATION, 
                    target.TRL_PART_ORG=src.TRL_PART_ORG, 
                    target.TRL_PICKLIST=src.TRL_PICKLIST, 
                    target.TRL_POEXTRACHARGES=src.TRL_POEXTRACHARGES, 
                    target.TRL_POTAXAMOUNT=src.TRL_POTAXAMOUNT, 
                    target.TRL_PRICE=src.TRL_PRICE, 
                    target.TRL_PRICEUPDATE=src.TRL_PRICEUPDATE, 
                    target.TRL_PRINTQTY=src.TRL_PRINTQTY, 
                    target.TRL_PROJBUD=src.TRL_PROJBUD, 
                    target.TRL_PROJECT=src.TRL_PROJECT, 
                    target.TRL_QTY=src.TRL_QTY, 
                    target.TRL_REJECTREASON=src.TRL_REJECTREASON, 
                    target.TRL_REPAIRPRICE=src.TRL_REPAIRPRICE, 
                    target.TRL_REQ=src.TRL_REQ, 
                    target.TRL_REQLINE=src.TRL_REQLINE, 
                    target.TRL_ROUTEREC=src.TRL_ROUTEREC, 
                    target.TRL_RTYPE=src.TRL_RTYPE, 
                    target.TRL_SCRAPOBJECT=src.TRL_SCRAPOBJECT, 
                    target.TRL_SCRAPOBJECT_ORG=src.TRL_SCRAPOBJECT_ORG, 
                    target.TRL_SCRAPQTY=src.TRL_SCRAPQTY, 
                    target.TRL_SOURCECODE=src.TRL_SOURCECODE, 
                    target.TRL_SOURCESYSTEM=src.TRL_SOURCESYSTEM, 
                    target.TRL_SPLITTRANS=src.TRL_SPLITTRANS, 
                    target.TRL_STOCKPRICE=src.TRL_STOCKPRICE, 
                    target.TRL_STORE=src.TRL_STORE, 
                    target.TRL_SUPPLIER=src.TRL_SUPPLIER, 
                    target.TRL_SUPPLIER_ORG=src.TRL_SUPPLIER_ORG, 
                    target.TRL_TAXJURISDICTION=src.TRL_TAXJURISDICTION, 
                    target.TRL_TRANS=src.TRL_TRANS, 
                    target.TRL_TRANSCODE=src.TRL_TRANSCODE, 
                    target.TRL_TRANSGROUP=src.TRL_TRANSGROUP, 
                    target.TRL_TRANSORGID=src.TRL_TRANSORGID, 
                    target.TRL_TYPE=src.TRL_TYPE, 
                    target.TRL_UDFCHAR01=src.TRL_UDFCHAR01, 
                    target.TRL_UDFCHAR02=src.TRL_UDFCHAR02, 
                    target.TRL_UDFCHAR03=src.TRL_UDFCHAR03, 
                    target.TRL_UDFCHAR04=src.TRL_UDFCHAR04, 
                    target.TRL_UDFCHAR05=src.TRL_UDFCHAR05, 
                    target.TRL_UDFCHAR06=src.TRL_UDFCHAR06, 
                    target.TRL_UDFCHAR07=src.TRL_UDFCHAR07, 
                    target.TRL_UDFCHAR08=src.TRL_UDFCHAR08, 
                    target.TRL_UDFCHAR09=src.TRL_UDFCHAR09, 
                    target.TRL_UDFCHAR10=src.TRL_UDFCHAR10, 
                    target.TRL_UDFCHAR11=src.TRL_UDFCHAR11, 
                    target.TRL_UDFCHAR12=src.TRL_UDFCHAR12, 
                    target.TRL_UDFCHAR13=src.TRL_UDFCHAR13, 
                    target.TRL_UDFCHAR14=src.TRL_UDFCHAR14, 
                    target.TRL_UDFCHAR15=src.TRL_UDFCHAR15, 
                    target.TRL_UDFCHAR16=src.TRL_UDFCHAR16, 
                    target.TRL_UDFCHAR17=src.TRL_UDFCHAR17, 
                    target.TRL_UDFCHAR18=src.TRL_UDFCHAR18, 
                    target.TRL_UDFCHAR19=src.TRL_UDFCHAR19, 
                    target.TRL_UDFCHAR20=src.TRL_UDFCHAR20, 
                    target.TRL_UDFCHAR21=src.TRL_UDFCHAR21, 
                    target.TRL_UDFCHAR22=src.TRL_UDFCHAR22, 
                    target.TRL_UDFCHAR23=src.TRL_UDFCHAR23, 
                    target.TRL_UDFCHAR24=src.TRL_UDFCHAR24, 
                    target.TRL_UDFCHAR25=src.TRL_UDFCHAR25, 
                    target.TRL_UDFCHAR26=src.TRL_UDFCHAR26, 
                    target.TRL_UDFCHAR27=src.TRL_UDFCHAR27, 
                    target.TRL_UDFCHAR28=src.TRL_UDFCHAR28, 
                    target.TRL_UDFCHAR29=src.TRL_UDFCHAR29, 
                    target.TRL_UDFCHAR30=src.TRL_UDFCHAR30, 
                    target.TRL_UDFCHKBOX01=src.TRL_UDFCHKBOX01, 
                    target.TRL_UDFCHKBOX02=src.TRL_UDFCHKBOX02, 
                    target.TRL_UDFCHKBOX03=src.TRL_UDFCHKBOX03, 
                    target.TRL_UDFCHKBOX04=src.TRL_UDFCHKBOX04, 
                    target.TRL_UDFCHKBOX05=src.TRL_UDFCHKBOX05, 
                    target.TRL_UDFDATE01=src.TRL_UDFDATE01, 
                    target.TRL_UDFDATE02=src.TRL_UDFDATE02, 
                    target.TRL_UDFDATE03=src.TRL_UDFDATE03, 
                    target.TRL_UDFDATE04=src.TRL_UDFDATE04, 
                    target.TRL_UDFDATE05=src.TRL_UDFDATE05, 
                    target.TRL_UDFNUM01=src.TRL_UDFNUM01, 
                    target.TRL_UDFNUM02=src.TRL_UDFNUM02, 
                    target.TRL_UDFNUM03=src.TRL_UDFNUM03, 
                    target.TRL_UDFNUM04=src.TRL_UDFNUM04, 
                    target.TRL_UDFNUM05=src.TRL_UDFNUM05, 
                    target.TRL_UPDATECOUNT=src.TRL_UPDATECOUNT, 
                    target.TRL_UPDATED=src.TRL_UPDATED, 
                    target.TRL_WARRANTY=src.TRL_WARRANTY, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( TRL_ACD, TRL_ACT, TRL_ALLOCATE, TRL_ATTACH, TRL_ATTACHTO, TRL_ATTACHTO_ORG, TRL_AVGPRICE, TRL_BILLSUBLINE, TRL_BIN, TRL_CALOTHERCOST, TRL_CONSIGNMENT, TRL_CONSIGNSUPPLIER, TRL_CONSIGNSUPPLIER_ORG, TRL_CORERETURNPRINTQTY, TRL_COSTCODE, TRL_CREATED, TRL_DATE, TRL_DCKCODE, TRL_DCKLINE, TRL_DESC, TRL_EVENT, TRL_EVTALIAS, TRL_FLEETCHECKED, TRL_FLEETMARKUP, TRL_GLTRANSFER, TRL_GLTRANSFERFLAG, TRL_HELDITEM, TRL_INTERFACE, TRL_INVOICE, TRL_INVOICELINE, TRL_INVOICE_ORG, TRL_INVOICE_REVISION, TRL_IO, TRL_ISSUEDPART, TRL_JECATEGORY, TRL_JESOURCE, TRL_LASTSAVED, TRL_LEAK, TRL_LINE, TRL_LOT, TRL_MANUFACTPART, TRL_MANUFACTURER, TRL_MULTIPLY, TRL_NEWCOSTCODE, TRL_NEWMANUFACT, TRL_NEWMRC, TRL_OBJECT, TRL_OBJECT_ORG, TRL_OBRTYPE, TRL_OBTYPE, TRL_ORDER, TRL_ORDER_ORG, TRL_ORDLINE, TRL_ORIGQTY, TRL_PACKAGE, TRL_PART, TRL_PARTLOCATION, TRL_PART_ORG, TRL_PICKLIST, TRL_POEXTRACHARGES, TRL_POTAXAMOUNT, TRL_PRICE, TRL_PRICEUPDATE, TRL_PRINTQTY, TRL_PROJBUD, TRL_PROJECT, TRL_QTY, TRL_REJECTREASON, TRL_REPAIRPRICE, TRL_REQ, TRL_REQLINE, TRL_ROUTEREC, TRL_RTYPE, TRL_SCRAPOBJECT, TRL_SCRAPOBJECT_ORG, TRL_SCRAPQTY, TRL_SOURCECODE, TRL_SOURCESYSTEM, TRL_SPLITTRANS, TRL_STOCKPRICE, TRL_STORE, TRL_SUPPLIER, TRL_SUPPLIER_ORG, TRL_TAXJURISDICTION, TRL_TRANS, TRL_TRANSCODE, TRL_TRANSGROUP, TRL_TRANSORGID, TRL_TYPE, TRL_UDFCHAR01, TRL_UDFCHAR02, TRL_UDFCHAR03, TRL_UDFCHAR04, TRL_UDFCHAR05, TRL_UDFCHAR06, TRL_UDFCHAR07, TRL_UDFCHAR08, TRL_UDFCHAR09, TRL_UDFCHAR10, TRL_UDFCHAR11, TRL_UDFCHAR12, TRL_UDFCHAR13, TRL_UDFCHAR14, TRL_UDFCHAR15, TRL_UDFCHAR16, TRL_UDFCHAR17, TRL_UDFCHAR18, TRL_UDFCHAR19, TRL_UDFCHAR20, TRL_UDFCHAR21, TRL_UDFCHAR22, TRL_UDFCHAR23, TRL_UDFCHAR24, TRL_UDFCHAR25, TRL_UDFCHAR26, TRL_UDFCHAR27, TRL_UDFCHAR28, TRL_UDFCHAR29, TRL_UDFCHAR30, TRL_UDFCHKBOX01, TRL_UDFCHKBOX02, TRL_UDFCHKBOX03, TRL_UDFCHKBOX04, TRL_UDFCHKBOX05, TRL_UDFDATE01, TRL_UDFDATE02, TRL_UDFDATE03, TRL_UDFDATE04, TRL_UDFDATE05, TRL_UDFNUM01, TRL_UDFNUM02, TRL_UDFNUM03, TRL_UDFNUM04, TRL_UDFNUM05, TRL_UPDATECOUNT, TRL_UPDATED, TRL_WARRANTY, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.TRL_ACD, 
                    src.TRL_ACT, 
                    src.TRL_ALLOCATE, 
                    src.TRL_ATTACH, 
                    src.TRL_ATTACHTO, 
                    src.TRL_ATTACHTO_ORG, 
                    src.TRL_AVGPRICE, 
                    src.TRL_BILLSUBLINE, 
                    src.TRL_BIN, 
                    src.TRL_CALOTHERCOST, 
                    src.TRL_CONSIGNMENT, 
                    src.TRL_CONSIGNSUPPLIER, 
                    src.TRL_CONSIGNSUPPLIER_ORG, 
                    src.TRL_CORERETURNPRINTQTY, 
                    src.TRL_COSTCODE, 
                    src.TRL_CREATED, 
                    src.TRL_DATE, 
                    src.TRL_DCKCODE, 
                    src.TRL_DCKLINE, 
                    src.TRL_DESC, 
                    src.TRL_EVENT, 
                    src.TRL_EVTALIAS, 
                    src.TRL_FLEETCHECKED, 
                    src.TRL_FLEETMARKUP, 
                    src.TRL_GLTRANSFER, 
                    src.TRL_GLTRANSFERFLAG, 
                    src.TRL_HELDITEM, 
                    src.TRL_INTERFACE, 
                    src.TRL_INVOICE, 
                    src.TRL_INVOICELINE, 
                    src.TRL_INVOICE_ORG, 
                    src.TRL_INVOICE_REVISION, 
                    src.TRL_IO, 
                    src.TRL_ISSUEDPART, 
                    src.TRL_JECATEGORY, 
                    src.TRL_JESOURCE, 
                    src.TRL_LASTSAVED, 
                    src.TRL_LEAK, 
                    src.TRL_LINE, 
                    src.TRL_LOT, 
                    src.TRL_MANUFACTPART, 
                    src.TRL_MANUFACTURER, 
                    src.TRL_MULTIPLY, 
                    src.TRL_NEWCOSTCODE, 
                    src.TRL_NEWMANUFACT, 
                    src.TRL_NEWMRC, 
                    src.TRL_OBJECT, 
                    src.TRL_OBJECT_ORG, 
                    src.TRL_OBRTYPE, 
                    src.TRL_OBTYPE, 
                    src.TRL_ORDER, 
                    src.TRL_ORDER_ORG, 
                    src.TRL_ORDLINE, 
                    src.TRL_ORIGQTY, 
                    src.TRL_PACKAGE, 
                    src.TRL_PART, 
                    src.TRL_PARTLOCATION, 
                    src.TRL_PART_ORG, 
                    src.TRL_PICKLIST, 
                    src.TRL_POEXTRACHARGES, 
                    src.TRL_POTAXAMOUNT, 
                    src.TRL_PRICE, 
                    src.TRL_PRICEUPDATE, 
                    src.TRL_PRINTQTY, 
                    src.TRL_PROJBUD, 
                    src.TRL_PROJECT, 
                    src.TRL_QTY, 
                    src.TRL_REJECTREASON, 
                    src.TRL_REPAIRPRICE, 
                    src.TRL_REQ, 
                    src.TRL_REQLINE, 
                    src.TRL_ROUTEREC, 
                    src.TRL_RTYPE, 
                    src.TRL_SCRAPOBJECT, 
                    src.TRL_SCRAPOBJECT_ORG, 
                    src.TRL_SCRAPQTY, 
                    src.TRL_SOURCECODE, 
                    src.TRL_SOURCESYSTEM, 
                    src.TRL_SPLITTRANS, 
                    src.TRL_STOCKPRICE, 
                    src.TRL_STORE, 
                    src.TRL_SUPPLIER, 
                    src.TRL_SUPPLIER_ORG, 
                    src.TRL_TAXJURISDICTION, 
                    src.TRL_TRANS, 
                    src.TRL_TRANSCODE, 
                    src.TRL_TRANSGROUP, 
                    src.TRL_TRANSORGID, 
                    src.TRL_TYPE, 
                    src.TRL_UDFCHAR01, 
                    src.TRL_UDFCHAR02, 
                    src.TRL_UDFCHAR03, 
                    src.TRL_UDFCHAR04, 
                    src.TRL_UDFCHAR05, 
                    src.TRL_UDFCHAR06, 
                    src.TRL_UDFCHAR07, 
                    src.TRL_UDFCHAR08, 
                    src.TRL_UDFCHAR09, 
                    src.TRL_UDFCHAR10, 
                    src.TRL_UDFCHAR11, 
                    src.TRL_UDFCHAR12, 
                    src.TRL_UDFCHAR13, 
                    src.TRL_UDFCHAR14, 
                    src.TRL_UDFCHAR15, 
                    src.TRL_UDFCHAR16, 
                    src.TRL_UDFCHAR17, 
                    src.TRL_UDFCHAR18, 
                    src.TRL_UDFCHAR19, 
                    src.TRL_UDFCHAR20, 
                    src.TRL_UDFCHAR21, 
                    src.TRL_UDFCHAR22, 
                    src.TRL_UDFCHAR23, 
                    src.TRL_UDFCHAR24, 
                    src.TRL_UDFCHAR25, 
                    src.TRL_UDFCHAR26, 
                    src.TRL_UDFCHAR27, 
                    src.TRL_UDFCHAR28, 
                    src.TRL_UDFCHAR29, 
                    src.TRL_UDFCHAR30, 
                    src.TRL_UDFCHKBOX01, 
                    src.TRL_UDFCHKBOX02, 
                    src.TRL_UDFCHKBOX03, 
                    src.TRL_UDFCHKBOX04, 
                    src.TRL_UDFCHKBOX05, 
                    src.TRL_UDFDATE01, 
                    src.TRL_UDFDATE02, 
                    src.TRL_UDFDATE03, 
                    src.TRL_UDFDATE04, 
                    src.TRL_UDFDATE05, 
                    src.TRL_UDFNUM01, 
                    src.TRL_UDFNUM02, 
                    src.TRL_UDFNUM03, 
                    src.TRL_UDFNUM04, 
                    src.TRL_UDFNUM05, 
                    src.TRL_UPDATECOUNT, 
                    src.TRL_UPDATED, 
                    src.TRL_WARRANTY, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;