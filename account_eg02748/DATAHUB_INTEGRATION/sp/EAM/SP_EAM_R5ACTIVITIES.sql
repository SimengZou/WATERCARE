create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5ACTIVITIES()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5ACTIVITIES_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5ACTIVITIES as target using (SELECT * FROM (SELECT 
            strm.ACT_ACT, 
            strm.ACT_ASMLEVEL, 
            strm.ACT_ASSIGNMENTSTATUS, 
            strm.ACT_CLASS, 
            strm.ACT_CLASS_ORG, 
            strm.ACT_COMPLETED, 
            strm.ACT_COMPLEVEL, 
            strm.ACT_COMPLOCATION, 
            strm.ACT_CONDITION_AS_FOUND, 
            strm.ACT_DEFERMAINTENANCE, 
            strm.ACT_DEFERREDIRECTMATS, 
            strm.ACT_DEFERREDORIGACT, 
            strm.ACT_DEFERREDORIGWO, 
            strm.ACT_DURATION, 
            strm.ACT_EST, 
            strm.ACT_ESTLABORCOST, 
            strm.ACT_ESTMATLCOST, 
            strm.ACT_ESTMISCCOST, 
            strm.ACT_EVENT, 
            strm.ACT_FIXH, 
            strm.ACT_FROMGEOREF, 
            strm.ACT_FROMPOINT, 
            strm.ACT_FROMREFDESC, 
            strm.ACT_FROM_HORIZONTAL_OFFSET, 
            strm.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
            strm.ACT_FROM_HORIZONTAL_OFFSETUOM, 
            strm.ACT_FROM_LATITUDE, 
            strm.ACT_FROM_LONGITUDE, 
            strm.ACT_FROM_OFFSET, 
            strm.ACT_FROM_OFFSET_DIRECTION, 
            strm.ACT_FROM_OFFSET_PERCENTAGE, 
            strm.ACT_FROM_REFERENCE, 
            strm.ACT_FROM_RELATIONSHIP_TYPE, 
            strm.ACT_FROM_VERTICAL_OFFSET, 
            strm.ACT_FROM_VERTICAL_OFFSETTYPE, 
            strm.ACT_FROM_VERTICAL_OFFSETUOM, 
            strm.ACT_FROM_XCOORDINATE, 
            strm.ACT_FROM_YCOORDINATE, 
            strm.ACT_GRAPH, 
            strm.ACT_HIRE, 
            strm.ACT_INVOICE, 
            strm.ACT_INVOICELINE, 
            strm.ACT_INVOICE_ORG, 
            strm.ACT_INVOICE_REVISION, 
            strm.ACT_LASTSAVED, 
            strm.ACT_LATESTSCHED, 
            strm.ACT_LEVEL, 
            strm.ACT_MANUFACT, 
            strm.ACT_MATLIST, 
            strm.ACT_MATLREV, 
            strm.ACT_MAXDUR, 
            strm.ACT_MINHOURS, 
            strm.ACT_MRC, 
            strm.ACT_MULTIPLETRADES, 
            strm.ACT_NEWDUR, 
            strm.ACT_NEWSTART, 
            strm.ACT_NOTE, 
            strm.ACT_NT, 
            strm.ACT_NTRATE, 
            strm.ACT_ORDER, 
            strm.ACT_ORDERED, 
            strm.ACT_ORDER_ORG, 
            strm.ACT_ORDLINE, 
            strm.ACT_ORDRTYPE, 
            strm.ACT_ORDTYPE, 
            strm.ACT_OT, 
            strm.ACT_OTRATE, 
            strm.ACT_PARENT, 
            strm.ACT_PERCOMPLETE, 
            strm.ACT_PERFORMBY2RESP, 
            strm.ACT_PERFORMBYRESP, 
            strm.ACT_PERFORMED, 
            strm.ACT_PERFORMED2, 
            strm.ACT_PERFORMEDBY, 
            strm.ACT_PERFORMEDBY2, 
            strm.ACT_PERFORMEDTYPE, 
            strm.ACT_PERFORMEDTYPE2, 
            strm.ACT_PERRESP, 
            strm.ACT_PERSONS, 
            strm.ACT_PLANNINGLEVEL, 
            strm.ACT_PROJBUD, 
            strm.ACT_PROJECT, 
            strm.ACT_PURRATE, 
            strm.ACT_QTY, 
            strm.ACT_REJECTPERFORMEDBY, 
            strm.ACT_REJECTPERFORMEDBY2, 
            strm.ACT_REJECTREASON, 
            strm.ACT_RELATEDWO, 
            strm.ACT_REM, 
            strm.ACT_REQ, 
            strm.ACT_REQLINE, 
            strm.ACT_REVIEWED, 
            strm.ACT_REVIEWEDBY, 
            strm.ACT_REVIEWEDTYPE, 
            strm.ACT_REVIEWRESP, 
            strm.ACT_ROUTE, 
            strm.ACT_RPC, 
            strm.ACT_SCHEDHRS, 
            strm.ACT_SCHEDULINGSESSIONID, 
            strm.ACT_SCHEDULINGSESSIONTYPE, 
            strm.ACT_SEQ, 
            strm.ACT_SHIFT, 
            strm.ACT_SOURCECODE, 
            strm.ACT_SOURCESYSTEM, 
            strm.ACT_SPECIAL, 
            strm.ACT_START, 
            strm.ACT_SUPPLIER, 
            strm.ACT_SUPPLIER_ORG, 
            strm.ACT_SYSLEVEL, 
            strm.ACT_TASK, 
            strm.ACT_TASKREV, 
            strm.ACT_TIME, 
            strm.ACT_TOGEOREF, 
            strm.ACT_TOPOINT, 
            strm.ACT_TOPPARENT, 
            strm.ACT_TOREFDESC, 
            strm.ACT_TO_HORIZONTAL_OFFSET, 
            strm.ACT_TO_HORIZONTAL_OFFSETTYPE, 
            strm.ACT_TO_HORIZONTAL_OFFSETUOM, 
            strm.ACT_TO_LATITUDE, 
            strm.ACT_TO_LONGITUDE, 
            strm.ACT_TO_OFFSET, 
            strm.ACT_TO_OFFSET_DIRECTION, 
            strm.ACT_TO_OFFSET_PERCENTAGE, 
            strm.ACT_TO_REFERENCE, 
            strm.ACT_TO_RELATIONSHIP_TYPE, 
            strm.ACT_TO_VERTICAL_OFFSET, 
            strm.ACT_TO_VERTICAL_OFFSETTYPE, 
            strm.ACT_TO_VERTICAL_OFFSETUOM, 
            strm.ACT_TO_XCOORDINATE, 
            strm.ACT_TO_YCOORDINATE, 
            strm.ACT_TPF, 
            strm.ACT_TRADE, 
            strm.ACT_UDFCHAR01, 
            strm.ACT_UDFCHAR02, 
            strm.ACT_UDFCHAR03, 
            strm.ACT_UDFCHAR04, 
            strm.ACT_UDFCHAR05, 
            strm.ACT_UDFCHAR06, 
            strm.ACT_UDFCHAR07, 
            strm.ACT_UDFCHAR08, 
            strm.ACT_UDFCHAR09, 
            strm.ACT_UDFCHAR10, 
            strm.ACT_UDFCHAR11, 
            strm.ACT_UDFCHAR12, 
            strm.ACT_UDFCHAR13, 
            strm.ACT_UDFCHAR14, 
            strm.ACT_UDFCHAR15, 
            strm.ACT_UDFCHAR16, 
            strm.ACT_UDFCHAR17, 
            strm.ACT_UDFCHAR18, 
            strm.ACT_UDFCHAR19, 
            strm.ACT_UDFCHAR20, 
            strm.ACT_UDFCHAR21, 
            strm.ACT_UDFCHAR22, 
            strm.ACT_UDFCHAR23, 
            strm.ACT_UDFCHAR24, 
            strm.ACT_UDFCHAR25, 
            strm.ACT_UDFCHAR26, 
            strm.ACT_UDFCHAR27, 
            strm.ACT_UDFCHAR28, 
            strm.ACT_UDFCHAR29, 
            strm.ACT_UDFCHAR30, 
            strm.ACT_UDFCHKBOX01, 
            strm.ACT_UDFCHKBOX02, 
            strm.ACT_UDFCHKBOX03, 
            strm.ACT_UDFCHKBOX04, 
            strm.ACT_UDFCHKBOX05, 
            strm.ACT_UDFDATE01, 
            strm.ACT_UDFDATE02, 
            strm.ACT_UDFDATE03, 
            strm.ACT_UDFDATE04, 
            strm.ACT_UDFDATE05, 
            strm.ACT_UDFNOTE01, 
            strm.ACT_UDFNOTE02, 
            strm.ACT_UDFNUM01, 
            strm.ACT_UDFNUM02, 
            strm.ACT_UDFNUM03, 
            strm.ACT_UDFNUM04, 
            strm.ACT_UDFNUM05, 
            strm.ACT_UOM, 
            strm.ACT_UPDATECOUNT, 
            strm.ACT_WAP, 
            strm.ACT_WARRANTY, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ACT_EVENT,
            strm.ACT_ACT ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ACTIVITIES as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ACT_EVENT=src.ACT_EVENT) OR (target.ACT_EVENT IS NULL AND src.ACT_EVENT IS NULL)) AND
            ((target.ACT_ACT=src.ACT_ACT) OR (target.ACT_ACT IS NULL AND src.ACT_ACT IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.ACT_ACT=src.ACT_ACT, 
                    target.ACT_ASMLEVEL=src.ACT_ASMLEVEL, 
                    target.ACT_ASSIGNMENTSTATUS=src.ACT_ASSIGNMENTSTATUS, 
                    target.ACT_CLASS=src.ACT_CLASS, 
                    target.ACT_CLASS_ORG=src.ACT_CLASS_ORG, 
                    target.ACT_COMPLETED=src.ACT_COMPLETED, 
                    target.ACT_COMPLEVEL=src.ACT_COMPLEVEL, 
                    target.ACT_COMPLOCATION=src.ACT_COMPLOCATION, 
                    target.ACT_CONDITION_AS_FOUND=src.ACT_CONDITION_AS_FOUND, 
                    target.ACT_DEFERMAINTENANCE=src.ACT_DEFERMAINTENANCE, 
                    target.ACT_DEFERREDIRECTMATS=src.ACT_DEFERREDIRECTMATS, 
                    target.ACT_DEFERREDORIGACT=src.ACT_DEFERREDORIGACT, 
                    target.ACT_DEFERREDORIGWO=src.ACT_DEFERREDORIGWO, 
                    target.ACT_DURATION=src.ACT_DURATION, 
                    target.ACT_EST=src.ACT_EST, 
                    target.ACT_ESTLABORCOST=src.ACT_ESTLABORCOST, 
                    target.ACT_ESTMATLCOST=src.ACT_ESTMATLCOST, 
                    target.ACT_ESTMISCCOST=src.ACT_ESTMISCCOST, 
                    target.ACT_EVENT=src.ACT_EVENT, 
                    target.ACT_FIXH=src.ACT_FIXH, 
                    target.ACT_FROMGEOREF=src.ACT_FROMGEOREF, 
                    target.ACT_FROMPOINT=src.ACT_FROMPOINT, 
                    target.ACT_FROMREFDESC=src.ACT_FROMREFDESC, 
                    target.ACT_FROM_HORIZONTAL_OFFSET=src.ACT_FROM_HORIZONTAL_OFFSET, 
                    target.ACT_FROM_HORIZONTAL_OFFSETTYPE=src.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
                    target.ACT_FROM_HORIZONTAL_OFFSETUOM=src.ACT_FROM_HORIZONTAL_OFFSETUOM, 
                    target.ACT_FROM_LATITUDE=src.ACT_FROM_LATITUDE, 
                    target.ACT_FROM_LONGITUDE=src.ACT_FROM_LONGITUDE, 
                    target.ACT_FROM_OFFSET=src.ACT_FROM_OFFSET, 
                    target.ACT_FROM_OFFSET_DIRECTION=src.ACT_FROM_OFFSET_DIRECTION, 
                    target.ACT_FROM_OFFSET_PERCENTAGE=src.ACT_FROM_OFFSET_PERCENTAGE, 
                    target.ACT_FROM_REFERENCE=src.ACT_FROM_REFERENCE, 
                    target.ACT_FROM_RELATIONSHIP_TYPE=src.ACT_FROM_RELATIONSHIP_TYPE, 
                    target.ACT_FROM_VERTICAL_OFFSET=src.ACT_FROM_VERTICAL_OFFSET, 
                    target.ACT_FROM_VERTICAL_OFFSETTYPE=src.ACT_FROM_VERTICAL_OFFSETTYPE, 
                    target.ACT_FROM_VERTICAL_OFFSETUOM=src.ACT_FROM_VERTICAL_OFFSETUOM, 
                    target.ACT_FROM_XCOORDINATE=src.ACT_FROM_XCOORDINATE, 
                    target.ACT_FROM_YCOORDINATE=src.ACT_FROM_YCOORDINATE, 
                    target.ACT_GRAPH=src.ACT_GRAPH, 
                    target.ACT_HIRE=src.ACT_HIRE, 
                    target.ACT_INVOICE=src.ACT_INVOICE, 
                    target.ACT_INVOICELINE=src.ACT_INVOICELINE, 
                    target.ACT_INVOICE_ORG=src.ACT_INVOICE_ORG, 
                    target.ACT_INVOICE_REVISION=src.ACT_INVOICE_REVISION, 
                    target.ACT_LASTSAVED=src.ACT_LASTSAVED, 
                    target.ACT_LATESTSCHED=src.ACT_LATESTSCHED, 
                    target.ACT_LEVEL=src.ACT_LEVEL, 
                    target.ACT_MANUFACT=src.ACT_MANUFACT, 
                    target.ACT_MATLIST=src.ACT_MATLIST, 
                    target.ACT_MATLREV=src.ACT_MATLREV, 
                    target.ACT_MAXDUR=src.ACT_MAXDUR, 
                    target.ACT_MINHOURS=src.ACT_MINHOURS, 
                    target.ACT_MRC=src.ACT_MRC, 
                    target.ACT_MULTIPLETRADES=src.ACT_MULTIPLETRADES, 
                    target.ACT_NEWDUR=src.ACT_NEWDUR, 
                    target.ACT_NEWSTART=src.ACT_NEWSTART, 
                    target.ACT_NOTE=src.ACT_NOTE, 
                    target.ACT_NT=src.ACT_NT, 
                    target.ACT_NTRATE=src.ACT_NTRATE, 
                    target.ACT_ORDER=src.ACT_ORDER, 
                    target.ACT_ORDERED=src.ACT_ORDERED, 
                    target.ACT_ORDER_ORG=src.ACT_ORDER_ORG, 
                    target.ACT_ORDLINE=src.ACT_ORDLINE, 
                    target.ACT_ORDRTYPE=src.ACT_ORDRTYPE, 
                    target.ACT_ORDTYPE=src.ACT_ORDTYPE, 
                    target.ACT_OT=src.ACT_OT, 
                    target.ACT_OTRATE=src.ACT_OTRATE, 
                    target.ACT_PARENT=src.ACT_PARENT, 
                    target.ACT_PERCOMPLETE=src.ACT_PERCOMPLETE, 
                    target.ACT_PERFORMBY2RESP=src.ACT_PERFORMBY2RESP, 
                    target.ACT_PERFORMBYRESP=src.ACT_PERFORMBYRESP, 
                    target.ACT_PERFORMED=src.ACT_PERFORMED, 
                    target.ACT_PERFORMED2=src.ACT_PERFORMED2, 
                    target.ACT_PERFORMEDBY=src.ACT_PERFORMEDBY, 
                    target.ACT_PERFORMEDBY2=src.ACT_PERFORMEDBY2, 
                    target.ACT_PERFORMEDTYPE=src.ACT_PERFORMEDTYPE, 
                    target.ACT_PERFORMEDTYPE2=src.ACT_PERFORMEDTYPE2, 
                    target.ACT_PERRESP=src.ACT_PERRESP, 
                    target.ACT_PERSONS=src.ACT_PERSONS, 
                    target.ACT_PLANNINGLEVEL=src.ACT_PLANNINGLEVEL, 
                    target.ACT_PROJBUD=src.ACT_PROJBUD, 
                    target.ACT_PROJECT=src.ACT_PROJECT, 
                    target.ACT_PURRATE=src.ACT_PURRATE, 
                    target.ACT_QTY=src.ACT_QTY, 
                    target.ACT_REJECTPERFORMEDBY=src.ACT_REJECTPERFORMEDBY, 
                    target.ACT_REJECTPERFORMEDBY2=src.ACT_REJECTPERFORMEDBY2, 
                    target.ACT_REJECTREASON=src.ACT_REJECTREASON, 
                    target.ACT_RELATEDWO=src.ACT_RELATEDWO, 
                    target.ACT_REM=src.ACT_REM, 
                    target.ACT_REQ=src.ACT_REQ, 
                    target.ACT_REQLINE=src.ACT_REQLINE, 
                    target.ACT_REVIEWED=src.ACT_REVIEWED, 
                    target.ACT_REVIEWEDBY=src.ACT_REVIEWEDBY, 
                    target.ACT_REVIEWEDTYPE=src.ACT_REVIEWEDTYPE, 
                    target.ACT_REVIEWRESP=src.ACT_REVIEWRESP, 
                    target.ACT_ROUTE=src.ACT_ROUTE, 
                    target.ACT_RPC=src.ACT_RPC, 
                    target.ACT_SCHEDHRS=src.ACT_SCHEDHRS, 
                    target.ACT_SCHEDULINGSESSIONID=src.ACT_SCHEDULINGSESSIONID, 
                    target.ACT_SCHEDULINGSESSIONTYPE=src.ACT_SCHEDULINGSESSIONTYPE, 
                    target.ACT_SEQ=src.ACT_SEQ, 
                    target.ACT_SHIFT=src.ACT_SHIFT, 
                    target.ACT_SOURCECODE=src.ACT_SOURCECODE, 
                    target.ACT_SOURCESYSTEM=src.ACT_SOURCESYSTEM, 
                    target.ACT_SPECIAL=src.ACT_SPECIAL, 
                    target.ACT_START=src.ACT_START, 
                    target.ACT_SUPPLIER=src.ACT_SUPPLIER, 
                    target.ACT_SUPPLIER_ORG=src.ACT_SUPPLIER_ORG, 
                    target.ACT_SYSLEVEL=src.ACT_SYSLEVEL, 
                    target.ACT_TASK=src.ACT_TASK, 
                    target.ACT_TASKREV=src.ACT_TASKREV, 
                    target.ACT_TIME=src.ACT_TIME, 
                    target.ACT_TOGEOREF=src.ACT_TOGEOREF, 
                    target.ACT_TOPOINT=src.ACT_TOPOINT, 
                    target.ACT_TOPPARENT=src.ACT_TOPPARENT, 
                    target.ACT_TOREFDESC=src.ACT_TOREFDESC, 
                    target.ACT_TO_HORIZONTAL_OFFSET=src.ACT_TO_HORIZONTAL_OFFSET, 
                    target.ACT_TO_HORIZONTAL_OFFSETTYPE=src.ACT_TO_HORIZONTAL_OFFSETTYPE, 
                    target.ACT_TO_HORIZONTAL_OFFSETUOM=src.ACT_TO_HORIZONTAL_OFFSETUOM, 
                    target.ACT_TO_LATITUDE=src.ACT_TO_LATITUDE, 
                    target.ACT_TO_LONGITUDE=src.ACT_TO_LONGITUDE, 
                    target.ACT_TO_OFFSET=src.ACT_TO_OFFSET, 
                    target.ACT_TO_OFFSET_DIRECTION=src.ACT_TO_OFFSET_DIRECTION, 
                    target.ACT_TO_OFFSET_PERCENTAGE=src.ACT_TO_OFFSET_PERCENTAGE, 
                    target.ACT_TO_REFERENCE=src.ACT_TO_REFERENCE, 
                    target.ACT_TO_RELATIONSHIP_TYPE=src.ACT_TO_RELATIONSHIP_TYPE, 
                    target.ACT_TO_VERTICAL_OFFSET=src.ACT_TO_VERTICAL_OFFSET, 
                    target.ACT_TO_VERTICAL_OFFSETTYPE=src.ACT_TO_VERTICAL_OFFSETTYPE, 
                    target.ACT_TO_VERTICAL_OFFSETUOM=src.ACT_TO_VERTICAL_OFFSETUOM, 
                    target.ACT_TO_XCOORDINATE=src.ACT_TO_XCOORDINATE, 
                    target.ACT_TO_YCOORDINATE=src.ACT_TO_YCOORDINATE, 
                    target.ACT_TPF=src.ACT_TPF, 
                    target.ACT_TRADE=src.ACT_TRADE, 
                    target.ACT_UDFCHAR01=src.ACT_UDFCHAR01, 
                    target.ACT_UDFCHAR02=src.ACT_UDFCHAR02, 
                    target.ACT_UDFCHAR03=src.ACT_UDFCHAR03, 
                    target.ACT_UDFCHAR04=src.ACT_UDFCHAR04, 
                    target.ACT_UDFCHAR05=src.ACT_UDFCHAR05, 
                    target.ACT_UDFCHAR06=src.ACT_UDFCHAR06, 
                    target.ACT_UDFCHAR07=src.ACT_UDFCHAR07, 
                    target.ACT_UDFCHAR08=src.ACT_UDFCHAR08, 
                    target.ACT_UDFCHAR09=src.ACT_UDFCHAR09, 
                    target.ACT_UDFCHAR10=src.ACT_UDFCHAR10, 
                    target.ACT_UDFCHAR11=src.ACT_UDFCHAR11, 
                    target.ACT_UDFCHAR12=src.ACT_UDFCHAR12, 
                    target.ACT_UDFCHAR13=src.ACT_UDFCHAR13, 
                    target.ACT_UDFCHAR14=src.ACT_UDFCHAR14, 
                    target.ACT_UDFCHAR15=src.ACT_UDFCHAR15, 
                    target.ACT_UDFCHAR16=src.ACT_UDFCHAR16, 
                    target.ACT_UDFCHAR17=src.ACT_UDFCHAR17, 
                    target.ACT_UDFCHAR18=src.ACT_UDFCHAR18, 
                    target.ACT_UDFCHAR19=src.ACT_UDFCHAR19, 
                    target.ACT_UDFCHAR20=src.ACT_UDFCHAR20, 
                    target.ACT_UDFCHAR21=src.ACT_UDFCHAR21, 
                    target.ACT_UDFCHAR22=src.ACT_UDFCHAR22, 
                    target.ACT_UDFCHAR23=src.ACT_UDFCHAR23, 
                    target.ACT_UDFCHAR24=src.ACT_UDFCHAR24, 
                    target.ACT_UDFCHAR25=src.ACT_UDFCHAR25, 
                    target.ACT_UDFCHAR26=src.ACT_UDFCHAR26, 
                    target.ACT_UDFCHAR27=src.ACT_UDFCHAR27, 
                    target.ACT_UDFCHAR28=src.ACT_UDFCHAR28, 
                    target.ACT_UDFCHAR29=src.ACT_UDFCHAR29, 
                    target.ACT_UDFCHAR30=src.ACT_UDFCHAR30, 
                    target.ACT_UDFCHKBOX01=src.ACT_UDFCHKBOX01, 
                    target.ACT_UDFCHKBOX02=src.ACT_UDFCHKBOX02, 
                    target.ACT_UDFCHKBOX03=src.ACT_UDFCHKBOX03, 
                    target.ACT_UDFCHKBOX04=src.ACT_UDFCHKBOX04, 
                    target.ACT_UDFCHKBOX05=src.ACT_UDFCHKBOX05, 
                    target.ACT_UDFDATE01=src.ACT_UDFDATE01, 
                    target.ACT_UDFDATE02=src.ACT_UDFDATE02, 
                    target.ACT_UDFDATE03=src.ACT_UDFDATE03, 
                    target.ACT_UDFDATE04=src.ACT_UDFDATE04, 
                    target.ACT_UDFDATE05=src.ACT_UDFDATE05, 
                    target.ACT_UDFNOTE01=src.ACT_UDFNOTE01, 
                    target.ACT_UDFNOTE02=src.ACT_UDFNOTE02, 
                    target.ACT_UDFNUM01=src.ACT_UDFNUM01, 
                    target.ACT_UDFNUM02=src.ACT_UDFNUM02, 
                    target.ACT_UDFNUM03=src.ACT_UDFNUM03, 
                    target.ACT_UDFNUM04=src.ACT_UDFNUM04, 
                    target.ACT_UDFNUM05=src.ACT_UDFNUM05, 
                    target.ACT_UOM=src.ACT_UOM, 
                    target.ACT_UPDATECOUNT=src.ACT_UPDATECOUNT, 
                    target.ACT_WAP=src.ACT_WAP, 
                    target.ACT_WARRANTY=src.ACT_WARRANTY, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    ACT_ACT, 
                    ACT_ASMLEVEL, 
                    ACT_ASSIGNMENTSTATUS, 
                    ACT_CLASS, 
                    ACT_CLASS_ORG, 
                    ACT_COMPLETED, 
                    ACT_COMPLEVEL, 
                    ACT_COMPLOCATION, 
                    ACT_CONDITION_AS_FOUND, 
                    ACT_DEFERMAINTENANCE, 
                    ACT_DEFERREDIRECTMATS, 
                    ACT_DEFERREDORIGACT, 
                    ACT_DEFERREDORIGWO, 
                    ACT_DURATION, 
                    ACT_EST, 
                    ACT_ESTLABORCOST, 
                    ACT_ESTMATLCOST, 
                    ACT_ESTMISCCOST, 
                    ACT_EVENT, 
                    ACT_FIXH, 
                    ACT_FROMGEOREF, 
                    ACT_FROMPOINT, 
                    ACT_FROMREFDESC, 
                    ACT_FROM_HORIZONTAL_OFFSET, 
                    ACT_FROM_HORIZONTAL_OFFSETTYPE, 
                    ACT_FROM_HORIZONTAL_OFFSETUOM, 
                    ACT_FROM_LATITUDE, 
                    ACT_FROM_LONGITUDE, 
                    ACT_FROM_OFFSET, 
                    ACT_FROM_OFFSET_DIRECTION, 
                    ACT_FROM_OFFSET_PERCENTAGE, 
                    ACT_FROM_REFERENCE, 
                    ACT_FROM_RELATIONSHIP_TYPE, 
                    ACT_FROM_VERTICAL_OFFSET, 
                    ACT_FROM_VERTICAL_OFFSETTYPE, 
                    ACT_FROM_VERTICAL_OFFSETUOM, 
                    ACT_FROM_XCOORDINATE, 
                    ACT_FROM_YCOORDINATE, 
                    ACT_GRAPH, 
                    ACT_HIRE, 
                    ACT_INVOICE, 
                    ACT_INVOICELINE, 
                    ACT_INVOICE_ORG, 
                    ACT_INVOICE_REVISION, 
                    ACT_LASTSAVED, 
                    ACT_LATESTSCHED, 
                    ACT_LEVEL, 
                    ACT_MANUFACT, 
                    ACT_MATLIST, 
                    ACT_MATLREV, 
                    ACT_MAXDUR, 
                    ACT_MINHOURS, 
                    ACT_MRC, 
                    ACT_MULTIPLETRADES, 
                    ACT_NEWDUR, 
                    ACT_NEWSTART, 
                    ACT_NOTE, 
                    ACT_NT, 
                    ACT_NTRATE, 
                    ACT_ORDER, 
                    ACT_ORDERED, 
                    ACT_ORDER_ORG, 
                    ACT_ORDLINE, 
                    ACT_ORDRTYPE, 
                    ACT_ORDTYPE, 
                    ACT_OT, 
                    ACT_OTRATE, 
                    ACT_PARENT, 
                    ACT_PERCOMPLETE, 
                    ACT_PERFORMBY2RESP, 
                    ACT_PERFORMBYRESP, 
                    ACT_PERFORMED, 
                    ACT_PERFORMED2, 
                    ACT_PERFORMEDBY, 
                    ACT_PERFORMEDBY2, 
                    ACT_PERFORMEDTYPE, 
                    ACT_PERFORMEDTYPE2, 
                    ACT_PERRESP, 
                    ACT_PERSONS, 
                    ACT_PLANNINGLEVEL, 
                    ACT_PROJBUD, 
                    ACT_PROJECT, 
                    ACT_PURRATE, 
                    ACT_QTY, 
                    ACT_REJECTPERFORMEDBY, 
                    ACT_REJECTPERFORMEDBY2, 
                    ACT_REJECTREASON, 
                    ACT_RELATEDWO, 
                    ACT_REM, 
                    ACT_REQ, 
                    ACT_REQLINE, 
                    ACT_REVIEWED, 
                    ACT_REVIEWEDBY, 
                    ACT_REVIEWEDTYPE, 
                    ACT_REVIEWRESP, 
                    ACT_ROUTE, 
                    ACT_RPC, 
                    ACT_SCHEDHRS, 
                    ACT_SCHEDULINGSESSIONID, 
                    ACT_SCHEDULINGSESSIONTYPE, 
                    ACT_SEQ, 
                    ACT_SHIFT, 
                    ACT_SOURCECODE, 
                    ACT_SOURCESYSTEM, 
                    ACT_SPECIAL, 
                    ACT_START, 
                    ACT_SUPPLIER, 
                    ACT_SUPPLIER_ORG, 
                    ACT_SYSLEVEL, 
                    ACT_TASK, 
                    ACT_TASKREV, 
                    ACT_TIME, 
                    ACT_TOGEOREF, 
                    ACT_TOPOINT, 
                    ACT_TOPPARENT, 
                    ACT_TOREFDESC, 
                    ACT_TO_HORIZONTAL_OFFSET, 
                    ACT_TO_HORIZONTAL_OFFSETTYPE, 
                    ACT_TO_HORIZONTAL_OFFSETUOM, 
                    ACT_TO_LATITUDE, 
                    ACT_TO_LONGITUDE, 
                    ACT_TO_OFFSET, 
                    ACT_TO_OFFSET_DIRECTION, 
                    ACT_TO_OFFSET_PERCENTAGE, 
                    ACT_TO_REFERENCE, 
                    ACT_TO_RELATIONSHIP_TYPE, 
                    ACT_TO_VERTICAL_OFFSET, 
                    ACT_TO_VERTICAL_OFFSETTYPE, 
                    ACT_TO_VERTICAL_OFFSETUOM, 
                    ACT_TO_XCOORDINATE, 
                    ACT_TO_YCOORDINATE, 
                    ACT_TPF, 
                    ACT_TRADE, 
                    ACT_UDFCHAR01, 
                    ACT_UDFCHAR02, 
                    ACT_UDFCHAR03, 
                    ACT_UDFCHAR04, 
                    ACT_UDFCHAR05, 
                    ACT_UDFCHAR06, 
                    ACT_UDFCHAR07, 
                    ACT_UDFCHAR08, 
                    ACT_UDFCHAR09, 
                    ACT_UDFCHAR10, 
                    ACT_UDFCHAR11, 
                    ACT_UDFCHAR12, 
                    ACT_UDFCHAR13, 
                    ACT_UDFCHAR14, 
                    ACT_UDFCHAR15, 
                    ACT_UDFCHAR16, 
                    ACT_UDFCHAR17, 
                    ACT_UDFCHAR18, 
                    ACT_UDFCHAR19, 
                    ACT_UDFCHAR20, 
                    ACT_UDFCHAR21, 
                    ACT_UDFCHAR22, 
                    ACT_UDFCHAR23, 
                    ACT_UDFCHAR24, 
                    ACT_UDFCHAR25, 
                    ACT_UDFCHAR26, 
                    ACT_UDFCHAR27, 
                    ACT_UDFCHAR28, 
                    ACT_UDFCHAR29, 
                    ACT_UDFCHAR30, 
                    ACT_UDFCHKBOX01, 
                    ACT_UDFCHKBOX02, 
                    ACT_UDFCHKBOX03, 
                    ACT_UDFCHKBOX04, 
                    ACT_UDFCHKBOX05, 
                    ACT_UDFDATE01, 
                    ACT_UDFDATE02, 
                    ACT_UDFDATE03, 
                    ACT_UDFDATE04, 
                    ACT_UDFDATE05, 
                    ACT_UDFNOTE01, 
                    ACT_UDFNOTE02, 
                    ACT_UDFNUM01, 
                    ACT_UDFNUM02, 
                    ACT_UDFNUM03, 
                    ACT_UDFNUM04, 
                    ACT_UDFNUM05, 
                    ACT_UOM, 
                    ACT_UPDATECOUNT, 
                    ACT_WAP, 
                    ACT_WARRANTY, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.ACT_ACT, 
                    src.ACT_ASMLEVEL, 
                    src.ACT_ASSIGNMENTSTATUS, 
                    src.ACT_CLASS, 
                    src.ACT_CLASS_ORG, 
                    src.ACT_COMPLETED, 
                    src.ACT_COMPLEVEL, 
                    src.ACT_COMPLOCATION, 
                    src.ACT_CONDITION_AS_FOUND, 
                    src.ACT_DEFERMAINTENANCE, 
                    src.ACT_DEFERREDIRECTMATS, 
                    src.ACT_DEFERREDORIGACT, 
                    src.ACT_DEFERREDORIGWO, 
                    src.ACT_DURATION, 
                    src.ACT_EST, 
                    src.ACT_ESTLABORCOST, 
                    src.ACT_ESTMATLCOST, 
                    src.ACT_ESTMISCCOST, 
                    src.ACT_EVENT, 
                    src.ACT_FIXH, 
                    src.ACT_FROMGEOREF, 
                    src.ACT_FROMPOINT, 
                    src.ACT_FROMREFDESC, 
                    src.ACT_FROM_HORIZONTAL_OFFSET, 
                    src.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
                    src.ACT_FROM_HORIZONTAL_OFFSETUOM, 
                    src.ACT_FROM_LATITUDE, 
                    src.ACT_FROM_LONGITUDE, 
                    src.ACT_FROM_OFFSET, 
                    src.ACT_FROM_OFFSET_DIRECTION, 
                    src.ACT_FROM_OFFSET_PERCENTAGE, 
                    src.ACT_FROM_REFERENCE, 
                    src.ACT_FROM_RELATIONSHIP_TYPE, 
                    src.ACT_FROM_VERTICAL_OFFSET, 
                    src.ACT_FROM_VERTICAL_OFFSETTYPE, 
                    src.ACT_FROM_VERTICAL_OFFSETUOM, 
                    src.ACT_FROM_XCOORDINATE, 
                    src.ACT_FROM_YCOORDINATE, 
                    src.ACT_GRAPH, 
                    src.ACT_HIRE, 
                    src.ACT_INVOICE, 
                    src.ACT_INVOICELINE, 
                    src.ACT_INVOICE_ORG, 
                    src.ACT_INVOICE_REVISION, 
                    src.ACT_LASTSAVED, 
                    src.ACT_LATESTSCHED, 
                    src.ACT_LEVEL, 
                    src.ACT_MANUFACT, 
                    src.ACT_MATLIST, 
                    src.ACT_MATLREV, 
                    src.ACT_MAXDUR, 
                    src.ACT_MINHOURS, 
                    src.ACT_MRC, 
                    src.ACT_MULTIPLETRADES, 
                    src.ACT_NEWDUR, 
                    src.ACT_NEWSTART, 
                    src.ACT_NOTE, 
                    src.ACT_NT, 
                    src.ACT_NTRATE, 
                    src.ACT_ORDER, 
                    src.ACT_ORDERED, 
                    src.ACT_ORDER_ORG, 
                    src.ACT_ORDLINE, 
                    src.ACT_ORDRTYPE, 
                    src.ACT_ORDTYPE, 
                    src.ACT_OT, 
                    src.ACT_OTRATE, 
                    src.ACT_PARENT, 
                    src.ACT_PERCOMPLETE, 
                    src.ACT_PERFORMBY2RESP, 
                    src.ACT_PERFORMBYRESP, 
                    src.ACT_PERFORMED, 
                    src.ACT_PERFORMED2, 
                    src.ACT_PERFORMEDBY, 
                    src.ACT_PERFORMEDBY2, 
                    src.ACT_PERFORMEDTYPE, 
                    src.ACT_PERFORMEDTYPE2, 
                    src.ACT_PERRESP, 
                    src.ACT_PERSONS, 
                    src.ACT_PLANNINGLEVEL, 
                    src.ACT_PROJBUD, 
                    src.ACT_PROJECT, 
                    src.ACT_PURRATE, 
                    src.ACT_QTY, 
                    src.ACT_REJECTPERFORMEDBY, 
                    src.ACT_REJECTPERFORMEDBY2, 
                    src.ACT_REJECTREASON, 
                    src.ACT_RELATEDWO, 
                    src.ACT_REM, 
                    src.ACT_REQ, 
                    src.ACT_REQLINE, 
                    src.ACT_REVIEWED, 
                    src.ACT_REVIEWEDBY, 
                    src.ACT_REVIEWEDTYPE, 
                    src.ACT_REVIEWRESP, 
                    src.ACT_ROUTE, 
                    src.ACT_RPC, 
                    src.ACT_SCHEDHRS, 
                    src.ACT_SCHEDULINGSESSIONID, 
                    src.ACT_SCHEDULINGSESSIONTYPE, 
                    src.ACT_SEQ, 
                    src.ACT_SHIFT, 
                    src.ACT_SOURCECODE, 
                    src.ACT_SOURCESYSTEM, 
                    src.ACT_SPECIAL, 
                    src.ACT_START, 
                    src.ACT_SUPPLIER, 
                    src.ACT_SUPPLIER_ORG, 
                    src.ACT_SYSLEVEL, 
                    src.ACT_TASK, 
                    src.ACT_TASKREV, 
                    src.ACT_TIME, 
                    src.ACT_TOGEOREF, 
                    src.ACT_TOPOINT, 
                    src.ACT_TOPPARENT, 
                    src.ACT_TOREFDESC, 
                    src.ACT_TO_HORIZONTAL_OFFSET, 
                    src.ACT_TO_HORIZONTAL_OFFSETTYPE, 
                    src.ACT_TO_HORIZONTAL_OFFSETUOM, 
                    src.ACT_TO_LATITUDE, 
                    src.ACT_TO_LONGITUDE, 
                    src.ACT_TO_OFFSET, 
                    src.ACT_TO_OFFSET_DIRECTION, 
                    src.ACT_TO_OFFSET_PERCENTAGE, 
                    src.ACT_TO_REFERENCE, 
                    src.ACT_TO_RELATIONSHIP_TYPE, 
                    src.ACT_TO_VERTICAL_OFFSET, 
                    src.ACT_TO_VERTICAL_OFFSETTYPE, 
                    src.ACT_TO_VERTICAL_OFFSETUOM, 
                    src.ACT_TO_XCOORDINATE, 
                    src.ACT_TO_YCOORDINATE, 
                    src.ACT_TPF, 
                    src.ACT_TRADE, 
                    src.ACT_UDFCHAR01, 
                    src.ACT_UDFCHAR02, 
                    src.ACT_UDFCHAR03, 
                    src.ACT_UDFCHAR04, 
                    src.ACT_UDFCHAR05, 
                    src.ACT_UDFCHAR06, 
                    src.ACT_UDFCHAR07, 
                    src.ACT_UDFCHAR08, 
                    src.ACT_UDFCHAR09, 
                    src.ACT_UDFCHAR10, 
                    src.ACT_UDFCHAR11, 
                    src.ACT_UDFCHAR12, 
                    src.ACT_UDFCHAR13, 
                    src.ACT_UDFCHAR14, 
                    src.ACT_UDFCHAR15, 
                    src.ACT_UDFCHAR16, 
                    src.ACT_UDFCHAR17, 
                    src.ACT_UDFCHAR18, 
                    src.ACT_UDFCHAR19, 
                    src.ACT_UDFCHAR20, 
                    src.ACT_UDFCHAR21, 
                    src.ACT_UDFCHAR22, 
                    src.ACT_UDFCHAR23, 
                    src.ACT_UDFCHAR24, 
                    src.ACT_UDFCHAR25, 
                    src.ACT_UDFCHAR26, 
                    src.ACT_UDFCHAR27, 
                    src.ACT_UDFCHAR28, 
                    src.ACT_UDFCHAR29, 
                    src.ACT_UDFCHAR30, 
                    src.ACT_UDFCHKBOX01, 
                    src.ACT_UDFCHKBOX02, 
                    src.ACT_UDFCHKBOX03, 
                    src.ACT_UDFCHKBOX04, 
                    src.ACT_UDFCHKBOX05, 
                    src.ACT_UDFDATE01, 
                    src.ACT_UDFDATE02, 
                    src.ACT_UDFDATE03, 
                    src.ACT_UDFDATE04, 
                    src.ACT_UDFDATE05, 
                    src.ACT_UDFNOTE01, 
                    src.ACT_UDFNOTE02, 
                    src.ACT_UDFNUM01, 
                    src.ACT_UDFNUM02, 
                    src.ACT_UDFNUM03, 
                    src.ACT_UDFNUM04, 
                    src.ACT_UDFNUM05, 
                    src.ACT_UOM, 
                    src.ACT_UPDATECOUNT, 
                    src.ACT_WAP, 
                    src.ACT_WARRANTY, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5ACTIVITIES_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.ACT_ACT, 
            strm.ACT_ASMLEVEL, 
            strm.ACT_ASSIGNMENTSTATUS, 
            strm.ACT_CLASS, 
            strm.ACT_CLASS_ORG, 
            strm.ACT_COMPLETED, 
            strm.ACT_COMPLEVEL, 
            strm.ACT_COMPLOCATION, 
            strm.ACT_CONDITION_AS_FOUND, 
            strm.ACT_DEFERMAINTENANCE, 
            strm.ACT_DEFERREDIRECTMATS, 
            strm.ACT_DEFERREDORIGACT, 
            strm.ACT_DEFERREDORIGWO, 
            strm.ACT_DURATION, 
            strm.ACT_EST, 
            strm.ACT_ESTLABORCOST, 
            strm.ACT_ESTMATLCOST, 
            strm.ACT_ESTMISCCOST, 
            strm.ACT_EVENT, 
            strm.ACT_FIXH, 
            strm.ACT_FROMGEOREF, 
            strm.ACT_FROMPOINT, 
            strm.ACT_FROMREFDESC, 
            strm.ACT_FROM_HORIZONTAL_OFFSET, 
            strm.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
            strm.ACT_FROM_HORIZONTAL_OFFSETUOM, 
            strm.ACT_FROM_LATITUDE, 
            strm.ACT_FROM_LONGITUDE, 
            strm.ACT_FROM_OFFSET, 
            strm.ACT_FROM_OFFSET_DIRECTION, 
            strm.ACT_FROM_OFFSET_PERCENTAGE, 
            strm.ACT_FROM_REFERENCE, 
            strm.ACT_FROM_RELATIONSHIP_TYPE, 
            strm.ACT_FROM_VERTICAL_OFFSET, 
            strm.ACT_FROM_VERTICAL_OFFSETTYPE, 
            strm.ACT_FROM_VERTICAL_OFFSETUOM, 
            strm.ACT_FROM_XCOORDINATE, 
            strm.ACT_FROM_YCOORDINATE, 
            strm.ACT_GRAPH, 
            strm.ACT_HIRE, 
            strm.ACT_INVOICE, 
            strm.ACT_INVOICELINE, 
            strm.ACT_INVOICE_ORG, 
            strm.ACT_INVOICE_REVISION, 
            strm.ACT_LASTSAVED, 
            strm.ACT_LATESTSCHED, 
            strm.ACT_LEVEL, 
            strm.ACT_MANUFACT, 
            strm.ACT_MATLIST, 
            strm.ACT_MATLREV, 
            strm.ACT_MAXDUR, 
            strm.ACT_MINHOURS, 
            strm.ACT_MRC, 
            strm.ACT_MULTIPLETRADES, 
            strm.ACT_NEWDUR, 
            strm.ACT_NEWSTART, 
            strm.ACT_NOTE, 
            strm.ACT_NT, 
            strm.ACT_NTRATE, 
            strm.ACT_ORDER, 
            strm.ACT_ORDERED, 
            strm.ACT_ORDER_ORG, 
            strm.ACT_ORDLINE, 
            strm.ACT_ORDRTYPE, 
            strm.ACT_ORDTYPE, 
            strm.ACT_OT, 
            strm.ACT_OTRATE, 
            strm.ACT_PARENT, 
            strm.ACT_PERCOMPLETE, 
            strm.ACT_PERFORMBY2RESP, 
            strm.ACT_PERFORMBYRESP, 
            strm.ACT_PERFORMED, 
            strm.ACT_PERFORMED2, 
            strm.ACT_PERFORMEDBY, 
            strm.ACT_PERFORMEDBY2, 
            strm.ACT_PERFORMEDTYPE, 
            strm.ACT_PERFORMEDTYPE2, 
            strm.ACT_PERRESP, 
            strm.ACT_PERSONS, 
            strm.ACT_PLANNINGLEVEL, 
            strm.ACT_PROJBUD, 
            strm.ACT_PROJECT, 
            strm.ACT_PURRATE, 
            strm.ACT_QTY, 
            strm.ACT_REJECTPERFORMEDBY, 
            strm.ACT_REJECTPERFORMEDBY2, 
            strm.ACT_REJECTREASON, 
            strm.ACT_RELATEDWO, 
            strm.ACT_REM, 
            strm.ACT_REQ, 
            strm.ACT_REQLINE, 
            strm.ACT_REVIEWED, 
            strm.ACT_REVIEWEDBY, 
            strm.ACT_REVIEWEDTYPE, 
            strm.ACT_REVIEWRESP, 
            strm.ACT_ROUTE, 
            strm.ACT_RPC, 
            strm.ACT_SCHEDHRS, 
            strm.ACT_SCHEDULINGSESSIONID, 
            strm.ACT_SCHEDULINGSESSIONTYPE, 
            strm.ACT_SEQ, 
            strm.ACT_SHIFT, 
            strm.ACT_SOURCECODE, 
            strm.ACT_SOURCESYSTEM, 
            strm.ACT_SPECIAL, 
            strm.ACT_START, 
            strm.ACT_SUPPLIER, 
            strm.ACT_SUPPLIER_ORG, 
            strm.ACT_SYSLEVEL, 
            strm.ACT_TASK, 
            strm.ACT_TASKREV, 
            strm.ACT_TIME, 
            strm.ACT_TOGEOREF, 
            strm.ACT_TOPOINT, 
            strm.ACT_TOPPARENT, 
            strm.ACT_TOREFDESC, 
            strm.ACT_TO_HORIZONTAL_OFFSET, 
            strm.ACT_TO_HORIZONTAL_OFFSETTYPE, 
            strm.ACT_TO_HORIZONTAL_OFFSETUOM, 
            strm.ACT_TO_LATITUDE, 
            strm.ACT_TO_LONGITUDE, 
            strm.ACT_TO_OFFSET, 
            strm.ACT_TO_OFFSET_DIRECTION, 
            strm.ACT_TO_OFFSET_PERCENTAGE, 
            strm.ACT_TO_REFERENCE, 
            strm.ACT_TO_RELATIONSHIP_TYPE, 
            strm.ACT_TO_VERTICAL_OFFSET, 
            strm.ACT_TO_VERTICAL_OFFSETTYPE, 
            strm.ACT_TO_VERTICAL_OFFSETUOM, 
            strm.ACT_TO_XCOORDINATE, 
            strm.ACT_TO_YCOORDINATE, 
            strm.ACT_TPF, 
            strm.ACT_TRADE, 
            strm.ACT_UDFCHAR01, 
            strm.ACT_UDFCHAR02, 
            strm.ACT_UDFCHAR03, 
            strm.ACT_UDFCHAR04, 
            strm.ACT_UDFCHAR05, 
            strm.ACT_UDFCHAR06, 
            strm.ACT_UDFCHAR07, 
            strm.ACT_UDFCHAR08, 
            strm.ACT_UDFCHAR09, 
            strm.ACT_UDFCHAR10, 
            strm.ACT_UDFCHAR11, 
            strm.ACT_UDFCHAR12, 
            strm.ACT_UDFCHAR13, 
            strm.ACT_UDFCHAR14, 
            strm.ACT_UDFCHAR15, 
            strm.ACT_UDFCHAR16, 
            strm.ACT_UDFCHAR17, 
            strm.ACT_UDFCHAR18, 
            strm.ACT_UDFCHAR19, 
            strm.ACT_UDFCHAR20, 
            strm.ACT_UDFCHAR21, 
            strm.ACT_UDFCHAR22, 
            strm.ACT_UDFCHAR23, 
            strm.ACT_UDFCHAR24, 
            strm.ACT_UDFCHAR25, 
            strm.ACT_UDFCHAR26, 
            strm.ACT_UDFCHAR27, 
            strm.ACT_UDFCHAR28, 
            strm.ACT_UDFCHAR29, 
            strm.ACT_UDFCHAR30, 
            strm.ACT_UDFCHKBOX01, 
            strm.ACT_UDFCHKBOX02, 
            strm.ACT_UDFCHKBOX03, 
            strm.ACT_UDFCHKBOX04, 
            strm.ACT_UDFCHKBOX05, 
            strm.ACT_UDFDATE01, 
            strm.ACT_UDFDATE02, 
            strm.ACT_UDFDATE03, 
            strm.ACT_UDFDATE04, 
            strm.ACT_UDFDATE05, 
            strm.ACT_UDFNOTE01, 
            strm.ACT_UDFNOTE02, 
            strm.ACT_UDFNUM01, 
            strm.ACT_UDFNUM02, 
            strm.ACT_UDFNUM03, 
            strm.ACT_UDFNUM04, 
            strm.ACT_UDFNUM05, 
            strm.ACT_UOM, 
            strm.ACT_UPDATECOUNT, 
            strm.ACT_WAP, 
            strm.ACT_WARRANTY, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ACT_EVENT,
            strm.ACT_ACT ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ACTIVITIES as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ACT_EVENT=src.ACT_EVENT) OR (target.ACT_EVENT IS NULL AND src.ACT_EVENT IS NULL)) AND
            ((target.ACT_ACT=src.ACT_ACT) OR (target.ACT_ACT IS NULL AND src.ACT_ACT IS NULL)) 
                when matched then update set
                    target.ACT_ACT=src.ACT_ACT, 
                    target.ACT_ASMLEVEL=src.ACT_ASMLEVEL, 
                    target.ACT_ASSIGNMENTSTATUS=src.ACT_ASSIGNMENTSTATUS, 
                    target.ACT_CLASS=src.ACT_CLASS, 
                    target.ACT_CLASS_ORG=src.ACT_CLASS_ORG, 
                    target.ACT_COMPLETED=src.ACT_COMPLETED, 
                    target.ACT_COMPLEVEL=src.ACT_COMPLEVEL, 
                    target.ACT_COMPLOCATION=src.ACT_COMPLOCATION, 
                    target.ACT_CONDITION_AS_FOUND=src.ACT_CONDITION_AS_FOUND, 
                    target.ACT_DEFERMAINTENANCE=src.ACT_DEFERMAINTENANCE, 
                    target.ACT_DEFERREDIRECTMATS=src.ACT_DEFERREDIRECTMATS, 
                    target.ACT_DEFERREDORIGACT=src.ACT_DEFERREDORIGACT, 
                    target.ACT_DEFERREDORIGWO=src.ACT_DEFERREDORIGWO, 
                    target.ACT_DURATION=src.ACT_DURATION, 
                    target.ACT_EST=src.ACT_EST, 
                    target.ACT_ESTLABORCOST=src.ACT_ESTLABORCOST, 
                    target.ACT_ESTMATLCOST=src.ACT_ESTMATLCOST, 
                    target.ACT_ESTMISCCOST=src.ACT_ESTMISCCOST, 
                    target.ACT_EVENT=src.ACT_EVENT, 
                    target.ACT_FIXH=src.ACT_FIXH, 
                    target.ACT_FROMGEOREF=src.ACT_FROMGEOREF, 
                    target.ACT_FROMPOINT=src.ACT_FROMPOINT, 
                    target.ACT_FROMREFDESC=src.ACT_FROMREFDESC, 
                    target.ACT_FROM_HORIZONTAL_OFFSET=src.ACT_FROM_HORIZONTAL_OFFSET, 
                    target.ACT_FROM_HORIZONTAL_OFFSETTYPE=src.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
                    target.ACT_FROM_HORIZONTAL_OFFSETUOM=src.ACT_FROM_HORIZONTAL_OFFSETUOM, 
                    target.ACT_FROM_LATITUDE=src.ACT_FROM_LATITUDE, 
                    target.ACT_FROM_LONGITUDE=src.ACT_FROM_LONGITUDE, 
                    target.ACT_FROM_OFFSET=src.ACT_FROM_OFFSET, 
                    target.ACT_FROM_OFFSET_DIRECTION=src.ACT_FROM_OFFSET_DIRECTION, 
                    target.ACT_FROM_OFFSET_PERCENTAGE=src.ACT_FROM_OFFSET_PERCENTAGE, 
                    target.ACT_FROM_REFERENCE=src.ACT_FROM_REFERENCE, 
                    target.ACT_FROM_RELATIONSHIP_TYPE=src.ACT_FROM_RELATIONSHIP_TYPE, 
                    target.ACT_FROM_VERTICAL_OFFSET=src.ACT_FROM_VERTICAL_OFFSET, 
                    target.ACT_FROM_VERTICAL_OFFSETTYPE=src.ACT_FROM_VERTICAL_OFFSETTYPE, 
                    target.ACT_FROM_VERTICAL_OFFSETUOM=src.ACT_FROM_VERTICAL_OFFSETUOM, 
                    target.ACT_FROM_XCOORDINATE=src.ACT_FROM_XCOORDINATE, 
                    target.ACT_FROM_YCOORDINATE=src.ACT_FROM_YCOORDINATE, 
                    target.ACT_GRAPH=src.ACT_GRAPH, 
                    target.ACT_HIRE=src.ACT_HIRE, 
                    target.ACT_INVOICE=src.ACT_INVOICE, 
                    target.ACT_INVOICELINE=src.ACT_INVOICELINE, 
                    target.ACT_INVOICE_ORG=src.ACT_INVOICE_ORG, 
                    target.ACT_INVOICE_REVISION=src.ACT_INVOICE_REVISION, 
                    target.ACT_LASTSAVED=src.ACT_LASTSAVED, 
                    target.ACT_LATESTSCHED=src.ACT_LATESTSCHED, 
                    target.ACT_LEVEL=src.ACT_LEVEL, 
                    target.ACT_MANUFACT=src.ACT_MANUFACT, 
                    target.ACT_MATLIST=src.ACT_MATLIST, 
                    target.ACT_MATLREV=src.ACT_MATLREV, 
                    target.ACT_MAXDUR=src.ACT_MAXDUR, 
                    target.ACT_MINHOURS=src.ACT_MINHOURS, 
                    target.ACT_MRC=src.ACT_MRC, 
                    target.ACT_MULTIPLETRADES=src.ACT_MULTIPLETRADES, 
                    target.ACT_NEWDUR=src.ACT_NEWDUR, 
                    target.ACT_NEWSTART=src.ACT_NEWSTART, 
                    target.ACT_NOTE=src.ACT_NOTE, 
                    target.ACT_NT=src.ACT_NT, 
                    target.ACT_NTRATE=src.ACT_NTRATE, 
                    target.ACT_ORDER=src.ACT_ORDER, 
                    target.ACT_ORDERED=src.ACT_ORDERED, 
                    target.ACT_ORDER_ORG=src.ACT_ORDER_ORG, 
                    target.ACT_ORDLINE=src.ACT_ORDLINE, 
                    target.ACT_ORDRTYPE=src.ACT_ORDRTYPE, 
                    target.ACT_ORDTYPE=src.ACT_ORDTYPE, 
                    target.ACT_OT=src.ACT_OT, 
                    target.ACT_OTRATE=src.ACT_OTRATE, 
                    target.ACT_PARENT=src.ACT_PARENT, 
                    target.ACT_PERCOMPLETE=src.ACT_PERCOMPLETE, 
                    target.ACT_PERFORMBY2RESP=src.ACT_PERFORMBY2RESP, 
                    target.ACT_PERFORMBYRESP=src.ACT_PERFORMBYRESP, 
                    target.ACT_PERFORMED=src.ACT_PERFORMED, 
                    target.ACT_PERFORMED2=src.ACT_PERFORMED2, 
                    target.ACT_PERFORMEDBY=src.ACT_PERFORMEDBY, 
                    target.ACT_PERFORMEDBY2=src.ACT_PERFORMEDBY2, 
                    target.ACT_PERFORMEDTYPE=src.ACT_PERFORMEDTYPE, 
                    target.ACT_PERFORMEDTYPE2=src.ACT_PERFORMEDTYPE2, 
                    target.ACT_PERRESP=src.ACT_PERRESP, 
                    target.ACT_PERSONS=src.ACT_PERSONS, 
                    target.ACT_PLANNINGLEVEL=src.ACT_PLANNINGLEVEL, 
                    target.ACT_PROJBUD=src.ACT_PROJBUD, 
                    target.ACT_PROJECT=src.ACT_PROJECT, 
                    target.ACT_PURRATE=src.ACT_PURRATE, 
                    target.ACT_QTY=src.ACT_QTY, 
                    target.ACT_REJECTPERFORMEDBY=src.ACT_REJECTPERFORMEDBY, 
                    target.ACT_REJECTPERFORMEDBY2=src.ACT_REJECTPERFORMEDBY2, 
                    target.ACT_REJECTREASON=src.ACT_REJECTREASON, 
                    target.ACT_RELATEDWO=src.ACT_RELATEDWO, 
                    target.ACT_REM=src.ACT_REM, 
                    target.ACT_REQ=src.ACT_REQ, 
                    target.ACT_REQLINE=src.ACT_REQLINE, 
                    target.ACT_REVIEWED=src.ACT_REVIEWED, 
                    target.ACT_REVIEWEDBY=src.ACT_REVIEWEDBY, 
                    target.ACT_REVIEWEDTYPE=src.ACT_REVIEWEDTYPE, 
                    target.ACT_REVIEWRESP=src.ACT_REVIEWRESP, 
                    target.ACT_ROUTE=src.ACT_ROUTE, 
                    target.ACT_RPC=src.ACT_RPC, 
                    target.ACT_SCHEDHRS=src.ACT_SCHEDHRS, 
                    target.ACT_SCHEDULINGSESSIONID=src.ACT_SCHEDULINGSESSIONID, 
                    target.ACT_SCHEDULINGSESSIONTYPE=src.ACT_SCHEDULINGSESSIONTYPE, 
                    target.ACT_SEQ=src.ACT_SEQ, 
                    target.ACT_SHIFT=src.ACT_SHIFT, 
                    target.ACT_SOURCECODE=src.ACT_SOURCECODE, 
                    target.ACT_SOURCESYSTEM=src.ACT_SOURCESYSTEM, 
                    target.ACT_SPECIAL=src.ACT_SPECIAL, 
                    target.ACT_START=src.ACT_START, 
                    target.ACT_SUPPLIER=src.ACT_SUPPLIER, 
                    target.ACT_SUPPLIER_ORG=src.ACT_SUPPLIER_ORG, 
                    target.ACT_SYSLEVEL=src.ACT_SYSLEVEL, 
                    target.ACT_TASK=src.ACT_TASK, 
                    target.ACT_TASKREV=src.ACT_TASKREV, 
                    target.ACT_TIME=src.ACT_TIME, 
                    target.ACT_TOGEOREF=src.ACT_TOGEOREF, 
                    target.ACT_TOPOINT=src.ACT_TOPOINT, 
                    target.ACT_TOPPARENT=src.ACT_TOPPARENT, 
                    target.ACT_TOREFDESC=src.ACT_TOREFDESC, 
                    target.ACT_TO_HORIZONTAL_OFFSET=src.ACT_TO_HORIZONTAL_OFFSET, 
                    target.ACT_TO_HORIZONTAL_OFFSETTYPE=src.ACT_TO_HORIZONTAL_OFFSETTYPE, 
                    target.ACT_TO_HORIZONTAL_OFFSETUOM=src.ACT_TO_HORIZONTAL_OFFSETUOM, 
                    target.ACT_TO_LATITUDE=src.ACT_TO_LATITUDE, 
                    target.ACT_TO_LONGITUDE=src.ACT_TO_LONGITUDE, 
                    target.ACT_TO_OFFSET=src.ACT_TO_OFFSET, 
                    target.ACT_TO_OFFSET_DIRECTION=src.ACT_TO_OFFSET_DIRECTION, 
                    target.ACT_TO_OFFSET_PERCENTAGE=src.ACT_TO_OFFSET_PERCENTAGE, 
                    target.ACT_TO_REFERENCE=src.ACT_TO_REFERENCE, 
                    target.ACT_TO_RELATIONSHIP_TYPE=src.ACT_TO_RELATIONSHIP_TYPE, 
                    target.ACT_TO_VERTICAL_OFFSET=src.ACT_TO_VERTICAL_OFFSET, 
                    target.ACT_TO_VERTICAL_OFFSETTYPE=src.ACT_TO_VERTICAL_OFFSETTYPE, 
                    target.ACT_TO_VERTICAL_OFFSETUOM=src.ACT_TO_VERTICAL_OFFSETUOM, 
                    target.ACT_TO_XCOORDINATE=src.ACT_TO_XCOORDINATE, 
                    target.ACT_TO_YCOORDINATE=src.ACT_TO_YCOORDINATE, 
                    target.ACT_TPF=src.ACT_TPF, 
                    target.ACT_TRADE=src.ACT_TRADE, 
                    target.ACT_UDFCHAR01=src.ACT_UDFCHAR01, 
                    target.ACT_UDFCHAR02=src.ACT_UDFCHAR02, 
                    target.ACT_UDFCHAR03=src.ACT_UDFCHAR03, 
                    target.ACT_UDFCHAR04=src.ACT_UDFCHAR04, 
                    target.ACT_UDFCHAR05=src.ACT_UDFCHAR05, 
                    target.ACT_UDFCHAR06=src.ACT_UDFCHAR06, 
                    target.ACT_UDFCHAR07=src.ACT_UDFCHAR07, 
                    target.ACT_UDFCHAR08=src.ACT_UDFCHAR08, 
                    target.ACT_UDFCHAR09=src.ACT_UDFCHAR09, 
                    target.ACT_UDFCHAR10=src.ACT_UDFCHAR10, 
                    target.ACT_UDFCHAR11=src.ACT_UDFCHAR11, 
                    target.ACT_UDFCHAR12=src.ACT_UDFCHAR12, 
                    target.ACT_UDFCHAR13=src.ACT_UDFCHAR13, 
                    target.ACT_UDFCHAR14=src.ACT_UDFCHAR14, 
                    target.ACT_UDFCHAR15=src.ACT_UDFCHAR15, 
                    target.ACT_UDFCHAR16=src.ACT_UDFCHAR16, 
                    target.ACT_UDFCHAR17=src.ACT_UDFCHAR17, 
                    target.ACT_UDFCHAR18=src.ACT_UDFCHAR18, 
                    target.ACT_UDFCHAR19=src.ACT_UDFCHAR19, 
                    target.ACT_UDFCHAR20=src.ACT_UDFCHAR20, 
                    target.ACT_UDFCHAR21=src.ACT_UDFCHAR21, 
                    target.ACT_UDFCHAR22=src.ACT_UDFCHAR22, 
                    target.ACT_UDFCHAR23=src.ACT_UDFCHAR23, 
                    target.ACT_UDFCHAR24=src.ACT_UDFCHAR24, 
                    target.ACT_UDFCHAR25=src.ACT_UDFCHAR25, 
                    target.ACT_UDFCHAR26=src.ACT_UDFCHAR26, 
                    target.ACT_UDFCHAR27=src.ACT_UDFCHAR27, 
                    target.ACT_UDFCHAR28=src.ACT_UDFCHAR28, 
                    target.ACT_UDFCHAR29=src.ACT_UDFCHAR29, 
                    target.ACT_UDFCHAR30=src.ACT_UDFCHAR30, 
                    target.ACT_UDFCHKBOX01=src.ACT_UDFCHKBOX01, 
                    target.ACT_UDFCHKBOX02=src.ACT_UDFCHKBOX02, 
                    target.ACT_UDFCHKBOX03=src.ACT_UDFCHKBOX03, 
                    target.ACT_UDFCHKBOX04=src.ACT_UDFCHKBOX04, 
                    target.ACT_UDFCHKBOX05=src.ACT_UDFCHKBOX05, 
                    target.ACT_UDFDATE01=src.ACT_UDFDATE01, 
                    target.ACT_UDFDATE02=src.ACT_UDFDATE02, 
                    target.ACT_UDFDATE03=src.ACT_UDFDATE03, 
                    target.ACT_UDFDATE04=src.ACT_UDFDATE04, 
                    target.ACT_UDFDATE05=src.ACT_UDFDATE05, 
                    target.ACT_UDFNOTE01=src.ACT_UDFNOTE01, 
                    target.ACT_UDFNOTE02=src.ACT_UDFNOTE02, 
                    target.ACT_UDFNUM01=src.ACT_UDFNUM01, 
                    target.ACT_UDFNUM02=src.ACT_UDFNUM02, 
                    target.ACT_UDFNUM03=src.ACT_UDFNUM03, 
                    target.ACT_UDFNUM04=src.ACT_UDFNUM04, 
                    target.ACT_UDFNUM05=src.ACT_UDFNUM05, 
                    target.ACT_UOM=src.ACT_UOM, 
                    target.ACT_UPDATECOUNT=src.ACT_UPDATECOUNT, 
                    target.ACT_WAP=src.ACT_WAP, 
                    target.ACT_WARRANTY=src.ACT_WARRANTY, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( ACT_ACT, ACT_ASMLEVEL, ACT_ASSIGNMENTSTATUS, ACT_CLASS, ACT_CLASS_ORG, ACT_COMPLETED, ACT_COMPLEVEL, ACT_COMPLOCATION, ACT_CONDITION_AS_FOUND, ACT_DEFERMAINTENANCE, ACT_DEFERREDIRECTMATS, ACT_DEFERREDORIGACT, ACT_DEFERREDORIGWO, ACT_DURATION, ACT_EST, ACT_ESTLABORCOST, ACT_ESTMATLCOST, ACT_ESTMISCCOST, ACT_EVENT, ACT_FIXH, ACT_FROMGEOREF, ACT_FROMPOINT, ACT_FROMREFDESC, ACT_FROM_HORIZONTAL_OFFSET, ACT_FROM_HORIZONTAL_OFFSETTYPE, ACT_FROM_HORIZONTAL_OFFSETUOM, ACT_FROM_LATITUDE, ACT_FROM_LONGITUDE, ACT_FROM_OFFSET, ACT_FROM_OFFSET_DIRECTION, ACT_FROM_OFFSET_PERCENTAGE, ACT_FROM_REFERENCE, ACT_FROM_RELATIONSHIP_TYPE, ACT_FROM_VERTICAL_OFFSET, ACT_FROM_VERTICAL_OFFSETTYPE, ACT_FROM_VERTICAL_OFFSETUOM, ACT_FROM_XCOORDINATE, ACT_FROM_YCOORDINATE, ACT_GRAPH, ACT_HIRE, ACT_INVOICE, ACT_INVOICELINE, ACT_INVOICE_ORG, ACT_INVOICE_REVISION, ACT_LASTSAVED, ACT_LATESTSCHED, ACT_LEVEL, ACT_MANUFACT, ACT_MATLIST, ACT_MATLREV, ACT_MAXDUR, ACT_MINHOURS, ACT_MRC, ACT_MULTIPLETRADES, ACT_NEWDUR, ACT_NEWSTART, ACT_NOTE, ACT_NT, ACT_NTRATE, ACT_ORDER, ACT_ORDERED, ACT_ORDER_ORG, ACT_ORDLINE, ACT_ORDRTYPE, ACT_ORDTYPE, ACT_OT, ACT_OTRATE, ACT_PARENT, ACT_PERCOMPLETE, ACT_PERFORMBY2RESP, ACT_PERFORMBYRESP, ACT_PERFORMED, ACT_PERFORMED2, ACT_PERFORMEDBY, ACT_PERFORMEDBY2, ACT_PERFORMEDTYPE, ACT_PERFORMEDTYPE2, ACT_PERRESP, ACT_PERSONS, ACT_PLANNINGLEVEL, ACT_PROJBUD, ACT_PROJECT, ACT_PURRATE, ACT_QTY, ACT_REJECTPERFORMEDBY, ACT_REJECTPERFORMEDBY2, ACT_REJECTREASON, ACT_RELATEDWO, ACT_REM, ACT_REQ, ACT_REQLINE, ACT_REVIEWED, ACT_REVIEWEDBY, ACT_REVIEWEDTYPE, ACT_REVIEWRESP, ACT_ROUTE, ACT_RPC, ACT_SCHEDHRS, ACT_SCHEDULINGSESSIONID, ACT_SCHEDULINGSESSIONTYPE, ACT_SEQ, ACT_SHIFT, ACT_SOURCECODE, ACT_SOURCESYSTEM, ACT_SPECIAL, ACT_START, ACT_SUPPLIER, ACT_SUPPLIER_ORG, ACT_SYSLEVEL, ACT_TASK, ACT_TASKREV, ACT_TIME, ACT_TOGEOREF, ACT_TOPOINT, ACT_TOPPARENT, ACT_TOREFDESC, ACT_TO_HORIZONTAL_OFFSET, ACT_TO_HORIZONTAL_OFFSETTYPE, ACT_TO_HORIZONTAL_OFFSETUOM, ACT_TO_LATITUDE, ACT_TO_LONGITUDE, ACT_TO_OFFSET, ACT_TO_OFFSET_DIRECTION, ACT_TO_OFFSET_PERCENTAGE, ACT_TO_REFERENCE, ACT_TO_RELATIONSHIP_TYPE, ACT_TO_VERTICAL_OFFSET, ACT_TO_VERTICAL_OFFSETTYPE, ACT_TO_VERTICAL_OFFSETUOM, ACT_TO_XCOORDINATE, ACT_TO_YCOORDINATE, ACT_TPF, ACT_TRADE, ACT_UDFCHAR01, ACT_UDFCHAR02, ACT_UDFCHAR03, ACT_UDFCHAR04, ACT_UDFCHAR05, ACT_UDFCHAR06, ACT_UDFCHAR07, ACT_UDFCHAR08, ACT_UDFCHAR09, ACT_UDFCHAR10, ACT_UDFCHAR11, ACT_UDFCHAR12, ACT_UDFCHAR13, ACT_UDFCHAR14, ACT_UDFCHAR15, ACT_UDFCHAR16, ACT_UDFCHAR17, ACT_UDFCHAR18, ACT_UDFCHAR19, ACT_UDFCHAR20, ACT_UDFCHAR21, ACT_UDFCHAR22, ACT_UDFCHAR23, ACT_UDFCHAR24, ACT_UDFCHAR25, ACT_UDFCHAR26, ACT_UDFCHAR27, ACT_UDFCHAR28, ACT_UDFCHAR29, ACT_UDFCHAR30, ACT_UDFCHKBOX01, ACT_UDFCHKBOX02, ACT_UDFCHKBOX03, ACT_UDFCHKBOX04, ACT_UDFCHKBOX05, ACT_UDFDATE01, ACT_UDFDATE02, ACT_UDFDATE03, ACT_UDFDATE04, ACT_UDFDATE05, ACT_UDFNOTE01, ACT_UDFNOTE02, ACT_UDFNUM01, ACT_UDFNUM02, ACT_UDFNUM03, ACT_UDFNUM04, ACT_UDFNUM05, ACT_UOM, ACT_UPDATECOUNT, ACT_WAP, ACT_WARRANTY, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.ACT_ACT, 
                    src.ACT_ASMLEVEL, 
                    src.ACT_ASSIGNMENTSTATUS, 
                    src.ACT_CLASS, 
                    src.ACT_CLASS_ORG, 
                    src.ACT_COMPLETED, 
                    src.ACT_COMPLEVEL, 
                    src.ACT_COMPLOCATION, 
                    src.ACT_CONDITION_AS_FOUND, 
                    src.ACT_DEFERMAINTENANCE, 
                    src.ACT_DEFERREDIRECTMATS, 
                    src.ACT_DEFERREDORIGACT, 
                    src.ACT_DEFERREDORIGWO, 
                    src.ACT_DURATION, 
                    src.ACT_EST, 
                    src.ACT_ESTLABORCOST, 
                    src.ACT_ESTMATLCOST, 
                    src.ACT_ESTMISCCOST, 
                    src.ACT_EVENT, 
                    src.ACT_FIXH, 
                    src.ACT_FROMGEOREF, 
                    src.ACT_FROMPOINT, 
                    src.ACT_FROMREFDESC, 
                    src.ACT_FROM_HORIZONTAL_OFFSET, 
                    src.ACT_FROM_HORIZONTAL_OFFSETTYPE, 
                    src.ACT_FROM_HORIZONTAL_OFFSETUOM, 
                    src.ACT_FROM_LATITUDE, 
                    src.ACT_FROM_LONGITUDE, 
                    src.ACT_FROM_OFFSET, 
                    src.ACT_FROM_OFFSET_DIRECTION, 
                    src.ACT_FROM_OFFSET_PERCENTAGE, 
                    src.ACT_FROM_REFERENCE, 
                    src.ACT_FROM_RELATIONSHIP_TYPE, 
                    src.ACT_FROM_VERTICAL_OFFSET, 
                    src.ACT_FROM_VERTICAL_OFFSETTYPE, 
                    src.ACT_FROM_VERTICAL_OFFSETUOM, 
                    src.ACT_FROM_XCOORDINATE, 
                    src.ACT_FROM_YCOORDINATE, 
                    src.ACT_GRAPH, 
                    src.ACT_HIRE, 
                    src.ACT_INVOICE, 
                    src.ACT_INVOICELINE, 
                    src.ACT_INVOICE_ORG, 
                    src.ACT_INVOICE_REVISION, 
                    src.ACT_LASTSAVED, 
                    src.ACT_LATESTSCHED, 
                    src.ACT_LEVEL, 
                    src.ACT_MANUFACT, 
                    src.ACT_MATLIST, 
                    src.ACT_MATLREV, 
                    src.ACT_MAXDUR, 
                    src.ACT_MINHOURS, 
                    src.ACT_MRC, 
                    src.ACT_MULTIPLETRADES, 
                    src.ACT_NEWDUR, 
                    src.ACT_NEWSTART, 
                    src.ACT_NOTE, 
                    src.ACT_NT, 
                    src.ACT_NTRATE, 
                    src.ACT_ORDER, 
                    src.ACT_ORDERED, 
                    src.ACT_ORDER_ORG, 
                    src.ACT_ORDLINE, 
                    src.ACT_ORDRTYPE, 
                    src.ACT_ORDTYPE, 
                    src.ACT_OT, 
                    src.ACT_OTRATE, 
                    src.ACT_PARENT, 
                    src.ACT_PERCOMPLETE, 
                    src.ACT_PERFORMBY2RESP, 
                    src.ACT_PERFORMBYRESP, 
                    src.ACT_PERFORMED, 
                    src.ACT_PERFORMED2, 
                    src.ACT_PERFORMEDBY, 
                    src.ACT_PERFORMEDBY2, 
                    src.ACT_PERFORMEDTYPE, 
                    src.ACT_PERFORMEDTYPE2, 
                    src.ACT_PERRESP, 
                    src.ACT_PERSONS, 
                    src.ACT_PLANNINGLEVEL, 
                    src.ACT_PROJBUD, 
                    src.ACT_PROJECT, 
                    src.ACT_PURRATE, 
                    src.ACT_QTY, 
                    src.ACT_REJECTPERFORMEDBY, 
                    src.ACT_REJECTPERFORMEDBY2, 
                    src.ACT_REJECTREASON, 
                    src.ACT_RELATEDWO, 
                    src.ACT_REM, 
                    src.ACT_REQ, 
                    src.ACT_REQLINE, 
                    src.ACT_REVIEWED, 
                    src.ACT_REVIEWEDBY, 
                    src.ACT_REVIEWEDTYPE, 
                    src.ACT_REVIEWRESP, 
                    src.ACT_ROUTE, 
                    src.ACT_RPC, 
                    src.ACT_SCHEDHRS, 
                    src.ACT_SCHEDULINGSESSIONID, 
                    src.ACT_SCHEDULINGSESSIONTYPE, 
                    src.ACT_SEQ, 
                    src.ACT_SHIFT, 
                    src.ACT_SOURCECODE, 
                    src.ACT_SOURCESYSTEM, 
                    src.ACT_SPECIAL, 
                    src.ACT_START, 
                    src.ACT_SUPPLIER, 
                    src.ACT_SUPPLIER_ORG, 
                    src.ACT_SYSLEVEL, 
                    src.ACT_TASK, 
                    src.ACT_TASKREV, 
                    src.ACT_TIME, 
                    src.ACT_TOGEOREF, 
                    src.ACT_TOPOINT, 
                    src.ACT_TOPPARENT, 
                    src.ACT_TOREFDESC, 
                    src.ACT_TO_HORIZONTAL_OFFSET, 
                    src.ACT_TO_HORIZONTAL_OFFSETTYPE, 
                    src.ACT_TO_HORIZONTAL_OFFSETUOM, 
                    src.ACT_TO_LATITUDE, 
                    src.ACT_TO_LONGITUDE, 
                    src.ACT_TO_OFFSET, 
                    src.ACT_TO_OFFSET_DIRECTION, 
                    src.ACT_TO_OFFSET_PERCENTAGE, 
                    src.ACT_TO_REFERENCE, 
                    src.ACT_TO_RELATIONSHIP_TYPE, 
                    src.ACT_TO_VERTICAL_OFFSET, 
                    src.ACT_TO_VERTICAL_OFFSETTYPE, 
                    src.ACT_TO_VERTICAL_OFFSETUOM, 
                    src.ACT_TO_XCOORDINATE, 
                    src.ACT_TO_YCOORDINATE, 
                    src.ACT_TPF, 
                    src.ACT_TRADE, 
                    src.ACT_UDFCHAR01, 
                    src.ACT_UDFCHAR02, 
                    src.ACT_UDFCHAR03, 
                    src.ACT_UDFCHAR04, 
                    src.ACT_UDFCHAR05, 
                    src.ACT_UDFCHAR06, 
                    src.ACT_UDFCHAR07, 
                    src.ACT_UDFCHAR08, 
                    src.ACT_UDFCHAR09, 
                    src.ACT_UDFCHAR10, 
                    src.ACT_UDFCHAR11, 
                    src.ACT_UDFCHAR12, 
                    src.ACT_UDFCHAR13, 
                    src.ACT_UDFCHAR14, 
                    src.ACT_UDFCHAR15, 
                    src.ACT_UDFCHAR16, 
                    src.ACT_UDFCHAR17, 
                    src.ACT_UDFCHAR18, 
                    src.ACT_UDFCHAR19, 
                    src.ACT_UDFCHAR20, 
                    src.ACT_UDFCHAR21, 
                    src.ACT_UDFCHAR22, 
                    src.ACT_UDFCHAR23, 
                    src.ACT_UDFCHAR24, 
                    src.ACT_UDFCHAR25, 
                    src.ACT_UDFCHAR26, 
                    src.ACT_UDFCHAR27, 
                    src.ACT_UDFCHAR28, 
                    src.ACT_UDFCHAR29, 
                    src.ACT_UDFCHAR30, 
                    src.ACT_UDFCHKBOX01, 
                    src.ACT_UDFCHKBOX02, 
                    src.ACT_UDFCHKBOX03, 
                    src.ACT_UDFCHKBOX04, 
                    src.ACT_UDFCHKBOX05, 
                    src.ACT_UDFDATE01, 
                    src.ACT_UDFDATE02, 
                    src.ACT_UDFDATE03, 
                    src.ACT_UDFDATE04, 
                    src.ACT_UDFDATE05, 
                    src.ACT_UDFNOTE01, 
                    src.ACT_UDFNOTE02, 
                    src.ACT_UDFNUM01, 
                    src.ACT_UDFNUM02, 
                    src.ACT_UDFNUM03, 
                    src.ACT_UDFNUM04, 
                    src.ACT_UDFNUM05, 
                    src.ACT_UOM, 
                    src.ACT_UPDATECOUNT, 
                    src.ACT_WAP, 
                    src.ACT_WARRANTY, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;