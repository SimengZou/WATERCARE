create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5ORLREVISIONS()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5ORLREVISIONS_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5ORLREVISIONS as target using (SELECT * FROM (SELECT 
            strm.OLR_ACD, 
            strm.OLR_ACT, 
            strm.OLR_ACTIVE, 
            strm.OLR_ALLOWPREPAYMENT, 
            strm.OLR_ATTENTIONTO, 
            strm.OLR_BLANKETLINE, 
            strm.OLR_BLANKETORDER, 
            strm.OLR_CONTRACT, 
            strm.OLR_COSTCODE, 
            strm.OLR_CURR, 
            strm.OLR_DCKRECVQTY, 
            strm.OLR_DELADDRESS, 
            strm.OLR_DISCPERC, 
            strm.OLR_DUE, 
            strm.OLR_EVENT, 
            strm.OLR_EXCH, 
            strm.OLR_EXCHFIX, 
            strm.OLR_EXCHFROMDUAL, 
            strm.OLR_EXCHTODUAL, 
            strm.OLR_INSPECT, 
            strm.OLR_INTERFACE, 
            strm.OLR_INVQTY, 
            strm.OLR_INVVALUE, 
            strm.OLR_IPCURRPRICE, 
            strm.OLR_IPERROR, 
            strm.OLR_IPERRORMESSAGE, 
            strm.OLR_IPTRANSMITTED, 
            strm.OLR_LASTSAVED, 
            strm.OLR_LONGDESCRIPTION, 
            strm.OLR_MANUFACTPART, 
            strm.OLR_MANUFACTURER, 
            strm.OLR_MULTIPLY, 
            strm.OLR_NOTE, 
            strm.OLR_ORDER, 
            strm.OLR_ORDER_ORG, 
            strm.OLR_ORDLINE, 
            strm.OLR_ORDQTY, 
            strm.OLR_PACKAGETRACKINGNUMBER, 
            strm.OLR_PART, 
            strm.OLR_PART_ORG, 
            strm.OLR_PAYMENTNUMBER, 
            strm.OLR_PRICE, 
            strm.OLR_PROJBUD, 
            strm.OLR_PROJECT, 
            strm.OLR_PURUOM, 
            strm.OLR_QUOTID, 
            strm.OLR_QUOTLINE, 
            strm.OLR_RECVQTY, 
            strm.OLR_RECVTASKQTY, 
            strm.OLR_RECVVALUE, 
            strm.OLR_REF, 
            strm.OLR_RELATEDWO, 
            strm.OLR_REQ, 
            strm.OLR_REQLINE, 
            strm.OLR_REVISED, 
            strm.OLR_REVISEDBY, 
            strm.OLR_REVISEDLINE, 
            strm.OLR_REVISION, 
            strm.OLR_RSTATUS, 
            strm.OLR_RTYPE, 
            strm.OLR_SCRAPQTY, 
            strm.OLR_SOURCECODE, 
            strm.OLR_SOURCESYSTEM, 
            strm.OLR_STATUS, 
            strm.OLR_STORE, 
            strm.OLR_SUPPLIER, 
            strm.OLR_SUPPLIER_ORG, 
            strm.OLR_TASK, 
            strm.OLR_TASKQTY, 
            strm.OLR_TASKREV, 
            strm.OLR_TAX, 
            strm.OLR_TAX2, 
            strm.OLR_TOTEXTRA, 
            strm.OLR_TOTTAXAMOUNT, 
            strm.OLR_TRADE, 
            strm.OLR_TYPE, 
            strm.OLR_UDFCHAR01, 
            strm.OLR_UDFCHAR02, 
            strm.OLR_UDFCHAR03, 
            strm.OLR_UDFCHAR04, 
            strm.OLR_UDFCHAR05, 
            strm.OLR_UDFCHAR06, 
            strm.OLR_UDFCHAR07, 
            strm.OLR_UDFCHAR08, 
            strm.OLR_UDFCHAR09, 
            strm.OLR_UDFCHAR10, 
            strm.OLR_UDFCHAR11, 
            strm.OLR_UDFCHAR12, 
            strm.OLR_UDFCHAR13, 
            strm.OLR_UDFCHAR14, 
            strm.OLR_UDFCHAR15, 
            strm.OLR_UDFCHAR16, 
            strm.OLR_UDFCHAR17, 
            strm.OLR_UDFCHAR18, 
            strm.OLR_UDFCHAR19, 
            strm.OLR_UDFCHAR20, 
            strm.OLR_UDFCHAR21, 
            strm.OLR_UDFCHAR22, 
            strm.OLR_UDFCHAR23, 
            strm.OLR_UDFCHAR24, 
            strm.OLR_UDFCHAR25, 
            strm.OLR_UDFCHAR26, 
            strm.OLR_UDFCHAR27, 
            strm.OLR_UDFCHAR28, 
            strm.OLR_UDFCHAR29, 
            strm.OLR_UDFCHAR30, 
            strm.OLR_UDFCHKBOX01, 
            strm.OLR_UDFCHKBOX02, 
            strm.OLR_UDFCHKBOX03, 
            strm.OLR_UDFCHKBOX04, 
            strm.OLR_UDFCHKBOX05, 
            strm.OLR_UDFDATE01, 
            strm.OLR_UDFDATE02, 
            strm.OLR_UDFDATE03, 
            strm.OLR_UDFDATE04, 
            strm.OLR_UDFDATE05, 
            strm.OLR_UDFNUM01, 
            strm.OLR_UDFNUM02, 
            strm.OLR_UDFNUM03, 
            strm.OLR_UDFNUM04, 
            strm.OLR_UDFNUM05, 
            strm.OLR_UPDATECOUNT, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.OLR_ORDER,
            strm.OLR_ORDER_ORG,
            strm.OLR_REVISION,
            strm.OLR_ORDLINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ORLREVISIONS as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.OLR_ORDER=src.OLR_ORDER) OR (target.OLR_ORDER IS NULL AND src.OLR_ORDER IS NULL)) AND
            ((target.OLR_ORDER_ORG=src.OLR_ORDER_ORG) OR (target.OLR_ORDER_ORG IS NULL AND src.OLR_ORDER_ORG IS NULL)) AND
            ((target.OLR_REVISION=src.OLR_REVISION) OR (target.OLR_REVISION IS NULL AND src.OLR_REVISION IS NULL)) AND
            ((target.OLR_ORDLINE=src.OLR_ORDLINE) OR (target.OLR_ORDLINE IS NULL AND src.OLR_ORDLINE IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.OLR_ACD=src.OLR_ACD, 
                    target.OLR_ACT=src.OLR_ACT, 
                    target.OLR_ACTIVE=src.OLR_ACTIVE, 
                    target.OLR_ALLOWPREPAYMENT=src.OLR_ALLOWPREPAYMENT, 
                    target.OLR_ATTENTIONTO=src.OLR_ATTENTIONTO, 
                    target.OLR_BLANKETLINE=src.OLR_BLANKETLINE, 
                    target.OLR_BLANKETORDER=src.OLR_BLANKETORDER, 
                    target.OLR_CONTRACT=src.OLR_CONTRACT, 
                    target.OLR_COSTCODE=src.OLR_COSTCODE, 
                    target.OLR_CURR=src.OLR_CURR, 
                    target.OLR_DCKRECVQTY=src.OLR_DCKRECVQTY, 
                    target.OLR_DELADDRESS=src.OLR_DELADDRESS, 
                    target.OLR_DISCPERC=src.OLR_DISCPERC, 
                    target.OLR_DUE=src.OLR_DUE, 
                    target.OLR_EVENT=src.OLR_EVENT, 
                    target.OLR_EXCH=src.OLR_EXCH, 
                    target.OLR_EXCHFIX=src.OLR_EXCHFIX, 
                    target.OLR_EXCHFROMDUAL=src.OLR_EXCHFROMDUAL, 
                    target.OLR_EXCHTODUAL=src.OLR_EXCHTODUAL, 
                    target.OLR_INSPECT=src.OLR_INSPECT, 
                    target.OLR_INTERFACE=src.OLR_INTERFACE, 
                    target.OLR_INVQTY=src.OLR_INVQTY, 
                    target.OLR_INVVALUE=src.OLR_INVVALUE, 
                    target.OLR_IPCURRPRICE=src.OLR_IPCURRPRICE, 
                    target.OLR_IPERROR=src.OLR_IPERROR, 
                    target.OLR_IPERRORMESSAGE=src.OLR_IPERRORMESSAGE, 
                    target.OLR_IPTRANSMITTED=src.OLR_IPTRANSMITTED, 
                    target.OLR_LASTSAVED=src.OLR_LASTSAVED, 
                    target.OLR_LONGDESCRIPTION=src.OLR_LONGDESCRIPTION, 
                    target.OLR_MANUFACTPART=src.OLR_MANUFACTPART, 
                    target.OLR_MANUFACTURER=src.OLR_MANUFACTURER, 
                    target.OLR_MULTIPLY=src.OLR_MULTIPLY, 
                    target.OLR_NOTE=src.OLR_NOTE, 
                    target.OLR_ORDER=src.OLR_ORDER, 
                    target.OLR_ORDER_ORG=src.OLR_ORDER_ORG, 
                    target.OLR_ORDLINE=src.OLR_ORDLINE, 
                    target.OLR_ORDQTY=src.OLR_ORDQTY, 
                    target.OLR_PACKAGETRACKINGNUMBER=src.OLR_PACKAGETRACKINGNUMBER, 
                    target.OLR_PART=src.OLR_PART, 
                    target.OLR_PART_ORG=src.OLR_PART_ORG, 
                    target.OLR_PAYMENTNUMBER=src.OLR_PAYMENTNUMBER, 
                    target.OLR_PRICE=src.OLR_PRICE, 
                    target.OLR_PROJBUD=src.OLR_PROJBUD, 
                    target.OLR_PROJECT=src.OLR_PROJECT, 
                    target.OLR_PURUOM=src.OLR_PURUOM, 
                    target.OLR_QUOTID=src.OLR_QUOTID, 
                    target.OLR_QUOTLINE=src.OLR_QUOTLINE, 
                    target.OLR_RECVQTY=src.OLR_RECVQTY, 
                    target.OLR_RECVTASKQTY=src.OLR_RECVTASKQTY, 
                    target.OLR_RECVVALUE=src.OLR_RECVVALUE, 
                    target.OLR_REF=src.OLR_REF, 
                    target.OLR_RELATEDWO=src.OLR_RELATEDWO, 
                    target.OLR_REQ=src.OLR_REQ, 
                    target.OLR_REQLINE=src.OLR_REQLINE, 
                    target.OLR_REVISED=src.OLR_REVISED, 
                    target.OLR_REVISEDBY=src.OLR_REVISEDBY, 
                    target.OLR_REVISEDLINE=src.OLR_REVISEDLINE, 
                    target.OLR_REVISION=src.OLR_REVISION, 
                    target.OLR_RSTATUS=src.OLR_RSTATUS, 
                    target.OLR_RTYPE=src.OLR_RTYPE, 
                    target.OLR_SCRAPQTY=src.OLR_SCRAPQTY, 
                    target.OLR_SOURCECODE=src.OLR_SOURCECODE, 
                    target.OLR_SOURCESYSTEM=src.OLR_SOURCESYSTEM, 
                    target.OLR_STATUS=src.OLR_STATUS, 
                    target.OLR_STORE=src.OLR_STORE, 
                    target.OLR_SUPPLIER=src.OLR_SUPPLIER, 
                    target.OLR_SUPPLIER_ORG=src.OLR_SUPPLIER_ORG, 
                    target.OLR_TASK=src.OLR_TASK, 
                    target.OLR_TASKQTY=src.OLR_TASKQTY, 
                    target.OLR_TASKREV=src.OLR_TASKREV, 
                    target.OLR_TAX=src.OLR_TAX, 
                    target.OLR_TAX2=src.OLR_TAX2, 
                    target.OLR_TOTEXTRA=src.OLR_TOTEXTRA, 
                    target.OLR_TOTTAXAMOUNT=src.OLR_TOTTAXAMOUNT, 
                    target.OLR_TRADE=src.OLR_TRADE, 
                    target.OLR_TYPE=src.OLR_TYPE, 
                    target.OLR_UDFCHAR01=src.OLR_UDFCHAR01, 
                    target.OLR_UDFCHAR02=src.OLR_UDFCHAR02, 
                    target.OLR_UDFCHAR03=src.OLR_UDFCHAR03, 
                    target.OLR_UDFCHAR04=src.OLR_UDFCHAR04, 
                    target.OLR_UDFCHAR05=src.OLR_UDFCHAR05, 
                    target.OLR_UDFCHAR06=src.OLR_UDFCHAR06, 
                    target.OLR_UDFCHAR07=src.OLR_UDFCHAR07, 
                    target.OLR_UDFCHAR08=src.OLR_UDFCHAR08, 
                    target.OLR_UDFCHAR09=src.OLR_UDFCHAR09, 
                    target.OLR_UDFCHAR10=src.OLR_UDFCHAR10, 
                    target.OLR_UDFCHAR11=src.OLR_UDFCHAR11, 
                    target.OLR_UDFCHAR12=src.OLR_UDFCHAR12, 
                    target.OLR_UDFCHAR13=src.OLR_UDFCHAR13, 
                    target.OLR_UDFCHAR14=src.OLR_UDFCHAR14, 
                    target.OLR_UDFCHAR15=src.OLR_UDFCHAR15, 
                    target.OLR_UDFCHAR16=src.OLR_UDFCHAR16, 
                    target.OLR_UDFCHAR17=src.OLR_UDFCHAR17, 
                    target.OLR_UDFCHAR18=src.OLR_UDFCHAR18, 
                    target.OLR_UDFCHAR19=src.OLR_UDFCHAR19, 
                    target.OLR_UDFCHAR20=src.OLR_UDFCHAR20, 
                    target.OLR_UDFCHAR21=src.OLR_UDFCHAR21, 
                    target.OLR_UDFCHAR22=src.OLR_UDFCHAR22, 
                    target.OLR_UDFCHAR23=src.OLR_UDFCHAR23, 
                    target.OLR_UDFCHAR24=src.OLR_UDFCHAR24, 
                    target.OLR_UDFCHAR25=src.OLR_UDFCHAR25, 
                    target.OLR_UDFCHAR26=src.OLR_UDFCHAR26, 
                    target.OLR_UDFCHAR27=src.OLR_UDFCHAR27, 
                    target.OLR_UDFCHAR28=src.OLR_UDFCHAR28, 
                    target.OLR_UDFCHAR29=src.OLR_UDFCHAR29, 
                    target.OLR_UDFCHAR30=src.OLR_UDFCHAR30, 
                    target.OLR_UDFCHKBOX01=src.OLR_UDFCHKBOX01, 
                    target.OLR_UDFCHKBOX02=src.OLR_UDFCHKBOX02, 
                    target.OLR_UDFCHKBOX03=src.OLR_UDFCHKBOX03, 
                    target.OLR_UDFCHKBOX04=src.OLR_UDFCHKBOX04, 
                    target.OLR_UDFCHKBOX05=src.OLR_UDFCHKBOX05, 
                    target.OLR_UDFDATE01=src.OLR_UDFDATE01, 
                    target.OLR_UDFDATE02=src.OLR_UDFDATE02, 
                    target.OLR_UDFDATE03=src.OLR_UDFDATE03, 
                    target.OLR_UDFDATE04=src.OLR_UDFDATE04, 
                    target.OLR_UDFDATE05=src.OLR_UDFDATE05, 
                    target.OLR_UDFNUM01=src.OLR_UDFNUM01, 
                    target.OLR_UDFNUM02=src.OLR_UDFNUM02, 
                    target.OLR_UDFNUM03=src.OLR_UDFNUM03, 
                    target.OLR_UDFNUM04=src.OLR_UDFNUM04, 
                    target.OLR_UDFNUM05=src.OLR_UDFNUM05, 
                    target.OLR_UPDATECOUNT=src.OLR_UPDATECOUNT, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    OLR_ACD, 
                    OLR_ACT, 
                    OLR_ACTIVE, 
                    OLR_ALLOWPREPAYMENT, 
                    OLR_ATTENTIONTO, 
                    OLR_BLANKETLINE, 
                    OLR_BLANKETORDER, 
                    OLR_CONTRACT, 
                    OLR_COSTCODE, 
                    OLR_CURR, 
                    OLR_DCKRECVQTY, 
                    OLR_DELADDRESS, 
                    OLR_DISCPERC, 
                    OLR_DUE, 
                    OLR_EVENT, 
                    OLR_EXCH, 
                    OLR_EXCHFIX, 
                    OLR_EXCHFROMDUAL, 
                    OLR_EXCHTODUAL, 
                    OLR_INSPECT, 
                    OLR_INTERFACE, 
                    OLR_INVQTY, 
                    OLR_INVVALUE, 
                    OLR_IPCURRPRICE, 
                    OLR_IPERROR, 
                    OLR_IPERRORMESSAGE, 
                    OLR_IPTRANSMITTED, 
                    OLR_LASTSAVED, 
                    OLR_LONGDESCRIPTION, 
                    OLR_MANUFACTPART, 
                    OLR_MANUFACTURER, 
                    OLR_MULTIPLY, 
                    OLR_NOTE, 
                    OLR_ORDER, 
                    OLR_ORDER_ORG, 
                    OLR_ORDLINE, 
                    OLR_ORDQTY, 
                    OLR_PACKAGETRACKINGNUMBER, 
                    OLR_PART, 
                    OLR_PART_ORG, 
                    OLR_PAYMENTNUMBER, 
                    OLR_PRICE, 
                    OLR_PROJBUD, 
                    OLR_PROJECT, 
                    OLR_PURUOM, 
                    OLR_QUOTID, 
                    OLR_QUOTLINE, 
                    OLR_RECVQTY, 
                    OLR_RECVTASKQTY, 
                    OLR_RECVVALUE, 
                    OLR_REF, 
                    OLR_RELATEDWO, 
                    OLR_REQ, 
                    OLR_REQLINE, 
                    OLR_REVISED, 
                    OLR_REVISEDBY, 
                    OLR_REVISEDLINE, 
                    OLR_REVISION, 
                    OLR_RSTATUS, 
                    OLR_RTYPE, 
                    OLR_SCRAPQTY, 
                    OLR_SOURCECODE, 
                    OLR_SOURCESYSTEM, 
                    OLR_STATUS, 
                    OLR_STORE, 
                    OLR_SUPPLIER, 
                    OLR_SUPPLIER_ORG, 
                    OLR_TASK, 
                    OLR_TASKQTY, 
                    OLR_TASKREV, 
                    OLR_TAX, 
                    OLR_TAX2, 
                    OLR_TOTEXTRA, 
                    OLR_TOTTAXAMOUNT, 
                    OLR_TRADE, 
                    OLR_TYPE, 
                    OLR_UDFCHAR01, 
                    OLR_UDFCHAR02, 
                    OLR_UDFCHAR03, 
                    OLR_UDFCHAR04, 
                    OLR_UDFCHAR05, 
                    OLR_UDFCHAR06, 
                    OLR_UDFCHAR07, 
                    OLR_UDFCHAR08, 
                    OLR_UDFCHAR09, 
                    OLR_UDFCHAR10, 
                    OLR_UDFCHAR11, 
                    OLR_UDFCHAR12, 
                    OLR_UDFCHAR13, 
                    OLR_UDFCHAR14, 
                    OLR_UDFCHAR15, 
                    OLR_UDFCHAR16, 
                    OLR_UDFCHAR17, 
                    OLR_UDFCHAR18, 
                    OLR_UDFCHAR19, 
                    OLR_UDFCHAR20, 
                    OLR_UDFCHAR21, 
                    OLR_UDFCHAR22, 
                    OLR_UDFCHAR23, 
                    OLR_UDFCHAR24, 
                    OLR_UDFCHAR25, 
                    OLR_UDFCHAR26, 
                    OLR_UDFCHAR27, 
                    OLR_UDFCHAR28, 
                    OLR_UDFCHAR29, 
                    OLR_UDFCHAR30, 
                    OLR_UDFCHKBOX01, 
                    OLR_UDFCHKBOX02, 
                    OLR_UDFCHKBOX03, 
                    OLR_UDFCHKBOX04, 
                    OLR_UDFCHKBOX05, 
                    OLR_UDFDATE01, 
                    OLR_UDFDATE02, 
                    OLR_UDFDATE03, 
                    OLR_UDFDATE04, 
                    OLR_UDFDATE05, 
                    OLR_UDFNUM01, 
                    OLR_UDFNUM02, 
                    OLR_UDFNUM03, 
                    OLR_UDFNUM04, 
                    OLR_UDFNUM05, 
                    OLR_UPDATECOUNT, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.OLR_ACD, 
                    src.OLR_ACT, 
                    src.OLR_ACTIVE, 
                    src.OLR_ALLOWPREPAYMENT, 
                    src.OLR_ATTENTIONTO, 
                    src.OLR_BLANKETLINE, 
                    src.OLR_BLANKETORDER, 
                    src.OLR_CONTRACT, 
                    src.OLR_COSTCODE, 
                    src.OLR_CURR, 
                    src.OLR_DCKRECVQTY, 
                    src.OLR_DELADDRESS, 
                    src.OLR_DISCPERC, 
                    src.OLR_DUE, 
                    src.OLR_EVENT, 
                    src.OLR_EXCH, 
                    src.OLR_EXCHFIX, 
                    src.OLR_EXCHFROMDUAL, 
                    src.OLR_EXCHTODUAL, 
                    src.OLR_INSPECT, 
                    src.OLR_INTERFACE, 
                    src.OLR_INVQTY, 
                    src.OLR_INVVALUE, 
                    src.OLR_IPCURRPRICE, 
                    src.OLR_IPERROR, 
                    src.OLR_IPERRORMESSAGE, 
                    src.OLR_IPTRANSMITTED, 
                    src.OLR_LASTSAVED, 
                    src.OLR_LONGDESCRIPTION, 
                    src.OLR_MANUFACTPART, 
                    src.OLR_MANUFACTURER, 
                    src.OLR_MULTIPLY, 
                    src.OLR_NOTE, 
                    src.OLR_ORDER, 
                    src.OLR_ORDER_ORG, 
                    src.OLR_ORDLINE, 
                    src.OLR_ORDQTY, 
                    src.OLR_PACKAGETRACKINGNUMBER, 
                    src.OLR_PART, 
                    src.OLR_PART_ORG, 
                    src.OLR_PAYMENTNUMBER, 
                    src.OLR_PRICE, 
                    src.OLR_PROJBUD, 
                    src.OLR_PROJECT, 
                    src.OLR_PURUOM, 
                    src.OLR_QUOTID, 
                    src.OLR_QUOTLINE, 
                    src.OLR_RECVQTY, 
                    src.OLR_RECVTASKQTY, 
                    src.OLR_RECVVALUE, 
                    src.OLR_REF, 
                    src.OLR_RELATEDWO, 
                    src.OLR_REQ, 
                    src.OLR_REQLINE, 
                    src.OLR_REVISED, 
                    src.OLR_REVISEDBY, 
                    src.OLR_REVISEDLINE, 
                    src.OLR_REVISION, 
                    src.OLR_RSTATUS, 
                    src.OLR_RTYPE, 
                    src.OLR_SCRAPQTY, 
                    src.OLR_SOURCECODE, 
                    src.OLR_SOURCESYSTEM, 
                    src.OLR_STATUS, 
                    src.OLR_STORE, 
                    src.OLR_SUPPLIER, 
                    src.OLR_SUPPLIER_ORG, 
                    src.OLR_TASK, 
                    src.OLR_TASKQTY, 
                    src.OLR_TASKREV, 
                    src.OLR_TAX, 
                    src.OLR_TAX2, 
                    src.OLR_TOTEXTRA, 
                    src.OLR_TOTTAXAMOUNT, 
                    src.OLR_TRADE, 
                    src.OLR_TYPE, 
                    src.OLR_UDFCHAR01, 
                    src.OLR_UDFCHAR02, 
                    src.OLR_UDFCHAR03, 
                    src.OLR_UDFCHAR04, 
                    src.OLR_UDFCHAR05, 
                    src.OLR_UDFCHAR06, 
                    src.OLR_UDFCHAR07, 
                    src.OLR_UDFCHAR08, 
                    src.OLR_UDFCHAR09, 
                    src.OLR_UDFCHAR10, 
                    src.OLR_UDFCHAR11, 
                    src.OLR_UDFCHAR12, 
                    src.OLR_UDFCHAR13, 
                    src.OLR_UDFCHAR14, 
                    src.OLR_UDFCHAR15, 
                    src.OLR_UDFCHAR16, 
                    src.OLR_UDFCHAR17, 
                    src.OLR_UDFCHAR18, 
                    src.OLR_UDFCHAR19, 
                    src.OLR_UDFCHAR20, 
                    src.OLR_UDFCHAR21, 
                    src.OLR_UDFCHAR22, 
                    src.OLR_UDFCHAR23, 
                    src.OLR_UDFCHAR24, 
                    src.OLR_UDFCHAR25, 
                    src.OLR_UDFCHAR26, 
                    src.OLR_UDFCHAR27, 
                    src.OLR_UDFCHAR28, 
                    src.OLR_UDFCHAR29, 
                    src.OLR_UDFCHAR30, 
                    src.OLR_UDFCHKBOX01, 
                    src.OLR_UDFCHKBOX02, 
                    src.OLR_UDFCHKBOX03, 
                    src.OLR_UDFCHKBOX04, 
                    src.OLR_UDFCHKBOX05, 
                    src.OLR_UDFDATE01, 
                    src.OLR_UDFDATE02, 
                    src.OLR_UDFDATE03, 
                    src.OLR_UDFDATE04, 
                    src.OLR_UDFDATE05, 
                    src.OLR_UDFNUM01, 
                    src.OLR_UDFNUM02, 
                    src.OLR_UDFNUM03, 
                    src.OLR_UDFNUM04, 
                    src.OLR_UDFNUM05, 
                    src.OLR_UPDATECOUNT, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5ORLREVISIONS_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.OLR_ACD, 
            strm.OLR_ACT, 
            strm.OLR_ACTIVE, 
            strm.OLR_ALLOWPREPAYMENT, 
            strm.OLR_ATTENTIONTO, 
            strm.OLR_BLANKETLINE, 
            strm.OLR_BLANKETORDER, 
            strm.OLR_CONTRACT, 
            strm.OLR_COSTCODE, 
            strm.OLR_CURR, 
            strm.OLR_DCKRECVQTY, 
            strm.OLR_DELADDRESS, 
            strm.OLR_DISCPERC, 
            strm.OLR_DUE, 
            strm.OLR_EVENT, 
            strm.OLR_EXCH, 
            strm.OLR_EXCHFIX, 
            strm.OLR_EXCHFROMDUAL, 
            strm.OLR_EXCHTODUAL, 
            strm.OLR_INSPECT, 
            strm.OLR_INTERFACE, 
            strm.OLR_INVQTY, 
            strm.OLR_INVVALUE, 
            strm.OLR_IPCURRPRICE, 
            strm.OLR_IPERROR, 
            strm.OLR_IPERRORMESSAGE, 
            strm.OLR_IPTRANSMITTED, 
            strm.OLR_LASTSAVED, 
            strm.OLR_LONGDESCRIPTION, 
            strm.OLR_MANUFACTPART, 
            strm.OLR_MANUFACTURER, 
            strm.OLR_MULTIPLY, 
            strm.OLR_NOTE, 
            strm.OLR_ORDER, 
            strm.OLR_ORDER_ORG, 
            strm.OLR_ORDLINE, 
            strm.OLR_ORDQTY, 
            strm.OLR_PACKAGETRACKINGNUMBER, 
            strm.OLR_PART, 
            strm.OLR_PART_ORG, 
            strm.OLR_PAYMENTNUMBER, 
            strm.OLR_PRICE, 
            strm.OLR_PROJBUD, 
            strm.OLR_PROJECT, 
            strm.OLR_PURUOM, 
            strm.OLR_QUOTID, 
            strm.OLR_QUOTLINE, 
            strm.OLR_RECVQTY, 
            strm.OLR_RECVTASKQTY, 
            strm.OLR_RECVVALUE, 
            strm.OLR_REF, 
            strm.OLR_RELATEDWO, 
            strm.OLR_REQ, 
            strm.OLR_REQLINE, 
            strm.OLR_REVISED, 
            strm.OLR_REVISEDBY, 
            strm.OLR_REVISEDLINE, 
            strm.OLR_REVISION, 
            strm.OLR_RSTATUS, 
            strm.OLR_RTYPE, 
            strm.OLR_SCRAPQTY, 
            strm.OLR_SOURCECODE, 
            strm.OLR_SOURCESYSTEM, 
            strm.OLR_STATUS, 
            strm.OLR_STORE, 
            strm.OLR_SUPPLIER, 
            strm.OLR_SUPPLIER_ORG, 
            strm.OLR_TASK, 
            strm.OLR_TASKQTY, 
            strm.OLR_TASKREV, 
            strm.OLR_TAX, 
            strm.OLR_TAX2, 
            strm.OLR_TOTEXTRA, 
            strm.OLR_TOTTAXAMOUNT, 
            strm.OLR_TRADE, 
            strm.OLR_TYPE, 
            strm.OLR_UDFCHAR01, 
            strm.OLR_UDFCHAR02, 
            strm.OLR_UDFCHAR03, 
            strm.OLR_UDFCHAR04, 
            strm.OLR_UDFCHAR05, 
            strm.OLR_UDFCHAR06, 
            strm.OLR_UDFCHAR07, 
            strm.OLR_UDFCHAR08, 
            strm.OLR_UDFCHAR09, 
            strm.OLR_UDFCHAR10, 
            strm.OLR_UDFCHAR11, 
            strm.OLR_UDFCHAR12, 
            strm.OLR_UDFCHAR13, 
            strm.OLR_UDFCHAR14, 
            strm.OLR_UDFCHAR15, 
            strm.OLR_UDFCHAR16, 
            strm.OLR_UDFCHAR17, 
            strm.OLR_UDFCHAR18, 
            strm.OLR_UDFCHAR19, 
            strm.OLR_UDFCHAR20, 
            strm.OLR_UDFCHAR21, 
            strm.OLR_UDFCHAR22, 
            strm.OLR_UDFCHAR23, 
            strm.OLR_UDFCHAR24, 
            strm.OLR_UDFCHAR25, 
            strm.OLR_UDFCHAR26, 
            strm.OLR_UDFCHAR27, 
            strm.OLR_UDFCHAR28, 
            strm.OLR_UDFCHAR29, 
            strm.OLR_UDFCHAR30, 
            strm.OLR_UDFCHKBOX01, 
            strm.OLR_UDFCHKBOX02, 
            strm.OLR_UDFCHKBOX03, 
            strm.OLR_UDFCHKBOX04, 
            strm.OLR_UDFCHKBOX05, 
            strm.OLR_UDFDATE01, 
            strm.OLR_UDFDATE02, 
            strm.OLR_UDFDATE03, 
            strm.OLR_UDFDATE04, 
            strm.OLR_UDFDATE05, 
            strm.OLR_UDFNUM01, 
            strm.OLR_UDFNUM02, 
            strm.OLR_UDFNUM03, 
            strm.OLR_UDFNUM04, 
            strm.OLR_UDFNUM05, 
            strm.OLR_UPDATECOUNT, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.OLR_ORDER,
            strm.OLR_ORDER_ORG,
            strm.OLR_REVISION,
            strm.OLR_ORDLINE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ORLREVISIONS as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.OLR_ORDER=src.OLR_ORDER) OR (target.OLR_ORDER IS NULL AND src.OLR_ORDER IS NULL)) AND
            ((target.OLR_ORDER_ORG=src.OLR_ORDER_ORG) OR (target.OLR_ORDER_ORG IS NULL AND src.OLR_ORDER_ORG IS NULL)) AND
            ((target.OLR_REVISION=src.OLR_REVISION) OR (target.OLR_REVISION IS NULL AND src.OLR_REVISION IS NULL)) AND
            ((target.OLR_ORDLINE=src.OLR_ORDLINE) OR (target.OLR_ORDLINE IS NULL AND src.OLR_ORDLINE IS NULL)) 
                when matched then update set
                    target.OLR_ACD=src.OLR_ACD, 
                    target.OLR_ACT=src.OLR_ACT, 
                    target.OLR_ACTIVE=src.OLR_ACTIVE, 
                    target.OLR_ALLOWPREPAYMENT=src.OLR_ALLOWPREPAYMENT, 
                    target.OLR_ATTENTIONTO=src.OLR_ATTENTIONTO, 
                    target.OLR_BLANKETLINE=src.OLR_BLANKETLINE, 
                    target.OLR_BLANKETORDER=src.OLR_BLANKETORDER, 
                    target.OLR_CONTRACT=src.OLR_CONTRACT, 
                    target.OLR_COSTCODE=src.OLR_COSTCODE, 
                    target.OLR_CURR=src.OLR_CURR, 
                    target.OLR_DCKRECVQTY=src.OLR_DCKRECVQTY, 
                    target.OLR_DELADDRESS=src.OLR_DELADDRESS, 
                    target.OLR_DISCPERC=src.OLR_DISCPERC, 
                    target.OLR_DUE=src.OLR_DUE, 
                    target.OLR_EVENT=src.OLR_EVENT, 
                    target.OLR_EXCH=src.OLR_EXCH, 
                    target.OLR_EXCHFIX=src.OLR_EXCHFIX, 
                    target.OLR_EXCHFROMDUAL=src.OLR_EXCHFROMDUAL, 
                    target.OLR_EXCHTODUAL=src.OLR_EXCHTODUAL, 
                    target.OLR_INSPECT=src.OLR_INSPECT, 
                    target.OLR_INTERFACE=src.OLR_INTERFACE, 
                    target.OLR_INVQTY=src.OLR_INVQTY, 
                    target.OLR_INVVALUE=src.OLR_INVVALUE, 
                    target.OLR_IPCURRPRICE=src.OLR_IPCURRPRICE, 
                    target.OLR_IPERROR=src.OLR_IPERROR, 
                    target.OLR_IPERRORMESSAGE=src.OLR_IPERRORMESSAGE, 
                    target.OLR_IPTRANSMITTED=src.OLR_IPTRANSMITTED, 
                    target.OLR_LASTSAVED=src.OLR_LASTSAVED, 
                    target.OLR_LONGDESCRIPTION=src.OLR_LONGDESCRIPTION, 
                    target.OLR_MANUFACTPART=src.OLR_MANUFACTPART, 
                    target.OLR_MANUFACTURER=src.OLR_MANUFACTURER, 
                    target.OLR_MULTIPLY=src.OLR_MULTIPLY, 
                    target.OLR_NOTE=src.OLR_NOTE, 
                    target.OLR_ORDER=src.OLR_ORDER, 
                    target.OLR_ORDER_ORG=src.OLR_ORDER_ORG, 
                    target.OLR_ORDLINE=src.OLR_ORDLINE, 
                    target.OLR_ORDQTY=src.OLR_ORDQTY, 
                    target.OLR_PACKAGETRACKINGNUMBER=src.OLR_PACKAGETRACKINGNUMBER, 
                    target.OLR_PART=src.OLR_PART, 
                    target.OLR_PART_ORG=src.OLR_PART_ORG, 
                    target.OLR_PAYMENTNUMBER=src.OLR_PAYMENTNUMBER, 
                    target.OLR_PRICE=src.OLR_PRICE, 
                    target.OLR_PROJBUD=src.OLR_PROJBUD, 
                    target.OLR_PROJECT=src.OLR_PROJECT, 
                    target.OLR_PURUOM=src.OLR_PURUOM, 
                    target.OLR_QUOTID=src.OLR_QUOTID, 
                    target.OLR_QUOTLINE=src.OLR_QUOTLINE, 
                    target.OLR_RECVQTY=src.OLR_RECVQTY, 
                    target.OLR_RECVTASKQTY=src.OLR_RECVTASKQTY, 
                    target.OLR_RECVVALUE=src.OLR_RECVVALUE, 
                    target.OLR_REF=src.OLR_REF, 
                    target.OLR_RELATEDWO=src.OLR_RELATEDWO, 
                    target.OLR_REQ=src.OLR_REQ, 
                    target.OLR_REQLINE=src.OLR_REQLINE, 
                    target.OLR_REVISED=src.OLR_REVISED, 
                    target.OLR_REVISEDBY=src.OLR_REVISEDBY, 
                    target.OLR_REVISEDLINE=src.OLR_REVISEDLINE, 
                    target.OLR_REVISION=src.OLR_REVISION, 
                    target.OLR_RSTATUS=src.OLR_RSTATUS, 
                    target.OLR_RTYPE=src.OLR_RTYPE, 
                    target.OLR_SCRAPQTY=src.OLR_SCRAPQTY, 
                    target.OLR_SOURCECODE=src.OLR_SOURCECODE, 
                    target.OLR_SOURCESYSTEM=src.OLR_SOURCESYSTEM, 
                    target.OLR_STATUS=src.OLR_STATUS, 
                    target.OLR_STORE=src.OLR_STORE, 
                    target.OLR_SUPPLIER=src.OLR_SUPPLIER, 
                    target.OLR_SUPPLIER_ORG=src.OLR_SUPPLIER_ORG, 
                    target.OLR_TASK=src.OLR_TASK, 
                    target.OLR_TASKQTY=src.OLR_TASKQTY, 
                    target.OLR_TASKREV=src.OLR_TASKREV, 
                    target.OLR_TAX=src.OLR_TAX, 
                    target.OLR_TAX2=src.OLR_TAX2, 
                    target.OLR_TOTEXTRA=src.OLR_TOTEXTRA, 
                    target.OLR_TOTTAXAMOUNT=src.OLR_TOTTAXAMOUNT, 
                    target.OLR_TRADE=src.OLR_TRADE, 
                    target.OLR_TYPE=src.OLR_TYPE, 
                    target.OLR_UDFCHAR01=src.OLR_UDFCHAR01, 
                    target.OLR_UDFCHAR02=src.OLR_UDFCHAR02, 
                    target.OLR_UDFCHAR03=src.OLR_UDFCHAR03, 
                    target.OLR_UDFCHAR04=src.OLR_UDFCHAR04, 
                    target.OLR_UDFCHAR05=src.OLR_UDFCHAR05, 
                    target.OLR_UDFCHAR06=src.OLR_UDFCHAR06, 
                    target.OLR_UDFCHAR07=src.OLR_UDFCHAR07, 
                    target.OLR_UDFCHAR08=src.OLR_UDFCHAR08, 
                    target.OLR_UDFCHAR09=src.OLR_UDFCHAR09, 
                    target.OLR_UDFCHAR10=src.OLR_UDFCHAR10, 
                    target.OLR_UDFCHAR11=src.OLR_UDFCHAR11, 
                    target.OLR_UDFCHAR12=src.OLR_UDFCHAR12, 
                    target.OLR_UDFCHAR13=src.OLR_UDFCHAR13, 
                    target.OLR_UDFCHAR14=src.OLR_UDFCHAR14, 
                    target.OLR_UDFCHAR15=src.OLR_UDFCHAR15, 
                    target.OLR_UDFCHAR16=src.OLR_UDFCHAR16, 
                    target.OLR_UDFCHAR17=src.OLR_UDFCHAR17, 
                    target.OLR_UDFCHAR18=src.OLR_UDFCHAR18, 
                    target.OLR_UDFCHAR19=src.OLR_UDFCHAR19, 
                    target.OLR_UDFCHAR20=src.OLR_UDFCHAR20, 
                    target.OLR_UDFCHAR21=src.OLR_UDFCHAR21, 
                    target.OLR_UDFCHAR22=src.OLR_UDFCHAR22, 
                    target.OLR_UDFCHAR23=src.OLR_UDFCHAR23, 
                    target.OLR_UDFCHAR24=src.OLR_UDFCHAR24, 
                    target.OLR_UDFCHAR25=src.OLR_UDFCHAR25, 
                    target.OLR_UDFCHAR26=src.OLR_UDFCHAR26, 
                    target.OLR_UDFCHAR27=src.OLR_UDFCHAR27, 
                    target.OLR_UDFCHAR28=src.OLR_UDFCHAR28, 
                    target.OLR_UDFCHAR29=src.OLR_UDFCHAR29, 
                    target.OLR_UDFCHAR30=src.OLR_UDFCHAR30, 
                    target.OLR_UDFCHKBOX01=src.OLR_UDFCHKBOX01, 
                    target.OLR_UDFCHKBOX02=src.OLR_UDFCHKBOX02, 
                    target.OLR_UDFCHKBOX03=src.OLR_UDFCHKBOX03, 
                    target.OLR_UDFCHKBOX04=src.OLR_UDFCHKBOX04, 
                    target.OLR_UDFCHKBOX05=src.OLR_UDFCHKBOX05, 
                    target.OLR_UDFDATE01=src.OLR_UDFDATE01, 
                    target.OLR_UDFDATE02=src.OLR_UDFDATE02, 
                    target.OLR_UDFDATE03=src.OLR_UDFDATE03, 
                    target.OLR_UDFDATE04=src.OLR_UDFDATE04, 
                    target.OLR_UDFDATE05=src.OLR_UDFDATE05, 
                    target.OLR_UDFNUM01=src.OLR_UDFNUM01, 
                    target.OLR_UDFNUM02=src.OLR_UDFNUM02, 
                    target.OLR_UDFNUM03=src.OLR_UDFNUM03, 
                    target.OLR_UDFNUM04=src.OLR_UDFNUM04, 
                    target.OLR_UDFNUM05=src.OLR_UDFNUM05, 
                    target.OLR_UPDATECOUNT=src.OLR_UPDATECOUNT, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( OLR_ACD, OLR_ACT, OLR_ACTIVE, OLR_ALLOWPREPAYMENT, OLR_ATTENTIONTO, OLR_BLANKETLINE, OLR_BLANKETORDER, OLR_CONTRACT, OLR_COSTCODE, OLR_CURR, OLR_DCKRECVQTY, OLR_DELADDRESS, OLR_DISCPERC, OLR_DUE, OLR_EVENT, OLR_EXCH, OLR_EXCHFIX, OLR_EXCHFROMDUAL, OLR_EXCHTODUAL, OLR_INSPECT, OLR_INTERFACE, OLR_INVQTY, OLR_INVVALUE, OLR_IPCURRPRICE, OLR_IPERROR, OLR_IPERRORMESSAGE, OLR_IPTRANSMITTED, OLR_LASTSAVED, OLR_LONGDESCRIPTION, OLR_MANUFACTPART, OLR_MANUFACTURER, OLR_MULTIPLY, OLR_NOTE, OLR_ORDER, OLR_ORDER_ORG, OLR_ORDLINE, OLR_ORDQTY, OLR_PACKAGETRACKINGNUMBER, OLR_PART, OLR_PART_ORG, OLR_PAYMENTNUMBER, OLR_PRICE, OLR_PROJBUD, OLR_PROJECT, OLR_PURUOM, OLR_QUOTID, OLR_QUOTLINE, OLR_RECVQTY, OLR_RECVTASKQTY, OLR_RECVVALUE, OLR_REF, OLR_RELATEDWO, OLR_REQ, OLR_REQLINE, OLR_REVISED, OLR_REVISEDBY, OLR_REVISEDLINE, OLR_REVISION, OLR_RSTATUS, OLR_RTYPE, OLR_SCRAPQTY, OLR_SOURCECODE, OLR_SOURCESYSTEM, OLR_STATUS, OLR_STORE, OLR_SUPPLIER, OLR_SUPPLIER_ORG, OLR_TASK, OLR_TASKQTY, OLR_TASKREV, OLR_TAX, OLR_TAX2, OLR_TOTEXTRA, OLR_TOTTAXAMOUNT, OLR_TRADE, OLR_TYPE, OLR_UDFCHAR01, OLR_UDFCHAR02, OLR_UDFCHAR03, OLR_UDFCHAR04, OLR_UDFCHAR05, OLR_UDFCHAR06, OLR_UDFCHAR07, OLR_UDFCHAR08, OLR_UDFCHAR09, OLR_UDFCHAR10, OLR_UDFCHAR11, OLR_UDFCHAR12, OLR_UDFCHAR13, OLR_UDFCHAR14, OLR_UDFCHAR15, OLR_UDFCHAR16, OLR_UDFCHAR17, OLR_UDFCHAR18, OLR_UDFCHAR19, OLR_UDFCHAR20, OLR_UDFCHAR21, OLR_UDFCHAR22, OLR_UDFCHAR23, OLR_UDFCHAR24, OLR_UDFCHAR25, OLR_UDFCHAR26, OLR_UDFCHAR27, OLR_UDFCHAR28, OLR_UDFCHAR29, OLR_UDFCHAR30, OLR_UDFCHKBOX01, OLR_UDFCHKBOX02, OLR_UDFCHKBOX03, OLR_UDFCHKBOX04, OLR_UDFCHKBOX05, OLR_UDFDATE01, OLR_UDFDATE02, OLR_UDFDATE03, OLR_UDFDATE04, OLR_UDFDATE05, OLR_UDFNUM01, OLR_UDFNUM02, OLR_UDFNUM03, OLR_UDFNUM04, OLR_UDFNUM05, OLR_UPDATECOUNT, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.OLR_ACD, 
                    src.OLR_ACT, 
                    src.OLR_ACTIVE, 
                    src.OLR_ALLOWPREPAYMENT, 
                    src.OLR_ATTENTIONTO, 
                    src.OLR_BLANKETLINE, 
                    src.OLR_BLANKETORDER, 
                    src.OLR_CONTRACT, 
                    src.OLR_COSTCODE, 
                    src.OLR_CURR, 
                    src.OLR_DCKRECVQTY, 
                    src.OLR_DELADDRESS, 
                    src.OLR_DISCPERC, 
                    src.OLR_DUE, 
                    src.OLR_EVENT, 
                    src.OLR_EXCH, 
                    src.OLR_EXCHFIX, 
                    src.OLR_EXCHFROMDUAL, 
                    src.OLR_EXCHTODUAL, 
                    src.OLR_INSPECT, 
                    src.OLR_INTERFACE, 
                    src.OLR_INVQTY, 
                    src.OLR_INVVALUE, 
                    src.OLR_IPCURRPRICE, 
                    src.OLR_IPERROR, 
                    src.OLR_IPERRORMESSAGE, 
                    src.OLR_IPTRANSMITTED, 
                    src.OLR_LASTSAVED, 
                    src.OLR_LONGDESCRIPTION, 
                    src.OLR_MANUFACTPART, 
                    src.OLR_MANUFACTURER, 
                    src.OLR_MULTIPLY, 
                    src.OLR_NOTE, 
                    src.OLR_ORDER, 
                    src.OLR_ORDER_ORG, 
                    src.OLR_ORDLINE, 
                    src.OLR_ORDQTY, 
                    src.OLR_PACKAGETRACKINGNUMBER, 
                    src.OLR_PART, 
                    src.OLR_PART_ORG, 
                    src.OLR_PAYMENTNUMBER, 
                    src.OLR_PRICE, 
                    src.OLR_PROJBUD, 
                    src.OLR_PROJECT, 
                    src.OLR_PURUOM, 
                    src.OLR_QUOTID, 
                    src.OLR_QUOTLINE, 
                    src.OLR_RECVQTY, 
                    src.OLR_RECVTASKQTY, 
                    src.OLR_RECVVALUE, 
                    src.OLR_REF, 
                    src.OLR_RELATEDWO, 
                    src.OLR_REQ, 
                    src.OLR_REQLINE, 
                    src.OLR_REVISED, 
                    src.OLR_REVISEDBY, 
                    src.OLR_REVISEDLINE, 
                    src.OLR_REVISION, 
                    src.OLR_RSTATUS, 
                    src.OLR_RTYPE, 
                    src.OLR_SCRAPQTY, 
                    src.OLR_SOURCECODE, 
                    src.OLR_SOURCESYSTEM, 
                    src.OLR_STATUS, 
                    src.OLR_STORE, 
                    src.OLR_SUPPLIER, 
                    src.OLR_SUPPLIER_ORG, 
                    src.OLR_TASK, 
                    src.OLR_TASKQTY, 
                    src.OLR_TASKREV, 
                    src.OLR_TAX, 
                    src.OLR_TAX2, 
                    src.OLR_TOTEXTRA, 
                    src.OLR_TOTTAXAMOUNT, 
                    src.OLR_TRADE, 
                    src.OLR_TYPE, 
                    src.OLR_UDFCHAR01, 
                    src.OLR_UDFCHAR02, 
                    src.OLR_UDFCHAR03, 
                    src.OLR_UDFCHAR04, 
                    src.OLR_UDFCHAR05, 
                    src.OLR_UDFCHAR06, 
                    src.OLR_UDFCHAR07, 
                    src.OLR_UDFCHAR08, 
                    src.OLR_UDFCHAR09, 
                    src.OLR_UDFCHAR10, 
                    src.OLR_UDFCHAR11, 
                    src.OLR_UDFCHAR12, 
                    src.OLR_UDFCHAR13, 
                    src.OLR_UDFCHAR14, 
                    src.OLR_UDFCHAR15, 
                    src.OLR_UDFCHAR16, 
                    src.OLR_UDFCHAR17, 
                    src.OLR_UDFCHAR18, 
                    src.OLR_UDFCHAR19, 
                    src.OLR_UDFCHAR20, 
                    src.OLR_UDFCHAR21, 
                    src.OLR_UDFCHAR22, 
                    src.OLR_UDFCHAR23, 
                    src.OLR_UDFCHAR24, 
                    src.OLR_UDFCHAR25, 
                    src.OLR_UDFCHAR26, 
                    src.OLR_UDFCHAR27, 
                    src.OLR_UDFCHAR28, 
                    src.OLR_UDFCHAR29, 
                    src.OLR_UDFCHAR30, 
                    src.OLR_UDFCHKBOX01, 
                    src.OLR_UDFCHKBOX02, 
                    src.OLR_UDFCHKBOX03, 
                    src.OLR_UDFCHKBOX04, 
                    src.OLR_UDFCHKBOX05, 
                    src.OLR_UDFDATE01, 
                    src.OLR_UDFDATE02, 
                    src.OLR_UDFDATE03, 
                    src.OLR_UDFDATE04, 
                    src.OLR_UDFDATE05, 
                    src.OLR_UDFNUM01, 
                    src.OLR_UDFNUM02, 
                    src.OLR_UDFNUM03, 
                    src.OLR_UDFNUM04, 
                    src.OLR_UDFNUM05, 
                    src.OLR_UPDATECOUNT, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;