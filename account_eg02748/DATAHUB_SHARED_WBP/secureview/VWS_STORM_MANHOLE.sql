CREATE OR REPLACE SECURE VIEW ${buildvar.env}_WBP_SHARE.DATAHUB_SHARED_WBP.VWS_STORM_MANHOLE
AS
SELECT 
  A1."ACQTYPE" AS "Acquistion Type"
, A2."ADDRKEY" AS "Address"
, A2."BARLDIAM" AS "Barrel Diameter"
, A2."COMPKEY" AS "CompKey"
, A1."COSTCENTRE" AS "Cost Centre Code"
, 'TBD' AS "Cost Centre Description"
, A2."CVRDIAM" as "Cover Diameter"
, A1."CRITICALITY" AS "Criticality Code"
, 'TBD' AS "Criticality Description"
, A2."MHDPTH" AS "Depth"
, A2."UNITDESC" AS "Description"
, A1."FORDISPOSAL" AS "Disposal Reason"
, A1."DRAWINGNO" AS "Drawing No"
, A1."DRAWINGNOREF" AS "Drawing No Ref"
, A2."BGTNO" AS "Equipment No"
, A2."EXPDATE" AS "Expire Date"
, A2."AREA" AS "Facility Code"
, 'TBD' AS "Facility Description"
, A2."INSTDATE" AS "Installed"
, A2."ASBLT" AS "Legacy Key"
, A2."UNITID" AS "Manhole ID"
, A2."UNITTYPE" AS "Manhole Type Code"
, 'TBD' AS "Manhole Type Description"
, A1."MODELNO" AS "Model #"
, A2."OWN" AS "Ownership Code"
, 'TBD' AS "Ownership Description"
, A2."MAPNO" AS "Position"
, A2."SUBAREA" AS "Process Code"
, 'TBD' AS "Process Description"
, A1."SAFETYCRITICAL" AS "Safety Critical Element"
, A2."SERVSTAT" AS "Service Status"
, A2."LOC" AS "Set Code"
, 'TBD' AS "Set Description"
, A2."SURF" AS "Surface Cover Code"
, 'TBD' AS "Surface Cover Description"
, A2."DISTRICT" AS "System Code"
, 'TBD' AS "System Description"
, A2."WALLTYPE" AS "Wall Type"

, ad."NZHOUSENO" AS "Street Number"
, CONCAT(ad."NZSTNAME",' ',ad."NZSTTYPE") AS "Street Name"
, ad."NZSUBURB" AS "City"
, ad."NZPOSTCODE" AS "Postal Code"

, A1.MAKE                      						 AS "Make"
, A1.ZONECATCHMENT             						 AS "Water Zone/Sewer Catchment"
, XSTORMMANHOLES.BOLTDOWN                            AS "Boltdown"
, CVRTYPE                                            AS "Cover Type"
, XSTORMMANHOLES.DIAMEXT                    		 AS "Diameter External (mm)"
, XSTORMMANHOLES.DIAMINT                    		 AS "Diameter Internal (mm)"
, XSTORMMANHOLES.HINGED                              AS "Hinged"
, XSTORMMANHOLES.INVLEVEL                         	 AS "Invert Level (M)"
, DROPMH	                                         AS "Is Drop Manhole"
, XSTORMMANHOLES.LIDLEVEL                            AS "Lid Level (M)"
, XSTORMMANHOLES.LOCKABLE                            AS "Lockable"
, XSTORMMANHOLES.REMOVABLE                           AS "Removable"
, XSTORMMANHOLES.SUBTYPEFEATURES                     AS "SubType Features"
, A1.WARRANTYEND               						 AS "Warranty End Date"
, A1.WARRANTYSTART             						 AS "Warranty Start Date"
, XSTORMMANHOLES.DESIGNRESILIENCE                    AS "Design Resilience"
, XSTORMMANHOLES.QUAKEDESIGN                         AS "Earthquake Design Level"
, XSTORMMANHOLES.FALLPROTECT                         AS "Fall Protection"
, XSTORMMANHOLES.FUNCAREA                            AS "Functional Area"
, XSTORMMANHOLES.GRDLEVEL                          	 AS "Ground Level"
, XSTORMMANHOLES.INTLINING                       	 AS "Internal Lining"
, XSTORMMANHOLES.LOADRATING                          AS "Load Rating (kN)"
, XSTORMMANHOLES.LOCALITY                            AS "Locality"
, XSTORMMANHOLES.MEDIATYPE                           AS "Media Type"
, XSTORMMANHOLES.PHOTO3D                             AS "Photo/3D Model"

FROM
  "${buildvar.env}_WCC_DATAWAREHOUSE"."DATAHUB_TARGET"."IPS_ASSETMANAGEMENT_STORM_COMPSTMH" as A2
  INNER JOIN "${buildvar.env}_WCC_DATAWAREHOUSE"."DATAHUB_TARGET"."IPS_WSLASSETS_XALLASSETSDP02" as A1 ON A2.COMPKEY = A1.COMPKEY AND A1.BUSINESSAREA IN ('WBC','WBE','WBW')
  LEFT OUTER JOIN "${buildvar.env}_WCC_DATAWAREHOUSE"."DATAHUB_TARGET"."IPS_PROPERTY_ADDRESS" as ad ON ad.ADDRKEY = a2.ADDRKEY AND ad.OPTA = 'WBP'
  LEFT OUTER JOIN "${buildvar.env}_WCC_DATAWAREHOUSE"."DATAHUB_TARGET".IPS_WSLASSETSSTORM_XSTORMMANHOLES  AS XSTORMMANHOLES ON A2.COMPKEY = XSTORMMANHOLES.COMPKEY 
  WHERE A2.BLDGFLOOR = 1003;
