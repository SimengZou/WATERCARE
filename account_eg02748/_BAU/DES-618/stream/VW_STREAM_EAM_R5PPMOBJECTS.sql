CREATE OR REPLACE VIEW DATAHUB_INTEGRATION.VW_STREAM_EAM_R5PPMOBJECTS
            AS
            SELECT
                src:"PPO_CHANGED"::varchar AS PPO_CHANGED, 
                src:"PPO_CLASS"::varchar AS PPO_CLASS, 
                src:"PPO_CLASS_ORG"::varchar AS PPO_CLASS_ORG, 
                src:"PPO_COSTCODE"::varchar AS PPO_COSTCODE, 
                src:"PPO_DEACTIVE"::datetime AS PPO_DEACTIVE, 
                src:"PPO_DORMEND"::datetime AS PPO_DORMEND, 
                src:"PPO_DORMREUSE"::varchar AS PPO_DORMREUSE, 
                src:"PPO_DORMSTART"::datetime AS PPO_DORMSTART, 
                src:"PPO_DUE"::datetime AS PPO_DUE, 
                src:"PPO_DUENONCONFORMITIESONLY"::varchar AS PPO_DUENONCONFORMITIESONLY, 
                src:"PPO_FIXED"::varchar AS PPO_FIXED, 
                src:"PPO_FREQ"::numeric(38, 10) AS PPO_FREQ, 
                src:"PPO_FROMGEOREF"::varchar AS PPO_FROMGEOREF, 
                src:"PPO_FROMPOINT"::numeric(38, 10) AS PPO_FROMPOINT, 
                src:"PPO_FROMREFDESC"::varchar AS PPO_FROMREFDESC, 
                src:"PPO_INCLUDENONCONFORMITIES"::varchar AS PPO_INCLUDENONCONFORMITIES, 
                src:"PPO_ISSTYPE"::varchar AS PPO_ISSTYPE, 
                src:"PPO_LASTSAVED"::datetime AS PPO_LASTSAVED,  
                src:"PPO_LASTSAVED"::datetime as ETL_LASTSAVED,
                src:"PPO_LOCATION"::varchar AS PPO_LOCATION, 
                src:"PPO_LOCATION_ORG"::varchar AS PPO_LOCATION_ORG, 
                src:"PPO_LOCKEDBYSESSION"::numeric(38, 10) AS PPO_LOCKEDBYSESSION, 
                src:"PPO_METER"::numeric(38, 10) AS PPO_METER, 
                src:"PPO_METER2"::numeric(38, 10) AS PPO_METER2, 
                src:"PPO_METERDUE"::numeric(38, 10) AS PPO_METERDUE, 
                src:"PPO_METERDUE2"::numeric(38, 10) AS PPO_METERDUE2, 
                src:"PPO_METUOM"::varchar AS PPO_METUOM, 
                src:"PPO_METUOM2"::varchar AS PPO_METUOM2, 
                src:"PPO_MRC"::varchar AS PPO_MRC, 
                src:"PPO_OBJECT"::varchar AS PPO_OBJECT, 
                src:"PPO_OBJECT_ORG"::varchar AS PPO_OBJECT_ORG, 
                src:"PPO_OBRTYPE"::varchar AS PPO_OBRTYPE, 
                src:"PPO_OBTYPE"::varchar AS PPO_OBTYPE, 
                src:"PPO_ORG"::varchar AS PPO_ORG, 
                src:"PPO_PACKAGE"::varchar AS PPO_PACKAGE, 
                src:"PPO_PERFORMONDAY"::numeric(38, 10) AS PPO_PERFORMONDAY, 
                src:"PPO_PERFORMONWEEK"::varchar AS PPO_PERFORMONWEEK, 
                src:"PPO_PERIODUOM"::varchar AS PPO_PERIODUOM, 
                src:"PPO_PERSON"::varchar AS PPO_PERSON, 
                src:"PPO_PK"::numeric(38, 10) AS PPO_PK, 
                src:"PPO_PPM"::varchar AS PPO_PPM, 
                src:"PPO_REVISION"::numeric(38, 10) AS PPO_REVISION, 
                src:"PPO_ROUTE"::varchar AS PPO_ROUTE, 
                src:"PPO_SCHEDGRP"::varchar AS PPO_SCHEDGRP, 
                src:"PPO_SET"::varchar AS PPO_SET, 
                src:"PPO_SETID"::numeric(38, 10) AS PPO_SETID, 
                src:"PPO_TOGEOREF"::varchar AS PPO_TOGEOREF, 
                src:"PPO_TOPOINT"::numeric(38, 10) AS PPO_TOPOINT, 
                src:"PPO_TOREFDESC"::varchar AS PPO_TOREFDESC, 
                src:"PPO_UDFCHAR01"::varchar AS PPO_UDFCHAR01, 
                src:"PPO_UDFCHAR02"::varchar AS PPO_UDFCHAR02, 
                src:"PPO_UDFCHAR03"::varchar AS PPO_UDFCHAR03, 
                src:"PPO_UDFCHAR04"::varchar AS PPO_UDFCHAR04, 
                src:"PPO_UDFCHAR05"::varchar AS PPO_UDFCHAR05, 
                src:"PPO_UDFCHAR06"::varchar AS PPO_UDFCHAR06, 
                src:"PPO_UDFCHAR07"::varchar AS PPO_UDFCHAR07, 
                src:"PPO_UDFCHAR08"::varchar AS PPO_UDFCHAR08, 
                src:"PPO_UDFCHAR09"::varchar AS PPO_UDFCHAR09, 
                src:"PPO_UDFCHAR10"::varchar AS PPO_UDFCHAR10, 
                src:"PPO_UDFCHAR11"::varchar AS PPO_UDFCHAR11, 
                src:"PPO_UDFCHAR12"::varchar AS PPO_UDFCHAR12, 
                src:"PPO_UDFCHAR13"::varchar AS PPO_UDFCHAR13, 
                src:"PPO_UDFCHAR14"::varchar AS PPO_UDFCHAR14, 
                src:"PPO_UDFCHAR15"::varchar AS PPO_UDFCHAR15, 
                src:"PPO_UDFCHAR16"::varchar AS PPO_UDFCHAR16, 
                src:"PPO_UDFCHAR17"::varchar AS PPO_UDFCHAR17, 
                src:"PPO_UDFCHAR18"::varchar AS PPO_UDFCHAR18, 
                src:"PPO_UDFCHAR19"::varchar AS PPO_UDFCHAR19, 
                src:"PPO_UDFCHAR20"::varchar AS PPO_UDFCHAR20, 
                src:"PPO_UDFCHAR21"::varchar AS PPO_UDFCHAR21, 
                src:"PPO_UDFCHAR22"::varchar AS PPO_UDFCHAR22, 
                src:"PPO_UDFCHAR23"::varchar AS PPO_UDFCHAR23, 
                src:"PPO_UDFCHAR24"::varchar AS PPO_UDFCHAR24, 
                src:"PPO_UDFCHAR25"::varchar AS PPO_UDFCHAR25, 
                src:"PPO_UDFCHAR26"::varchar AS PPO_UDFCHAR26, 
                src:"PPO_UDFCHAR27"::varchar AS PPO_UDFCHAR27, 
                src:"PPO_UDFCHAR28"::varchar AS PPO_UDFCHAR28, 
                src:"PPO_UDFCHAR29"::varchar AS PPO_UDFCHAR29, 
                src:"PPO_UDFCHAR30"::varchar AS PPO_UDFCHAR30, 
                src:"PPO_UDFCHAR31"::varchar AS PPO_UDFCHAR31, 
                src:"PPO_UDFCHAR32"::varchar AS PPO_UDFCHAR32, 
                src:"PPO_UDFCHAR33"::varchar AS PPO_UDFCHAR33, 
                src:"PPO_UDFCHAR34"::varchar AS PPO_UDFCHAR34, 
                src:"PPO_UDFCHAR35"::varchar AS PPO_UDFCHAR35, 
                src:"PPO_UDFCHAR36"::varchar AS PPO_UDFCHAR36, 
                src:"PPO_UDFCHAR37"::varchar AS PPO_UDFCHAR37, 
                src:"PPO_UDFCHAR38"::varchar AS PPO_UDFCHAR38, 
                src:"PPO_UDFCHAR39"::varchar AS PPO_UDFCHAR39, 
                src:"PPO_UDFCHAR40"::varchar AS PPO_UDFCHAR40, 
                src:"PPO_UDFCHAR41"::varchar AS PPO_UDFCHAR41, 
                src:"PPO_UDFCHAR42"::varchar AS PPO_UDFCHAR42, 
                src:"PPO_UDFCHAR43"::varchar AS PPO_UDFCHAR43, 
                src:"PPO_UDFCHAR44"::varchar AS PPO_UDFCHAR44, 
                src:"PPO_UDFCHAR45"::varchar AS PPO_UDFCHAR45, 
                src:"PPO_UDFCHKBOX01"::varchar AS PPO_UDFCHKBOX01, 
                src:"PPO_UDFCHKBOX02"::varchar AS PPO_UDFCHKBOX02, 
                src:"PPO_UDFCHKBOX03"::varchar AS PPO_UDFCHKBOX03, 
                src:"PPO_UDFCHKBOX04"::varchar AS PPO_UDFCHKBOX04, 
                src:"PPO_UDFCHKBOX05"::varchar AS PPO_UDFCHKBOX05, 
                src:"PPO_UDFCHKBOX06"::varchar AS PPO_UDFCHKBOX06, 
                src:"PPO_UDFCHKBOX07"::varchar AS PPO_UDFCHKBOX07, 
                src:"PPO_UDFCHKBOX08"::varchar AS PPO_UDFCHKBOX08, 
                src:"PPO_UDFCHKBOX09"::varchar AS PPO_UDFCHKBOX09, 
                src:"PPO_UDFCHKBOX10"::varchar AS PPO_UDFCHKBOX10, 
                src:"PPO_UDFDATE01"::datetime AS PPO_UDFDATE01, 
                src:"PPO_UDFDATE02"::datetime AS PPO_UDFDATE02, 
                src:"PPO_UDFDATE03"::datetime AS PPO_UDFDATE03, 
                src:"PPO_UDFDATE04"::datetime AS PPO_UDFDATE04, 
                src:"PPO_UDFDATE05"::datetime AS PPO_UDFDATE05, 
                src:"PPO_UDFDATE06"::datetime AS PPO_UDFDATE06, 
                src:"PPO_UDFDATE07"::datetime AS PPO_UDFDATE07, 
                src:"PPO_UDFDATE08"::datetime AS PPO_UDFDATE08, 
                src:"PPO_UDFDATE09"::datetime AS PPO_UDFDATE09, 
                src:"PPO_UDFDATE10"::datetime AS PPO_UDFDATE10, 
                src:"PPO_UDFNOTE01"::varchar AS PPO_UDFNOTE01, 
                src:"PPO_UDFNOTE02"::varchar AS PPO_UDFNOTE02, 
                src:"PPO_UDFNUM01"::numeric(38, 10) AS PPO_UDFNUM01, 
                src:"PPO_UDFNUM02"::numeric(38, 10) AS PPO_UDFNUM02, 
                src:"PPO_UDFNUM03"::numeric(38, 10) AS PPO_UDFNUM03, 
                src:"PPO_UDFNUM04"::numeric(38, 10) AS PPO_UDFNUM04, 
                src:"PPO_UDFNUM05"::numeric(38, 10) AS PPO_UDFNUM05, 
                src:"PPO_UDFNUM06"::numeric(38, 10) AS PPO_UDFNUM06, 
                src:"PPO_UDFNUM07"::numeric(38, 10) AS PPO_UDFNUM07, 
                src:"PPO_UDFNUM08"::numeric(38, 10) AS PPO_UDFNUM08, 
                src:"PPO_UDFNUM09"::numeric(38, 10) AS PPO_UDFNUM09, 
                src:"PPO_UDFNUM10"::numeric(38, 10) AS PPO_UDFNUM10, 
                src:"PPO_UPDATECOUNT"::numeric(38, 10) AS PPO_UPDATECOUNT, 
                src:"_DELETED"::boolean AS _DELETED, 
                src:"_DELETED"::BOOLEAN as ETL_DELETED, 
                etl_load_datetime,
                etl_load_metadatafilename
                FROM 
                (
                select 
                    src,
                    etl_load_datetime,
                    etl_load_metadatafilename
                    from
                    (
                        SELECT
     
                            
                src:"PPO_PK"::numeric(38, 10),
                src:"PPO_REVISION"::numeric(38, 10),
                src:"PPO_LASTSAVED"::datetime
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:"PPO_PK"::numeric(38, 10),
                src:"PPO_REVISION"::numeric(38, 10)  ORDER BY 
                src:"PPO_LASTSAVED"::datetime desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_INTEGRATION.STREAM_EAM_R5PPMOBJECTS as strm

)
    WHERE
    ROWNUMBER=1)
                ; 