create or replace procedure DATAHUB_INTEGRATION.SP_LN_TSSOC210()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TSSOC210_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TSSOC210 as target using (SELECT * FROM (SELECT 
            strm.acdt, 
            strm.acdu, 
            strm.acln, 
            strm.actg, 
            strm.actg_ref_compnr, 
            strm.adfa, 
            strm.adfa_kw, 
            strm.adin, 
            strm.adtm, 
            strm.advl, 
            strm.aftm, 
            strm.ains, 
            strm.ains_kw, 
            strm.aivl, 
            strm.altn, 
            strm.amod, 
            strm.appo, 
            strm.appo_kw, 
            strm.asgd, 
            strm.asta, 
            strm.asta_kw, 
            strm.astm, 
            strm.atbl, 
            strm.atbl_kw, 
            strm.atpc, 
            strm.atpc_kw, 
            strm.atpd, 
            strm.bfbp, 
            strm.bfbp_ref_compnr, 
            strm.bsch, 
            strm.bsch_ref_compnr, 
            strm.cadt, 
            strm.camr, 
            strm.camr_ref_compnr, 
            strm.caro_1, 
            strm.caro_10, 
            strm.caro_2, 
            strm.caro_3, 
            strm.caro_4, 
            strm.caro_5, 
            strm.caro_6, 
            strm.caro_7, 
            strm.caro_8, 
            strm.caro_9, 
            strm.ccar, 
            strm.ccar_ref_compnr, 
            strm.cchl, 
            strm.cchl_ref_compnr, 
            strm.ccll, 
            strm.ccll_ref_compnr, 
            strm.cctp, 
            strm.cctp_ref_compnr, 
            strm.cdis, 
            strm.cdis_ref_compnr, 
            strm.clst, 
            strm.clst_ref_compnr, 
            strm.cmea, 
            strm.cmea_ref_compnr, 
            strm.cncd, 
            strm.come, 
            strm.come_ref_compnr, 
            strm.compnr, 
            strm.cova, 
            strm.cpor, 
            strm.cpor_kw, 
            strm.cprj, 
            strm.cprj_ref_compnr, 
            strm.cprl, 
            strm.cprl_ref_compnr, 
            strm.crac, 
            strm.crac_ref_compnr, 
            strm.crpu, 
            strm.crpu_kw, 
            strm.crtc, 
            strm.crtc_ref_compnr, 
            strm.csar, 
            strm.csar_ref_compnr, 
            strm.csco, 
            strm.csco_ref_compnr, 
            strm.cskt, 
            strm.cskt_ref_compnr, 
            strm.cspa, 
            strm.cstn, 
            strm.cstn_ref_compnr, 
            strm.cstp, 
            strm.cstp_ref_compnr, 
            strm.cupr, 
            strm.cupr_ref_compnr, 
            strm.cuxr, 
            strm.cuxr_ref_compnr, 
            strm.cvtm, 
            strm.dbfc, 
            strm.deleted, 
            strm.desc, 
            strm.docn, 
            strm.docn_ref_compnr, 
            strm.eaod, 
            strm.emno, 
            strm.emno_ref_compnr, 
            strm.erdt, 
            strm.espr, 
            strm.estm, 
            strm.fcon, 
            strm.fcon_ref_compnr, 
            strm.inby, 
            strm.inby_kw, 
            strm.inpl, 
            strm.inpl_ref_compnr, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_sern_ref_compnr, 
            strm.item_xrsr_ref_compnr, 
            strm.lcad, 
            strm.lcad_ref_compnr, 
            strm.lftm, 
            strm.mepo, 
            strm.mepo_ref_compnr, 
            strm.micn, 
            strm.micn_kw, 
            strm.mvla, 
            strm.mvln, 
            strm.nivl, 
            strm.noun, 
            strm.obpr, 
            strm.obpr_ref_compnr, 
            strm.oftm, 
            strm.orac, 
            strm.oras, 
            strm.orno, 
            strm.orno_ref_compnr, 
            strm.orps, 
            strm.ostm, 
            strm.pbsm, 
            strm.pbsm_kw, 
            strm.pcac, 
            strm.pcch, 
            strm.pcln, 
            strm.pcon, 
            strm.pcon_pcch_ref_compnr, 
            strm.pcon_ref_compnr, 
            strm.pdvl, 
            strm.pftm, 
            strm.pmtd, 
            strm.pmtd_kw, 
            strm.porg, 
            strm.porg_kw, 
            strm.prac, 
            strm.prac_kw, 
            strm.pris, 
            strm.prpr, 
            strm.prpr_ref_compnr, 
            strm.pstm, 
            strm.ptft, 
            strm.ptst, 
            strm.qtnl, 
            strm.qtno, 
            strm.qtno_revn_qtnl_altn_ref_compnr, 
            strm.revn, 
            strm.rfpt, 
            strm.rltm, 
            strm.rnyn, 
            strm.rnyn_kw, 
            strm.rown, 
            strm.rown_ref_compnr, 
            strm.rrqt, 
            strm.sbit, 
            strm.sbit_ref_compnr, 
            strm.sear, 
            strm.sequencenumber, 
            strm.sern, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.skla, 
            strm.sklb, 
            strm.sklc, 
            strm.smto, 
            strm.smto_kw, 
            strm.ssta, 
            strm.ssta_kw, 
            strm.stad, 
            strm.stad_ref_compnr, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.subc, 
            strm.subc_kw, 
            strm.supm, 
            strm.supm_kw, 
            strm.timestamp, 
            strm.tmun, 
            strm.tmun_kw, 
            strm.trdi, 
            strm.trdi_buln, 
            strm.trdu, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.txtb, 
            strm.txtb_ref_compnr, 
            strm.txtc, 
            strm.txtc_ref_compnr, 
            strm.txtd, 
            strm.txtd_ref_compnr, 
            strm.username, 
            strm.vtbo, 
            strm.vtbo_kw, 
            strm.wrtp, 
            strm.wrtp_kw, 
            strm.wrty, 
            strm.xrcu, 
            strm.xrcu_ref_compnr, 
            strm.xrnh, 
            strm.xrnh_kw, 
            strm.xrrt, 
            strm.xrsr, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.orno,
            strm.acln ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TSSOC210 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.orno=src.orno) OR (target.orno IS NULL AND src.orno IS NULL)) AND
            ((target.acln=src.acln) OR (target.acln IS NULL AND src.acln IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.acdt=src.acdt, 
                    target.acdu=src.acdu, 
                    target.acln=src.acln, 
                    target.actg=src.actg, 
                    target.actg_ref_compnr=src.actg_ref_compnr, 
                    target.adfa=src.adfa, 
                    target.adfa_kw=src.adfa_kw, 
                    target.adin=src.adin, 
                    target.adtm=src.adtm, 
                    target.advl=src.advl, 
                    target.aftm=src.aftm, 
                    target.ains=src.ains, 
                    target.ains_kw=src.ains_kw, 
                    target.aivl=src.aivl, 
                    target.altn=src.altn, 
                    target.amod=src.amod, 
                    target.appo=src.appo, 
                    target.appo_kw=src.appo_kw, 
                    target.asgd=src.asgd, 
                    target.asta=src.asta, 
                    target.asta_kw=src.asta_kw, 
                    target.astm=src.astm, 
                    target.atbl=src.atbl, 
                    target.atbl_kw=src.atbl_kw, 
                    target.atpc=src.atpc, 
                    target.atpc_kw=src.atpc_kw, 
                    target.atpd=src.atpd, 
                    target.bfbp=src.bfbp, 
                    target.bfbp_ref_compnr=src.bfbp_ref_compnr, 
                    target.bsch=src.bsch, 
                    target.bsch_ref_compnr=src.bsch_ref_compnr, 
                    target.cadt=src.cadt, 
                    target.camr=src.camr, 
                    target.camr_ref_compnr=src.camr_ref_compnr, 
                    target.caro_1=src.caro_1, 
                    target.caro_10=src.caro_10, 
                    target.caro_2=src.caro_2, 
                    target.caro_3=src.caro_3, 
                    target.caro_4=src.caro_4, 
                    target.caro_5=src.caro_5, 
                    target.caro_6=src.caro_6, 
                    target.caro_7=src.caro_7, 
                    target.caro_8=src.caro_8, 
                    target.caro_9=src.caro_9, 
                    target.ccar=src.ccar, 
                    target.ccar_ref_compnr=src.ccar_ref_compnr, 
                    target.cchl=src.cchl, 
                    target.cchl_ref_compnr=src.cchl_ref_compnr, 
                    target.ccll=src.ccll, 
                    target.ccll_ref_compnr=src.ccll_ref_compnr, 
                    target.cctp=src.cctp, 
                    target.cctp_ref_compnr=src.cctp_ref_compnr, 
                    target.cdis=src.cdis, 
                    target.cdis_ref_compnr=src.cdis_ref_compnr, 
                    target.clst=src.clst, 
                    target.clst_ref_compnr=src.clst_ref_compnr, 
                    target.cmea=src.cmea, 
                    target.cmea_ref_compnr=src.cmea_ref_compnr, 
                    target.cncd=src.cncd, 
                    target.come=src.come, 
                    target.come_ref_compnr=src.come_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cova=src.cova, 
                    target.cpor=src.cpor, 
                    target.cpor_kw=src.cpor_kw, 
                    target.cprj=src.cprj, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprl=src.cprl, 
                    target.cprl_ref_compnr=src.cprl_ref_compnr, 
                    target.crac=src.crac, 
                    target.crac_ref_compnr=src.crac_ref_compnr, 
                    target.crpu=src.crpu, 
                    target.crpu_kw=src.crpu_kw, 
                    target.crtc=src.crtc, 
                    target.crtc_ref_compnr=src.crtc_ref_compnr, 
                    target.csar=src.csar, 
                    target.csar_ref_compnr=src.csar_ref_compnr, 
                    target.csco=src.csco, 
                    target.csco_ref_compnr=src.csco_ref_compnr, 
                    target.cskt=src.cskt, 
                    target.cskt_ref_compnr=src.cskt_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cstn=src.cstn, 
                    target.cstn_ref_compnr=src.cstn_ref_compnr, 
                    target.cstp=src.cstp, 
                    target.cstp_ref_compnr=src.cstp_ref_compnr, 
                    target.cupr=src.cupr, 
                    target.cupr_ref_compnr=src.cupr_ref_compnr, 
                    target.cuxr=src.cuxr, 
                    target.cuxr_ref_compnr=src.cuxr_ref_compnr, 
                    target.cvtm=src.cvtm, 
                    target.dbfc=src.dbfc, 
                    target.deleted=src.deleted, 
                    target.desc=src.desc, 
                    target.docn=src.docn, 
                    target.docn_ref_compnr=src.docn_ref_compnr, 
                    target.eaod=src.eaod, 
                    target.emno=src.emno, 
                    target.emno_ref_compnr=src.emno_ref_compnr, 
                    target.erdt=src.erdt, 
                    target.espr=src.espr, 
                    target.estm=src.estm, 
                    target.fcon=src.fcon, 
                    target.fcon_ref_compnr=src.fcon_ref_compnr, 
                    target.inby=src.inby, 
                    target.inby_kw=src.inby_kw, 
                    target.inpl=src.inpl, 
                    target.inpl_ref_compnr=src.inpl_ref_compnr, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_sern_ref_compnr=src.item_sern_ref_compnr, 
                    target.item_xrsr_ref_compnr=src.item_xrsr_ref_compnr, 
                    target.lcad=src.lcad, 
                    target.lcad_ref_compnr=src.lcad_ref_compnr, 
                    target.lftm=src.lftm, 
                    target.mepo=src.mepo, 
                    target.mepo_ref_compnr=src.mepo_ref_compnr, 
                    target.micn=src.micn, 
                    target.micn_kw=src.micn_kw, 
                    target.mvla=src.mvla, 
                    target.mvln=src.mvln, 
                    target.nivl=src.nivl, 
                    target.noun=src.noun, 
                    target.obpr=src.obpr, 
                    target.obpr_ref_compnr=src.obpr_ref_compnr, 
                    target.oftm=src.oftm, 
                    target.orac=src.orac, 
                    target.oras=src.oras, 
                    target.orno=src.orno, 
                    target.orno_ref_compnr=src.orno_ref_compnr, 
                    target.orps=src.orps, 
                    target.ostm=src.ostm, 
                    target.pbsm=src.pbsm, 
                    target.pbsm_kw=src.pbsm_kw, 
                    target.pcac=src.pcac, 
                    target.pcch=src.pcch, 
                    target.pcln=src.pcln, 
                    target.pcon=src.pcon, 
                    target.pcon_pcch_ref_compnr=src.pcon_pcch_ref_compnr, 
                    target.pcon_ref_compnr=src.pcon_ref_compnr, 
                    target.pdvl=src.pdvl, 
                    target.pftm=src.pftm, 
                    target.pmtd=src.pmtd, 
                    target.pmtd_kw=src.pmtd_kw, 
                    target.porg=src.porg, 
                    target.porg_kw=src.porg_kw, 
                    target.prac=src.prac, 
                    target.prac_kw=src.prac_kw, 
                    target.pris=src.pris, 
                    target.prpr=src.prpr, 
                    target.prpr_ref_compnr=src.prpr_ref_compnr, 
                    target.pstm=src.pstm, 
                    target.ptft=src.ptft, 
                    target.ptst=src.ptst, 
                    target.qtnl=src.qtnl, 
                    target.qtno=src.qtno, 
                    target.qtno_revn_qtnl_altn_ref_compnr=src.qtno_revn_qtnl_altn_ref_compnr, 
                    target.revn=src.revn, 
                    target.rfpt=src.rfpt, 
                    target.rltm=src.rltm, 
                    target.rnyn=src.rnyn, 
                    target.rnyn_kw=src.rnyn_kw, 
                    target.rown=src.rown, 
                    target.rown_ref_compnr=src.rown_ref_compnr, 
                    target.rrqt=src.rrqt, 
                    target.sbit=src.sbit, 
                    target.sbit_ref_compnr=src.sbit_ref_compnr, 
                    target.sear=src.sear, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sern=src.sern, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.skla=src.skla, 
                    target.sklb=src.sklb, 
                    target.sklc=src.sklc, 
                    target.smto=src.smto, 
                    target.smto_kw=src.smto_kw, 
                    target.ssta=src.ssta, 
                    target.ssta_kw=src.ssta_kw, 
                    target.stad=src.stad, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.supm=src.supm, 
                    target.supm_kw=src.supm_kw, 
                    target.timestamp=src.timestamp, 
                    target.tmun=src.tmun, 
                    target.tmun_kw=src.tmun_kw, 
                    target.trdi=src.trdi, 
                    target.trdi_buln=src.trdi_buln, 
                    target.trdu=src.trdu, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.txtb=src.txtb, 
                    target.txtb_ref_compnr=src.txtb_ref_compnr, 
                    target.txtc=src.txtc, 
                    target.txtc_ref_compnr=src.txtc_ref_compnr, 
                    target.txtd=src.txtd, 
                    target.txtd_ref_compnr=src.txtd_ref_compnr, 
                    target.username=src.username, 
                    target.vtbo=src.vtbo, 
                    target.vtbo_kw=src.vtbo_kw, 
                    target.wrtp=src.wrtp, 
                    target.wrtp_kw=src.wrtp_kw, 
                    target.wrty=src.wrty, 
                    target.xrcu=src.xrcu, 
                    target.xrcu_ref_compnr=src.xrcu_ref_compnr, 
                    target.xrnh=src.xrnh, 
                    target.xrnh_kw=src.xrnh_kw, 
                    target.xrrt=src.xrrt, 
                    target.xrsr=src.xrsr, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    acdt, 
                    acdu, 
                    acln, 
                    actg, 
                    actg_ref_compnr, 
                    adfa, 
                    adfa_kw, 
                    adin, 
                    adtm, 
                    advl, 
                    aftm, 
                    ains, 
                    ains_kw, 
                    aivl, 
                    altn, 
                    amod, 
                    appo, 
                    appo_kw, 
                    asgd, 
                    asta, 
                    asta_kw, 
                    astm, 
                    atbl, 
                    atbl_kw, 
                    atpc, 
                    atpc_kw, 
                    atpd, 
                    bfbp, 
                    bfbp_ref_compnr, 
                    bsch, 
                    bsch_ref_compnr, 
                    cadt, 
                    camr, 
                    camr_ref_compnr, 
                    caro_1, 
                    caro_10, 
                    caro_2, 
                    caro_3, 
                    caro_4, 
                    caro_5, 
                    caro_6, 
                    caro_7, 
                    caro_8, 
                    caro_9, 
                    ccar, 
                    ccar_ref_compnr, 
                    cchl, 
                    cchl_ref_compnr, 
                    ccll, 
                    ccll_ref_compnr, 
                    cctp, 
                    cctp_ref_compnr, 
                    cdis, 
                    cdis_ref_compnr, 
                    clst, 
                    clst_ref_compnr, 
                    cmea, 
                    cmea_ref_compnr, 
                    cncd, 
                    come, 
                    come_ref_compnr, 
                    compnr, 
                    cova, 
                    cpor, 
                    cpor_kw, 
                    cprj, 
                    cprj_ref_compnr, 
                    cprl, 
                    cprl_ref_compnr, 
                    crac, 
                    crac_ref_compnr, 
                    crpu, 
                    crpu_kw, 
                    crtc, 
                    crtc_ref_compnr, 
                    csar, 
                    csar_ref_compnr, 
                    csco, 
                    csco_ref_compnr, 
                    cskt, 
                    cskt_ref_compnr, 
                    cspa, 
                    cstn, 
                    cstn_ref_compnr, 
                    cstp, 
                    cstp_ref_compnr, 
                    cupr, 
                    cupr_ref_compnr, 
                    cuxr, 
                    cuxr_ref_compnr, 
                    cvtm, 
                    dbfc, 
                    deleted, 
                    desc, 
                    docn, 
                    docn_ref_compnr, 
                    eaod, 
                    emno, 
                    emno_ref_compnr, 
                    erdt, 
                    espr, 
                    estm, 
                    fcon, 
                    fcon_ref_compnr, 
                    inby, 
                    inby_kw, 
                    inpl, 
                    inpl_ref_compnr, 
                    item, 
                    item_ref_compnr, 
                    item_sern_ref_compnr, 
                    item_xrsr_ref_compnr, 
                    lcad, 
                    lcad_ref_compnr, 
                    lftm, 
                    mepo, 
                    mepo_ref_compnr, 
                    micn, 
                    micn_kw, 
                    mvla, 
                    mvln, 
                    nivl, 
                    noun, 
                    obpr, 
                    obpr_ref_compnr, 
                    oftm, 
                    orac, 
                    oras, 
                    orno, 
                    orno_ref_compnr, 
                    orps, 
                    ostm, 
                    pbsm, 
                    pbsm_kw, 
                    pcac, 
                    pcch, 
                    pcln, 
                    pcon, 
                    pcon_pcch_ref_compnr, 
                    pcon_ref_compnr, 
                    pdvl, 
                    pftm, 
                    pmtd, 
                    pmtd_kw, 
                    porg, 
                    porg_kw, 
                    prac, 
                    prac_kw, 
                    pris, 
                    prpr, 
                    prpr_ref_compnr, 
                    pstm, 
                    ptft, 
                    ptst, 
                    qtnl, 
                    qtno, 
                    qtno_revn_qtnl_altn_ref_compnr, 
                    revn, 
                    rfpt, 
                    rltm, 
                    rnyn, 
                    rnyn_kw, 
                    rown, 
                    rown_ref_compnr, 
                    rrqt, 
                    sbit, 
                    sbit_ref_compnr, 
                    sear, 
                    sequencenumber, 
                    sern, 
                    sfad, 
                    sfad_ref_compnr, 
                    skla, 
                    sklb, 
                    sklc, 
                    smto, 
                    smto_kw, 
                    ssta, 
                    ssta_kw, 
                    stad, 
                    stad_ref_compnr, 
                    stbp, 
                    stbp_ref_compnr, 
                    stcn, 
                    stcn_ref_compnr, 
                    subc, 
                    subc_kw, 
                    supm, 
                    supm_kw, 
                    timestamp, 
                    tmun, 
                    tmun_kw, 
                    trdi, 
                    trdi_buln, 
                    trdu, 
                    txta, 
                    txta_ref_compnr, 
                    txtb, 
                    txtb_ref_compnr, 
                    txtc, 
                    txtc_ref_compnr, 
                    txtd, 
                    txtd_ref_compnr, 
                    username, 
                    vtbo, 
                    vtbo_kw, 
                    wrtp, 
                    wrtp_kw, 
                    wrty, 
                    xrcu, 
                    xrcu_ref_compnr, 
                    xrnh, 
                    xrnh_kw, 
                    xrrt, 
                    xrsr, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.acdt, 
                    src.acdu, 
                    src.acln, 
                    src.actg, 
                    src.actg_ref_compnr, 
                    src.adfa, 
                    src.adfa_kw, 
                    src.adin, 
                    src.adtm, 
                    src.advl, 
                    src.aftm, 
                    src.ains, 
                    src.ains_kw, 
                    src.aivl, 
                    src.altn, 
                    src.amod, 
                    src.appo, 
                    src.appo_kw, 
                    src.asgd, 
                    src.asta, 
                    src.asta_kw, 
                    src.astm, 
                    src.atbl, 
                    src.atbl_kw, 
                    src.atpc, 
                    src.atpc_kw, 
                    src.atpd, 
                    src.bfbp, 
                    src.bfbp_ref_compnr, 
                    src.bsch, 
                    src.bsch_ref_compnr, 
                    src.cadt, 
                    src.camr, 
                    src.camr_ref_compnr, 
                    src.caro_1, 
                    src.caro_10, 
                    src.caro_2, 
                    src.caro_3, 
                    src.caro_4, 
                    src.caro_5, 
                    src.caro_6, 
                    src.caro_7, 
                    src.caro_8, 
                    src.caro_9, 
                    src.ccar, 
                    src.ccar_ref_compnr, 
                    src.cchl, 
                    src.cchl_ref_compnr, 
                    src.ccll, 
                    src.ccll_ref_compnr, 
                    src.cctp, 
                    src.cctp_ref_compnr, 
                    src.cdis, 
                    src.cdis_ref_compnr, 
                    src.clst, 
                    src.clst_ref_compnr, 
                    src.cmea, 
                    src.cmea_ref_compnr, 
                    src.cncd, 
                    src.come, 
                    src.come_ref_compnr, 
                    src.compnr, 
                    src.cova, 
                    src.cpor, 
                    src.cpor_kw, 
                    src.cprj, 
                    src.cprj_ref_compnr, 
                    src.cprl, 
                    src.cprl_ref_compnr, 
                    src.crac, 
                    src.crac_ref_compnr, 
                    src.crpu, 
                    src.crpu_kw, 
                    src.crtc, 
                    src.crtc_ref_compnr, 
                    src.csar, 
                    src.csar_ref_compnr, 
                    src.csco, 
                    src.csco_ref_compnr, 
                    src.cskt, 
                    src.cskt_ref_compnr, 
                    src.cspa, 
                    src.cstn, 
                    src.cstn_ref_compnr, 
                    src.cstp, 
                    src.cstp_ref_compnr, 
                    src.cupr, 
                    src.cupr_ref_compnr, 
                    src.cuxr, 
                    src.cuxr_ref_compnr, 
                    src.cvtm, 
                    src.dbfc, 
                    src.deleted, 
                    src.desc, 
                    src.docn, 
                    src.docn_ref_compnr, 
                    src.eaod, 
                    src.emno, 
                    src.emno_ref_compnr, 
                    src.erdt, 
                    src.espr, 
                    src.estm, 
                    src.fcon, 
                    src.fcon_ref_compnr, 
                    src.inby, 
                    src.inby_kw, 
                    src.inpl, 
                    src.inpl_ref_compnr, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_sern_ref_compnr, 
                    src.item_xrsr_ref_compnr, 
                    src.lcad, 
                    src.lcad_ref_compnr, 
                    src.lftm, 
                    src.mepo, 
                    src.mepo_ref_compnr, 
                    src.micn, 
                    src.micn_kw, 
                    src.mvla, 
                    src.mvln, 
                    src.nivl, 
                    src.noun, 
                    src.obpr, 
                    src.obpr_ref_compnr, 
                    src.oftm, 
                    src.orac, 
                    src.oras, 
                    src.orno, 
                    src.orno_ref_compnr, 
                    src.orps, 
                    src.ostm, 
                    src.pbsm, 
                    src.pbsm_kw, 
                    src.pcac, 
                    src.pcch, 
                    src.pcln, 
                    src.pcon, 
                    src.pcon_pcch_ref_compnr, 
                    src.pcon_ref_compnr, 
                    src.pdvl, 
                    src.pftm, 
                    src.pmtd, 
                    src.pmtd_kw, 
                    src.porg, 
                    src.porg_kw, 
                    src.prac, 
                    src.prac_kw, 
                    src.pris, 
                    src.prpr, 
                    src.prpr_ref_compnr, 
                    src.pstm, 
                    src.ptft, 
                    src.ptst, 
                    src.qtnl, 
                    src.qtno, 
                    src.qtno_revn_qtnl_altn_ref_compnr, 
                    src.revn, 
                    src.rfpt, 
                    src.rltm, 
                    src.rnyn, 
                    src.rnyn_kw, 
                    src.rown, 
                    src.rown_ref_compnr, 
                    src.rrqt, 
                    src.sbit, 
                    src.sbit_ref_compnr, 
                    src.sear, 
                    src.sequencenumber, 
                    src.sern, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.skla, 
                    src.sklb, 
                    src.sklc, 
                    src.smto, 
                    src.smto_kw, 
                    src.ssta, 
                    src.ssta_kw, 
                    src.stad, 
                    src.stad_ref_compnr, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.subc, 
                    src.subc_kw, 
                    src.supm, 
                    src.supm_kw, 
                    src.timestamp, 
                    src.tmun, 
                    src.tmun_kw, 
                    src.trdi, 
                    src.trdi_buln, 
                    src.trdu, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.txtb, 
                    src.txtb_ref_compnr, 
                    src.txtc, 
                    src.txtc_ref_compnr, 
                    src.txtd, 
                    src.txtd_ref_compnr, 
                    src.username, 
                    src.vtbo, 
                    src.vtbo_kw, 
                    src.wrtp, 
                    src.wrtp_kw, 
                    src.wrty, 
                    src.xrcu, 
                    src.xrcu_ref_compnr, 
                    src.xrnh, 
                    src.xrnh_kw, 
                    src.xrrt, 
                    src.xrsr,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TSSOC210_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.acdt, 
            strm.acdu, 
            strm.acln, 
            strm.actg, 
            strm.actg_ref_compnr, 
            strm.adfa, 
            strm.adfa_kw, 
            strm.adin, 
            strm.adtm, 
            strm.advl, 
            strm.aftm, 
            strm.ains, 
            strm.ains_kw, 
            strm.aivl, 
            strm.altn, 
            strm.amod, 
            strm.appo, 
            strm.appo_kw, 
            strm.asgd, 
            strm.asta, 
            strm.asta_kw, 
            strm.astm, 
            strm.atbl, 
            strm.atbl_kw, 
            strm.atpc, 
            strm.atpc_kw, 
            strm.atpd, 
            strm.bfbp, 
            strm.bfbp_ref_compnr, 
            strm.bsch, 
            strm.bsch_ref_compnr, 
            strm.cadt, 
            strm.camr, 
            strm.camr_ref_compnr, 
            strm.caro_1, 
            strm.caro_10, 
            strm.caro_2, 
            strm.caro_3, 
            strm.caro_4, 
            strm.caro_5, 
            strm.caro_6, 
            strm.caro_7, 
            strm.caro_8, 
            strm.caro_9, 
            strm.ccar, 
            strm.ccar_ref_compnr, 
            strm.cchl, 
            strm.cchl_ref_compnr, 
            strm.ccll, 
            strm.ccll_ref_compnr, 
            strm.cctp, 
            strm.cctp_ref_compnr, 
            strm.cdis, 
            strm.cdis_ref_compnr, 
            strm.clst, 
            strm.clst_ref_compnr, 
            strm.cmea, 
            strm.cmea_ref_compnr, 
            strm.cncd, 
            strm.come, 
            strm.come_ref_compnr, 
            strm.compnr, 
            strm.cova, 
            strm.cpor, 
            strm.cpor_kw, 
            strm.cprj, 
            strm.cprj_ref_compnr, 
            strm.cprl, 
            strm.cprl_ref_compnr, 
            strm.crac, 
            strm.crac_ref_compnr, 
            strm.crpu, 
            strm.crpu_kw, 
            strm.crtc, 
            strm.crtc_ref_compnr, 
            strm.csar, 
            strm.csar_ref_compnr, 
            strm.csco, 
            strm.csco_ref_compnr, 
            strm.cskt, 
            strm.cskt_ref_compnr, 
            strm.cspa, 
            strm.cstn, 
            strm.cstn_ref_compnr, 
            strm.cstp, 
            strm.cstp_ref_compnr, 
            strm.cupr, 
            strm.cupr_ref_compnr, 
            strm.cuxr, 
            strm.cuxr_ref_compnr, 
            strm.cvtm, 
            strm.dbfc, 
            strm.deleted, 
            strm.desc, 
            strm.docn, 
            strm.docn_ref_compnr, 
            strm.eaod, 
            strm.emno, 
            strm.emno_ref_compnr, 
            strm.erdt, 
            strm.espr, 
            strm.estm, 
            strm.fcon, 
            strm.fcon_ref_compnr, 
            strm.inby, 
            strm.inby_kw, 
            strm.inpl, 
            strm.inpl_ref_compnr, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_sern_ref_compnr, 
            strm.item_xrsr_ref_compnr, 
            strm.lcad, 
            strm.lcad_ref_compnr, 
            strm.lftm, 
            strm.mepo, 
            strm.mepo_ref_compnr, 
            strm.micn, 
            strm.micn_kw, 
            strm.mvla, 
            strm.mvln, 
            strm.nivl, 
            strm.noun, 
            strm.obpr, 
            strm.obpr_ref_compnr, 
            strm.oftm, 
            strm.orac, 
            strm.oras, 
            strm.orno, 
            strm.orno_ref_compnr, 
            strm.orps, 
            strm.ostm, 
            strm.pbsm, 
            strm.pbsm_kw, 
            strm.pcac, 
            strm.pcch, 
            strm.pcln, 
            strm.pcon, 
            strm.pcon_pcch_ref_compnr, 
            strm.pcon_ref_compnr, 
            strm.pdvl, 
            strm.pftm, 
            strm.pmtd, 
            strm.pmtd_kw, 
            strm.porg, 
            strm.porg_kw, 
            strm.prac, 
            strm.prac_kw, 
            strm.pris, 
            strm.prpr, 
            strm.prpr_ref_compnr, 
            strm.pstm, 
            strm.ptft, 
            strm.ptst, 
            strm.qtnl, 
            strm.qtno, 
            strm.qtno_revn_qtnl_altn_ref_compnr, 
            strm.revn, 
            strm.rfpt, 
            strm.rltm, 
            strm.rnyn, 
            strm.rnyn_kw, 
            strm.rown, 
            strm.rown_ref_compnr, 
            strm.rrqt, 
            strm.sbit, 
            strm.sbit_ref_compnr, 
            strm.sear, 
            strm.sequencenumber, 
            strm.sern, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.skla, 
            strm.sklb, 
            strm.sklc, 
            strm.smto, 
            strm.smto_kw, 
            strm.ssta, 
            strm.ssta_kw, 
            strm.stad, 
            strm.stad_ref_compnr, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.subc, 
            strm.subc_kw, 
            strm.supm, 
            strm.supm_kw, 
            strm.timestamp, 
            strm.tmun, 
            strm.tmun_kw, 
            strm.trdi, 
            strm.trdi_buln, 
            strm.trdu, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.txtb, 
            strm.txtb_ref_compnr, 
            strm.txtc, 
            strm.txtc_ref_compnr, 
            strm.txtd, 
            strm.txtd_ref_compnr, 
            strm.username, 
            strm.vtbo, 
            strm.vtbo_kw, 
            strm.wrtp, 
            strm.wrtp_kw, 
            strm.wrty, 
            strm.xrcu, 
            strm.xrcu_ref_compnr, 
            strm.xrnh, 
            strm.xrnh_kw, 
            strm.xrrt, 
            strm.xrsr, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.orno,
            strm.acln ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TSSOC210 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.orno=src.orno) OR (target.orno IS NULL AND src.orno IS NULL)) AND
            ((target.acln=src.acln) OR (target.acln IS NULL AND src.acln IS NULL)) 
                when matched then update set
                    target.acdt=src.acdt, 
                    target.acdu=src.acdu, 
                    target.acln=src.acln, 
                    target.actg=src.actg, 
                    target.actg_ref_compnr=src.actg_ref_compnr, 
                    target.adfa=src.adfa, 
                    target.adfa_kw=src.adfa_kw, 
                    target.adin=src.adin, 
                    target.adtm=src.adtm, 
                    target.advl=src.advl, 
                    target.aftm=src.aftm, 
                    target.ains=src.ains, 
                    target.ains_kw=src.ains_kw, 
                    target.aivl=src.aivl, 
                    target.altn=src.altn, 
                    target.amod=src.amod, 
                    target.appo=src.appo, 
                    target.appo_kw=src.appo_kw, 
                    target.asgd=src.asgd, 
                    target.asta=src.asta, 
                    target.asta_kw=src.asta_kw, 
                    target.astm=src.astm, 
                    target.atbl=src.atbl, 
                    target.atbl_kw=src.atbl_kw, 
                    target.atpc=src.atpc, 
                    target.atpc_kw=src.atpc_kw, 
                    target.atpd=src.atpd, 
                    target.bfbp=src.bfbp, 
                    target.bfbp_ref_compnr=src.bfbp_ref_compnr, 
                    target.bsch=src.bsch, 
                    target.bsch_ref_compnr=src.bsch_ref_compnr, 
                    target.cadt=src.cadt, 
                    target.camr=src.camr, 
                    target.camr_ref_compnr=src.camr_ref_compnr, 
                    target.caro_1=src.caro_1, 
                    target.caro_10=src.caro_10, 
                    target.caro_2=src.caro_2, 
                    target.caro_3=src.caro_3, 
                    target.caro_4=src.caro_4, 
                    target.caro_5=src.caro_5, 
                    target.caro_6=src.caro_6, 
                    target.caro_7=src.caro_7, 
                    target.caro_8=src.caro_8, 
                    target.caro_9=src.caro_9, 
                    target.ccar=src.ccar, 
                    target.ccar_ref_compnr=src.ccar_ref_compnr, 
                    target.cchl=src.cchl, 
                    target.cchl_ref_compnr=src.cchl_ref_compnr, 
                    target.ccll=src.ccll, 
                    target.ccll_ref_compnr=src.ccll_ref_compnr, 
                    target.cctp=src.cctp, 
                    target.cctp_ref_compnr=src.cctp_ref_compnr, 
                    target.cdis=src.cdis, 
                    target.cdis_ref_compnr=src.cdis_ref_compnr, 
                    target.clst=src.clst, 
                    target.clst_ref_compnr=src.clst_ref_compnr, 
                    target.cmea=src.cmea, 
                    target.cmea_ref_compnr=src.cmea_ref_compnr, 
                    target.cncd=src.cncd, 
                    target.come=src.come, 
                    target.come_ref_compnr=src.come_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cova=src.cova, 
                    target.cpor=src.cpor, 
                    target.cpor_kw=src.cpor_kw, 
                    target.cprj=src.cprj, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprl=src.cprl, 
                    target.cprl_ref_compnr=src.cprl_ref_compnr, 
                    target.crac=src.crac, 
                    target.crac_ref_compnr=src.crac_ref_compnr, 
                    target.crpu=src.crpu, 
                    target.crpu_kw=src.crpu_kw, 
                    target.crtc=src.crtc, 
                    target.crtc_ref_compnr=src.crtc_ref_compnr, 
                    target.csar=src.csar, 
                    target.csar_ref_compnr=src.csar_ref_compnr, 
                    target.csco=src.csco, 
                    target.csco_ref_compnr=src.csco_ref_compnr, 
                    target.cskt=src.cskt, 
                    target.cskt_ref_compnr=src.cskt_ref_compnr, 
                    target.cspa=src.cspa, 
                    target.cstn=src.cstn, 
                    target.cstn_ref_compnr=src.cstn_ref_compnr, 
                    target.cstp=src.cstp, 
                    target.cstp_ref_compnr=src.cstp_ref_compnr, 
                    target.cupr=src.cupr, 
                    target.cupr_ref_compnr=src.cupr_ref_compnr, 
                    target.cuxr=src.cuxr, 
                    target.cuxr_ref_compnr=src.cuxr_ref_compnr, 
                    target.cvtm=src.cvtm, 
                    target.dbfc=src.dbfc, 
                    target.deleted=src.deleted, 
                    target.desc=src.desc, 
                    target.docn=src.docn, 
                    target.docn_ref_compnr=src.docn_ref_compnr, 
                    target.eaod=src.eaod, 
                    target.emno=src.emno, 
                    target.emno_ref_compnr=src.emno_ref_compnr, 
                    target.erdt=src.erdt, 
                    target.espr=src.espr, 
                    target.estm=src.estm, 
                    target.fcon=src.fcon, 
                    target.fcon_ref_compnr=src.fcon_ref_compnr, 
                    target.inby=src.inby, 
                    target.inby_kw=src.inby_kw, 
                    target.inpl=src.inpl, 
                    target.inpl_ref_compnr=src.inpl_ref_compnr, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_sern_ref_compnr=src.item_sern_ref_compnr, 
                    target.item_xrsr_ref_compnr=src.item_xrsr_ref_compnr, 
                    target.lcad=src.lcad, 
                    target.lcad_ref_compnr=src.lcad_ref_compnr, 
                    target.lftm=src.lftm, 
                    target.mepo=src.mepo, 
                    target.mepo_ref_compnr=src.mepo_ref_compnr, 
                    target.micn=src.micn, 
                    target.micn_kw=src.micn_kw, 
                    target.mvla=src.mvla, 
                    target.mvln=src.mvln, 
                    target.nivl=src.nivl, 
                    target.noun=src.noun, 
                    target.obpr=src.obpr, 
                    target.obpr_ref_compnr=src.obpr_ref_compnr, 
                    target.oftm=src.oftm, 
                    target.orac=src.orac, 
                    target.oras=src.oras, 
                    target.orno=src.orno, 
                    target.orno_ref_compnr=src.orno_ref_compnr, 
                    target.orps=src.orps, 
                    target.ostm=src.ostm, 
                    target.pbsm=src.pbsm, 
                    target.pbsm_kw=src.pbsm_kw, 
                    target.pcac=src.pcac, 
                    target.pcch=src.pcch, 
                    target.pcln=src.pcln, 
                    target.pcon=src.pcon, 
                    target.pcon_pcch_ref_compnr=src.pcon_pcch_ref_compnr, 
                    target.pcon_ref_compnr=src.pcon_ref_compnr, 
                    target.pdvl=src.pdvl, 
                    target.pftm=src.pftm, 
                    target.pmtd=src.pmtd, 
                    target.pmtd_kw=src.pmtd_kw, 
                    target.porg=src.porg, 
                    target.porg_kw=src.porg_kw, 
                    target.prac=src.prac, 
                    target.prac_kw=src.prac_kw, 
                    target.pris=src.pris, 
                    target.prpr=src.prpr, 
                    target.prpr_ref_compnr=src.prpr_ref_compnr, 
                    target.pstm=src.pstm, 
                    target.ptft=src.ptft, 
                    target.ptst=src.ptst, 
                    target.qtnl=src.qtnl, 
                    target.qtno=src.qtno, 
                    target.qtno_revn_qtnl_altn_ref_compnr=src.qtno_revn_qtnl_altn_ref_compnr, 
                    target.revn=src.revn, 
                    target.rfpt=src.rfpt, 
                    target.rltm=src.rltm, 
                    target.rnyn=src.rnyn, 
                    target.rnyn_kw=src.rnyn_kw, 
                    target.rown=src.rown, 
                    target.rown_ref_compnr=src.rown_ref_compnr, 
                    target.rrqt=src.rrqt, 
                    target.sbit=src.sbit, 
                    target.sbit_ref_compnr=src.sbit_ref_compnr, 
                    target.sear=src.sear, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sern=src.sern, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.skla=src.skla, 
                    target.sklb=src.sklb, 
                    target.sklc=src.sklc, 
                    target.smto=src.smto, 
                    target.smto_kw=src.smto_kw, 
                    target.ssta=src.ssta, 
                    target.ssta_kw=src.ssta_kw, 
                    target.stad=src.stad, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.supm=src.supm, 
                    target.supm_kw=src.supm_kw, 
                    target.timestamp=src.timestamp, 
                    target.tmun=src.tmun, 
                    target.tmun_kw=src.tmun_kw, 
                    target.trdi=src.trdi, 
                    target.trdi_buln=src.trdi_buln, 
                    target.trdu=src.trdu, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.txtb=src.txtb, 
                    target.txtb_ref_compnr=src.txtb_ref_compnr, 
                    target.txtc=src.txtc, 
                    target.txtc_ref_compnr=src.txtc_ref_compnr, 
                    target.txtd=src.txtd, 
                    target.txtd_ref_compnr=src.txtd_ref_compnr, 
                    target.username=src.username, 
                    target.vtbo=src.vtbo, 
                    target.vtbo_kw=src.vtbo_kw, 
                    target.wrtp=src.wrtp, 
                    target.wrtp_kw=src.wrtp_kw, 
                    target.wrty=src.wrty, 
                    target.xrcu=src.xrcu, 
                    target.xrcu_ref_compnr=src.xrcu_ref_compnr, 
                    target.xrnh=src.xrnh, 
                    target.xrnh_kw=src.xrnh_kw, 
                    target.xrrt=src.xrrt, 
                    target.xrsr=src.xrsr, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( acdt, acdu, acln, actg, actg_ref_compnr, adfa, adfa_kw, adin, adtm, advl, aftm, ains, ains_kw, aivl, altn, amod, appo, appo_kw, asgd, asta, asta_kw, astm, atbl, atbl_kw, atpc, atpc_kw, atpd, bfbp, bfbp_ref_compnr, bsch, bsch_ref_compnr, cadt, camr, camr_ref_compnr, caro_1, caro_10, caro_2, caro_3, caro_4, caro_5, caro_6, caro_7, caro_8, caro_9, ccar, ccar_ref_compnr, cchl, cchl_ref_compnr, ccll, ccll_ref_compnr, cctp, cctp_ref_compnr, cdis, cdis_ref_compnr, clst, clst_ref_compnr, cmea, cmea_ref_compnr, cncd, come, come_ref_compnr, compnr, cova, cpor, cpor_kw, cprj, cprj_ref_compnr, cprl, cprl_ref_compnr, crac, crac_ref_compnr, crpu, crpu_kw, crtc, crtc_ref_compnr, csar, csar_ref_compnr, csco, csco_ref_compnr, cskt, cskt_ref_compnr, cspa, cstn, cstn_ref_compnr, cstp, cstp_ref_compnr, cupr, cupr_ref_compnr, cuxr, cuxr_ref_compnr, cvtm, dbfc, deleted, desc, docn, docn_ref_compnr, eaod, emno, emno_ref_compnr, erdt, espr, estm, fcon, fcon_ref_compnr, inby, inby_kw, inpl, inpl_ref_compnr, item, item_ref_compnr, item_sern_ref_compnr, item_xrsr_ref_compnr, lcad, lcad_ref_compnr, lftm, mepo, mepo_ref_compnr, micn, micn_kw, mvla, mvln, nivl, noun, obpr, obpr_ref_compnr, oftm, orac, oras, orno, orno_ref_compnr, orps, ostm, pbsm, pbsm_kw, pcac, pcch, pcln, pcon, pcon_pcch_ref_compnr, pcon_ref_compnr, pdvl, pftm, pmtd, pmtd_kw, porg, porg_kw, prac, prac_kw, pris, prpr, prpr_ref_compnr, pstm, ptft, ptst, qtnl, qtno, qtno_revn_qtnl_altn_ref_compnr, revn, rfpt, rltm, rnyn, rnyn_kw, rown, rown_ref_compnr, rrqt, sbit, sbit_ref_compnr, sear, sequencenumber, sern, sfad, sfad_ref_compnr, skla, sklb, sklc, smto, smto_kw, ssta, ssta_kw, stad, stad_ref_compnr, stbp, stbp_ref_compnr, stcn, stcn_ref_compnr, subc, subc_kw, supm, supm_kw, timestamp, tmun, tmun_kw, trdi, trdi_buln, trdu, txta, txta_ref_compnr, txtb, txtb_ref_compnr, txtc, txtc_ref_compnr, txtd, txtd_ref_compnr, username, vtbo, vtbo_kw, wrtp, wrtp_kw, wrty, xrcu, xrcu_ref_compnr, xrnh, xrnh_kw, xrrt, xrsr, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.acdt, 
                    src.acdu, 
                    src.acln, 
                    src.actg, 
                    src.actg_ref_compnr, 
                    src.adfa, 
                    src.adfa_kw, 
                    src.adin, 
                    src.adtm, 
                    src.advl, 
                    src.aftm, 
                    src.ains, 
                    src.ains_kw, 
                    src.aivl, 
                    src.altn, 
                    src.amod, 
                    src.appo, 
                    src.appo_kw, 
                    src.asgd, 
                    src.asta, 
                    src.asta_kw, 
                    src.astm, 
                    src.atbl, 
                    src.atbl_kw, 
                    src.atpc, 
                    src.atpc_kw, 
                    src.atpd, 
                    src.bfbp, 
                    src.bfbp_ref_compnr, 
                    src.bsch, 
                    src.bsch_ref_compnr, 
                    src.cadt, 
                    src.camr, 
                    src.camr_ref_compnr, 
                    src.caro_1, 
                    src.caro_10, 
                    src.caro_2, 
                    src.caro_3, 
                    src.caro_4, 
                    src.caro_5, 
                    src.caro_6, 
                    src.caro_7, 
                    src.caro_8, 
                    src.caro_9, 
                    src.ccar, 
                    src.ccar_ref_compnr, 
                    src.cchl, 
                    src.cchl_ref_compnr, 
                    src.ccll, 
                    src.ccll_ref_compnr, 
                    src.cctp, 
                    src.cctp_ref_compnr, 
                    src.cdis, 
                    src.cdis_ref_compnr, 
                    src.clst, 
                    src.clst_ref_compnr, 
                    src.cmea, 
                    src.cmea_ref_compnr, 
                    src.cncd, 
                    src.come, 
                    src.come_ref_compnr, 
                    src.compnr, 
                    src.cova, 
                    src.cpor, 
                    src.cpor_kw, 
                    src.cprj, 
                    src.cprj_ref_compnr, 
                    src.cprl, 
                    src.cprl_ref_compnr, 
                    src.crac, 
                    src.crac_ref_compnr, 
                    src.crpu, 
                    src.crpu_kw, 
                    src.crtc, 
                    src.crtc_ref_compnr, 
                    src.csar, 
                    src.csar_ref_compnr, 
                    src.csco, 
                    src.csco_ref_compnr, 
                    src.cskt, 
                    src.cskt_ref_compnr, 
                    src.cspa, 
                    src.cstn, 
                    src.cstn_ref_compnr, 
                    src.cstp, 
                    src.cstp_ref_compnr, 
                    src.cupr, 
                    src.cupr_ref_compnr, 
                    src.cuxr, 
                    src.cuxr_ref_compnr, 
                    src.cvtm, 
                    src.dbfc, 
                    src.deleted, 
                    src.desc, 
                    src.docn, 
                    src.docn_ref_compnr, 
                    src.eaod, 
                    src.emno, 
                    src.emno_ref_compnr, 
                    src.erdt, 
                    src.espr, 
                    src.estm, 
                    src.fcon, 
                    src.fcon_ref_compnr, 
                    src.inby, 
                    src.inby_kw, 
                    src.inpl, 
                    src.inpl_ref_compnr, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_sern_ref_compnr, 
                    src.item_xrsr_ref_compnr, 
                    src.lcad, 
                    src.lcad_ref_compnr, 
                    src.lftm, 
                    src.mepo, 
                    src.mepo_ref_compnr, 
                    src.micn, 
                    src.micn_kw, 
                    src.mvla, 
                    src.mvln, 
                    src.nivl, 
                    src.noun, 
                    src.obpr, 
                    src.obpr_ref_compnr, 
                    src.oftm, 
                    src.orac, 
                    src.oras, 
                    src.orno, 
                    src.orno_ref_compnr, 
                    src.orps, 
                    src.ostm, 
                    src.pbsm, 
                    src.pbsm_kw, 
                    src.pcac, 
                    src.pcch, 
                    src.pcln, 
                    src.pcon, 
                    src.pcon_pcch_ref_compnr, 
                    src.pcon_ref_compnr, 
                    src.pdvl, 
                    src.pftm, 
                    src.pmtd, 
                    src.pmtd_kw, 
                    src.porg, 
                    src.porg_kw, 
                    src.prac, 
                    src.prac_kw, 
                    src.pris, 
                    src.prpr, 
                    src.prpr_ref_compnr, 
                    src.pstm, 
                    src.ptft, 
                    src.ptst, 
                    src.qtnl, 
                    src.qtno, 
                    src.qtno_revn_qtnl_altn_ref_compnr, 
                    src.revn, 
                    src.rfpt, 
                    src.rltm, 
                    src.rnyn, 
                    src.rnyn_kw, 
                    src.rown, 
                    src.rown_ref_compnr, 
                    src.rrqt, 
                    src.sbit, 
                    src.sbit_ref_compnr, 
                    src.sear, 
                    src.sequencenumber, 
                    src.sern, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.skla, 
                    src.sklb, 
                    src.sklc, 
                    src.smto, 
                    src.smto_kw, 
                    src.ssta, 
                    src.ssta_kw, 
                    src.stad, 
                    src.stad_ref_compnr, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.subc, 
                    src.subc_kw, 
                    src.supm, 
                    src.supm_kw, 
                    src.timestamp, 
                    src.tmun, 
                    src.tmun_kw, 
                    src.trdi, 
                    src.trdi_buln, 
                    src.trdu, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.txtb, 
                    src.txtb_ref_compnr, 
                    src.txtc, 
                    src.txtc_ref_compnr, 
                    src.txtd, 
                    src.txtd_ref_compnr, 
                    src.username, 
                    src.vtbo, 
                    src.vtbo_kw, 
                    src.wrtp, 
                    src.wrtp_kw, 
                    src.wrty, 
                    src.xrcu, 
                    src.xrcu_ref_compnr, 
                    src.xrnh, 
                    src.xrnh_kw, 
                    src.xrrt, 
                    src.xrsr,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;