create or replace procedure DATAHUB_INTEGRATION.SP_LN_TDPUR301()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TDPUR301_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TDPUR301 as target using (SELECT * FROM (SELECT 
            strm.aemq, 
            strm.aemq_kw, 
            strm.bamt, 
            strm.bamt_dtwc, 
            strm.bamt_lclc, 
            strm.bamt_rfrc, 
            strm.bamt_rpc1, 
            strm.bamt_rpc2, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.cadr, 
            strm.cadr_ref_compnr, 
            strm.caga, 
            strm.caga_dtwc, 
            strm.caga_lclc, 
            strm.caga_rfrc, 
            strm.caga_rpc1, 
            strm.caga_rpc2, 
            strm.camt, 
            strm.camt_dtwc, 
            strm.camt_lclc, 
            strm.camt_rfrc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.ccon, 
            strm.ccon_ref_compnr, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdf_cdsc, 
            strm.cdf_clmt, 
            strm.cdf_comt, 
            strm.cdf_idet, 
            strm.cdf_ramt, 
            strm.cdf_refe, 
            strm.cdf_sctg, 
            strm.ceno, 
            strm.citt, 
            strm.citt_ref_compnr, 
            strm.cltp, 
            strm.cltp_kw, 
            strm.cmnf, 
            strm.cmnf_ref_compnr, 
            strm.cncd, 
            strm.cofc, 
            strm.cofc_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_ref_compnr, 
            strm.cons, 
            strm.cons_kw, 
            strm.cpgp, 
            strm.cpgp_ref_compnr, 
            strm.crit, 
            strm.crrf, 
            strm.crrf_kw, 
            strm.csqn, 
            strm.csts, 
            strm.csts_kw, 
            strm.cuqp, 
            strm.cuqp_ref_compnr, 
            strm.cvat, 
            strm.cvqp, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dsch, 
            strm.dsch_kw, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.iaga, 
            strm.iaga_dtwc, 
            strm.iaga_lclc, 
            strm.iaga_rfrc, 
            strm.iaga_rpc1, 
            strm.iaga_rpc2, 
            strm.icap, 
            strm.icap_kw, 
            strm.icyp, 
            strm.icyp_kw, 
            strm.ieva, 
            strm.ieva_kw, 
            strm.iqab, 
            strm.iqab_kw, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.leng, 
            strm.mpnr, 
            strm.mpnr_cmnf_ref_compnr, 
            strm.mqtl, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.ncmp, 
            strm.ncmp_ref_compnr, 
            strm.obpr, 
            strm.obpr_kw, 
            strm.otbp, 
            strm.otbp_ref_compnr, 
            strm.owno, 
            strm.paft, 
            strm.paft_kw, 
            strm.poff, 
            strm.poff_ref_compnr, 
            strm.pono, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qiap, 
            strm.qicl, 
            strm.qicl_buar, 
            strm.qicl_buln, 
            strm.qicl_bupc, 
            strm.qicl_butm, 
            strm.qicl_buvl, 
            strm.qicl_buwg, 
            strm.qicl_trnu, 
            strm.qiec, 
            strm.qifi, 
            strm.qigc, 
            strm.qigc_buar, 
            strm.qigc_buln, 
            strm.qigc_bupc, 
            strm.qigc_butm, 
            strm.qigc_buvl, 
            strm.qigc_buwg, 
            strm.qigc_trnu, 
            strm.qigi, 
            strm.qigi_buar, 
            strm.qigi_buln, 
            strm.qigi_bupc, 
            strm.qigi_butm, 
            strm.qigi_buvl, 
            strm.qigi_buwg, 
            strm.qigi_trnu, 
            strm.qiiv, 
            strm.qiiv_buar, 
            strm.qiiv_buln, 
            strm.qiiv_bupc, 
            strm.qiiv_butm, 
            strm.qiiv_buvl, 
            strm.qiiv_buwg, 
            strm.qiiv_trnu, 
            strm.qima, 
            strm.qimf, 
            strm.qimi, 
            strm.qogo, 
            strm.qogo_buar, 
            strm.qogo_buln, 
            strm.qogo_bupc, 
            strm.qogo_butm, 
            strm.qogo_buvl, 
            strm.qogo_buwg, 
            strm.qogo_invu, 
            strm.qomn, 
            strm.qomx, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.qual, 
            strm.qual_kw, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.rcsi, 
            strm.rcsi_ref_compnr, 
            strm.revi, 
            strm.rpdr, 
            strm.rpdr_kw, 
            strm.sbdt, 
            strm.sbdt_kw, 
            strm.sbim, 
            strm.sbim_kw, 
            strm.sbmt, 
            strm.sbmt_ref_compnr, 
            strm.scus, 
            strm.scus_kw, 
            strm.sdat, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.sequencenumber, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.sfbp, 
            strm.sfbp_ref_compnr, 
            strm.sfcn, 
            strm.sfcn_ref_compnr, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.subc, 
            strm.subc_kw, 
            strm.subs, 
            strm.subs_ref_compnr, 
            strm.thic, 
            strm.timestamp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.txtt, 
            strm.txtt_ref_compnr, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.pono,
            strm.cofc,
            strm.csqn ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDPUR301 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.cofc=src.cofc) OR (target.cofc IS NULL AND src.cofc IS NULL)) AND
            ((target.csqn=src.csqn) OR (target.csqn IS NULL AND src.csqn IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.aemq=src.aemq, 
                    target.aemq_kw=src.aemq_kw, 
                    target.bamt=src.bamt, 
                    target.bamt_dtwc=src.bamt_dtwc, 
                    target.bamt_lclc=src.bamt_lclc, 
                    target.bamt_rfrc=src.bamt_rfrc, 
                    target.bamt_rpc1=src.bamt_rpc1, 
                    target.bamt_rpc2=src.bamt_rpc2, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.cadr=src.cadr, 
                    target.cadr_ref_compnr=src.cadr_ref_compnr, 
                    target.caga=src.caga, 
                    target.caga_dtwc=src.caga_dtwc, 
                    target.caga_lclc=src.caga_lclc, 
                    target.caga_rfrc=src.caga_rfrc, 
                    target.caga_rpc1=src.caga_rpc1, 
                    target.caga_rpc2=src.caga_rpc2, 
                    target.camt=src.camt, 
                    target.camt_dtwc=src.camt_dtwc, 
                    target.camt_lclc=src.camt_lclc, 
                    target.camt_rfrc=src.camt_rfrc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.ccon=src.ccon, 
                    target.ccon_ref_compnr=src.ccon_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdf_cdsc=src.cdf_cdsc, 
                    target.cdf_clmt=src.cdf_clmt, 
                    target.cdf_comt=src.cdf_comt, 
                    target.cdf_idet=src.cdf_idet, 
                    target.cdf_ramt=src.cdf_ramt, 
                    target.cdf_refe=src.cdf_refe, 
                    target.cdf_sctg=src.cdf_sctg, 
                    target.ceno=src.ceno, 
                    target.citt=src.citt, 
                    target.citt_ref_compnr=src.citt_ref_compnr, 
                    target.cltp=src.cltp, 
                    target.cltp_kw=src.cltp_kw, 
                    target.cmnf=src.cmnf, 
                    target.cmnf_ref_compnr=src.cmnf_ref_compnr, 
                    target.cncd=src.cncd, 
                    target.cofc=src.cofc, 
                    target.cofc_ref_compnr=src.cofc_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.cons=src.cons, 
                    target.cons_kw=src.cons_kw, 
                    target.cpgp=src.cpgp, 
                    target.cpgp_ref_compnr=src.cpgp_ref_compnr, 
                    target.crit=src.crit, 
                    target.crrf=src.crrf, 
                    target.crrf_kw=src.crrf_kw, 
                    target.csqn=src.csqn, 
                    target.csts=src.csts, 
                    target.csts_kw=src.csts_kw, 
                    target.cuqp=src.cuqp, 
                    target.cuqp_ref_compnr=src.cuqp_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvqp=src.cvqp, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dsch=src.dsch, 
                    target.dsch_kw=src.dsch_kw, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.iaga=src.iaga, 
                    target.iaga_dtwc=src.iaga_dtwc, 
                    target.iaga_lclc=src.iaga_lclc, 
                    target.iaga_rfrc=src.iaga_rfrc, 
                    target.iaga_rpc1=src.iaga_rpc1, 
                    target.iaga_rpc2=src.iaga_rpc2, 
                    target.icap=src.icap, 
                    target.icap_kw=src.icap_kw, 
                    target.icyp=src.icyp, 
                    target.icyp_kw=src.icyp_kw, 
                    target.ieva=src.ieva, 
                    target.ieva_kw=src.ieva_kw, 
                    target.iqab=src.iqab, 
                    target.iqab_kw=src.iqab_kw, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.leng=src.leng, 
                    target.mpnr=src.mpnr, 
                    target.mpnr_cmnf_ref_compnr=src.mpnr_cmnf_ref_compnr, 
                    target.mqtl=src.mqtl, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.ncmp=src.ncmp, 
                    target.ncmp_ref_compnr=src.ncmp_ref_compnr, 
                    target.obpr=src.obpr, 
                    target.obpr_kw=src.obpr_kw, 
                    target.otbp=src.otbp, 
                    target.otbp_ref_compnr=src.otbp_ref_compnr, 
                    target.owno=src.owno, 
                    target.paft=src.paft, 
                    target.paft_kw=src.paft_kw, 
                    target.poff=src.poff, 
                    target.poff_ref_compnr=src.poff_ref_compnr, 
                    target.pono=src.pono, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qiap=src.qiap, 
                    target.qicl=src.qicl, 
                    target.qicl_buar=src.qicl_buar, 
                    target.qicl_buln=src.qicl_buln, 
                    target.qicl_bupc=src.qicl_bupc, 
                    target.qicl_butm=src.qicl_butm, 
                    target.qicl_buvl=src.qicl_buvl, 
                    target.qicl_buwg=src.qicl_buwg, 
                    target.qicl_trnu=src.qicl_trnu, 
                    target.qiec=src.qiec, 
                    target.qifi=src.qifi, 
                    target.qigc=src.qigc, 
                    target.qigc_buar=src.qigc_buar, 
                    target.qigc_buln=src.qigc_buln, 
                    target.qigc_bupc=src.qigc_bupc, 
                    target.qigc_butm=src.qigc_butm, 
                    target.qigc_buvl=src.qigc_buvl, 
                    target.qigc_buwg=src.qigc_buwg, 
                    target.qigc_trnu=src.qigc_trnu, 
                    target.qigi=src.qigi, 
                    target.qigi_buar=src.qigi_buar, 
                    target.qigi_buln=src.qigi_buln, 
                    target.qigi_bupc=src.qigi_bupc, 
                    target.qigi_butm=src.qigi_butm, 
                    target.qigi_buvl=src.qigi_buvl, 
                    target.qigi_buwg=src.qigi_buwg, 
                    target.qigi_trnu=src.qigi_trnu, 
                    target.qiiv=src.qiiv, 
                    target.qiiv_buar=src.qiiv_buar, 
                    target.qiiv_buln=src.qiiv_buln, 
                    target.qiiv_bupc=src.qiiv_bupc, 
                    target.qiiv_butm=src.qiiv_butm, 
                    target.qiiv_buvl=src.qiiv_buvl, 
                    target.qiiv_buwg=src.qiiv_buwg, 
                    target.qiiv_trnu=src.qiiv_trnu, 
                    target.qima=src.qima, 
                    target.qimf=src.qimf, 
                    target.qimi=src.qimi, 
                    target.qogo=src.qogo, 
                    target.qogo_buar=src.qogo_buar, 
                    target.qogo_buln=src.qogo_buln, 
                    target.qogo_bupc=src.qogo_bupc, 
                    target.qogo_butm=src.qogo_butm, 
                    target.qogo_buvl=src.qogo_buvl, 
                    target.qogo_buwg=src.qogo_buwg, 
                    target.qogo_invu=src.qogo_invu, 
                    target.qomn=src.qomn, 
                    target.qomx=src.qomx, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.qual=src.qual, 
                    target.qual_kw=src.qual_kw, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.rcsi=src.rcsi, 
                    target.rcsi_ref_compnr=src.rcsi_ref_compnr, 
                    target.revi=src.revi, 
                    target.rpdr=src.rpdr, 
                    target.rpdr_kw=src.rpdr_kw, 
                    target.sbdt=src.sbdt, 
                    target.sbdt_kw=src.sbdt_kw, 
                    target.sbim=src.sbim, 
                    target.sbim_kw=src.sbim_kw, 
                    target.sbmt=src.sbmt, 
                    target.sbmt_ref_compnr=src.sbmt_ref_compnr, 
                    target.scus=src.scus, 
                    target.scus_kw=src.scus_kw, 
                    target.sdat=src.sdat, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.sfbp=src.sfbp, 
                    target.sfbp_ref_compnr=src.sfbp_ref_compnr, 
                    target.sfcn=src.sfcn, 
                    target.sfcn_ref_compnr=src.sfcn_ref_compnr, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.subs=src.subs, 
                    target.subs_ref_compnr=src.subs_ref_compnr, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.txtt=src.txtt, 
                    target.txtt_ref_compnr=src.txtt_ref_compnr, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    aemq, 
                    aemq_kw, 
                    bamt, 
                    bamt_dtwc, 
                    bamt_lclc, 
                    bamt_rfrc, 
                    bamt_rpc1, 
                    bamt_rpc2, 
                    bpcl, 
                    bpcl_ref_compnr, 
                    bptc, 
                    bptc_ref_compnr, 
                    cadr, 
                    cadr_ref_compnr, 
                    caga, 
                    caga_dtwc, 
                    caga_lclc, 
                    caga_rfrc, 
                    caga_rpc1, 
                    caga_rpc2, 
                    camt, 
                    camt_dtwc, 
                    camt_lclc, 
                    camt_rfrc, 
                    camt_rpc1, 
                    camt_rpc2, 
                    ccon, 
                    ccon_ref_compnr, 
                    ccty, 
                    ccty_cvat_ref_compnr, 
                    ccty_ref_compnr, 
                    cdat, 
                    cdec, 
                    cdec_ref_compnr, 
                    cdf_cdsc, 
                    cdf_clmt, 
                    cdf_comt, 
                    cdf_idet, 
                    cdf_ramt, 
                    cdf_refe, 
                    cdf_sctg, 
                    ceno, 
                    citt, 
                    citt_ref_compnr, 
                    cltp, 
                    cltp_kw, 
                    cmnf, 
                    cmnf_ref_compnr, 
                    cncd, 
                    cofc, 
                    cofc_ref_compnr, 
                    compnr, 
                    cono, 
                    cono_ref_compnr, 
                    cons, 
                    cons_kw, 
                    cpgp, 
                    cpgp_ref_compnr, 
                    crit, 
                    crrf, 
                    crrf_kw, 
                    csqn, 
                    csts, 
                    csts_kw, 
                    cuqp, 
                    cuqp_ref_compnr, 
                    cvat, 
                    cvqp, 
                    cwar, 
                    cwar_ref_compnr, 
                    deleted, 
                    dsch, 
                    dsch_kw, 
                    edat, 
                    effn, 
                    effn_ref_compnr, 
                    exmt, 
                    exmt_kw, 
                    gamt_dtwc, 
                    gamt_lclc, 
                    gamt_rfrc, 
                    gamt_rpc1, 
                    gamt_rpc2, 
                    gamt_trnc, 
                    iaga, 
                    iaga_dtwc, 
                    iaga_lclc, 
                    iaga_rfrc, 
                    iaga_rpc1, 
                    iaga_rpc2, 
                    icap, 
                    icap_kw, 
                    icyp, 
                    icyp_kw, 
                    ieva, 
                    ieva_kw, 
                    iqab, 
                    iqab_kw, 
                    item, 
                    item_ref_compnr, 
                    leng, 
                    mpnr, 
                    mpnr_cmnf_ref_compnr, 
                    mqtl, 
                    namt_dtwc, 
                    namt_lclc, 
                    namt_rfrc, 
                    namt_rpc1, 
                    namt_rpc2, 
                    namt_trnc, 
                    ncmp, 
                    ncmp_ref_compnr, 
                    obpr, 
                    obpr_kw, 
                    otbp, 
                    otbp_ref_compnr, 
                    owno, 
                    paft, 
                    paft_kw, 
                    poff, 
                    poff_ref_compnr, 
                    pono, 
                    ptpa, 
                    ptpa_ref_compnr, 
                    qiap, 
                    qicl, 
                    qicl_buar, 
                    qicl_buln, 
                    qicl_bupc, 
                    qicl_butm, 
                    qicl_buvl, 
                    qicl_buwg, 
                    qicl_trnu, 
                    qiec, 
                    qifi, 
                    qigc, 
                    qigc_buar, 
                    qigc_buln, 
                    qigc_bupc, 
                    qigc_butm, 
                    qigc_buvl, 
                    qigc_buwg, 
                    qigc_trnu, 
                    qigi, 
                    qigi_buar, 
                    qigi_buln, 
                    qigi_bupc, 
                    qigi_butm, 
                    qigi_buvl, 
                    qigi_buwg, 
                    qigi_trnu, 
                    qiiv, 
                    qiiv_buar, 
                    qiiv_buln, 
                    qiiv_bupc, 
                    qiiv_butm, 
                    qiiv_buvl, 
                    qiiv_buwg, 
                    qiiv_trnu, 
                    qima, 
                    qimf, 
                    qimi, 
                    qogo, 
                    qogo_buar, 
                    qogo_buln, 
                    qogo_bupc, 
                    qogo_butm, 
                    qogo_buvl, 
                    qogo_buwg, 
                    qogo_invu, 
                    qomn, 
                    qomx, 
                    qoor, 
                    qoor_buar, 
                    qoor_buln, 
                    qoor_bupc, 
                    qoor_butm, 
                    qoor_buvl, 
                    qoor_buwg, 
                    qoor_invu, 
                    qual, 
                    qual_kw, 
                    rcod, 
                    rcod_ref_compnr, 
                    rcsi, 
                    rcsi_ref_compnr, 
                    revi, 
                    rpdr, 
                    rpdr_kw, 
                    sbdt, 
                    sbdt_kw, 
                    sbim, 
                    sbim_kw, 
                    sbmt, 
                    sbmt_ref_compnr, 
                    scus, 
                    scus_kw, 
                    sdat, 
                    sdsc, 
                    sdsc_kw, 
                    sequencenumber, 
                    sfad, 
                    sfad_ref_compnr, 
                    sfbp, 
                    sfbp_ref_compnr, 
                    sfcn, 
                    sfcn_ref_compnr, 
                    site, 
                    site_ref_compnr, 
                    subc, 
                    subc_kw, 
                    subs, 
                    subs_ref_compnr, 
                    thic, 
                    timestamp, 
                    txta, 
                    txta_ref_compnr, 
                    txtt, 
                    txtt_ref_compnr, 
                    username, 
                    widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.aemq, 
                    src.aemq_kw, 
                    src.bamt, 
                    src.bamt_dtwc, 
                    src.bamt_lclc, 
                    src.bamt_rfrc, 
                    src.bamt_rpc1, 
                    src.bamt_rpc2, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.cadr, 
                    src.cadr_ref_compnr, 
                    src.caga, 
                    src.caga_dtwc, 
                    src.caga_lclc, 
                    src.caga_rfrc, 
                    src.caga_rpc1, 
                    src.caga_rpc2, 
                    src.camt, 
                    src.camt_dtwc, 
                    src.camt_lclc, 
                    src.camt_rfrc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.ccon, 
                    src.ccon_ref_compnr, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdf_cdsc, 
                    src.cdf_clmt, 
                    src.cdf_comt, 
                    src.cdf_idet, 
                    src.cdf_ramt, 
                    src.cdf_refe, 
                    src.cdf_sctg, 
                    src.ceno, 
                    src.citt, 
                    src.citt_ref_compnr, 
                    src.cltp, 
                    src.cltp_kw, 
                    src.cmnf, 
                    src.cmnf_ref_compnr, 
                    src.cncd, 
                    src.cofc, 
                    src.cofc_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_ref_compnr, 
                    src.cons, 
                    src.cons_kw, 
                    src.cpgp, 
                    src.cpgp_ref_compnr, 
                    src.crit, 
                    src.crrf, 
                    src.crrf_kw, 
                    src.csqn, 
                    src.csts, 
                    src.csts_kw, 
                    src.cuqp, 
                    src.cuqp_ref_compnr, 
                    src.cvat, 
                    src.cvqp, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dsch, 
                    src.dsch_kw, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.iaga, 
                    src.iaga_dtwc, 
                    src.iaga_lclc, 
                    src.iaga_rfrc, 
                    src.iaga_rpc1, 
                    src.iaga_rpc2, 
                    src.icap, 
                    src.icap_kw, 
                    src.icyp, 
                    src.icyp_kw, 
                    src.ieva, 
                    src.ieva_kw, 
                    src.iqab, 
                    src.iqab_kw, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.leng, 
                    src.mpnr, 
                    src.mpnr_cmnf_ref_compnr, 
                    src.mqtl, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.ncmp, 
                    src.ncmp_ref_compnr, 
                    src.obpr, 
                    src.obpr_kw, 
                    src.otbp, 
                    src.otbp_ref_compnr, 
                    src.owno, 
                    src.paft, 
                    src.paft_kw, 
                    src.poff, 
                    src.poff_ref_compnr, 
                    src.pono, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qiap, 
                    src.qicl, 
                    src.qicl_buar, 
                    src.qicl_buln, 
                    src.qicl_bupc, 
                    src.qicl_butm, 
                    src.qicl_buvl, 
                    src.qicl_buwg, 
                    src.qicl_trnu, 
                    src.qiec, 
                    src.qifi, 
                    src.qigc, 
                    src.qigc_buar, 
                    src.qigc_buln, 
                    src.qigc_bupc, 
                    src.qigc_butm, 
                    src.qigc_buvl, 
                    src.qigc_buwg, 
                    src.qigc_trnu, 
                    src.qigi, 
                    src.qigi_buar, 
                    src.qigi_buln, 
                    src.qigi_bupc, 
                    src.qigi_butm, 
                    src.qigi_buvl, 
                    src.qigi_buwg, 
                    src.qigi_trnu, 
                    src.qiiv, 
                    src.qiiv_buar, 
                    src.qiiv_buln, 
                    src.qiiv_bupc, 
                    src.qiiv_butm, 
                    src.qiiv_buvl, 
                    src.qiiv_buwg, 
                    src.qiiv_trnu, 
                    src.qima, 
                    src.qimf, 
                    src.qimi, 
                    src.qogo, 
                    src.qogo_buar, 
                    src.qogo_buln, 
                    src.qogo_bupc, 
                    src.qogo_butm, 
                    src.qogo_buvl, 
                    src.qogo_buwg, 
                    src.qogo_invu, 
                    src.qomn, 
                    src.qomx, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.qual, 
                    src.qual_kw, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.rcsi, 
                    src.rcsi_ref_compnr, 
                    src.revi, 
                    src.rpdr, 
                    src.rpdr_kw, 
                    src.sbdt, 
                    src.sbdt_kw, 
                    src.sbim, 
                    src.sbim_kw, 
                    src.sbmt, 
                    src.sbmt_ref_compnr, 
                    src.scus, 
                    src.scus_kw, 
                    src.sdat, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.sequencenumber, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.sfbp, 
                    src.sfbp_ref_compnr, 
                    src.sfcn, 
                    src.sfcn_ref_compnr, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.subc, 
                    src.subc_kw, 
                    src.subs, 
                    src.subs_ref_compnr, 
                    src.thic, 
                    src.timestamp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.txtt, 
                    src.txtt_ref_compnr, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TDPUR301_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.aemq, 
            strm.aemq_kw, 
            strm.bamt, 
            strm.bamt_dtwc, 
            strm.bamt_lclc, 
            strm.bamt_rfrc, 
            strm.bamt_rpc1, 
            strm.bamt_rpc2, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.cadr, 
            strm.cadr_ref_compnr, 
            strm.caga, 
            strm.caga_dtwc, 
            strm.caga_lclc, 
            strm.caga_rfrc, 
            strm.caga_rpc1, 
            strm.caga_rpc2, 
            strm.camt, 
            strm.camt_dtwc, 
            strm.camt_lclc, 
            strm.camt_rfrc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.ccon, 
            strm.ccon_ref_compnr, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdf_cdsc, 
            strm.cdf_clmt, 
            strm.cdf_comt, 
            strm.cdf_idet, 
            strm.cdf_ramt, 
            strm.cdf_refe, 
            strm.cdf_sctg, 
            strm.ceno, 
            strm.citt, 
            strm.citt_ref_compnr, 
            strm.cltp, 
            strm.cltp_kw, 
            strm.cmnf, 
            strm.cmnf_ref_compnr, 
            strm.cncd, 
            strm.cofc, 
            strm.cofc_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_ref_compnr, 
            strm.cons, 
            strm.cons_kw, 
            strm.cpgp, 
            strm.cpgp_ref_compnr, 
            strm.crit, 
            strm.crrf, 
            strm.crrf_kw, 
            strm.csqn, 
            strm.csts, 
            strm.csts_kw, 
            strm.cuqp, 
            strm.cuqp_ref_compnr, 
            strm.cvat, 
            strm.cvqp, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dsch, 
            strm.dsch_kw, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.iaga, 
            strm.iaga_dtwc, 
            strm.iaga_lclc, 
            strm.iaga_rfrc, 
            strm.iaga_rpc1, 
            strm.iaga_rpc2, 
            strm.icap, 
            strm.icap_kw, 
            strm.icyp, 
            strm.icyp_kw, 
            strm.ieva, 
            strm.ieva_kw, 
            strm.iqab, 
            strm.iqab_kw, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.leng, 
            strm.mpnr, 
            strm.mpnr_cmnf_ref_compnr, 
            strm.mqtl, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.ncmp, 
            strm.ncmp_ref_compnr, 
            strm.obpr, 
            strm.obpr_kw, 
            strm.otbp, 
            strm.otbp_ref_compnr, 
            strm.owno, 
            strm.paft, 
            strm.paft_kw, 
            strm.poff, 
            strm.poff_ref_compnr, 
            strm.pono, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qiap, 
            strm.qicl, 
            strm.qicl_buar, 
            strm.qicl_buln, 
            strm.qicl_bupc, 
            strm.qicl_butm, 
            strm.qicl_buvl, 
            strm.qicl_buwg, 
            strm.qicl_trnu, 
            strm.qiec, 
            strm.qifi, 
            strm.qigc, 
            strm.qigc_buar, 
            strm.qigc_buln, 
            strm.qigc_bupc, 
            strm.qigc_butm, 
            strm.qigc_buvl, 
            strm.qigc_buwg, 
            strm.qigc_trnu, 
            strm.qigi, 
            strm.qigi_buar, 
            strm.qigi_buln, 
            strm.qigi_bupc, 
            strm.qigi_butm, 
            strm.qigi_buvl, 
            strm.qigi_buwg, 
            strm.qigi_trnu, 
            strm.qiiv, 
            strm.qiiv_buar, 
            strm.qiiv_buln, 
            strm.qiiv_bupc, 
            strm.qiiv_butm, 
            strm.qiiv_buvl, 
            strm.qiiv_buwg, 
            strm.qiiv_trnu, 
            strm.qima, 
            strm.qimf, 
            strm.qimi, 
            strm.qogo, 
            strm.qogo_buar, 
            strm.qogo_buln, 
            strm.qogo_bupc, 
            strm.qogo_butm, 
            strm.qogo_buvl, 
            strm.qogo_buwg, 
            strm.qogo_invu, 
            strm.qomn, 
            strm.qomx, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.qual, 
            strm.qual_kw, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.rcsi, 
            strm.rcsi_ref_compnr, 
            strm.revi, 
            strm.rpdr, 
            strm.rpdr_kw, 
            strm.sbdt, 
            strm.sbdt_kw, 
            strm.sbim, 
            strm.sbim_kw, 
            strm.sbmt, 
            strm.sbmt_ref_compnr, 
            strm.scus, 
            strm.scus_kw, 
            strm.sdat, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.sequencenumber, 
            strm.sfad, 
            strm.sfad_ref_compnr, 
            strm.sfbp, 
            strm.sfbp_ref_compnr, 
            strm.sfcn, 
            strm.sfcn_ref_compnr, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.subc, 
            strm.subc_kw, 
            strm.subs, 
            strm.subs_ref_compnr, 
            strm.thic, 
            strm.timestamp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.txtt, 
            strm.txtt_ref_compnr, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.pono,
            strm.cofc,
            strm.csqn ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDPUR301 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.cofc=src.cofc) OR (target.cofc IS NULL AND src.cofc IS NULL)) AND
            ((target.csqn=src.csqn) OR (target.csqn IS NULL AND src.csqn IS NULL)) 
                when matched then update set
                    target.aemq=src.aemq, 
                    target.aemq_kw=src.aemq_kw, 
                    target.bamt=src.bamt, 
                    target.bamt_dtwc=src.bamt_dtwc, 
                    target.bamt_lclc=src.bamt_lclc, 
                    target.bamt_rfrc=src.bamt_rfrc, 
                    target.bamt_rpc1=src.bamt_rpc1, 
                    target.bamt_rpc2=src.bamt_rpc2, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.cadr=src.cadr, 
                    target.cadr_ref_compnr=src.cadr_ref_compnr, 
                    target.caga=src.caga, 
                    target.caga_dtwc=src.caga_dtwc, 
                    target.caga_lclc=src.caga_lclc, 
                    target.caga_rfrc=src.caga_rfrc, 
                    target.caga_rpc1=src.caga_rpc1, 
                    target.caga_rpc2=src.caga_rpc2, 
                    target.camt=src.camt, 
                    target.camt_dtwc=src.camt_dtwc, 
                    target.camt_lclc=src.camt_lclc, 
                    target.camt_rfrc=src.camt_rfrc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.ccon=src.ccon, 
                    target.ccon_ref_compnr=src.ccon_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdf_cdsc=src.cdf_cdsc, 
                    target.cdf_clmt=src.cdf_clmt, 
                    target.cdf_comt=src.cdf_comt, 
                    target.cdf_idet=src.cdf_idet, 
                    target.cdf_ramt=src.cdf_ramt, 
                    target.cdf_refe=src.cdf_refe, 
                    target.cdf_sctg=src.cdf_sctg, 
                    target.ceno=src.ceno, 
                    target.citt=src.citt, 
                    target.citt_ref_compnr=src.citt_ref_compnr, 
                    target.cltp=src.cltp, 
                    target.cltp_kw=src.cltp_kw, 
                    target.cmnf=src.cmnf, 
                    target.cmnf_ref_compnr=src.cmnf_ref_compnr, 
                    target.cncd=src.cncd, 
                    target.cofc=src.cofc, 
                    target.cofc_ref_compnr=src.cofc_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.cons=src.cons, 
                    target.cons_kw=src.cons_kw, 
                    target.cpgp=src.cpgp, 
                    target.cpgp_ref_compnr=src.cpgp_ref_compnr, 
                    target.crit=src.crit, 
                    target.crrf=src.crrf, 
                    target.crrf_kw=src.crrf_kw, 
                    target.csqn=src.csqn, 
                    target.csts=src.csts, 
                    target.csts_kw=src.csts_kw, 
                    target.cuqp=src.cuqp, 
                    target.cuqp_ref_compnr=src.cuqp_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvqp=src.cvqp, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dsch=src.dsch, 
                    target.dsch_kw=src.dsch_kw, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.iaga=src.iaga, 
                    target.iaga_dtwc=src.iaga_dtwc, 
                    target.iaga_lclc=src.iaga_lclc, 
                    target.iaga_rfrc=src.iaga_rfrc, 
                    target.iaga_rpc1=src.iaga_rpc1, 
                    target.iaga_rpc2=src.iaga_rpc2, 
                    target.icap=src.icap, 
                    target.icap_kw=src.icap_kw, 
                    target.icyp=src.icyp, 
                    target.icyp_kw=src.icyp_kw, 
                    target.ieva=src.ieva, 
                    target.ieva_kw=src.ieva_kw, 
                    target.iqab=src.iqab, 
                    target.iqab_kw=src.iqab_kw, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.leng=src.leng, 
                    target.mpnr=src.mpnr, 
                    target.mpnr_cmnf_ref_compnr=src.mpnr_cmnf_ref_compnr, 
                    target.mqtl=src.mqtl, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.ncmp=src.ncmp, 
                    target.ncmp_ref_compnr=src.ncmp_ref_compnr, 
                    target.obpr=src.obpr, 
                    target.obpr_kw=src.obpr_kw, 
                    target.otbp=src.otbp, 
                    target.otbp_ref_compnr=src.otbp_ref_compnr, 
                    target.owno=src.owno, 
                    target.paft=src.paft, 
                    target.paft_kw=src.paft_kw, 
                    target.poff=src.poff, 
                    target.poff_ref_compnr=src.poff_ref_compnr, 
                    target.pono=src.pono, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qiap=src.qiap, 
                    target.qicl=src.qicl, 
                    target.qicl_buar=src.qicl_buar, 
                    target.qicl_buln=src.qicl_buln, 
                    target.qicl_bupc=src.qicl_bupc, 
                    target.qicl_butm=src.qicl_butm, 
                    target.qicl_buvl=src.qicl_buvl, 
                    target.qicl_buwg=src.qicl_buwg, 
                    target.qicl_trnu=src.qicl_trnu, 
                    target.qiec=src.qiec, 
                    target.qifi=src.qifi, 
                    target.qigc=src.qigc, 
                    target.qigc_buar=src.qigc_buar, 
                    target.qigc_buln=src.qigc_buln, 
                    target.qigc_bupc=src.qigc_bupc, 
                    target.qigc_butm=src.qigc_butm, 
                    target.qigc_buvl=src.qigc_buvl, 
                    target.qigc_buwg=src.qigc_buwg, 
                    target.qigc_trnu=src.qigc_trnu, 
                    target.qigi=src.qigi, 
                    target.qigi_buar=src.qigi_buar, 
                    target.qigi_buln=src.qigi_buln, 
                    target.qigi_bupc=src.qigi_bupc, 
                    target.qigi_butm=src.qigi_butm, 
                    target.qigi_buvl=src.qigi_buvl, 
                    target.qigi_buwg=src.qigi_buwg, 
                    target.qigi_trnu=src.qigi_trnu, 
                    target.qiiv=src.qiiv, 
                    target.qiiv_buar=src.qiiv_buar, 
                    target.qiiv_buln=src.qiiv_buln, 
                    target.qiiv_bupc=src.qiiv_bupc, 
                    target.qiiv_butm=src.qiiv_butm, 
                    target.qiiv_buvl=src.qiiv_buvl, 
                    target.qiiv_buwg=src.qiiv_buwg, 
                    target.qiiv_trnu=src.qiiv_trnu, 
                    target.qima=src.qima, 
                    target.qimf=src.qimf, 
                    target.qimi=src.qimi, 
                    target.qogo=src.qogo, 
                    target.qogo_buar=src.qogo_buar, 
                    target.qogo_buln=src.qogo_buln, 
                    target.qogo_bupc=src.qogo_bupc, 
                    target.qogo_butm=src.qogo_butm, 
                    target.qogo_buvl=src.qogo_buvl, 
                    target.qogo_buwg=src.qogo_buwg, 
                    target.qogo_invu=src.qogo_invu, 
                    target.qomn=src.qomn, 
                    target.qomx=src.qomx, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.qual=src.qual, 
                    target.qual_kw=src.qual_kw, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.rcsi=src.rcsi, 
                    target.rcsi_ref_compnr=src.rcsi_ref_compnr, 
                    target.revi=src.revi, 
                    target.rpdr=src.rpdr, 
                    target.rpdr_kw=src.rpdr_kw, 
                    target.sbdt=src.sbdt, 
                    target.sbdt_kw=src.sbdt_kw, 
                    target.sbim=src.sbim, 
                    target.sbim_kw=src.sbim_kw, 
                    target.sbmt=src.sbmt, 
                    target.sbmt_ref_compnr=src.sbmt_ref_compnr, 
                    target.scus=src.scus, 
                    target.scus_kw=src.scus_kw, 
                    target.sdat=src.sdat, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfad=src.sfad, 
                    target.sfad_ref_compnr=src.sfad_ref_compnr, 
                    target.sfbp=src.sfbp, 
                    target.sfbp_ref_compnr=src.sfbp_ref_compnr, 
                    target.sfcn=src.sfcn, 
                    target.sfcn_ref_compnr=src.sfcn_ref_compnr, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.subc=src.subc, 
                    target.subc_kw=src.subc_kw, 
                    target.subs=src.subs, 
                    target.subs_ref_compnr=src.subs_ref_compnr, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.txtt=src.txtt, 
                    target.txtt_ref_compnr=src.txtt_ref_compnr, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( aemq, aemq_kw, bamt, bamt_dtwc, bamt_lclc, bamt_rfrc, bamt_rpc1, bamt_rpc2, bpcl, bpcl_ref_compnr, bptc, bptc_ref_compnr, cadr, cadr_ref_compnr, caga, caga_dtwc, caga_lclc, caga_rfrc, caga_rpc1, caga_rpc2, camt, camt_dtwc, camt_lclc, camt_rfrc, camt_rpc1, camt_rpc2, ccon, ccon_ref_compnr, ccty, ccty_cvat_ref_compnr, ccty_ref_compnr, cdat, cdec, cdec_ref_compnr, cdf_cdsc, cdf_clmt, cdf_comt, cdf_idet, cdf_ramt, cdf_refe, cdf_sctg, ceno, citt, citt_ref_compnr, cltp, cltp_kw, cmnf, cmnf_ref_compnr, cncd, cofc, cofc_ref_compnr, compnr, cono, cono_ref_compnr, cons, cons_kw, cpgp, cpgp_ref_compnr, crit, crrf, crrf_kw, csqn, csts, csts_kw, cuqp, cuqp_ref_compnr, cvat, cvqp, cwar, cwar_ref_compnr, deleted, dsch, dsch_kw, edat, effn, effn_ref_compnr, exmt, exmt_kw, gamt_dtwc, gamt_lclc, gamt_rfrc, gamt_rpc1, gamt_rpc2, gamt_trnc, iaga, iaga_dtwc, iaga_lclc, iaga_rfrc, iaga_rpc1, iaga_rpc2, icap, icap_kw, icyp, icyp_kw, ieva, ieva_kw, iqab, iqab_kw, item, item_ref_compnr, leng, mpnr, mpnr_cmnf_ref_compnr, mqtl, namt_dtwc, namt_lclc, namt_rfrc, namt_rpc1, namt_rpc2, namt_trnc, ncmp, ncmp_ref_compnr, obpr, obpr_kw, otbp, otbp_ref_compnr, owno, paft, paft_kw, poff, poff_ref_compnr, pono, ptpa, ptpa_ref_compnr, qiap, qicl, qicl_buar, qicl_buln, qicl_bupc, qicl_butm, qicl_buvl, qicl_buwg, qicl_trnu, qiec, qifi, qigc, qigc_buar, qigc_buln, qigc_bupc, qigc_butm, qigc_buvl, qigc_buwg, qigc_trnu, qigi, qigi_buar, qigi_buln, qigi_bupc, qigi_butm, qigi_buvl, qigi_buwg, qigi_trnu, qiiv, qiiv_buar, qiiv_buln, qiiv_bupc, qiiv_butm, qiiv_buvl, qiiv_buwg, qiiv_trnu, qima, qimf, qimi, qogo, qogo_buar, qogo_buln, qogo_bupc, qogo_butm, qogo_buvl, qogo_buwg, qogo_invu, qomn, qomx, qoor, qoor_buar, qoor_buln, qoor_bupc, qoor_butm, qoor_buvl, qoor_buwg, qoor_invu, qual, qual_kw, rcod, rcod_ref_compnr, rcsi, rcsi_ref_compnr, revi, rpdr, rpdr_kw, sbdt, sbdt_kw, sbim, sbim_kw, sbmt, sbmt_ref_compnr, scus, scus_kw, sdat, sdsc, sdsc_kw, sequencenumber, sfad, sfad_ref_compnr, sfbp, sfbp_ref_compnr, sfcn, sfcn_ref_compnr, site, site_ref_compnr, subc, subc_kw, subs, subs_ref_compnr, thic, timestamp, txta, txta_ref_compnr, txtt, txtt_ref_compnr, username, widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.aemq, 
                    src.aemq_kw, 
                    src.bamt, 
                    src.bamt_dtwc, 
                    src.bamt_lclc, 
                    src.bamt_rfrc, 
                    src.bamt_rpc1, 
                    src.bamt_rpc2, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.cadr, 
                    src.cadr_ref_compnr, 
                    src.caga, 
                    src.caga_dtwc, 
                    src.caga_lclc, 
                    src.caga_rfrc, 
                    src.caga_rpc1, 
                    src.caga_rpc2, 
                    src.camt, 
                    src.camt_dtwc, 
                    src.camt_lclc, 
                    src.camt_rfrc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.ccon, 
                    src.ccon_ref_compnr, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdf_cdsc, 
                    src.cdf_clmt, 
                    src.cdf_comt, 
                    src.cdf_idet, 
                    src.cdf_ramt, 
                    src.cdf_refe, 
                    src.cdf_sctg, 
                    src.ceno, 
                    src.citt, 
                    src.citt_ref_compnr, 
                    src.cltp, 
                    src.cltp_kw, 
                    src.cmnf, 
                    src.cmnf_ref_compnr, 
                    src.cncd, 
                    src.cofc, 
                    src.cofc_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_ref_compnr, 
                    src.cons, 
                    src.cons_kw, 
                    src.cpgp, 
                    src.cpgp_ref_compnr, 
                    src.crit, 
                    src.crrf, 
                    src.crrf_kw, 
                    src.csqn, 
                    src.csts, 
                    src.csts_kw, 
                    src.cuqp, 
                    src.cuqp_ref_compnr, 
                    src.cvat, 
                    src.cvqp, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dsch, 
                    src.dsch_kw, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.iaga, 
                    src.iaga_dtwc, 
                    src.iaga_lclc, 
                    src.iaga_rfrc, 
                    src.iaga_rpc1, 
                    src.iaga_rpc2, 
                    src.icap, 
                    src.icap_kw, 
                    src.icyp, 
                    src.icyp_kw, 
                    src.ieva, 
                    src.ieva_kw, 
                    src.iqab, 
                    src.iqab_kw, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.leng, 
                    src.mpnr, 
                    src.mpnr_cmnf_ref_compnr, 
                    src.mqtl, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.ncmp, 
                    src.ncmp_ref_compnr, 
                    src.obpr, 
                    src.obpr_kw, 
                    src.otbp, 
                    src.otbp_ref_compnr, 
                    src.owno, 
                    src.paft, 
                    src.paft_kw, 
                    src.poff, 
                    src.poff_ref_compnr, 
                    src.pono, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qiap, 
                    src.qicl, 
                    src.qicl_buar, 
                    src.qicl_buln, 
                    src.qicl_bupc, 
                    src.qicl_butm, 
                    src.qicl_buvl, 
                    src.qicl_buwg, 
                    src.qicl_trnu, 
                    src.qiec, 
                    src.qifi, 
                    src.qigc, 
                    src.qigc_buar, 
                    src.qigc_buln, 
                    src.qigc_bupc, 
                    src.qigc_butm, 
                    src.qigc_buvl, 
                    src.qigc_buwg, 
                    src.qigc_trnu, 
                    src.qigi, 
                    src.qigi_buar, 
                    src.qigi_buln, 
                    src.qigi_bupc, 
                    src.qigi_butm, 
                    src.qigi_buvl, 
                    src.qigi_buwg, 
                    src.qigi_trnu, 
                    src.qiiv, 
                    src.qiiv_buar, 
                    src.qiiv_buln, 
                    src.qiiv_bupc, 
                    src.qiiv_butm, 
                    src.qiiv_buvl, 
                    src.qiiv_buwg, 
                    src.qiiv_trnu, 
                    src.qima, 
                    src.qimf, 
                    src.qimi, 
                    src.qogo, 
                    src.qogo_buar, 
                    src.qogo_buln, 
                    src.qogo_bupc, 
                    src.qogo_butm, 
                    src.qogo_buvl, 
                    src.qogo_buwg, 
                    src.qogo_invu, 
                    src.qomn, 
                    src.qomx, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.qual, 
                    src.qual_kw, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.rcsi, 
                    src.rcsi_ref_compnr, 
                    src.revi, 
                    src.rpdr, 
                    src.rpdr_kw, 
                    src.sbdt, 
                    src.sbdt_kw, 
                    src.sbim, 
                    src.sbim_kw, 
                    src.sbmt, 
                    src.sbmt_ref_compnr, 
                    src.scus, 
                    src.scus_kw, 
                    src.sdat, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.sequencenumber, 
                    src.sfad, 
                    src.sfad_ref_compnr, 
                    src.sfbp, 
                    src.sfbp_ref_compnr, 
                    src.sfcn, 
                    src.sfcn_ref_compnr, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.subc, 
                    src.subc_kw, 
                    src.subs, 
                    src.subs_ref_compnr, 
                    src.thic, 
                    src.timestamp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.txtt, 
                    src.txtt_ref_compnr, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;