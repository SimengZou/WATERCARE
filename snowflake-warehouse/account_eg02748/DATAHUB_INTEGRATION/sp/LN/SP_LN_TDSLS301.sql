create or replace procedure DATAHUB_INTEGRATION.SP_LN_TDSLS301()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TDSLS301_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TDSLS301 as target using (SELECT * FROM (SELECT 
            strm.adco, 
            strm.adco_kw, 
            strm.adcs, 
            strm.adcs_ref_compnr, 
            strm.aeco, 
            strm.aeco_kw, 
            strm.aeed, 
            strm.aeed_kw, 
            strm.aemq, 
            strm.aemq_kw, 
            strm.afrb, 
            strm.afrb_kw, 
            strm.bamt, 
            strm.bamt_dtwc, 
            strm.bamt_lclc, 
            strm.bamt_rfrc, 
            strm.bamt_rpc1, 
            strm.bamt_rpc2, 
            strm.bfbp, 
            strm.bfbp_ref_compnr, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.camt, 
            strm.camt_dtwc, 
            strm.camt_lclc, 
            strm.camt_rfrc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.ccrf, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdis_1, 
            strm.cdis_10, 
            strm.cdis_11, 
            strm.cdis_2, 
            strm.cdis_3, 
            strm.cdis_4, 
            strm.cdis_5, 
            strm.cdis_6, 
            strm.cdis_7, 
            strm.cdis_8, 
            strm.cdis_9, 
            strm.ceno, 
            strm.citm, 
            strm.citt, 
            strm.cncd, 
            strm.cofc, 
            strm.cofc_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_ref_compnr, 
            strm.corn, 
            strm.cpgs, 
            strm.cpgs_ref_compnr, 
            strm.cpwc, 
            strm.cpwc_kw, 
            strm.crep, 
            strm.crep_ref_compnr, 
            strm.cups, 
            strm.cups_ref_compnr, 
            strm.cuqs, 
            strm.cuqs_ref_compnr, 
            strm.cvat, 
            strm.cvps, 
            strm.cvqs, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dest, 
            strm.dest_kw, 
            strm.disc_1, 
            strm.disc_10, 
            strm.disc_11, 
            strm.disc_2, 
            strm.disc_3, 
            strm.disc_4, 
            strm.disc_5, 
            strm.disc_6, 
            strm.disc_7, 
            strm.disc_8, 
            strm.disc_9, 
            strm.dlpt, 
            strm.dmth_1, 
            strm.dmth_10, 
            strm.dmth_11, 
            strm.dmth_2, 
            strm.dmth_3, 
            strm.dmth_4, 
            strm.dmth_5, 
            strm.dmth_6, 
            strm.dmth_7, 
            strm.dmth_8, 
            strm.dmth_9, 
            strm.dmth_kw_1, 
            strm.dmth_kw_10, 
            strm.dmth_kw_11, 
            strm.dmth_kw_2, 
            strm.dmth_kw_3, 
            strm.dmth_kw_4, 
            strm.dmth_kw_5, 
            strm.dmth_kw_6, 
            strm.dmth_kw_7, 
            strm.dmth_kw_8, 
            strm.dmth_kw_9, 
            strm.dsor, 
            strm.dsor_kw, 
            strm.dssc_1, 
            strm.dssc_10, 
            strm.dssc_11, 
            strm.dssc_2, 
            strm.dssc_3, 
            strm.dssc_4, 
            strm.dssc_5, 
            strm.dssc_6, 
            strm.dssc_7, 
            strm.dssc_8, 
            strm.dssc_9, 
            strm.dtrm, 
            strm.dtrm_kw, 
            strm.dttl, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.elgb, 
            strm.elgb_kw, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.hqan, 
            strm.hqan_kw, 
            strm.hval, 
            strm.hval_kw, 
            strm.icap, 
            strm.icap_kw, 
            strm.icyp, 
            strm.icyp_kw, 
            strm.ieva, 
            strm.ieva_kw, 
            strm.imcs, 
            strm.iqab, 
            strm.iqab_kw, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.item_stsi_ref_compnr, 
            strm.ldam_1, 
            strm.ldam_10, 
            strm.ldam_11, 
            strm.ldam_2, 
            strm.ldam_3, 
            strm.ldam_4, 
            strm.ldam_5, 
            strm.ldam_6, 
            strm.ldam_7, 
            strm.ldam_8, 
            strm.ldam_9, 
            strm.leng, 
            strm.maxv, 
            strm.minv, 
            strm.mqtl, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.osrp, 
            strm.osrp_ref_compnr, 
            strm.owno, 
            strm.pbor, 
            strm.pbor_kw, 
            strm.pcpr, 
            strm.pcpr_kw, 
            strm.pono, 
            strm.prbo, 
            strm.prbo_ref_compnr, 
            strm.pric, 
            strm.priu, 
            strm.priu_kw, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qicl, 
            strm.qicl_buar, 
            strm.qicl_buln, 
            strm.qicl_bupc, 
            strm.qicl_butm, 
            strm.qicl_buvl, 
            strm.qicl_buwg, 
            strm.qicl_trnu, 
            strm.qiiv, 
            strm.qiiv_buar, 
            strm.qiiv_buln, 
            strm.qiiv_bupc, 
            strm.qiiv_butm, 
            strm.qiiv_buvl, 
            strm.qiiv_buwg, 
            strm.qiiv_trnu, 
            strm.qimo, 
            strm.qomn, 
            strm.qomx, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.revi, 
            strm.rpds, 
            strm.rpds_kw, 
            strm.sdat, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.sequencenumber, 
            strm.sfbp, 
            strm.sfbp_ref_compnr, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stwh, 
            strm.stwh_ref_compnr, 
            strm.thic, 
            strm.timestamp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.ucms, 
            strm.ucms_kw, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.pono,
            strm.cofc ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDSLS301 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.cofc=src.cofc) OR (target.cofc IS NULL AND src.cofc IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.adco=src.adco, 
                    target.adco_kw=src.adco_kw, 
                    target.adcs=src.adcs, 
                    target.adcs_ref_compnr=src.adcs_ref_compnr, 
                    target.aeco=src.aeco, 
                    target.aeco_kw=src.aeco_kw, 
                    target.aeed=src.aeed, 
                    target.aeed_kw=src.aeed_kw, 
                    target.aemq=src.aemq, 
                    target.aemq_kw=src.aemq_kw, 
                    target.afrb=src.afrb, 
                    target.afrb_kw=src.afrb_kw, 
                    target.bamt=src.bamt, 
                    target.bamt_dtwc=src.bamt_dtwc, 
                    target.bamt_lclc=src.bamt_lclc, 
                    target.bamt_rfrc=src.bamt_rfrc, 
                    target.bamt_rpc1=src.bamt_rpc1, 
                    target.bamt_rpc2=src.bamt_rpc2, 
                    target.bfbp=src.bfbp, 
                    target.bfbp_ref_compnr=src.bfbp_ref_compnr, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.camt=src.camt, 
                    target.camt_dtwc=src.camt_dtwc, 
                    target.camt_lclc=src.camt_lclc, 
                    target.camt_rfrc=src.camt_rfrc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.ccrf=src.ccrf, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdis_1=src.cdis_1, 
                    target.cdis_10=src.cdis_10, 
                    target.cdis_11=src.cdis_11, 
                    target.cdis_2=src.cdis_2, 
                    target.cdis_3=src.cdis_3, 
                    target.cdis_4=src.cdis_4, 
                    target.cdis_5=src.cdis_5, 
                    target.cdis_6=src.cdis_6, 
                    target.cdis_7=src.cdis_7, 
                    target.cdis_8=src.cdis_8, 
                    target.cdis_9=src.cdis_9, 
                    target.ceno=src.ceno, 
                    target.citm=src.citm, 
                    target.citt=src.citt, 
                    target.cncd=src.cncd, 
                    target.cofc=src.cofc, 
                    target.cofc_ref_compnr=src.cofc_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.corn=src.corn, 
                    target.cpgs=src.cpgs, 
                    target.cpgs_ref_compnr=src.cpgs_ref_compnr, 
                    target.cpwc=src.cpwc, 
                    target.cpwc_kw=src.cpwc_kw, 
                    target.crep=src.crep, 
                    target.crep_ref_compnr=src.crep_ref_compnr, 
                    target.cups=src.cups, 
                    target.cups_ref_compnr=src.cups_ref_compnr, 
                    target.cuqs=src.cuqs, 
                    target.cuqs_ref_compnr=src.cuqs_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvps=src.cvps, 
                    target.cvqs=src.cvqs, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dest=src.dest, 
                    target.dest_kw=src.dest_kw, 
                    target.disc_1=src.disc_1, 
                    target.disc_10=src.disc_10, 
                    target.disc_11=src.disc_11, 
                    target.disc_2=src.disc_2, 
                    target.disc_3=src.disc_3, 
                    target.disc_4=src.disc_4, 
                    target.disc_5=src.disc_5, 
                    target.disc_6=src.disc_6, 
                    target.disc_7=src.disc_7, 
                    target.disc_8=src.disc_8, 
                    target.disc_9=src.disc_9, 
                    target.dlpt=src.dlpt, 
                    target.dmth_1=src.dmth_1, 
                    target.dmth_10=src.dmth_10, 
                    target.dmth_11=src.dmth_11, 
                    target.dmth_2=src.dmth_2, 
                    target.dmth_3=src.dmth_3, 
                    target.dmth_4=src.dmth_4, 
                    target.dmth_5=src.dmth_5, 
                    target.dmth_6=src.dmth_6, 
                    target.dmth_7=src.dmth_7, 
                    target.dmth_8=src.dmth_8, 
                    target.dmth_9=src.dmth_9, 
                    target.dmth_kw_1=src.dmth_kw_1, 
                    target.dmth_kw_10=src.dmth_kw_10, 
                    target.dmth_kw_11=src.dmth_kw_11, 
                    target.dmth_kw_2=src.dmth_kw_2, 
                    target.dmth_kw_3=src.dmth_kw_3, 
                    target.dmth_kw_4=src.dmth_kw_4, 
                    target.dmth_kw_5=src.dmth_kw_5, 
                    target.dmth_kw_6=src.dmth_kw_6, 
                    target.dmth_kw_7=src.dmth_kw_7, 
                    target.dmth_kw_8=src.dmth_kw_8, 
                    target.dmth_kw_9=src.dmth_kw_9, 
                    target.dsor=src.dsor, 
                    target.dsor_kw=src.dsor_kw, 
                    target.dssc_1=src.dssc_1, 
                    target.dssc_10=src.dssc_10, 
                    target.dssc_11=src.dssc_11, 
                    target.dssc_2=src.dssc_2, 
                    target.dssc_3=src.dssc_3, 
                    target.dssc_4=src.dssc_4, 
                    target.dssc_5=src.dssc_5, 
                    target.dssc_6=src.dssc_6, 
                    target.dssc_7=src.dssc_7, 
                    target.dssc_8=src.dssc_8, 
                    target.dssc_9=src.dssc_9, 
                    target.dtrm=src.dtrm, 
                    target.dtrm_kw=src.dtrm_kw, 
                    target.dttl=src.dttl, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.elgb=src.elgb, 
                    target.elgb_kw=src.elgb_kw, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.hqan=src.hqan, 
                    target.hqan_kw=src.hqan_kw, 
                    target.hval=src.hval, 
                    target.hval_kw=src.hval_kw, 
                    target.icap=src.icap, 
                    target.icap_kw=src.icap_kw, 
                    target.icyp=src.icyp, 
                    target.icyp_kw=src.icyp_kw, 
                    target.ieva=src.ieva, 
                    target.ieva_kw=src.ieva_kw, 
                    target.imcs=src.imcs, 
                    target.iqab=src.iqab, 
                    target.iqab_kw=src.iqab_kw, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.item_stsi_ref_compnr=src.item_stsi_ref_compnr, 
                    target.ldam_1=src.ldam_1, 
                    target.ldam_10=src.ldam_10, 
                    target.ldam_11=src.ldam_11, 
                    target.ldam_2=src.ldam_2, 
                    target.ldam_3=src.ldam_3, 
                    target.ldam_4=src.ldam_4, 
                    target.ldam_5=src.ldam_5, 
                    target.ldam_6=src.ldam_6, 
                    target.ldam_7=src.ldam_7, 
                    target.ldam_8=src.ldam_8, 
                    target.ldam_9=src.ldam_9, 
                    target.leng=src.leng, 
                    target.maxv=src.maxv, 
                    target.minv=src.minv, 
                    target.mqtl=src.mqtl, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.osrp=src.osrp, 
                    target.osrp_ref_compnr=src.osrp_ref_compnr, 
                    target.owno=src.owno, 
                    target.pbor=src.pbor, 
                    target.pbor_kw=src.pbor_kw, 
                    target.pcpr=src.pcpr, 
                    target.pcpr_kw=src.pcpr_kw, 
                    target.pono=src.pono, 
                    target.prbo=src.prbo, 
                    target.prbo_ref_compnr=src.prbo_ref_compnr, 
                    target.pric=src.pric, 
                    target.priu=src.priu, 
                    target.priu_kw=src.priu_kw, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qicl=src.qicl, 
                    target.qicl_buar=src.qicl_buar, 
                    target.qicl_buln=src.qicl_buln, 
                    target.qicl_bupc=src.qicl_bupc, 
                    target.qicl_butm=src.qicl_butm, 
                    target.qicl_buvl=src.qicl_buvl, 
                    target.qicl_buwg=src.qicl_buwg, 
                    target.qicl_trnu=src.qicl_trnu, 
                    target.qiiv=src.qiiv, 
                    target.qiiv_buar=src.qiiv_buar, 
                    target.qiiv_buln=src.qiiv_buln, 
                    target.qiiv_bupc=src.qiiv_bupc, 
                    target.qiiv_butm=src.qiiv_butm, 
                    target.qiiv_buvl=src.qiiv_buvl, 
                    target.qiiv_buwg=src.qiiv_buwg, 
                    target.qiiv_trnu=src.qiiv_trnu, 
                    target.qimo=src.qimo, 
                    target.qomn=src.qomn, 
                    target.qomx=src.qomx, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.revi=src.revi, 
                    target.rpds=src.rpds, 
                    target.rpds_kw=src.rpds_kw, 
                    target.sdat=src.sdat, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfbp=src.sfbp, 
                    target.sfbp_ref_compnr=src.sfbp_ref_compnr, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stwh=src.stwh, 
                    target.stwh_ref_compnr=src.stwh_ref_compnr, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.ucms=src.ucms, 
                    target.ucms_kw=src.ucms_kw, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    adco, 
                    adco_kw, 
                    adcs, 
                    adcs_ref_compnr, 
                    aeco, 
                    aeco_kw, 
                    aeed, 
                    aeed_kw, 
                    aemq, 
                    aemq_kw, 
                    afrb, 
                    afrb_kw, 
                    bamt, 
                    bamt_dtwc, 
                    bamt_lclc, 
                    bamt_rfrc, 
                    bamt_rpc1, 
                    bamt_rpc2, 
                    bfbp, 
                    bfbp_ref_compnr, 
                    bpcl, 
                    bpcl_ref_compnr, 
                    bptc, 
                    bptc_ref_compnr, 
                    camt, 
                    camt_dtwc, 
                    camt_lclc, 
                    camt_rfrc, 
                    camt_rpc1, 
                    camt_rpc2, 
                    ccrf, 
                    ccty, 
                    ccty_cvat_ref_compnr, 
                    ccty_ref_compnr, 
                    cdat, 
                    cdec, 
                    cdec_ref_compnr, 
                    cdis_1, 
                    cdis_10, 
                    cdis_11, 
                    cdis_2, 
                    cdis_3, 
                    cdis_4, 
                    cdis_5, 
                    cdis_6, 
                    cdis_7, 
                    cdis_8, 
                    cdis_9, 
                    ceno, 
                    citm, 
                    citt, 
                    cncd, 
                    cofc, 
                    cofc_ref_compnr, 
                    compnr, 
                    cono, 
                    cono_ref_compnr, 
                    corn, 
                    cpgs, 
                    cpgs_ref_compnr, 
                    cpwc, 
                    cpwc_kw, 
                    crep, 
                    crep_ref_compnr, 
                    cups, 
                    cups_ref_compnr, 
                    cuqs, 
                    cuqs_ref_compnr, 
                    cvat, 
                    cvps, 
                    cvqs, 
                    cwar, 
                    cwar_ref_compnr, 
                    deleted, 
                    dest, 
                    dest_kw, 
                    disc_1, 
                    disc_10, 
                    disc_11, 
                    disc_2, 
                    disc_3, 
                    disc_4, 
                    disc_5, 
                    disc_6, 
                    disc_7, 
                    disc_8, 
                    disc_9, 
                    dlpt, 
                    dmth_1, 
                    dmth_10, 
                    dmth_11, 
                    dmth_2, 
                    dmth_3, 
                    dmth_4, 
                    dmth_5, 
                    dmth_6, 
                    dmth_7, 
                    dmth_8, 
                    dmth_9, 
                    dmth_kw_1, 
                    dmth_kw_10, 
                    dmth_kw_11, 
                    dmth_kw_2, 
                    dmth_kw_3, 
                    dmth_kw_4, 
                    dmth_kw_5, 
                    dmth_kw_6, 
                    dmth_kw_7, 
                    dmth_kw_8, 
                    dmth_kw_9, 
                    dsor, 
                    dsor_kw, 
                    dssc_1, 
                    dssc_10, 
                    dssc_11, 
                    dssc_2, 
                    dssc_3, 
                    dssc_4, 
                    dssc_5, 
                    dssc_6, 
                    dssc_7, 
                    dssc_8, 
                    dssc_9, 
                    dtrm, 
                    dtrm_kw, 
                    dttl, 
                    edat, 
                    effn, 
                    effn_ref_compnr, 
                    elgb, 
                    elgb_kw, 
                    exmt, 
                    exmt_kw, 
                    gamt_dtwc, 
                    gamt_lclc, 
                    gamt_rfrc, 
                    gamt_rpc1, 
                    gamt_rpc2, 
                    gamt_trnc, 
                    hqan, 
                    hqan_kw, 
                    hval, 
                    hval_kw, 
                    icap, 
                    icap_kw, 
                    icyp, 
                    icyp_kw, 
                    ieva, 
                    ieva_kw, 
                    imcs, 
                    iqab, 
                    iqab_kw, 
                    item, 
                    item_ref_compnr, 
                    item_site_ref_compnr, 
                    item_stsi_ref_compnr, 
                    ldam_1, 
                    ldam_10, 
                    ldam_11, 
                    ldam_2, 
                    ldam_3, 
                    ldam_4, 
                    ldam_5, 
                    ldam_6, 
                    ldam_7, 
                    ldam_8, 
                    ldam_9, 
                    leng, 
                    maxv, 
                    minv, 
                    mqtl, 
                    namt_dtwc, 
                    namt_lclc, 
                    namt_rfrc, 
                    namt_rpc1, 
                    namt_rpc2, 
                    namt_trnc, 
                    ofbp, 
                    ofbp_ref_compnr, 
                    osrp, 
                    osrp_ref_compnr, 
                    owno, 
                    pbor, 
                    pbor_kw, 
                    pcpr, 
                    pcpr_kw, 
                    pono, 
                    prbo, 
                    prbo_ref_compnr, 
                    pric, 
                    priu, 
                    priu_kw, 
                    ptpa, 
                    ptpa_ref_compnr, 
                    qicl, 
                    qicl_buar, 
                    qicl_buln, 
                    qicl_bupc, 
                    qicl_butm, 
                    qicl_buvl, 
                    qicl_buwg, 
                    qicl_trnu, 
                    qiiv, 
                    qiiv_buar, 
                    qiiv_buln, 
                    qiiv_bupc, 
                    qiiv_butm, 
                    qiiv_buvl, 
                    qiiv_buwg, 
                    qiiv_trnu, 
                    qimo, 
                    qomn, 
                    qomx, 
                    qoor, 
                    qoor_buar, 
                    qoor_buln, 
                    qoor_bupc, 
                    qoor_butm, 
                    qoor_buvl, 
                    qoor_buwg, 
                    qoor_invu, 
                    rcod, 
                    rcod_ref_compnr, 
                    revi, 
                    rpds, 
                    rpds_kw, 
                    sdat, 
                    sdsc, 
                    sdsc_kw, 
                    sequencenumber, 
                    sfbp, 
                    sfbp_ref_compnr, 
                    site, 
                    site_ref_compnr, 
                    stad, 
                    stad_dlpt_ref_compnr, 
                    stad_ref_compnr, 
                    stbp, 
                    stbp_ref_compnr, 
                    stcn, 
                    stcn_ref_compnr, 
                    stsi, 
                    stsi_ref_compnr, 
                    stwh, 
                    stwh_ref_compnr, 
                    thic, 
                    timestamp, 
                    txta, 
                    txta_ref_compnr, 
                    ucms, 
                    ucms_kw, 
                    username, 
                    widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.adco, 
                    src.adco_kw, 
                    src.adcs, 
                    src.adcs_ref_compnr, 
                    src.aeco, 
                    src.aeco_kw, 
                    src.aeed, 
                    src.aeed_kw, 
                    src.aemq, 
                    src.aemq_kw, 
                    src.afrb, 
                    src.afrb_kw, 
                    src.bamt, 
                    src.bamt_dtwc, 
                    src.bamt_lclc, 
                    src.bamt_rfrc, 
                    src.bamt_rpc1, 
                    src.bamt_rpc2, 
                    src.bfbp, 
                    src.bfbp_ref_compnr, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.camt, 
                    src.camt_dtwc, 
                    src.camt_lclc, 
                    src.camt_rfrc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.ccrf, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdis_1, 
                    src.cdis_10, 
                    src.cdis_11, 
                    src.cdis_2, 
                    src.cdis_3, 
                    src.cdis_4, 
                    src.cdis_5, 
                    src.cdis_6, 
                    src.cdis_7, 
                    src.cdis_8, 
                    src.cdis_9, 
                    src.ceno, 
                    src.citm, 
                    src.citt, 
                    src.cncd, 
                    src.cofc, 
                    src.cofc_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_ref_compnr, 
                    src.corn, 
                    src.cpgs, 
                    src.cpgs_ref_compnr, 
                    src.cpwc, 
                    src.cpwc_kw, 
                    src.crep, 
                    src.crep_ref_compnr, 
                    src.cups, 
                    src.cups_ref_compnr, 
                    src.cuqs, 
                    src.cuqs_ref_compnr, 
                    src.cvat, 
                    src.cvps, 
                    src.cvqs, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dest, 
                    src.dest_kw, 
                    src.disc_1, 
                    src.disc_10, 
                    src.disc_11, 
                    src.disc_2, 
                    src.disc_3, 
                    src.disc_4, 
                    src.disc_5, 
                    src.disc_6, 
                    src.disc_7, 
                    src.disc_8, 
                    src.disc_9, 
                    src.dlpt, 
                    src.dmth_1, 
                    src.dmth_10, 
                    src.dmth_11, 
                    src.dmth_2, 
                    src.dmth_3, 
                    src.dmth_4, 
                    src.dmth_5, 
                    src.dmth_6, 
                    src.dmth_7, 
                    src.dmth_8, 
                    src.dmth_9, 
                    src.dmth_kw_1, 
                    src.dmth_kw_10, 
                    src.dmth_kw_11, 
                    src.dmth_kw_2, 
                    src.dmth_kw_3, 
                    src.dmth_kw_4, 
                    src.dmth_kw_5, 
                    src.dmth_kw_6, 
                    src.dmth_kw_7, 
                    src.dmth_kw_8, 
                    src.dmth_kw_9, 
                    src.dsor, 
                    src.dsor_kw, 
                    src.dssc_1, 
                    src.dssc_10, 
                    src.dssc_11, 
                    src.dssc_2, 
                    src.dssc_3, 
                    src.dssc_4, 
                    src.dssc_5, 
                    src.dssc_6, 
                    src.dssc_7, 
                    src.dssc_8, 
                    src.dssc_9, 
                    src.dtrm, 
                    src.dtrm_kw, 
                    src.dttl, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.elgb, 
                    src.elgb_kw, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.hqan, 
                    src.hqan_kw, 
                    src.hval, 
                    src.hval_kw, 
                    src.icap, 
                    src.icap_kw, 
                    src.icyp, 
                    src.icyp_kw, 
                    src.ieva, 
                    src.ieva_kw, 
                    src.imcs, 
                    src.iqab, 
                    src.iqab_kw, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.item_stsi_ref_compnr, 
                    src.ldam_1, 
                    src.ldam_10, 
                    src.ldam_11, 
                    src.ldam_2, 
                    src.ldam_3, 
                    src.ldam_4, 
                    src.ldam_5, 
                    src.ldam_6, 
                    src.ldam_7, 
                    src.ldam_8, 
                    src.ldam_9, 
                    src.leng, 
                    src.maxv, 
                    src.minv, 
                    src.mqtl, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.osrp, 
                    src.osrp_ref_compnr, 
                    src.owno, 
                    src.pbor, 
                    src.pbor_kw, 
                    src.pcpr, 
                    src.pcpr_kw, 
                    src.pono, 
                    src.prbo, 
                    src.prbo_ref_compnr, 
                    src.pric, 
                    src.priu, 
                    src.priu_kw, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qicl, 
                    src.qicl_buar, 
                    src.qicl_buln, 
                    src.qicl_bupc, 
                    src.qicl_butm, 
                    src.qicl_buvl, 
                    src.qicl_buwg, 
                    src.qicl_trnu, 
                    src.qiiv, 
                    src.qiiv_buar, 
                    src.qiiv_buln, 
                    src.qiiv_bupc, 
                    src.qiiv_butm, 
                    src.qiiv_buvl, 
                    src.qiiv_buwg, 
                    src.qiiv_trnu, 
                    src.qimo, 
                    src.qomn, 
                    src.qomx, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.revi, 
                    src.rpds, 
                    src.rpds_kw, 
                    src.sdat, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.sequencenumber, 
                    src.sfbp, 
                    src.sfbp_ref_compnr, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stwh, 
                    src.stwh_ref_compnr, 
                    src.thic, 
                    src.timestamp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.ucms, 
                    src.ucms_kw, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TDSLS301_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.adco, 
            strm.adco_kw, 
            strm.adcs, 
            strm.adcs_ref_compnr, 
            strm.aeco, 
            strm.aeco_kw, 
            strm.aeed, 
            strm.aeed_kw, 
            strm.aemq, 
            strm.aemq_kw, 
            strm.afrb, 
            strm.afrb_kw, 
            strm.bamt, 
            strm.bamt_dtwc, 
            strm.bamt_lclc, 
            strm.bamt_rfrc, 
            strm.bamt_rpc1, 
            strm.bamt_rpc2, 
            strm.bfbp, 
            strm.bfbp_ref_compnr, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.camt, 
            strm.camt_dtwc, 
            strm.camt_lclc, 
            strm.camt_rfrc, 
            strm.camt_rpc1, 
            strm.camt_rpc2, 
            strm.ccrf, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.ccty_ref_compnr, 
            strm.cdat, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.cdis_1, 
            strm.cdis_10, 
            strm.cdis_11, 
            strm.cdis_2, 
            strm.cdis_3, 
            strm.cdis_4, 
            strm.cdis_5, 
            strm.cdis_6, 
            strm.cdis_7, 
            strm.cdis_8, 
            strm.cdis_9, 
            strm.ceno, 
            strm.citm, 
            strm.citt, 
            strm.cncd, 
            strm.cofc, 
            strm.cofc_ref_compnr, 
            strm.compnr, 
            strm.cono, 
            strm.cono_ref_compnr, 
            strm.corn, 
            strm.cpgs, 
            strm.cpgs_ref_compnr, 
            strm.cpwc, 
            strm.cpwc_kw, 
            strm.crep, 
            strm.crep_ref_compnr, 
            strm.cups, 
            strm.cups_ref_compnr, 
            strm.cuqs, 
            strm.cuqs_ref_compnr, 
            strm.cvat, 
            strm.cvps, 
            strm.cvqs, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dest, 
            strm.dest_kw, 
            strm.disc_1, 
            strm.disc_10, 
            strm.disc_11, 
            strm.disc_2, 
            strm.disc_3, 
            strm.disc_4, 
            strm.disc_5, 
            strm.disc_6, 
            strm.disc_7, 
            strm.disc_8, 
            strm.disc_9, 
            strm.dlpt, 
            strm.dmth_1, 
            strm.dmth_10, 
            strm.dmth_11, 
            strm.dmth_2, 
            strm.dmth_3, 
            strm.dmth_4, 
            strm.dmth_5, 
            strm.dmth_6, 
            strm.dmth_7, 
            strm.dmth_8, 
            strm.dmth_9, 
            strm.dmth_kw_1, 
            strm.dmth_kw_10, 
            strm.dmth_kw_11, 
            strm.dmth_kw_2, 
            strm.dmth_kw_3, 
            strm.dmth_kw_4, 
            strm.dmth_kw_5, 
            strm.dmth_kw_6, 
            strm.dmth_kw_7, 
            strm.dmth_kw_8, 
            strm.dmth_kw_9, 
            strm.dsor, 
            strm.dsor_kw, 
            strm.dssc_1, 
            strm.dssc_10, 
            strm.dssc_11, 
            strm.dssc_2, 
            strm.dssc_3, 
            strm.dssc_4, 
            strm.dssc_5, 
            strm.dssc_6, 
            strm.dssc_7, 
            strm.dssc_8, 
            strm.dssc_9, 
            strm.dtrm, 
            strm.dtrm_kw, 
            strm.dttl, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.elgb, 
            strm.elgb_kw, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.hqan, 
            strm.hqan_kw, 
            strm.hval, 
            strm.hval_kw, 
            strm.icap, 
            strm.icap_kw, 
            strm.icyp, 
            strm.icyp_kw, 
            strm.ieva, 
            strm.ieva_kw, 
            strm.imcs, 
            strm.iqab, 
            strm.iqab_kw, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.item_stsi_ref_compnr, 
            strm.ldam_1, 
            strm.ldam_10, 
            strm.ldam_11, 
            strm.ldam_2, 
            strm.ldam_3, 
            strm.ldam_4, 
            strm.ldam_5, 
            strm.ldam_6, 
            strm.ldam_7, 
            strm.ldam_8, 
            strm.ldam_9, 
            strm.leng, 
            strm.maxv, 
            strm.minv, 
            strm.mqtl, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.osrp, 
            strm.osrp_ref_compnr, 
            strm.owno, 
            strm.pbor, 
            strm.pbor_kw, 
            strm.pcpr, 
            strm.pcpr_kw, 
            strm.pono, 
            strm.prbo, 
            strm.prbo_ref_compnr, 
            strm.pric, 
            strm.priu, 
            strm.priu_kw, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qicl, 
            strm.qicl_buar, 
            strm.qicl_buln, 
            strm.qicl_bupc, 
            strm.qicl_butm, 
            strm.qicl_buvl, 
            strm.qicl_buwg, 
            strm.qicl_trnu, 
            strm.qiiv, 
            strm.qiiv_buar, 
            strm.qiiv_buln, 
            strm.qiiv_bupc, 
            strm.qiiv_butm, 
            strm.qiiv_buvl, 
            strm.qiiv_buwg, 
            strm.qiiv_trnu, 
            strm.qimo, 
            strm.qomn, 
            strm.qomx, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.revi, 
            strm.rpds, 
            strm.rpds_kw, 
            strm.sdat, 
            strm.sdsc, 
            strm.sdsc_kw, 
            strm.sequencenumber, 
            strm.sfbp, 
            strm.sfbp_ref_compnr, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stcn, 
            strm.stcn_ref_compnr, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stwh, 
            strm.stwh_ref_compnr, 
            strm.thic, 
            strm.timestamp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.ucms, 
            strm.ucms_kw, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cono,
            strm.pono,
            strm.cofc ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDSLS301 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cono=src.cono) OR (target.cono IS NULL AND src.cono IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.cofc=src.cofc) OR (target.cofc IS NULL AND src.cofc IS NULL)) 
                when matched then update set
                    target.adco=src.adco, 
                    target.adco_kw=src.adco_kw, 
                    target.adcs=src.adcs, 
                    target.adcs_ref_compnr=src.adcs_ref_compnr, 
                    target.aeco=src.aeco, 
                    target.aeco_kw=src.aeco_kw, 
                    target.aeed=src.aeed, 
                    target.aeed_kw=src.aeed_kw, 
                    target.aemq=src.aemq, 
                    target.aemq_kw=src.aemq_kw, 
                    target.afrb=src.afrb, 
                    target.afrb_kw=src.afrb_kw, 
                    target.bamt=src.bamt, 
                    target.bamt_dtwc=src.bamt_dtwc, 
                    target.bamt_lclc=src.bamt_lclc, 
                    target.bamt_rfrc=src.bamt_rfrc, 
                    target.bamt_rpc1=src.bamt_rpc1, 
                    target.bamt_rpc2=src.bamt_rpc2, 
                    target.bfbp=src.bfbp, 
                    target.bfbp_ref_compnr=src.bfbp_ref_compnr, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.camt=src.camt, 
                    target.camt_dtwc=src.camt_dtwc, 
                    target.camt_lclc=src.camt_lclc, 
                    target.camt_rfrc=src.camt_rfrc, 
                    target.camt_rpc1=src.camt_rpc1, 
                    target.camt_rpc2=src.camt_rpc2, 
                    target.ccrf=src.ccrf, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.ccty_ref_compnr=src.ccty_ref_compnr, 
                    target.cdat=src.cdat, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.cdis_1=src.cdis_1, 
                    target.cdis_10=src.cdis_10, 
                    target.cdis_11=src.cdis_11, 
                    target.cdis_2=src.cdis_2, 
                    target.cdis_3=src.cdis_3, 
                    target.cdis_4=src.cdis_4, 
                    target.cdis_5=src.cdis_5, 
                    target.cdis_6=src.cdis_6, 
                    target.cdis_7=src.cdis_7, 
                    target.cdis_8=src.cdis_8, 
                    target.cdis_9=src.cdis_9, 
                    target.ceno=src.ceno, 
                    target.citm=src.citm, 
                    target.citt=src.citt, 
                    target.cncd=src.cncd, 
                    target.cofc=src.cofc, 
                    target.cofc_ref_compnr=src.cofc_ref_compnr, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.corn=src.corn, 
                    target.cpgs=src.cpgs, 
                    target.cpgs_ref_compnr=src.cpgs_ref_compnr, 
                    target.cpwc=src.cpwc, 
                    target.cpwc_kw=src.cpwc_kw, 
                    target.crep=src.crep, 
                    target.crep_ref_compnr=src.crep_ref_compnr, 
                    target.cups=src.cups, 
                    target.cups_ref_compnr=src.cups_ref_compnr, 
                    target.cuqs=src.cuqs, 
                    target.cuqs_ref_compnr=src.cuqs_ref_compnr, 
                    target.cvat=src.cvat, 
                    target.cvps=src.cvps, 
                    target.cvqs=src.cvqs, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dest=src.dest, 
                    target.dest_kw=src.dest_kw, 
                    target.disc_1=src.disc_1, 
                    target.disc_10=src.disc_10, 
                    target.disc_11=src.disc_11, 
                    target.disc_2=src.disc_2, 
                    target.disc_3=src.disc_3, 
                    target.disc_4=src.disc_4, 
                    target.disc_5=src.disc_5, 
                    target.disc_6=src.disc_6, 
                    target.disc_7=src.disc_7, 
                    target.disc_8=src.disc_8, 
                    target.disc_9=src.disc_9, 
                    target.dlpt=src.dlpt, 
                    target.dmth_1=src.dmth_1, 
                    target.dmth_10=src.dmth_10, 
                    target.dmth_11=src.dmth_11, 
                    target.dmth_2=src.dmth_2, 
                    target.dmth_3=src.dmth_3, 
                    target.dmth_4=src.dmth_4, 
                    target.dmth_5=src.dmth_5, 
                    target.dmth_6=src.dmth_6, 
                    target.dmth_7=src.dmth_7, 
                    target.dmth_8=src.dmth_8, 
                    target.dmth_9=src.dmth_9, 
                    target.dmth_kw_1=src.dmth_kw_1, 
                    target.dmth_kw_10=src.dmth_kw_10, 
                    target.dmth_kw_11=src.dmth_kw_11, 
                    target.dmth_kw_2=src.dmth_kw_2, 
                    target.dmth_kw_3=src.dmth_kw_3, 
                    target.dmth_kw_4=src.dmth_kw_4, 
                    target.dmth_kw_5=src.dmth_kw_5, 
                    target.dmth_kw_6=src.dmth_kw_6, 
                    target.dmth_kw_7=src.dmth_kw_7, 
                    target.dmth_kw_8=src.dmth_kw_8, 
                    target.dmth_kw_9=src.dmth_kw_9, 
                    target.dsor=src.dsor, 
                    target.dsor_kw=src.dsor_kw, 
                    target.dssc_1=src.dssc_1, 
                    target.dssc_10=src.dssc_10, 
                    target.dssc_11=src.dssc_11, 
                    target.dssc_2=src.dssc_2, 
                    target.dssc_3=src.dssc_3, 
                    target.dssc_4=src.dssc_4, 
                    target.dssc_5=src.dssc_5, 
                    target.dssc_6=src.dssc_6, 
                    target.dssc_7=src.dssc_7, 
                    target.dssc_8=src.dssc_8, 
                    target.dssc_9=src.dssc_9, 
                    target.dtrm=src.dtrm, 
                    target.dtrm_kw=src.dtrm_kw, 
                    target.dttl=src.dttl, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.elgb=src.elgb, 
                    target.elgb_kw=src.elgb_kw, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.hqan=src.hqan, 
                    target.hqan_kw=src.hqan_kw, 
                    target.hval=src.hval, 
                    target.hval_kw=src.hval_kw, 
                    target.icap=src.icap, 
                    target.icap_kw=src.icap_kw, 
                    target.icyp=src.icyp, 
                    target.icyp_kw=src.icyp_kw, 
                    target.ieva=src.ieva, 
                    target.ieva_kw=src.ieva_kw, 
                    target.imcs=src.imcs, 
                    target.iqab=src.iqab, 
                    target.iqab_kw=src.iqab_kw, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.item_stsi_ref_compnr=src.item_stsi_ref_compnr, 
                    target.ldam_1=src.ldam_1, 
                    target.ldam_10=src.ldam_10, 
                    target.ldam_11=src.ldam_11, 
                    target.ldam_2=src.ldam_2, 
                    target.ldam_3=src.ldam_3, 
                    target.ldam_4=src.ldam_4, 
                    target.ldam_5=src.ldam_5, 
                    target.ldam_6=src.ldam_6, 
                    target.ldam_7=src.ldam_7, 
                    target.ldam_8=src.ldam_8, 
                    target.ldam_9=src.ldam_9, 
                    target.leng=src.leng, 
                    target.maxv=src.maxv, 
                    target.minv=src.minv, 
                    target.mqtl=src.mqtl, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.osrp=src.osrp, 
                    target.osrp_ref_compnr=src.osrp_ref_compnr, 
                    target.owno=src.owno, 
                    target.pbor=src.pbor, 
                    target.pbor_kw=src.pbor_kw, 
                    target.pcpr=src.pcpr, 
                    target.pcpr_kw=src.pcpr_kw, 
                    target.pono=src.pono, 
                    target.prbo=src.prbo, 
                    target.prbo_ref_compnr=src.prbo_ref_compnr, 
                    target.pric=src.pric, 
                    target.priu=src.priu, 
                    target.priu_kw=src.priu_kw, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qicl=src.qicl, 
                    target.qicl_buar=src.qicl_buar, 
                    target.qicl_buln=src.qicl_buln, 
                    target.qicl_bupc=src.qicl_bupc, 
                    target.qicl_butm=src.qicl_butm, 
                    target.qicl_buvl=src.qicl_buvl, 
                    target.qicl_buwg=src.qicl_buwg, 
                    target.qicl_trnu=src.qicl_trnu, 
                    target.qiiv=src.qiiv, 
                    target.qiiv_buar=src.qiiv_buar, 
                    target.qiiv_buln=src.qiiv_buln, 
                    target.qiiv_bupc=src.qiiv_bupc, 
                    target.qiiv_butm=src.qiiv_butm, 
                    target.qiiv_buvl=src.qiiv_buvl, 
                    target.qiiv_buwg=src.qiiv_buwg, 
                    target.qiiv_trnu=src.qiiv_trnu, 
                    target.qimo=src.qimo, 
                    target.qomn=src.qomn, 
                    target.qomx=src.qomx, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.revi=src.revi, 
                    target.rpds=src.rpds, 
                    target.rpds_kw=src.rpds_kw, 
                    target.sdat=src.sdat, 
                    target.sdsc=src.sdsc, 
                    target.sdsc_kw=src.sdsc_kw, 
                    target.sequencenumber=src.sequencenumber, 
                    target.sfbp=src.sfbp, 
                    target.sfbp_ref_compnr=src.sfbp_ref_compnr, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stcn=src.stcn, 
                    target.stcn_ref_compnr=src.stcn_ref_compnr, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stwh=src.stwh, 
                    target.stwh_ref_compnr=src.stwh_ref_compnr, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.ucms=src.ucms, 
                    target.ucms_kw=src.ucms_kw, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( adco, adco_kw, adcs, adcs_ref_compnr, aeco, aeco_kw, aeed, aeed_kw, aemq, aemq_kw, afrb, afrb_kw, bamt, bamt_dtwc, bamt_lclc, bamt_rfrc, bamt_rpc1, bamt_rpc2, bfbp, bfbp_ref_compnr, bpcl, bpcl_ref_compnr, bptc, bptc_ref_compnr, camt, camt_dtwc, camt_lclc, camt_rfrc, camt_rpc1, camt_rpc2, ccrf, ccty, ccty_cvat_ref_compnr, ccty_ref_compnr, cdat, cdec, cdec_ref_compnr, cdis_1, cdis_10, cdis_11, cdis_2, cdis_3, cdis_4, cdis_5, cdis_6, cdis_7, cdis_8, cdis_9, ceno, citm, citt, cncd, cofc, cofc_ref_compnr, compnr, cono, cono_ref_compnr, corn, cpgs, cpgs_ref_compnr, cpwc, cpwc_kw, crep, crep_ref_compnr, cups, cups_ref_compnr, cuqs, cuqs_ref_compnr, cvat, cvps, cvqs, cwar, cwar_ref_compnr, deleted, dest, dest_kw, disc_1, disc_10, disc_11, disc_2, disc_3, disc_4, disc_5, disc_6, disc_7, disc_8, disc_9, dlpt, dmth_1, dmth_10, dmth_11, dmth_2, dmth_3, dmth_4, dmth_5, dmth_6, dmth_7, dmth_8, dmth_9, dmth_kw_1, dmth_kw_10, dmth_kw_11, dmth_kw_2, dmth_kw_3, dmth_kw_4, dmth_kw_5, dmth_kw_6, dmth_kw_7, dmth_kw_8, dmth_kw_9, dsor, dsor_kw, dssc_1, dssc_10, dssc_11, dssc_2, dssc_3, dssc_4, dssc_5, dssc_6, dssc_7, dssc_8, dssc_9, dtrm, dtrm_kw, dttl, edat, effn, effn_ref_compnr, elgb, elgb_kw, exmt, exmt_kw, gamt_dtwc, gamt_lclc, gamt_rfrc, gamt_rpc1, gamt_rpc2, gamt_trnc, hqan, hqan_kw, hval, hval_kw, icap, icap_kw, icyp, icyp_kw, ieva, ieva_kw, imcs, iqab, iqab_kw, item, item_ref_compnr, item_site_ref_compnr, item_stsi_ref_compnr, ldam_1, ldam_10, ldam_11, ldam_2, ldam_3, ldam_4, ldam_5, ldam_6, ldam_7, ldam_8, ldam_9, leng, maxv, minv, mqtl, namt_dtwc, namt_lclc, namt_rfrc, namt_rpc1, namt_rpc2, namt_trnc, ofbp, ofbp_ref_compnr, osrp, osrp_ref_compnr, owno, pbor, pbor_kw, pcpr, pcpr_kw, pono, prbo, prbo_ref_compnr, pric, priu, priu_kw, ptpa, ptpa_ref_compnr, qicl, qicl_buar, qicl_buln, qicl_bupc, qicl_butm, qicl_buvl, qicl_buwg, qicl_trnu, qiiv, qiiv_buar, qiiv_buln, qiiv_bupc, qiiv_butm, qiiv_buvl, qiiv_buwg, qiiv_trnu, qimo, qomn, qomx, qoor, qoor_buar, qoor_buln, qoor_bupc, qoor_butm, qoor_buvl, qoor_buwg, qoor_invu, rcod, rcod_ref_compnr, revi, rpds, rpds_kw, sdat, sdsc, sdsc_kw, sequencenumber, sfbp, sfbp_ref_compnr, site, site_ref_compnr, stad, stad_dlpt_ref_compnr, stad_ref_compnr, stbp, stbp_ref_compnr, stcn, stcn_ref_compnr, stsi, stsi_ref_compnr, stwh, stwh_ref_compnr, thic, timestamp, txta, txta_ref_compnr, ucms, ucms_kw, username, widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.adco, 
                    src.adco_kw, 
                    src.adcs, 
                    src.adcs_ref_compnr, 
                    src.aeco, 
                    src.aeco_kw, 
                    src.aeed, 
                    src.aeed_kw, 
                    src.aemq, 
                    src.aemq_kw, 
                    src.afrb, 
                    src.afrb_kw, 
                    src.bamt, 
                    src.bamt_dtwc, 
                    src.bamt_lclc, 
                    src.bamt_rfrc, 
                    src.bamt_rpc1, 
                    src.bamt_rpc2, 
                    src.bfbp, 
                    src.bfbp_ref_compnr, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.camt, 
                    src.camt_dtwc, 
                    src.camt_lclc, 
                    src.camt_rfrc, 
                    src.camt_rpc1, 
                    src.camt_rpc2, 
                    src.ccrf, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.ccty_ref_compnr, 
                    src.cdat, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.cdis_1, 
                    src.cdis_10, 
                    src.cdis_11, 
                    src.cdis_2, 
                    src.cdis_3, 
                    src.cdis_4, 
                    src.cdis_5, 
                    src.cdis_6, 
                    src.cdis_7, 
                    src.cdis_8, 
                    src.cdis_9, 
                    src.ceno, 
                    src.citm, 
                    src.citt, 
                    src.cncd, 
                    src.cofc, 
                    src.cofc_ref_compnr, 
                    src.compnr, 
                    src.cono, 
                    src.cono_ref_compnr, 
                    src.corn, 
                    src.cpgs, 
                    src.cpgs_ref_compnr, 
                    src.cpwc, 
                    src.cpwc_kw, 
                    src.crep, 
                    src.crep_ref_compnr, 
                    src.cups, 
                    src.cups_ref_compnr, 
                    src.cuqs, 
                    src.cuqs_ref_compnr, 
                    src.cvat, 
                    src.cvps, 
                    src.cvqs, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dest, 
                    src.dest_kw, 
                    src.disc_1, 
                    src.disc_10, 
                    src.disc_11, 
                    src.disc_2, 
                    src.disc_3, 
                    src.disc_4, 
                    src.disc_5, 
                    src.disc_6, 
                    src.disc_7, 
                    src.disc_8, 
                    src.disc_9, 
                    src.dlpt, 
                    src.dmth_1, 
                    src.dmth_10, 
                    src.dmth_11, 
                    src.dmth_2, 
                    src.dmth_3, 
                    src.dmth_4, 
                    src.dmth_5, 
                    src.dmth_6, 
                    src.dmth_7, 
                    src.dmth_8, 
                    src.dmth_9, 
                    src.dmth_kw_1, 
                    src.dmth_kw_10, 
                    src.dmth_kw_11, 
                    src.dmth_kw_2, 
                    src.dmth_kw_3, 
                    src.dmth_kw_4, 
                    src.dmth_kw_5, 
                    src.dmth_kw_6, 
                    src.dmth_kw_7, 
                    src.dmth_kw_8, 
                    src.dmth_kw_9, 
                    src.dsor, 
                    src.dsor_kw, 
                    src.dssc_1, 
                    src.dssc_10, 
                    src.dssc_11, 
                    src.dssc_2, 
                    src.dssc_3, 
                    src.dssc_4, 
                    src.dssc_5, 
                    src.dssc_6, 
                    src.dssc_7, 
                    src.dssc_8, 
                    src.dssc_9, 
                    src.dtrm, 
                    src.dtrm_kw, 
                    src.dttl, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.elgb, 
                    src.elgb_kw, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.hqan, 
                    src.hqan_kw, 
                    src.hval, 
                    src.hval_kw, 
                    src.icap, 
                    src.icap_kw, 
                    src.icyp, 
                    src.icyp_kw, 
                    src.ieva, 
                    src.ieva_kw, 
                    src.imcs, 
                    src.iqab, 
                    src.iqab_kw, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.item_stsi_ref_compnr, 
                    src.ldam_1, 
                    src.ldam_10, 
                    src.ldam_11, 
                    src.ldam_2, 
                    src.ldam_3, 
                    src.ldam_4, 
                    src.ldam_5, 
                    src.ldam_6, 
                    src.ldam_7, 
                    src.ldam_8, 
                    src.ldam_9, 
                    src.leng, 
                    src.maxv, 
                    src.minv, 
                    src.mqtl, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.osrp, 
                    src.osrp_ref_compnr, 
                    src.owno, 
                    src.pbor, 
                    src.pbor_kw, 
                    src.pcpr, 
                    src.pcpr_kw, 
                    src.pono, 
                    src.prbo, 
                    src.prbo_ref_compnr, 
                    src.pric, 
                    src.priu, 
                    src.priu_kw, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qicl, 
                    src.qicl_buar, 
                    src.qicl_buln, 
                    src.qicl_bupc, 
                    src.qicl_butm, 
                    src.qicl_buvl, 
                    src.qicl_buwg, 
                    src.qicl_trnu, 
                    src.qiiv, 
                    src.qiiv_buar, 
                    src.qiiv_buln, 
                    src.qiiv_bupc, 
                    src.qiiv_butm, 
                    src.qiiv_buvl, 
                    src.qiiv_buwg, 
                    src.qiiv_trnu, 
                    src.qimo, 
                    src.qomn, 
                    src.qomx, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.revi, 
                    src.rpds, 
                    src.rpds_kw, 
                    src.sdat, 
                    src.sdsc, 
                    src.sdsc_kw, 
                    src.sequencenumber, 
                    src.sfbp, 
                    src.sfbp_ref_compnr, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stcn, 
                    src.stcn_ref_compnr, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stwh, 
                    src.stwh_ref_compnr, 
                    src.thic, 
                    src.timestamp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.ucms, 
                    src.ucms_kw, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;