create or replace procedure DATAHUB_INTEGRATION.SP_LN_TDSLS307()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TDSLS307_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TDSLS307 as target using (SELECT * FROM (SELECT 
            strm.adin, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.casi, 
            strm.casi_ref_compnr, 
            strm.cchn, 
            strm.cchp, 
            strm.ccof, 
            strm.ccof_ref_compnr, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.ceno, 
            strm.cfdt, 
            strm.cfrw, 
            strm.cfrw_ref_compnr, 
            strm.chan, 
            strm.chan_ref_compnr, 
            strm.citr, 
            strm.clot, 
            strm.compnr, 
            strm.cono, 
            strm.cono_pono_ccof_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.crdt, 
            strm.ctyp, 
            strm.ctyp_kw, 
            strm.cucf, 
            strm.cucf_ref_compnr, 
            strm.cups, 
            strm.cuqs, 
            strm.cuqs_ref_compnr, 
            strm.curq, 
            strm.curq_ref_compnr, 
            strm.cuva, 
            strm.cvat, 
            strm.cvcf, 
            strm.cvps, 
            strm.cvqs, 
            strm.cvrq, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.ddta, 
            strm.deleted, 
            strm.dest, 
            strm.dest_kw, 
            strm.dlno, 
            strm.dlpt, 
            strm.dock, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.hold, 
            strm.hold_kw, 
            strm.imcs, 
            strm.invd, 
            strm.invn, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.item_stsi_ref_compnr, 
            strm.leng, 
            strm.lnor, 
            strm.lnor_kw, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.odat, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.opon, 
            strm.orno, 
            strm.pmnt, 
            strm.pmnt_kw, 
            strm.pono, 
            strm.prdt, 
            strm.prfa, 
            strm.prfb, 
            strm.pric, 
            strm.prid, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qccf, 
            strm.qccf_buar, 
            strm.qccf_buln, 
            strm.qccf_bupc, 
            strm.qccf_butm, 
            strm.qccf_buvl, 
            strm.qccf_buwg, 
            strm.qccf_invu, 
            strm.qccf_trnu, 
            strm.qidl, 
            strm.qidl_buar, 
            strm.qidl_buln, 
            strm.qidl_bupc, 
            strm.qidl_butm, 
            strm.qidl_buvl, 
            strm.qidl_buwg, 
            strm.qidl_trnu, 
            strm.qoad, 
            strm.qoad_buar, 
            strm.qoad_buln, 
            strm.qoad_bupc, 
            strm.qoad_butm, 
            strm.qoad_buvl, 
            strm.qoad_buwg, 
            strm.qoad_invu, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.qrrq, 
            strm.qrrq_buar, 
            strm.qrrq_buln, 
            strm.qrrq_bupc, 
            strm.qrrq_butm, 
            strm.qrrq_buvl, 
            strm.qrrq_buwg, 
            strm.qrrq_invu, 
            strm.qrrq_trnu, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.refe, 
            strm.refs, 
            strm.revi, 
            strm.revn, 
            strm.rrdt, 
            strm.rtyp, 
            strm.rtyp_kw, 
            strm.samt, 
            strm.sbim, 
            strm.sbim_kw, 
            strm.schn, 
            strm.schn_sctp_revn_ref_compnr, 
            strm.scmp, 
            strm.sctp, 
            strm.sctp_kw, 
            strm.sdat, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.smsl, 
            strm.smsl_kw, 
            strm.spcn, 
            strm.spon, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stwh, 
            strm.stwh_ref_compnr, 
            strm.styp, 
            strm.styp_ref_compnr, 
            strm.tcpr_dtwc, 
            strm.tcpr_lclc, 
            strm.tcpr_rfrc, 
            strm.tcpr_rpc1, 
            strm.tcpr_rpc2, 
            strm.tcpr_trnc, 
            strm.thic, 
            strm.timestamp, 
            strm.tiun, 
            strm.tiun_kw, 
            strm.ttyp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.schn,
            strm.sctp,
            strm.revn,
            strm.spon ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDSLS307 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.schn=src.schn) OR (target.schn IS NULL AND src.schn IS NULL)) AND
            ((target.sctp=src.sctp) OR (target.sctp IS NULL AND src.sctp IS NULL)) AND
            ((target.revn=src.revn) OR (target.revn IS NULL AND src.revn IS NULL)) AND
            ((target.spon=src.spon) OR (target.spon IS NULL AND src.spon IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.adin=src.adin, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.casi=src.casi, 
                    target.casi_ref_compnr=src.casi_ref_compnr, 
                    target.cchn=src.cchn, 
                    target.cchp=src.cchp, 
                    target.ccof=src.ccof, 
                    target.ccof_ref_compnr=src.ccof_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.ceno=src.ceno, 
                    target.cfdt=src.cfdt, 
                    target.cfrw=src.cfrw, 
                    target.cfrw_ref_compnr=src.cfrw_ref_compnr, 
                    target.chan=src.chan, 
                    target.chan_ref_compnr=src.chan_ref_compnr, 
                    target.citr=src.citr, 
                    target.clot=src.clot, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_pono_ccof_ref_compnr=src.cono_pono_ccof_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.crdt=src.crdt, 
                    target.ctyp=src.ctyp, 
                    target.ctyp_kw=src.ctyp_kw, 
                    target.cucf=src.cucf, 
                    target.cucf_ref_compnr=src.cucf_ref_compnr, 
                    target.cups=src.cups, 
                    target.cuqs=src.cuqs, 
                    target.cuqs_ref_compnr=src.cuqs_ref_compnr, 
                    target.curq=src.curq, 
                    target.curq_ref_compnr=src.curq_ref_compnr, 
                    target.cuva=src.cuva, 
                    target.cvat=src.cvat, 
                    target.cvcf=src.cvcf, 
                    target.cvps=src.cvps, 
                    target.cvqs=src.cvqs, 
                    target.cvrq=src.cvrq, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.ddta=src.ddta, 
                    target.deleted=src.deleted, 
                    target.dest=src.dest, 
                    target.dest_kw=src.dest_kw, 
                    target.dlno=src.dlno, 
                    target.dlpt=src.dlpt, 
                    target.dock=src.dock, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.hold=src.hold, 
                    target.hold_kw=src.hold_kw, 
                    target.imcs=src.imcs, 
                    target.invd=src.invd, 
                    target.invn=src.invn, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.item_stsi_ref_compnr=src.item_stsi_ref_compnr, 
                    target.leng=src.leng, 
                    target.lnor=src.lnor, 
                    target.lnor_kw=src.lnor_kw, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.odat=src.odat, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.opon=src.opon, 
                    target.orno=src.orno, 
                    target.pmnt=src.pmnt, 
                    target.pmnt_kw=src.pmnt_kw, 
                    target.pono=src.pono, 
                    target.prdt=src.prdt, 
                    target.prfa=src.prfa, 
                    target.prfb=src.prfb, 
                    target.pric=src.pric, 
                    target.prid=src.prid, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qccf=src.qccf, 
                    target.qccf_buar=src.qccf_buar, 
                    target.qccf_buln=src.qccf_buln, 
                    target.qccf_bupc=src.qccf_bupc, 
                    target.qccf_butm=src.qccf_butm, 
                    target.qccf_buvl=src.qccf_buvl, 
                    target.qccf_buwg=src.qccf_buwg, 
                    target.qccf_invu=src.qccf_invu, 
                    target.qccf_trnu=src.qccf_trnu, 
                    target.qidl=src.qidl, 
                    target.qidl_buar=src.qidl_buar, 
                    target.qidl_buln=src.qidl_buln, 
                    target.qidl_bupc=src.qidl_bupc, 
                    target.qidl_butm=src.qidl_butm, 
                    target.qidl_buvl=src.qidl_buvl, 
                    target.qidl_buwg=src.qidl_buwg, 
                    target.qidl_trnu=src.qidl_trnu, 
                    target.qoad=src.qoad, 
                    target.qoad_buar=src.qoad_buar, 
                    target.qoad_buln=src.qoad_buln, 
                    target.qoad_bupc=src.qoad_bupc, 
                    target.qoad_butm=src.qoad_butm, 
                    target.qoad_buvl=src.qoad_buvl, 
                    target.qoad_buwg=src.qoad_buwg, 
                    target.qoad_invu=src.qoad_invu, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.qrrq=src.qrrq, 
                    target.qrrq_buar=src.qrrq_buar, 
                    target.qrrq_buln=src.qrrq_buln, 
                    target.qrrq_bupc=src.qrrq_bupc, 
                    target.qrrq_butm=src.qrrq_butm, 
                    target.qrrq_buvl=src.qrrq_buvl, 
                    target.qrrq_buwg=src.qrrq_buwg, 
                    target.qrrq_invu=src.qrrq_invu, 
                    target.qrrq_trnu=src.qrrq_trnu, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.refe=src.refe, 
                    target.refs=src.refs, 
                    target.revi=src.revi, 
                    target.revn=src.revn, 
                    target.rrdt=src.rrdt, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_kw=src.rtyp_kw, 
                    target.samt=src.samt, 
                    target.sbim=src.sbim, 
                    target.sbim_kw=src.sbim_kw, 
                    target.schn=src.schn, 
                    target.schn_sctp_revn_ref_compnr=src.schn_sctp_revn_ref_compnr, 
                    target.scmp=src.scmp, 
                    target.sctp=src.sctp, 
                    target.sctp_kw=src.sctp_kw, 
                    target.sdat=src.sdat, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.smsl=src.smsl, 
                    target.smsl_kw=src.smsl_kw, 
                    target.spcn=src.spcn, 
                    target.spon=src.spon, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stwh=src.stwh, 
                    target.stwh_ref_compnr=src.stwh_ref_compnr, 
                    target.styp=src.styp, 
                    target.styp_ref_compnr=src.styp_ref_compnr, 
                    target.tcpr_dtwc=src.tcpr_dtwc, 
                    target.tcpr_lclc=src.tcpr_lclc, 
                    target.tcpr_rfrc=src.tcpr_rfrc, 
                    target.tcpr_rpc1=src.tcpr_rpc1, 
                    target.tcpr_rpc2=src.tcpr_rpc2, 
                    target.tcpr_trnc=src.tcpr_trnc, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.tiun=src.tiun, 
                    target.tiun_kw=src.tiun_kw, 
                    target.ttyp=src.ttyp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    adin, 
                    bpcl, 
                    bpcl_ref_compnr, 
                    bptc, 
                    bptc_ref_compnr, 
                    casi, 
                    casi_ref_compnr, 
                    cchn, 
                    cchp, 
                    ccof, 
                    ccof_ref_compnr, 
                    ccty, 
                    ccty_cvat_ref_compnr, 
                    cdec, 
                    cdec_ref_compnr, 
                    ceno, 
                    cfdt, 
                    cfrw, 
                    cfrw_ref_compnr, 
                    chan, 
                    chan_ref_compnr, 
                    citr, 
                    clot, 
                    compnr, 
                    cono, 
                    cono_pono_ccof_ref_compnr, 
                    cono_ref_compnr, 
                    crdt, 
                    ctyp, 
                    ctyp_kw, 
                    cucf, 
                    cucf_ref_compnr, 
                    cups, 
                    cuqs, 
                    cuqs_ref_compnr, 
                    curq, 
                    curq_ref_compnr, 
                    cuva, 
                    cvat, 
                    cvcf, 
                    cvps, 
                    cvqs, 
                    cvrq, 
                    cwar, 
                    cwar_ref_compnr, 
                    ddta, 
                    deleted, 
                    dest, 
                    dest_kw, 
                    dlno, 
                    dlpt, 
                    dock, 
                    edat, 
                    effn, 
                    effn_ref_compnr, 
                    exmt, 
                    exmt_kw, 
                    gamt_dtwc, 
                    gamt_lclc, 
                    gamt_rfrc, 
                    gamt_rpc1, 
                    gamt_rpc2, 
                    gamt_trnc, 
                    hold, 
                    hold_kw, 
                    imcs, 
                    invd, 
                    invn, 
                    item, 
                    item_ref_compnr, 
                    item_site_ref_compnr, 
                    item_stsi_ref_compnr, 
                    leng, 
                    lnor, 
                    lnor_kw, 
                    namt_dtwc, 
                    namt_lclc, 
                    namt_rfrc, 
                    namt_rpc1, 
                    namt_rpc2, 
                    namt_trnc, 
                    odat, 
                    ofbp, 
                    ofbp_ref_compnr, 
                    opon, 
                    orno, 
                    pmnt, 
                    pmnt_kw, 
                    pono, 
                    prdt, 
                    prfa, 
                    prfb, 
                    pric, 
                    prid, 
                    ptpa, 
                    ptpa_ref_compnr, 
                    qccf, 
                    qccf_buar, 
                    qccf_buln, 
                    qccf_bupc, 
                    qccf_butm, 
                    qccf_buvl, 
                    qccf_buwg, 
                    qccf_invu, 
                    qccf_trnu, 
                    qidl, 
                    qidl_buar, 
                    qidl_buln, 
                    qidl_bupc, 
                    qidl_butm, 
                    qidl_buvl, 
                    qidl_buwg, 
                    qidl_trnu, 
                    qoad, 
                    qoad_buar, 
                    qoad_buln, 
                    qoad_bupc, 
                    qoad_butm, 
                    qoad_buvl, 
                    qoad_buwg, 
                    qoad_invu, 
                    qoor, 
                    qoor_buar, 
                    qoor_buln, 
                    qoor_bupc, 
                    qoor_butm, 
                    qoor_buvl, 
                    qoor_buwg, 
                    qoor_invu, 
                    qrrq, 
                    qrrq_buar, 
                    qrrq_buln, 
                    qrrq_bupc, 
                    qrrq_butm, 
                    qrrq_buvl, 
                    qrrq_buwg, 
                    qrrq_invu, 
                    qrrq_trnu, 
                    rcod, 
                    rcod_ref_compnr, 
                    refe, 
                    refs, 
                    revi, 
                    revn, 
                    rrdt, 
                    rtyp, 
                    rtyp_kw, 
                    samt, 
                    sbim, 
                    sbim_kw, 
                    schn, 
                    schn_sctp_revn_ref_compnr, 
                    scmp, 
                    sctp, 
                    sctp_kw, 
                    sdat, 
                    seqn, 
                    sequencenumber, 
                    site, 
                    site_ref_compnr, 
                    smsl, 
                    smsl_kw, 
                    spcn, 
                    spon, 
                    stad, 
                    stad_dlpt_ref_compnr, 
                    stad_ref_compnr, 
                    stat, 
                    stat_kw, 
                    stbp, 
                    stbp_ref_compnr, 
                    stsi, 
                    stsi_ref_compnr, 
                    stwh, 
                    stwh_ref_compnr, 
                    styp, 
                    styp_ref_compnr, 
                    tcpr_dtwc, 
                    tcpr_lclc, 
                    tcpr_rfrc, 
                    tcpr_rpc1, 
                    tcpr_rpc2, 
                    tcpr_trnc, 
                    thic, 
                    timestamp, 
                    tiun, 
                    tiun_kw, 
                    ttyp, 
                    txta, 
                    txta_ref_compnr, 
                    username, 
                    widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.adin, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.casi, 
                    src.casi_ref_compnr, 
                    src.cchn, 
                    src.cchp, 
                    src.ccof, 
                    src.ccof_ref_compnr, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.ceno, 
                    src.cfdt, 
                    src.cfrw, 
                    src.cfrw_ref_compnr, 
                    src.chan, 
                    src.chan_ref_compnr, 
                    src.citr, 
                    src.clot, 
                    src.compnr, 
                    src.cono, 
                    src.cono_pono_ccof_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.crdt, 
                    src.ctyp, 
                    src.ctyp_kw, 
                    src.cucf, 
                    src.cucf_ref_compnr, 
                    src.cups, 
                    src.cuqs, 
                    src.cuqs_ref_compnr, 
                    src.curq, 
                    src.curq_ref_compnr, 
                    src.cuva, 
                    src.cvat, 
                    src.cvcf, 
                    src.cvps, 
                    src.cvqs, 
                    src.cvrq, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.ddta, 
                    src.deleted, 
                    src.dest, 
                    src.dest_kw, 
                    src.dlno, 
                    src.dlpt, 
                    src.dock, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.hold, 
                    src.hold_kw, 
                    src.imcs, 
                    src.invd, 
                    src.invn, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.item_stsi_ref_compnr, 
                    src.leng, 
                    src.lnor, 
                    src.lnor_kw, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.odat, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.opon, 
                    src.orno, 
                    src.pmnt, 
                    src.pmnt_kw, 
                    src.pono, 
                    src.prdt, 
                    src.prfa, 
                    src.prfb, 
                    src.pric, 
                    src.prid, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qccf, 
                    src.qccf_buar, 
                    src.qccf_buln, 
                    src.qccf_bupc, 
                    src.qccf_butm, 
                    src.qccf_buvl, 
                    src.qccf_buwg, 
                    src.qccf_invu, 
                    src.qccf_trnu, 
                    src.qidl, 
                    src.qidl_buar, 
                    src.qidl_buln, 
                    src.qidl_bupc, 
                    src.qidl_butm, 
                    src.qidl_buvl, 
                    src.qidl_buwg, 
                    src.qidl_trnu, 
                    src.qoad, 
                    src.qoad_buar, 
                    src.qoad_buln, 
                    src.qoad_bupc, 
                    src.qoad_butm, 
                    src.qoad_buvl, 
                    src.qoad_buwg, 
                    src.qoad_invu, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.qrrq, 
                    src.qrrq_buar, 
                    src.qrrq_buln, 
                    src.qrrq_bupc, 
                    src.qrrq_butm, 
                    src.qrrq_buvl, 
                    src.qrrq_buwg, 
                    src.qrrq_invu, 
                    src.qrrq_trnu, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.refe, 
                    src.refs, 
                    src.revi, 
                    src.revn, 
                    src.rrdt, 
                    src.rtyp, 
                    src.rtyp_kw, 
                    src.samt, 
                    src.sbim, 
                    src.sbim_kw, 
                    src.schn, 
                    src.schn_sctp_revn_ref_compnr, 
                    src.scmp, 
                    src.sctp, 
                    src.sctp_kw, 
                    src.sdat, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.smsl, 
                    src.smsl_kw, 
                    src.spcn, 
                    src.spon, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stwh, 
                    src.stwh_ref_compnr, 
                    src.styp, 
                    src.styp_ref_compnr, 
                    src.tcpr_dtwc, 
                    src.tcpr_lclc, 
                    src.tcpr_rfrc, 
                    src.tcpr_rpc1, 
                    src.tcpr_rpc2, 
                    src.tcpr_trnc, 
                    src.thic, 
                    src.timestamp, 
                    src.tiun, 
                    src.tiun_kw, 
                    src.ttyp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TDSLS307_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.adin, 
            strm.bpcl, 
            strm.bpcl_ref_compnr, 
            strm.bptc, 
            strm.bptc_ref_compnr, 
            strm.casi, 
            strm.casi_ref_compnr, 
            strm.cchn, 
            strm.cchp, 
            strm.ccof, 
            strm.ccof_ref_compnr, 
            strm.ccty, 
            strm.ccty_cvat_ref_compnr, 
            strm.cdec, 
            strm.cdec_ref_compnr, 
            strm.ceno, 
            strm.cfdt, 
            strm.cfrw, 
            strm.cfrw_ref_compnr, 
            strm.chan, 
            strm.chan_ref_compnr, 
            strm.citr, 
            strm.clot, 
            strm.compnr, 
            strm.cono, 
            strm.cono_pono_ccof_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.crdt, 
            strm.ctyp, 
            strm.ctyp_kw, 
            strm.cucf, 
            strm.cucf_ref_compnr, 
            strm.cups, 
            strm.cuqs, 
            strm.cuqs_ref_compnr, 
            strm.curq, 
            strm.curq_ref_compnr, 
            strm.cuva, 
            strm.cvat, 
            strm.cvcf, 
            strm.cvps, 
            strm.cvqs, 
            strm.cvrq, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.ddta, 
            strm.deleted, 
            strm.dest, 
            strm.dest_kw, 
            strm.dlno, 
            strm.dlpt, 
            strm.dock, 
            strm.edat, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.exmt, 
            strm.exmt_kw, 
            strm.gamt_dtwc, 
            strm.gamt_lclc, 
            strm.gamt_rfrc, 
            strm.gamt_rpc1, 
            strm.gamt_rpc2, 
            strm.gamt_trnc, 
            strm.hold, 
            strm.hold_kw, 
            strm.imcs, 
            strm.invd, 
            strm.invn, 
            strm.item, 
            strm.item_ref_compnr, 
            strm.item_site_ref_compnr, 
            strm.item_stsi_ref_compnr, 
            strm.leng, 
            strm.lnor, 
            strm.lnor_kw, 
            strm.namt_dtwc, 
            strm.namt_lclc, 
            strm.namt_rfrc, 
            strm.namt_rpc1, 
            strm.namt_rpc2, 
            strm.namt_trnc, 
            strm.odat, 
            strm.ofbp, 
            strm.ofbp_ref_compnr, 
            strm.opon, 
            strm.orno, 
            strm.pmnt, 
            strm.pmnt_kw, 
            strm.pono, 
            strm.prdt, 
            strm.prfa, 
            strm.prfb, 
            strm.pric, 
            strm.prid, 
            strm.ptpa, 
            strm.ptpa_ref_compnr, 
            strm.qccf, 
            strm.qccf_buar, 
            strm.qccf_buln, 
            strm.qccf_bupc, 
            strm.qccf_butm, 
            strm.qccf_buvl, 
            strm.qccf_buwg, 
            strm.qccf_invu, 
            strm.qccf_trnu, 
            strm.qidl, 
            strm.qidl_buar, 
            strm.qidl_buln, 
            strm.qidl_bupc, 
            strm.qidl_butm, 
            strm.qidl_buvl, 
            strm.qidl_buwg, 
            strm.qidl_trnu, 
            strm.qoad, 
            strm.qoad_buar, 
            strm.qoad_buln, 
            strm.qoad_bupc, 
            strm.qoad_butm, 
            strm.qoad_buvl, 
            strm.qoad_buwg, 
            strm.qoad_invu, 
            strm.qoor, 
            strm.qoor_buar, 
            strm.qoor_buln, 
            strm.qoor_bupc, 
            strm.qoor_butm, 
            strm.qoor_buvl, 
            strm.qoor_buwg, 
            strm.qoor_invu, 
            strm.qrrq, 
            strm.qrrq_buar, 
            strm.qrrq_buln, 
            strm.qrrq_bupc, 
            strm.qrrq_butm, 
            strm.qrrq_buvl, 
            strm.qrrq_buwg, 
            strm.qrrq_invu, 
            strm.qrrq_trnu, 
            strm.rcod, 
            strm.rcod_ref_compnr, 
            strm.refe, 
            strm.refs, 
            strm.revi, 
            strm.revn, 
            strm.rrdt, 
            strm.rtyp, 
            strm.rtyp_kw, 
            strm.samt, 
            strm.sbim, 
            strm.sbim_kw, 
            strm.schn, 
            strm.schn_sctp_revn_ref_compnr, 
            strm.scmp, 
            strm.sctp, 
            strm.sctp_kw, 
            strm.sdat, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.site, 
            strm.site_ref_compnr, 
            strm.smsl, 
            strm.smsl_kw, 
            strm.spcn, 
            strm.spon, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.stad_ref_compnr, 
            strm.stat, 
            strm.stat_kw, 
            strm.stbp, 
            strm.stbp_ref_compnr, 
            strm.stsi, 
            strm.stsi_ref_compnr, 
            strm.stwh, 
            strm.stwh_ref_compnr, 
            strm.styp, 
            strm.styp_ref_compnr, 
            strm.tcpr_dtwc, 
            strm.tcpr_lclc, 
            strm.tcpr_rfrc, 
            strm.tcpr_rpc1, 
            strm.tcpr_rpc2, 
            strm.tcpr_trnc, 
            strm.thic, 
            strm.timestamp, 
            strm.tiun, 
            strm.tiun_kw, 
            strm.ttyp, 
            strm.txta, 
            strm.txta_ref_compnr, 
            strm.username, 
            strm.widt, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.schn,
            strm.sctp,
            strm.revn,
            strm.spon ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TDSLS307 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.schn=src.schn) OR (target.schn IS NULL AND src.schn IS NULL)) AND
            ((target.sctp=src.sctp) OR (target.sctp IS NULL AND src.sctp IS NULL)) AND
            ((target.revn=src.revn) OR (target.revn IS NULL AND src.revn IS NULL)) AND
            ((target.spon=src.spon) OR (target.spon IS NULL AND src.spon IS NULL)) 
                when matched then update set
                    target.adin=src.adin, 
                    target.bpcl=src.bpcl, 
                    target.bpcl_ref_compnr=src.bpcl_ref_compnr, 
                    target.bptc=src.bptc, 
                    target.bptc_ref_compnr=src.bptc_ref_compnr, 
                    target.casi=src.casi, 
                    target.casi_ref_compnr=src.casi_ref_compnr, 
                    target.cchn=src.cchn, 
                    target.cchp=src.cchp, 
                    target.ccof=src.ccof, 
                    target.ccof_ref_compnr=src.ccof_ref_compnr, 
                    target.ccty=src.ccty, 
                    target.ccty_cvat_ref_compnr=src.ccty_cvat_ref_compnr, 
                    target.cdec=src.cdec, 
                    target.cdec_ref_compnr=src.cdec_ref_compnr, 
                    target.ceno=src.ceno, 
                    target.cfdt=src.cfdt, 
                    target.cfrw=src.cfrw, 
                    target.cfrw_ref_compnr=src.cfrw_ref_compnr, 
                    target.chan=src.chan, 
                    target.chan_ref_compnr=src.chan_ref_compnr, 
                    target.citr=src.citr, 
                    target.clot=src.clot, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_pono_ccof_ref_compnr=src.cono_pono_ccof_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.crdt=src.crdt, 
                    target.ctyp=src.ctyp, 
                    target.ctyp_kw=src.ctyp_kw, 
                    target.cucf=src.cucf, 
                    target.cucf_ref_compnr=src.cucf_ref_compnr, 
                    target.cups=src.cups, 
                    target.cuqs=src.cuqs, 
                    target.cuqs_ref_compnr=src.cuqs_ref_compnr, 
                    target.curq=src.curq, 
                    target.curq_ref_compnr=src.curq_ref_compnr, 
                    target.cuva=src.cuva, 
                    target.cvat=src.cvat, 
                    target.cvcf=src.cvcf, 
                    target.cvps=src.cvps, 
                    target.cvqs=src.cvqs, 
                    target.cvrq=src.cvrq, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.ddta=src.ddta, 
                    target.deleted=src.deleted, 
                    target.dest=src.dest, 
                    target.dest_kw=src.dest_kw, 
                    target.dlno=src.dlno, 
                    target.dlpt=src.dlpt, 
                    target.dock=src.dock, 
                    target.edat=src.edat, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.exmt=src.exmt, 
                    target.exmt_kw=src.exmt_kw, 
                    target.gamt_dtwc=src.gamt_dtwc, 
                    target.gamt_lclc=src.gamt_lclc, 
                    target.gamt_rfrc=src.gamt_rfrc, 
                    target.gamt_rpc1=src.gamt_rpc1, 
                    target.gamt_rpc2=src.gamt_rpc2, 
                    target.gamt_trnc=src.gamt_trnc, 
                    target.hold=src.hold, 
                    target.hold_kw=src.hold_kw, 
                    target.imcs=src.imcs, 
                    target.invd=src.invd, 
                    target.invn=src.invn, 
                    target.item=src.item, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.item_site_ref_compnr=src.item_site_ref_compnr, 
                    target.item_stsi_ref_compnr=src.item_stsi_ref_compnr, 
                    target.leng=src.leng, 
                    target.lnor=src.lnor, 
                    target.lnor_kw=src.lnor_kw, 
                    target.namt_dtwc=src.namt_dtwc, 
                    target.namt_lclc=src.namt_lclc, 
                    target.namt_rfrc=src.namt_rfrc, 
                    target.namt_rpc1=src.namt_rpc1, 
                    target.namt_rpc2=src.namt_rpc2, 
                    target.namt_trnc=src.namt_trnc, 
                    target.odat=src.odat, 
                    target.ofbp=src.ofbp, 
                    target.ofbp_ref_compnr=src.ofbp_ref_compnr, 
                    target.opon=src.opon, 
                    target.orno=src.orno, 
                    target.pmnt=src.pmnt, 
                    target.pmnt_kw=src.pmnt_kw, 
                    target.pono=src.pono, 
                    target.prdt=src.prdt, 
                    target.prfa=src.prfa, 
                    target.prfb=src.prfb, 
                    target.pric=src.pric, 
                    target.prid=src.prid, 
                    target.ptpa=src.ptpa, 
                    target.ptpa_ref_compnr=src.ptpa_ref_compnr, 
                    target.qccf=src.qccf, 
                    target.qccf_buar=src.qccf_buar, 
                    target.qccf_buln=src.qccf_buln, 
                    target.qccf_bupc=src.qccf_bupc, 
                    target.qccf_butm=src.qccf_butm, 
                    target.qccf_buvl=src.qccf_buvl, 
                    target.qccf_buwg=src.qccf_buwg, 
                    target.qccf_invu=src.qccf_invu, 
                    target.qccf_trnu=src.qccf_trnu, 
                    target.qidl=src.qidl, 
                    target.qidl_buar=src.qidl_buar, 
                    target.qidl_buln=src.qidl_buln, 
                    target.qidl_bupc=src.qidl_bupc, 
                    target.qidl_butm=src.qidl_butm, 
                    target.qidl_buvl=src.qidl_buvl, 
                    target.qidl_buwg=src.qidl_buwg, 
                    target.qidl_trnu=src.qidl_trnu, 
                    target.qoad=src.qoad, 
                    target.qoad_buar=src.qoad_buar, 
                    target.qoad_buln=src.qoad_buln, 
                    target.qoad_bupc=src.qoad_bupc, 
                    target.qoad_butm=src.qoad_butm, 
                    target.qoad_buvl=src.qoad_buvl, 
                    target.qoad_buwg=src.qoad_buwg, 
                    target.qoad_invu=src.qoad_invu, 
                    target.qoor=src.qoor, 
                    target.qoor_buar=src.qoor_buar, 
                    target.qoor_buln=src.qoor_buln, 
                    target.qoor_bupc=src.qoor_bupc, 
                    target.qoor_butm=src.qoor_butm, 
                    target.qoor_buvl=src.qoor_buvl, 
                    target.qoor_buwg=src.qoor_buwg, 
                    target.qoor_invu=src.qoor_invu, 
                    target.qrrq=src.qrrq, 
                    target.qrrq_buar=src.qrrq_buar, 
                    target.qrrq_buln=src.qrrq_buln, 
                    target.qrrq_bupc=src.qrrq_bupc, 
                    target.qrrq_butm=src.qrrq_butm, 
                    target.qrrq_buvl=src.qrrq_buvl, 
                    target.qrrq_buwg=src.qrrq_buwg, 
                    target.qrrq_invu=src.qrrq_invu, 
                    target.qrrq_trnu=src.qrrq_trnu, 
                    target.rcod=src.rcod, 
                    target.rcod_ref_compnr=src.rcod_ref_compnr, 
                    target.refe=src.refe, 
                    target.refs=src.refs, 
                    target.revi=src.revi, 
                    target.revn=src.revn, 
                    target.rrdt=src.rrdt, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_kw=src.rtyp_kw, 
                    target.samt=src.samt, 
                    target.sbim=src.sbim, 
                    target.sbim_kw=src.sbim_kw, 
                    target.schn=src.schn, 
                    target.schn_sctp_revn_ref_compnr=src.schn_sctp_revn_ref_compnr, 
                    target.scmp=src.scmp, 
                    target.sctp=src.sctp, 
                    target.sctp_kw=src.sctp_kw, 
                    target.sdat=src.sdat, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.site=src.site, 
                    target.site_ref_compnr=src.site_ref_compnr, 
                    target.smsl=src.smsl, 
                    target.smsl_kw=src.smsl_kw, 
                    target.spcn=src.spcn, 
                    target.spon=src.spon, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.stad_ref_compnr=src.stad_ref_compnr, 
                    target.stat=src.stat, 
                    target.stat_kw=src.stat_kw, 
                    target.stbp=src.stbp, 
                    target.stbp_ref_compnr=src.stbp_ref_compnr, 
                    target.stsi=src.stsi, 
                    target.stsi_ref_compnr=src.stsi_ref_compnr, 
                    target.stwh=src.stwh, 
                    target.stwh_ref_compnr=src.stwh_ref_compnr, 
                    target.styp=src.styp, 
                    target.styp_ref_compnr=src.styp_ref_compnr, 
                    target.tcpr_dtwc=src.tcpr_dtwc, 
                    target.tcpr_lclc=src.tcpr_lclc, 
                    target.tcpr_rfrc=src.tcpr_rfrc, 
                    target.tcpr_rpc1=src.tcpr_rpc1, 
                    target.tcpr_rpc2=src.tcpr_rpc2, 
                    target.tcpr_trnc=src.tcpr_trnc, 
                    target.thic=src.thic, 
                    target.timestamp=src.timestamp, 
                    target.tiun=src.tiun, 
                    target.tiun_kw=src.tiun_kw, 
                    target.ttyp=src.ttyp, 
                    target.txta=src.txta, 
                    target.txta_ref_compnr=src.txta_ref_compnr, 
                    target.username=src.username, 
                    target.widt=src.widt, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( adin, bpcl, bpcl_ref_compnr, bptc, bptc_ref_compnr, casi, casi_ref_compnr, cchn, cchp, ccof, ccof_ref_compnr, ccty, ccty_cvat_ref_compnr, cdec, cdec_ref_compnr, ceno, cfdt, cfrw, cfrw_ref_compnr, chan, chan_ref_compnr, citr, clot, compnr, cono, cono_pono_ccof_ref_compnr, cono_ref_compnr, crdt, ctyp, ctyp_kw, cucf, cucf_ref_compnr, cups, cuqs, cuqs_ref_compnr, curq, curq_ref_compnr, cuva, cvat, cvcf, cvps, cvqs, cvrq, cwar, cwar_ref_compnr, ddta, deleted, dest, dest_kw, dlno, dlpt, dock, edat, effn, effn_ref_compnr, exmt, exmt_kw, gamt_dtwc, gamt_lclc, gamt_rfrc, gamt_rpc1, gamt_rpc2, gamt_trnc, hold, hold_kw, imcs, invd, invn, item, item_ref_compnr, item_site_ref_compnr, item_stsi_ref_compnr, leng, lnor, lnor_kw, namt_dtwc, namt_lclc, namt_rfrc, namt_rpc1, namt_rpc2, namt_trnc, odat, ofbp, ofbp_ref_compnr, opon, orno, pmnt, pmnt_kw, pono, prdt, prfa, prfb, pric, prid, ptpa, ptpa_ref_compnr, qccf, qccf_buar, qccf_buln, qccf_bupc, qccf_butm, qccf_buvl, qccf_buwg, qccf_invu, qccf_trnu, qidl, qidl_buar, qidl_buln, qidl_bupc, qidl_butm, qidl_buvl, qidl_buwg, qidl_trnu, qoad, qoad_buar, qoad_buln, qoad_bupc, qoad_butm, qoad_buvl, qoad_buwg, qoad_invu, qoor, qoor_buar, qoor_buln, qoor_bupc, qoor_butm, qoor_buvl, qoor_buwg, qoor_invu, qrrq, qrrq_buar, qrrq_buln, qrrq_bupc, qrrq_butm, qrrq_buvl, qrrq_buwg, qrrq_invu, qrrq_trnu, rcod, rcod_ref_compnr, refe, refs, revi, revn, rrdt, rtyp, rtyp_kw, samt, sbim, sbim_kw, schn, schn_sctp_revn_ref_compnr, scmp, sctp, sctp_kw, sdat, seqn, sequencenumber, site, site_ref_compnr, smsl, smsl_kw, spcn, spon, stad, stad_dlpt_ref_compnr, stad_ref_compnr, stat, stat_kw, stbp, stbp_ref_compnr, stsi, stsi_ref_compnr, stwh, stwh_ref_compnr, styp, styp_ref_compnr, tcpr_dtwc, tcpr_lclc, tcpr_rfrc, tcpr_rpc1, tcpr_rpc2, tcpr_trnc, thic, timestamp, tiun, tiun_kw, ttyp, txta, txta_ref_compnr, username, widt, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.adin, 
                    src.bpcl, 
                    src.bpcl_ref_compnr, 
                    src.bptc, 
                    src.bptc_ref_compnr, 
                    src.casi, 
                    src.casi_ref_compnr, 
                    src.cchn, 
                    src.cchp, 
                    src.ccof, 
                    src.ccof_ref_compnr, 
                    src.ccty, 
                    src.ccty_cvat_ref_compnr, 
                    src.cdec, 
                    src.cdec_ref_compnr, 
                    src.ceno, 
                    src.cfdt, 
                    src.cfrw, 
                    src.cfrw_ref_compnr, 
                    src.chan, 
                    src.chan_ref_compnr, 
                    src.citr, 
                    src.clot, 
                    src.compnr, 
                    src.cono, 
                    src.cono_pono_ccof_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.crdt, 
                    src.ctyp, 
                    src.ctyp_kw, 
                    src.cucf, 
                    src.cucf_ref_compnr, 
                    src.cups, 
                    src.cuqs, 
                    src.cuqs_ref_compnr, 
                    src.curq, 
                    src.curq_ref_compnr, 
                    src.cuva, 
                    src.cvat, 
                    src.cvcf, 
                    src.cvps, 
                    src.cvqs, 
                    src.cvrq, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.ddta, 
                    src.deleted, 
                    src.dest, 
                    src.dest_kw, 
                    src.dlno, 
                    src.dlpt, 
                    src.dock, 
                    src.edat, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.exmt, 
                    src.exmt_kw, 
                    src.gamt_dtwc, 
                    src.gamt_lclc, 
                    src.gamt_rfrc, 
                    src.gamt_rpc1, 
                    src.gamt_rpc2, 
                    src.gamt_trnc, 
                    src.hold, 
                    src.hold_kw, 
                    src.imcs, 
                    src.invd, 
                    src.invn, 
                    src.item, 
                    src.item_ref_compnr, 
                    src.item_site_ref_compnr, 
                    src.item_stsi_ref_compnr, 
                    src.leng, 
                    src.lnor, 
                    src.lnor_kw, 
                    src.namt_dtwc, 
                    src.namt_lclc, 
                    src.namt_rfrc, 
                    src.namt_rpc1, 
                    src.namt_rpc2, 
                    src.namt_trnc, 
                    src.odat, 
                    src.ofbp, 
                    src.ofbp_ref_compnr, 
                    src.opon, 
                    src.orno, 
                    src.pmnt, 
                    src.pmnt_kw, 
                    src.pono, 
                    src.prdt, 
                    src.prfa, 
                    src.prfb, 
                    src.pric, 
                    src.prid, 
                    src.ptpa, 
                    src.ptpa_ref_compnr, 
                    src.qccf, 
                    src.qccf_buar, 
                    src.qccf_buln, 
                    src.qccf_bupc, 
                    src.qccf_butm, 
                    src.qccf_buvl, 
                    src.qccf_buwg, 
                    src.qccf_invu, 
                    src.qccf_trnu, 
                    src.qidl, 
                    src.qidl_buar, 
                    src.qidl_buln, 
                    src.qidl_bupc, 
                    src.qidl_butm, 
                    src.qidl_buvl, 
                    src.qidl_buwg, 
                    src.qidl_trnu, 
                    src.qoad, 
                    src.qoad_buar, 
                    src.qoad_buln, 
                    src.qoad_bupc, 
                    src.qoad_butm, 
                    src.qoad_buvl, 
                    src.qoad_buwg, 
                    src.qoad_invu, 
                    src.qoor, 
                    src.qoor_buar, 
                    src.qoor_buln, 
                    src.qoor_bupc, 
                    src.qoor_butm, 
                    src.qoor_buvl, 
                    src.qoor_buwg, 
                    src.qoor_invu, 
                    src.qrrq, 
                    src.qrrq_buar, 
                    src.qrrq_buln, 
                    src.qrrq_bupc, 
                    src.qrrq_butm, 
                    src.qrrq_buvl, 
                    src.qrrq_buwg, 
                    src.qrrq_invu, 
                    src.qrrq_trnu, 
                    src.rcod, 
                    src.rcod_ref_compnr, 
                    src.refe, 
                    src.refs, 
                    src.revi, 
                    src.revn, 
                    src.rrdt, 
                    src.rtyp, 
                    src.rtyp_kw, 
                    src.samt, 
                    src.sbim, 
                    src.sbim_kw, 
                    src.schn, 
                    src.schn_sctp_revn_ref_compnr, 
                    src.scmp, 
                    src.sctp, 
                    src.sctp_kw, 
                    src.sdat, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.site, 
                    src.site_ref_compnr, 
                    src.smsl, 
                    src.smsl_kw, 
                    src.spcn, 
                    src.spon, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.stad_ref_compnr, 
                    src.stat, 
                    src.stat_kw, 
                    src.stbp, 
                    src.stbp_ref_compnr, 
                    src.stsi, 
                    src.stsi_ref_compnr, 
                    src.stwh, 
                    src.stwh_ref_compnr, 
                    src.styp, 
                    src.styp_ref_compnr, 
                    src.tcpr_dtwc, 
                    src.tcpr_lclc, 
                    src.tcpr_rfrc, 
                    src.tcpr_rpc1, 
                    src.tcpr_rpc2, 
                    src.tcpr_trnc, 
                    src.thic, 
                    src.timestamp, 
                    src.tiun, 
                    src.tiun_kw, 
                    src.ttyp, 
                    src.txta, 
                    src.txta_ref_compnr, 
                    src.username, 
                    src.widt,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;