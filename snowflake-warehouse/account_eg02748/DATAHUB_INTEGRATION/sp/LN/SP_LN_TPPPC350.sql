create or replace procedure DATAHUB_INTEGRATION.SP_LN_TPPPC350()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_TPPPC350_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_TPPPC350 as target using (SELECT * FROM (SELECT 
            strm.afin, 
            strm.afin_kw, 
            strm.amhc_1, 
            strm.amhc_2, 
            strm.amhc_3, 
            strm.amnt, 
            strm.apdt, 
            strm.appr, 
            strm.bfpp, 
            strm.bfpp_kw, 
            strm.bfrf, 
            strm.bfrf_kw, 
            strm.bgam, 
            strm.blnc, 
            strm.blnc_cntc, 
            strm.blnc_dwhc, 
            strm.blnc_homc, 
            strm.blnc_prjc, 
            strm.blnc_refc, 
            strm.blnc_rpc1, 
            strm.blnc_rpc2, 
            strm.btcs, 
            strm.cact, 
            strm.camc, 
            strm.camc_cntc, 
            strm.camc_dwhc, 
            strm.camc_prjc, 
            strm.camc_refc, 
            strm.camr, 
            strm.camr_cntc, 
            strm.camr_dwhc, 
            strm.camr_prjc, 
            strm.camr_refc, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdru, 
            strm.cert, 
            strm.cert_ref_compnr, 
            strm.cfpo, 
            strm.cfpo_kw, 
            strm.chcc_1, 
            strm.chcc_2, 
            strm.chcc_3, 
            strm.chcr_1, 
            strm.chcr_2, 
            strm.chcr_3, 
            strm.clmg, 
            strm.cmfb, 
            strm.cmfb_kw, 
            strm.cmpc, 
            strm.cmpc_kw, 
            strm.cnln, 
            strm.cogs, 
            strm.cogs_kw, 
            strm.comf, 
            strm.comf_kw, 
            strm.compnr, 
            strm.cono, 
            strm.cono_cnln_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.copr, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_cpla_cact_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_cstl_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cprv, 
            strm.cprv_ref_compnr, 
            strm.cptc, 
            strm.cptc_year_peri_ref_compnr, 
            strm.cptf, 
            strm.cptf_fyea_fper_ref_compnr, 
            strm.crdc, 
            strm.crdr, 
            strm.crfc_1, 
            strm.crfc_2, 
            strm.crfc_3, 
            strm.crfr_1, 
            strm.crfr_2, 
            strm.crfr_3, 
            strm.crtc_1, 
            strm.crtc_2, 
            strm.crtc_3, 
            strm.crtr_1, 
            strm.crtr_2, 
            strm.crtr_3, 
            strm.cser, 
            strm.cspa, 
            strm.cstl, 
            strm.ctic, 
            strm.deleted, 
            strm.desc, 
            strm.drun, 
            strm.earf, 
            strm.estc, 
            strm.etcm, 
            strm.exrv, 
            strm.farv, 
            strm.fper, 
            strm.frgd, 
            strm.fyea, 
            strm.guid, 
            strm.heac, 
            strm.hetc, 
            strm.hrbg, 
            strm.hrct, 
            strm.irby, 
            strm.irby_kw, 
            strm.iror, 
            strm.iror_kw, 
            strm.irsc, 
            strm.irsc_kw, 
            strm.lmus, 
            strm.ltdt, 
            strm.pcmp, 
            strm.peri, 
            strm.pfob, 
            strm.pfob_kw, 
            strm.post, 
            strm.post_kw, 
            strm.prpc, 
            strm.prvt, 
            strm.prvt_kw, 
            strm.pstb, 
            strm.pstb_kw, 
            strm.ramc, 
            strm.ramc_cntc, 
            strm.ramc_dwhc, 
            strm.ramc_prjc, 
            strm.ramc_refc, 
            strm.ramr, 
            strm.ramr_cntc, 
            strm.ramr_dwhc, 
            strm.ramr_prjc, 
            strm.ramr_refc, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rdat, 
            strm.rert, 
            strm.rert_ref_compnr, 
            strm.revl, 
            strm.revr, 
            strm.revr_kw, 
            strm.revt, 
            strm.rgdt, 
            strm.rhcc_1, 
            strm.rhcc_2, 
            strm.rhcc_3, 
            strm.rhcr_1, 
            strm.rhcr_2, 
            strm.rhcr_3, 
            strm.rrby, 
            strm.rrby_kw, 
            strm.rrdc, 
            strm.rrdr, 
            strm.rrfc_1, 
            strm.rrfc_2, 
            strm.rrfc_3, 
            strm.rrfr_1, 
            strm.rrfr_2, 
            strm.rrfr_3, 
            strm.rrtc_1, 
            strm.rrtc_2, 
            strm.rrtc_3, 
            strm.rrtr_1, 
            strm.rrtr_2, 
            strm.rrtr_3, 
            strm.rtco, 
            strm.rtco_ref_compnr, 
            strm.rtre, 
            strm.rtre_ref_compnr, 
            strm.rtyp, 
            strm.rtyp_ref_compnr, 
            strm.scds, 
            strm.sequencenumber, 
            strm.serb, 
            strm.sern, 
            strm.timestamp, 
            strm.trpr, 
            strm.txtn, 
            strm.txtn_ref_compnr, 
            strm.username, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cprj,
            strm.cstl,
            strm.cact,
            strm.cspa,
            strm.sern ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPPC350 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.cstl=src.cstl) OR (target.cstl IS NULL AND src.cstl IS NULL)) AND
            ((target.cact=src.cact) OR (target.cact IS NULL AND src.cact IS NULL)) AND
            ((target.cspa=src.cspa) OR (target.cspa IS NULL AND src.cspa IS NULL)) AND
            ((target.sern=src.sern) OR (target.sern IS NULL AND src.sern IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.afin=src.afin, 
                    target.afin_kw=src.afin_kw, 
                    target.amhc_1=src.amhc_1, 
                    target.amhc_2=src.amhc_2, 
                    target.amhc_3=src.amhc_3, 
                    target.amnt=src.amnt, 
                    target.apdt=src.apdt, 
                    target.appr=src.appr, 
                    target.bfpp=src.bfpp, 
                    target.bfpp_kw=src.bfpp_kw, 
                    target.bfrf=src.bfrf, 
                    target.bfrf_kw=src.bfrf_kw, 
                    target.bgam=src.bgam, 
                    target.blnc=src.blnc, 
                    target.blnc_cntc=src.blnc_cntc, 
                    target.blnc_dwhc=src.blnc_dwhc, 
                    target.blnc_homc=src.blnc_homc, 
                    target.blnc_prjc=src.blnc_prjc, 
                    target.blnc_refc=src.blnc_refc, 
                    target.blnc_rpc1=src.blnc_rpc1, 
                    target.blnc_rpc2=src.blnc_rpc2, 
                    target.btcs=src.btcs, 
                    target.cact=src.cact, 
                    target.camc=src.camc, 
                    target.camc_cntc=src.camc_cntc, 
                    target.camc_dwhc=src.camc_dwhc, 
                    target.camc_prjc=src.camc_prjc, 
                    target.camc_refc=src.camc_refc, 
                    target.camr=src.camr, 
                    target.camr_cntc=src.camr_cntc, 
                    target.camr_dwhc=src.camr_dwhc, 
                    target.camr_prjc=src.camr_prjc, 
                    target.camr_refc=src.camr_refc, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdru=src.cdru, 
                    target.cert=src.cert, 
                    target.cert_ref_compnr=src.cert_ref_compnr, 
                    target.cfpo=src.cfpo, 
                    target.cfpo_kw=src.cfpo_kw, 
                    target.chcc_1=src.chcc_1, 
                    target.chcc_2=src.chcc_2, 
                    target.chcc_3=src.chcc_3, 
                    target.chcr_1=src.chcr_1, 
                    target.chcr_2=src.chcr_2, 
                    target.chcr_3=src.chcr_3, 
                    target.clmg=src.clmg, 
                    target.cmfb=src.cmfb, 
                    target.cmfb_kw=src.cmfb_kw, 
                    target.cmpc=src.cmpc, 
                    target.cmpc_kw=src.cmpc_kw, 
                    target.cnln=src.cnln, 
                    target.cogs=src.cogs, 
                    target.cogs_kw=src.cogs_kw, 
                    target.comf=src.comf, 
                    target.comf_kw=src.comf_kw, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_cnln_ref_compnr=src.cono_cnln_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.copr=src.copr, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_cpla_cact_ref_compnr=src.cprj_cpla_cact_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_cstl_ref_compnr=src.cprj_cstl_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprv=src.cprv, 
                    target.cprv_ref_compnr=src.cprv_ref_compnr, 
                    target.cptc=src.cptc, 
                    target.cptc_year_peri_ref_compnr=src.cptc_year_peri_ref_compnr, 
                    target.cptf=src.cptf, 
                    target.cptf_fyea_fper_ref_compnr=src.cptf_fyea_fper_ref_compnr, 
                    target.crdc=src.crdc, 
                    target.crdr=src.crdr, 
                    target.crfc_1=src.crfc_1, 
                    target.crfc_2=src.crfc_2, 
                    target.crfc_3=src.crfc_3, 
                    target.crfr_1=src.crfr_1, 
                    target.crfr_2=src.crfr_2, 
                    target.crfr_3=src.crfr_3, 
                    target.crtc_1=src.crtc_1, 
                    target.crtc_2=src.crtc_2, 
                    target.crtc_3=src.crtc_3, 
                    target.crtr_1=src.crtr_1, 
                    target.crtr_2=src.crtr_2, 
                    target.crtr_3=src.crtr_3, 
                    target.cser=src.cser, 
                    target.cspa=src.cspa, 
                    target.cstl=src.cstl, 
                    target.ctic=src.ctic, 
                    target.deleted=src.deleted, 
                    target.desc=src.desc, 
                    target.drun=src.drun, 
                    target.earf=src.earf, 
                    target.estc=src.estc, 
                    target.etcm=src.etcm, 
                    target.exrv=src.exrv, 
                    target.farv=src.farv, 
                    target.fper=src.fper, 
                    target.frgd=src.frgd, 
                    target.fyea=src.fyea, 
                    target.guid=src.guid, 
                    target.heac=src.heac, 
                    target.hetc=src.hetc, 
                    target.hrbg=src.hrbg, 
                    target.hrct=src.hrct, 
                    target.irby=src.irby, 
                    target.irby_kw=src.irby_kw, 
                    target.iror=src.iror, 
                    target.iror_kw=src.iror_kw, 
                    target.irsc=src.irsc, 
                    target.irsc_kw=src.irsc_kw, 
                    target.lmus=src.lmus, 
                    target.ltdt=src.ltdt, 
                    target.pcmp=src.pcmp, 
                    target.peri=src.peri, 
                    target.pfob=src.pfob, 
                    target.pfob_kw=src.pfob_kw, 
                    target.post=src.post, 
                    target.post_kw=src.post_kw, 
                    target.prpc=src.prpc, 
                    target.prvt=src.prvt, 
                    target.prvt_kw=src.prvt_kw, 
                    target.pstb=src.pstb, 
                    target.pstb_kw=src.pstb_kw, 
                    target.ramc=src.ramc, 
                    target.ramc_cntc=src.ramc_cntc, 
                    target.ramc_dwhc=src.ramc_dwhc, 
                    target.ramc_prjc=src.ramc_prjc, 
                    target.ramc_refc=src.ramc_refc, 
                    target.ramr=src.ramr, 
                    target.ramr_cntc=src.ramr_cntc, 
                    target.ramr_dwhc=src.ramr_dwhc, 
                    target.ramr_prjc=src.ramr_prjc, 
                    target.ramr_refc=src.ramr_refc, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rdat=src.rdat, 
                    target.rert=src.rert, 
                    target.rert_ref_compnr=src.rert_ref_compnr, 
                    target.revl=src.revl, 
                    target.revr=src.revr, 
                    target.revr_kw=src.revr_kw, 
                    target.revt=src.revt, 
                    target.rgdt=src.rgdt, 
                    target.rhcc_1=src.rhcc_1, 
                    target.rhcc_2=src.rhcc_2, 
                    target.rhcc_3=src.rhcc_3, 
                    target.rhcr_1=src.rhcr_1, 
                    target.rhcr_2=src.rhcr_2, 
                    target.rhcr_3=src.rhcr_3, 
                    target.rrby=src.rrby, 
                    target.rrby_kw=src.rrby_kw, 
                    target.rrdc=src.rrdc, 
                    target.rrdr=src.rrdr, 
                    target.rrfc_1=src.rrfc_1, 
                    target.rrfc_2=src.rrfc_2, 
                    target.rrfc_3=src.rrfc_3, 
                    target.rrfr_1=src.rrfr_1, 
                    target.rrfr_2=src.rrfr_2, 
                    target.rrfr_3=src.rrfr_3, 
                    target.rrtc_1=src.rrtc_1, 
                    target.rrtc_2=src.rrtc_2, 
                    target.rrtc_3=src.rrtc_3, 
                    target.rrtr_1=src.rrtr_1, 
                    target.rrtr_2=src.rrtr_2, 
                    target.rrtr_3=src.rrtr_3, 
                    target.rtco=src.rtco, 
                    target.rtco_ref_compnr=src.rtco_ref_compnr, 
                    target.rtre=src.rtre, 
                    target.rtre_ref_compnr=src.rtre_ref_compnr, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_ref_compnr=src.rtyp_ref_compnr, 
                    target.scds=src.scds, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serb=src.serb, 
                    target.sern=src.sern, 
                    target.timestamp=src.timestamp, 
                    target.trpr=src.trpr, 
                    target.txtn=src.txtn, 
                    target.txtn_ref_compnr=src.txtn_ref_compnr, 
                    target.username=src.username, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    afin, 
                    afin_kw, 
                    amhc_1, 
                    amhc_2, 
                    amhc_3, 
                    amnt, 
                    apdt, 
                    appr, 
                    bfpp, 
                    bfpp_kw, 
                    bfrf, 
                    bfrf_kw, 
                    bgam, 
                    blnc, 
                    blnc_cntc, 
                    blnc_dwhc, 
                    blnc_homc, 
                    blnc_prjc, 
                    blnc_refc, 
                    blnc_rpc1, 
                    blnc_rpc2, 
                    btcs, 
                    cact, 
                    camc, 
                    camc_cntc, 
                    camc_dwhc, 
                    camc_prjc, 
                    camc_refc, 
                    camr, 
                    camr_cntc, 
                    camr_dwhc, 
                    camr_prjc, 
                    camr_refc, 
                    ccur, 
                    ccur_ref_compnr, 
                    cdru, 
                    cert, 
                    cert_ref_compnr, 
                    cfpo, 
                    cfpo_kw, 
                    chcc_1, 
                    chcc_2, 
                    chcc_3, 
                    chcr_1, 
                    chcr_2, 
                    chcr_3, 
                    clmg, 
                    cmfb, 
                    cmfb_kw, 
                    cmpc, 
                    cmpc_kw, 
                    cnln, 
                    cogs, 
                    cogs_kw, 
                    comf, 
                    comf_kw, 
                    compnr, 
                    cono, 
                    cono_cnln_ref_compnr, 
                    cono_ref_compnr, 
                    copr, 
                    cpla, 
                    cprj, 
                    cprj_cpla_cact_ref_compnr, 
                    cprj_cspa_ref_compnr, 
                    cprj_cstl_ref_compnr, 
                    cprj_ref_compnr, 
                    cprv, 
                    cprv_ref_compnr, 
                    cptc, 
                    cptc_year_peri_ref_compnr, 
                    cptf, 
                    cptf_fyea_fper_ref_compnr, 
                    crdc, 
                    crdr, 
                    crfc_1, 
                    crfc_2, 
                    crfc_3, 
                    crfr_1, 
                    crfr_2, 
                    crfr_3, 
                    crtc_1, 
                    crtc_2, 
                    crtc_3, 
                    crtr_1, 
                    crtr_2, 
                    crtr_3, 
                    cser, 
                    cspa, 
                    cstl, 
                    ctic, 
                    deleted, 
                    desc, 
                    drun, 
                    earf, 
                    estc, 
                    etcm, 
                    exrv, 
                    farv, 
                    fper, 
                    frgd, 
                    fyea, 
                    guid, 
                    heac, 
                    hetc, 
                    hrbg, 
                    hrct, 
                    irby, 
                    irby_kw, 
                    iror, 
                    iror_kw, 
                    irsc, 
                    irsc_kw, 
                    lmus, 
                    ltdt, 
                    pcmp, 
                    peri, 
                    pfob, 
                    pfob_kw, 
                    post, 
                    post_kw, 
                    prpc, 
                    prvt, 
                    prvt_kw, 
                    pstb, 
                    pstb_kw, 
                    ramc, 
                    ramc_cntc, 
                    ramc_dwhc, 
                    ramc_prjc, 
                    ramc_refc, 
                    ramr, 
                    ramr_cntc, 
                    ramr_dwhc, 
                    ramr_prjc, 
                    ramr_refc, 
                    rate_1, 
                    rate_2, 
                    rate_3, 
                    ratf_1, 
                    ratf_2, 
                    ratf_3, 
                    rdat, 
                    rert, 
                    rert_ref_compnr, 
                    revl, 
                    revr, 
                    revr_kw, 
                    revt, 
                    rgdt, 
                    rhcc_1, 
                    rhcc_2, 
                    rhcc_3, 
                    rhcr_1, 
                    rhcr_2, 
                    rhcr_3, 
                    rrby, 
                    rrby_kw, 
                    rrdc, 
                    rrdr, 
                    rrfc_1, 
                    rrfc_2, 
                    rrfc_3, 
                    rrfr_1, 
                    rrfr_2, 
                    rrfr_3, 
                    rrtc_1, 
                    rrtc_2, 
                    rrtc_3, 
                    rrtr_1, 
                    rrtr_2, 
                    rrtr_3, 
                    rtco, 
                    rtco_ref_compnr, 
                    rtre, 
                    rtre_ref_compnr, 
                    rtyp, 
                    rtyp_ref_compnr, 
                    scds, 
                    sequencenumber, 
                    serb, 
                    sern, 
                    timestamp, 
                    trpr, 
                    txtn, 
                    txtn_ref_compnr, 
                    username, 
                    year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.afin, 
                    src.afin_kw, 
                    src.amhc_1, 
                    src.amhc_2, 
                    src.amhc_3, 
                    src.amnt, 
                    src.apdt, 
                    src.appr, 
                    src.bfpp, 
                    src.bfpp_kw, 
                    src.bfrf, 
                    src.bfrf_kw, 
                    src.bgam, 
                    src.blnc, 
                    src.blnc_cntc, 
                    src.blnc_dwhc, 
                    src.blnc_homc, 
                    src.blnc_prjc, 
                    src.blnc_refc, 
                    src.blnc_rpc1, 
                    src.blnc_rpc2, 
                    src.btcs, 
                    src.cact, 
                    src.camc, 
                    src.camc_cntc, 
                    src.camc_dwhc, 
                    src.camc_prjc, 
                    src.camc_refc, 
                    src.camr, 
                    src.camr_cntc, 
                    src.camr_dwhc, 
                    src.camr_prjc, 
                    src.camr_refc, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdru, 
                    src.cert, 
                    src.cert_ref_compnr, 
                    src.cfpo, 
                    src.cfpo_kw, 
                    src.chcc_1, 
                    src.chcc_2, 
                    src.chcc_3, 
                    src.chcr_1, 
                    src.chcr_2, 
                    src.chcr_3, 
                    src.clmg, 
                    src.cmfb, 
                    src.cmfb_kw, 
                    src.cmpc, 
                    src.cmpc_kw, 
                    src.cnln, 
                    src.cogs, 
                    src.cogs_kw, 
                    src.comf, 
                    src.comf_kw, 
                    src.compnr, 
                    src.cono, 
                    src.cono_cnln_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.copr, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_cpla_cact_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_cstl_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cprv, 
                    src.cprv_ref_compnr, 
                    src.cptc, 
                    src.cptc_year_peri_ref_compnr, 
                    src.cptf, 
                    src.cptf_fyea_fper_ref_compnr, 
                    src.crdc, 
                    src.crdr, 
                    src.crfc_1, 
                    src.crfc_2, 
                    src.crfc_3, 
                    src.crfr_1, 
                    src.crfr_2, 
                    src.crfr_3, 
                    src.crtc_1, 
                    src.crtc_2, 
                    src.crtc_3, 
                    src.crtr_1, 
                    src.crtr_2, 
                    src.crtr_3, 
                    src.cser, 
                    src.cspa, 
                    src.cstl, 
                    src.ctic, 
                    src.deleted, 
                    src.desc, 
                    src.drun, 
                    src.earf, 
                    src.estc, 
                    src.etcm, 
                    src.exrv, 
                    src.farv, 
                    src.fper, 
                    src.frgd, 
                    src.fyea, 
                    src.guid, 
                    src.heac, 
                    src.hetc, 
                    src.hrbg, 
                    src.hrct, 
                    src.irby, 
                    src.irby_kw, 
                    src.iror, 
                    src.iror_kw, 
                    src.irsc, 
                    src.irsc_kw, 
                    src.lmus, 
                    src.ltdt, 
                    src.pcmp, 
                    src.peri, 
                    src.pfob, 
                    src.pfob_kw, 
                    src.post, 
                    src.post_kw, 
                    src.prpc, 
                    src.prvt, 
                    src.prvt_kw, 
                    src.pstb, 
                    src.pstb_kw, 
                    src.ramc, 
                    src.ramc_cntc, 
                    src.ramc_dwhc, 
                    src.ramc_prjc, 
                    src.ramc_refc, 
                    src.ramr, 
                    src.ramr_cntc, 
                    src.ramr_dwhc, 
                    src.ramr_prjc, 
                    src.ramr_refc, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rdat, 
                    src.rert, 
                    src.rert_ref_compnr, 
                    src.revl, 
                    src.revr, 
                    src.revr_kw, 
                    src.revt, 
                    src.rgdt, 
                    src.rhcc_1, 
                    src.rhcc_2, 
                    src.rhcc_3, 
                    src.rhcr_1, 
                    src.rhcr_2, 
                    src.rhcr_3, 
                    src.rrby, 
                    src.rrby_kw, 
                    src.rrdc, 
                    src.rrdr, 
                    src.rrfc_1, 
                    src.rrfc_2, 
                    src.rrfc_3, 
                    src.rrfr_1, 
                    src.rrfr_2, 
                    src.rrfr_3, 
                    src.rrtc_1, 
                    src.rrtc_2, 
                    src.rrtc_3, 
                    src.rrtr_1, 
                    src.rrtr_2, 
                    src.rrtr_3, 
                    src.rtco, 
                    src.rtco_ref_compnr, 
                    src.rtre, 
                    src.rtre_ref_compnr, 
                    src.rtyp, 
                    src.rtyp_ref_compnr, 
                    src.scds, 
                    src.sequencenumber, 
                    src.serb, 
                    src.sern, 
                    src.timestamp, 
                    src.trpr, 
                    src.txtn, 
                    src.txtn_ref_compnr, 
                    src.username, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_TPPPC350_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.afin, 
            strm.afin_kw, 
            strm.amhc_1, 
            strm.amhc_2, 
            strm.amhc_3, 
            strm.amnt, 
            strm.apdt, 
            strm.appr, 
            strm.bfpp, 
            strm.bfpp_kw, 
            strm.bfrf, 
            strm.bfrf_kw, 
            strm.bgam, 
            strm.blnc, 
            strm.blnc_cntc, 
            strm.blnc_dwhc, 
            strm.blnc_homc, 
            strm.blnc_prjc, 
            strm.blnc_refc, 
            strm.blnc_rpc1, 
            strm.blnc_rpc2, 
            strm.btcs, 
            strm.cact, 
            strm.camc, 
            strm.camc_cntc, 
            strm.camc_dwhc, 
            strm.camc_prjc, 
            strm.camc_refc, 
            strm.camr, 
            strm.camr_cntc, 
            strm.camr_dwhc, 
            strm.camr_prjc, 
            strm.camr_refc, 
            strm.ccur, 
            strm.ccur_ref_compnr, 
            strm.cdru, 
            strm.cert, 
            strm.cert_ref_compnr, 
            strm.cfpo, 
            strm.cfpo_kw, 
            strm.chcc_1, 
            strm.chcc_2, 
            strm.chcc_3, 
            strm.chcr_1, 
            strm.chcr_2, 
            strm.chcr_3, 
            strm.clmg, 
            strm.cmfb, 
            strm.cmfb_kw, 
            strm.cmpc, 
            strm.cmpc_kw, 
            strm.cnln, 
            strm.cogs, 
            strm.cogs_kw, 
            strm.comf, 
            strm.comf_kw, 
            strm.compnr, 
            strm.cono, 
            strm.cono_cnln_ref_compnr, 
            strm.cono_ref_compnr, 
            strm.copr, 
            strm.cpla, 
            strm.cprj, 
            strm.cprj_cpla_cact_ref_compnr, 
            strm.cprj_cspa_ref_compnr, 
            strm.cprj_cstl_ref_compnr, 
            strm.cprj_ref_compnr, 
            strm.cprv, 
            strm.cprv_ref_compnr, 
            strm.cptc, 
            strm.cptc_year_peri_ref_compnr, 
            strm.cptf, 
            strm.cptf_fyea_fper_ref_compnr, 
            strm.crdc, 
            strm.crdr, 
            strm.crfc_1, 
            strm.crfc_2, 
            strm.crfc_3, 
            strm.crfr_1, 
            strm.crfr_2, 
            strm.crfr_3, 
            strm.crtc_1, 
            strm.crtc_2, 
            strm.crtc_3, 
            strm.crtr_1, 
            strm.crtr_2, 
            strm.crtr_3, 
            strm.cser, 
            strm.cspa, 
            strm.cstl, 
            strm.ctic, 
            strm.deleted, 
            strm.desc, 
            strm.drun, 
            strm.earf, 
            strm.estc, 
            strm.etcm, 
            strm.exrv, 
            strm.farv, 
            strm.fper, 
            strm.frgd, 
            strm.fyea, 
            strm.guid, 
            strm.heac, 
            strm.hetc, 
            strm.hrbg, 
            strm.hrct, 
            strm.irby, 
            strm.irby_kw, 
            strm.iror, 
            strm.iror_kw, 
            strm.irsc, 
            strm.irsc_kw, 
            strm.lmus, 
            strm.ltdt, 
            strm.pcmp, 
            strm.peri, 
            strm.pfob, 
            strm.pfob_kw, 
            strm.post, 
            strm.post_kw, 
            strm.prpc, 
            strm.prvt, 
            strm.prvt_kw, 
            strm.pstb, 
            strm.pstb_kw, 
            strm.ramc, 
            strm.ramc_cntc, 
            strm.ramc_dwhc, 
            strm.ramc_prjc, 
            strm.ramc_refc, 
            strm.ramr, 
            strm.ramr_cntc, 
            strm.ramr_dwhc, 
            strm.ramr_prjc, 
            strm.ramr_refc, 
            strm.rate_1, 
            strm.rate_2, 
            strm.rate_3, 
            strm.ratf_1, 
            strm.ratf_2, 
            strm.ratf_3, 
            strm.rdat, 
            strm.rert, 
            strm.rert_ref_compnr, 
            strm.revl, 
            strm.revr, 
            strm.revr_kw, 
            strm.revt, 
            strm.rgdt, 
            strm.rhcc_1, 
            strm.rhcc_2, 
            strm.rhcc_3, 
            strm.rhcr_1, 
            strm.rhcr_2, 
            strm.rhcr_3, 
            strm.rrby, 
            strm.rrby_kw, 
            strm.rrdc, 
            strm.rrdr, 
            strm.rrfc_1, 
            strm.rrfc_2, 
            strm.rrfc_3, 
            strm.rrfr_1, 
            strm.rrfr_2, 
            strm.rrfr_3, 
            strm.rrtc_1, 
            strm.rrtc_2, 
            strm.rrtc_3, 
            strm.rrtr_1, 
            strm.rrtr_2, 
            strm.rrtr_3, 
            strm.rtco, 
            strm.rtco_ref_compnr, 
            strm.rtre, 
            strm.rtre_ref_compnr, 
            strm.rtyp, 
            strm.rtyp_ref_compnr, 
            strm.scds, 
            strm.sequencenumber, 
            strm.serb, 
            strm.sern, 
            strm.timestamp, 
            strm.trpr, 
            strm.txtn, 
            strm.txtn_ref_compnr, 
            strm.username, 
            strm.year, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.cprj,
            strm.cstl,
            strm.cact,
            strm.cspa,
            strm.sern ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_TPPPC350 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.cprj=src.cprj) OR (target.cprj IS NULL AND src.cprj IS NULL)) AND
            ((target.cstl=src.cstl) OR (target.cstl IS NULL AND src.cstl IS NULL)) AND
            ((target.cact=src.cact) OR (target.cact IS NULL AND src.cact IS NULL)) AND
            ((target.cspa=src.cspa) OR (target.cspa IS NULL AND src.cspa IS NULL)) AND
            ((target.sern=src.sern) OR (target.sern IS NULL AND src.sern IS NULL)) 
                when matched then update set
                    target.afin=src.afin, 
                    target.afin_kw=src.afin_kw, 
                    target.amhc_1=src.amhc_1, 
                    target.amhc_2=src.amhc_2, 
                    target.amhc_3=src.amhc_3, 
                    target.amnt=src.amnt, 
                    target.apdt=src.apdt, 
                    target.appr=src.appr, 
                    target.bfpp=src.bfpp, 
                    target.bfpp_kw=src.bfpp_kw, 
                    target.bfrf=src.bfrf, 
                    target.bfrf_kw=src.bfrf_kw, 
                    target.bgam=src.bgam, 
                    target.blnc=src.blnc, 
                    target.blnc_cntc=src.blnc_cntc, 
                    target.blnc_dwhc=src.blnc_dwhc, 
                    target.blnc_homc=src.blnc_homc, 
                    target.blnc_prjc=src.blnc_prjc, 
                    target.blnc_refc=src.blnc_refc, 
                    target.blnc_rpc1=src.blnc_rpc1, 
                    target.blnc_rpc2=src.blnc_rpc2, 
                    target.btcs=src.btcs, 
                    target.cact=src.cact, 
                    target.camc=src.camc, 
                    target.camc_cntc=src.camc_cntc, 
                    target.camc_dwhc=src.camc_dwhc, 
                    target.camc_prjc=src.camc_prjc, 
                    target.camc_refc=src.camc_refc, 
                    target.camr=src.camr, 
                    target.camr_cntc=src.camr_cntc, 
                    target.camr_dwhc=src.camr_dwhc, 
                    target.camr_prjc=src.camr_prjc, 
                    target.camr_refc=src.camr_refc, 
                    target.ccur=src.ccur, 
                    target.ccur_ref_compnr=src.ccur_ref_compnr, 
                    target.cdru=src.cdru, 
                    target.cert=src.cert, 
                    target.cert_ref_compnr=src.cert_ref_compnr, 
                    target.cfpo=src.cfpo, 
                    target.cfpo_kw=src.cfpo_kw, 
                    target.chcc_1=src.chcc_1, 
                    target.chcc_2=src.chcc_2, 
                    target.chcc_3=src.chcc_3, 
                    target.chcr_1=src.chcr_1, 
                    target.chcr_2=src.chcr_2, 
                    target.chcr_3=src.chcr_3, 
                    target.clmg=src.clmg, 
                    target.cmfb=src.cmfb, 
                    target.cmfb_kw=src.cmfb_kw, 
                    target.cmpc=src.cmpc, 
                    target.cmpc_kw=src.cmpc_kw, 
                    target.cnln=src.cnln, 
                    target.cogs=src.cogs, 
                    target.cogs_kw=src.cogs_kw, 
                    target.comf=src.comf, 
                    target.comf_kw=src.comf_kw, 
                    target.compnr=src.compnr, 
                    target.cono=src.cono, 
                    target.cono_cnln_ref_compnr=src.cono_cnln_ref_compnr, 
                    target.cono_ref_compnr=src.cono_ref_compnr, 
                    target.copr=src.copr, 
                    target.cpla=src.cpla, 
                    target.cprj=src.cprj, 
                    target.cprj_cpla_cact_ref_compnr=src.cprj_cpla_cact_ref_compnr, 
                    target.cprj_cspa_ref_compnr=src.cprj_cspa_ref_compnr, 
                    target.cprj_cstl_ref_compnr=src.cprj_cstl_ref_compnr, 
                    target.cprj_ref_compnr=src.cprj_ref_compnr, 
                    target.cprv=src.cprv, 
                    target.cprv_ref_compnr=src.cprv_ref_compnr, 
                    target.cptc=src.cptc, 
                    target.cptc_year_peri_ref_compnr=src.cptc_year_peri_ref_compnr, 
                    target.cptf=src.cptf, 
                    target.cptf_fyea_fper_ref_compnr=src.cptf_fyea_fper_ref_compnr, 
                    target.crdc=src.crdc, 
                    target.crdr=src.crdr, 
                    target.crfc_1=src.crfc_1, 
                    target.crfc_2=src.crfc_2, 
                    target.crfc_3=src.crfc_3, 
                    target.crfr_1=src.crfr_1, 
                    target.crfr_2=src.crfr_2, 
                    target.crfr_3=src.crfr_3, 
                    target.crtc_1=src.crtc_1, 
                    target.crtc_2=src.crtc_2, 
                    target.crtc_3=src.crtc_3, 
                    target.crtr_1=src.crtr_1, 
                    target.crtr_2=src.crtr_2, 
                    target.crtr_3=src.crtr_3, 
                    target.cser=src.cser, 
                    target.cspa=src.cspa, 
                    target.cstl=src.cstl, 
                    target.ctic=src.ctic, 
                    target.deleted=src.deleted, 
                    target.desc=src.desc, 
                    target.drun=src.drun, 
                    target.earf=src.earf, 
                    target.estc=src.estc, 
                    target.etcm=src.etcm, 
                    target.exrv=src.exrv, 
                    target.farv=src.farv, 
                    target.fper=src.fper, 
                    target.frgd=src.frgd, 
                    target.fyea=src.fyea, 
                    target.guid=src.guid, 
                    target.heac=src.heac, 
                    target.hetc=src.hetc, 
                    target.hrbg=src.hrbg, 
                    target.hrct=src.hrct, 
                    target.irby=src.irby, 
                    target.irby_kw=src.irby_kw, 
                    target.iror=src.iror, 
                    target.iror_kw=src.iror_kw, 
                    target.irsc=src.irsc, 
                    target.irsc_kw=src.irsc_kw, 
                    target.lmus=src.lmus, 
                    target.ltdt=src.ltdt, 
                    target.pcmp=src.pcmp, 
                    target.peri=src.peri, 
                    target.pfob=src.pfob, 
                    target.pfob_kw=src.pfob_kw, 
                    target.post=src.post, 
                    target.post_kw=src.post_kw, 
                    target.prpc=src.prpc, 
                    target.prvt=src.prvt, 
                    target.prvt_kw=src.prvt_kw, 
                    target.pstb=src.pstb, 
                    target.pstb_kw=src.pstb_kw, 
                    target.ramc=src.ramc, 
                    target.ramc_cntc=src.ramc_cntc, 
                    target.ramc_dwhc=src.ramc_dwhc, 
                    target.ramc_prjc=src.ramc_prjc, 
                    target.ramc_refc=src.ramc_refc, 
                    target.ramr=src.ramr, 
                    target.ramr_cntc=src.ramr_cntc, 
                    target.ramr_dwhc=src.ramr_dwhc, 
                    target.ramr_prjc=src.ramr_prjc, 
                    target.ramr_refc=src.ramr_refc, 
                    target.rate_1=src.rate_1, 
                    target.rate_2=src.rate_2, 
                    target.rate_3=src.rate_3, 
                    target.ratf_1=src.ratf_1, 
                    target.ratf_2=src.ratf_2, 
                    target.ratf_3=src.ratf_3, 
                    target.rdat=src.rdat, 
                    target.rert=src.rert, 
                    target.rert_ref_compnr=src.rert_ref_compnr, 
                    target.revl=src.revl, 
                    target.revr=src.revr, 
                    target.revr_kw=src.revr_kw, 
                    target.revt=src.revt, 
                    target.rgdt=src.rgdt, 
                    target.rhcc_1=src.rhcc_1, 
                    target.rhcc_2=src.rhcc_2, 
                    target.rhcc_3=src.rhcc_3, 
                    target.rhcr_1=src.rhcr_1, 
                    target.rhcr_2=src.rhcr_2, 
                    target.rhcr_3=src.rhcr_3, 
                    target.rrby=src.rrby, 
                    target.rrby_kw=src.rrby_kw, 
                    target.rrdc=src.rrdc, 
                    target.rrdr=src.rrdr, 
                    target.rrfc_1=src.rrfc_1, 
                    target.rrfc_2=src.rrfc_2, 
                    target.rrfc_3=src.rrfc_3, 
                    target.rrfr_1=src.rrfr_1, 
                    target.rrfr_2=src.rrfr_2, 
                    target.rrfr_3=src.rrfr_3, 
                    target.rrtc_1=src.rrtc_1, 
                    target.rrtc_2=src.rrtc_2, 
                    target.rrtc_3=src.rrtc_3, 
                    target.rrtr_1=src.rrtr_1, 
                    target.rrtr_2=src.rrtr_2, 
                    target.rrtr_3=src.rrtr_3, 
                    target.rtco=src.rtco, 
                    target.rtco_ref_compnr=src.rtco_ref_compnr, 
                    target.rtre=src.rtre, 
                    target.rtre_ref_compnr=src.rtre_ref_compnr, 
                    target.rtyp=src.rtyp, 
                    target.rtyp_ref_compnr=src.rtyp_ref_compnr, 
                    target.scds=src.scds, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serb=src.serb, 
                    target.sern=src.sern, 
                    target.timestamp=src.timestamp, 
                    target.trpr=src.trpr, 
                    target.txtn=src.txtn, 
                    target.txtn_ref_compnr=src.txtn_ref_compnr, 
                    target.username=src.username, 
                    target.year=src.year, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( afin, afin_kw, amhc_1, amhc_2, amhc_3, amnt, apdt, appr, bfpp, bfpp_kw, bfrf, bfrf_kw, bgam, blnc, blnc_cntc, blnc_dwhc, blnc_homc, blnc_prjc, blnc_refc, blnc_rpc1, blnc_rpc2, btcs, cact, camc, camc_cntc, camc_dwhc, camc_prjc, camc_refc, camr, camr_cntc, camr_dwhc, camr_prjc, camr_refc, ccur, ccur_ref_compnr, cdru, cert, cert_ref_compnr, cfpo, cfpo_kw, chcc_1, chcc_2, chcc_3, chcr_1, chcr_2, chcr_3, clmg, cmfb, cmfb_kw, cmpc, cmpc_kw, cnln, cogs, cogs_kw, comf, comf_kw, compnr, cono, cono_cnln_ref_compnr, cono_ref_compnr, copr, cpla, cprj, cprj_cpla_cact_ref_compnr, cprj_cspa_ref_compnr, cprj_cstl_ref_compnr, cprj_ref_compnr, cprv, cprv_ref_compnr, cptc, cptc_year_peri_ref_compnr, cptf, cptf_fyea_fper_ref_compnr, crdc, crdr, crfc_1, crfc_2, crfc_3, crfr_1, crfr_2, crfr_3, crtc_1, crtc_2, crtc_3, crtr_1, crtr_2, crtr_3, cser, cspa, cstl, ctic, deleted, desc, drun, earf, estc, etcm, exrv, farv, fper, frgd, fyea, guid, heac, hetc, hrbg, hrct, irby, irby_kw, iror, iror_kw, irsc, irsc_kw, lmus, ltdt, pcmp, peri, pfob, pfob_kw, post, post_kw, prpc, prvt, prvt_kw, pstb, pstb_kw, ramc, ramc_cntc, ramc_dwhc, ramc_prjc, ramc_refc, ramr, ramr_cntc, ramr_dwhc, ramr_prjc, ramr_refc, rate_1, rate_2, rate_3, ratf_1, ratf_2, ratf_3, rdat, rert, rert_ref_compnr, revl, revr, revr_kw, revt, rgdt, rhcc_1, rhcc_2, rhcc_3, rhcr_1, rhcr_2, rhcr_3, rrby, rrby_kw, rrdc, rrdr, rrfc_1, rrfc_2, rrfc_3, rrfr_1, rrfr_2, rrfr_3, rrtc_1, rrtc_2, rrtc_3, rrtr_1, rrtr_2, rrtr_3, rtco, rtco_ref_compnr, rtre, rtre_ref_compnr, rtyp, rtyp_ref_compnr, scds, sequencenumber, serb, sern, timestamp, trpr, txtn, txtn_ref_compnr, username, year, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.afin, 
                    src.afin_kw, 
                    src.amhc_1, 
                    src.amhc_2, 
                    src.amhc_3, 
                    src.amnt, 
                    src.apdt, 
                    src.appr, 
                    src.bfpp, 
                    src.bfpp_kw, 
                    src.bfrf, 
                    src.bfrf_kw, 
                    src.bgam, 
                    src.blnc, 
                    src.blnc_cntc, 
                    src.blnc_dwhc, 
                    src.blnc_homc, 
                    src.blnc_prjc, 
                    src.blnc_refc, 
                    src.blnc_rpc1, 
                    src.blnc_rpc2, 
                    src.btcs, 
                    src.cact, 
                    src.camc, 
                    src.camc_cntc, 
                    src.camc_dwhc, 
                    src.camc_prjc, 
                    src.camc_refc, 
                    src.camr, 
                    src.camr_cntc, 
                    src.camr_dwhc, 
                    src.camr_prjc, 
                    src.camr_refc, 
                    src.ccur, 
                    src.ccur_ref_compnr, 
                    src.cdru, 
                    src.cert, 
                    src.cert_ref_compnr, 
                    src.cfpo, 
                    src.cfpo_kw, 
                    src.chcc_1, 
                    src.chcc_2, 
                    src.chcc_3, 
                    src.chcr_1, 
                    src.chcr_2, 
                    src.chcr_3, 
                    src.clmg, 
                    src.cmfb, 
                    src.cmfb_kw, 
                    src.cmpc, 
                    src.cmpc_kw, 
                    src.cnln, 
                    src.cogs, 
                    src.cogs_kw, 
                    src.comf, 
                    src.comf_kw, 
                    src.compnr, 
                    src.cono, 
                    src.cono_cnln_ref_compnr, 
                    src.cono_ref_compnr, 
                    src.copr, 
                    src.cpla, 
                    src.cprj, 
                    src.cprj_cpla_cact_ref_compnr, 
                    src.cprj_cspa_ref_compnr, 
                    src.cprj_cstl_ref_compnr, 
                    src.cprj_ref_compnr, 
                    src.cprv, 
                    src.cprv_ref_compnr, 
                    src.cptc, 
                    src.cptc_year_peri_ref_compnr, 
                    src.cptf, 
                    src.cptf_fyea_fper_ref_compnr, 
                    src.crdc, 
                    src.crdr, 
                    src.crfc_1, 
                    src.crfc_2, 
                    src.crfc_3, 
                    src.crfr_1, 
                    src.crfr_2, 
                    src.crfr_3, 
                    src.crtc_1, 
                    src.crtc_2, 
                    src.crtc_3, 
                    src.crtr_1, 
                    src.crtr_2, 
                    src.crtr_3, 
                    src.cser, 
                    src.cspa, 
                    src.cstl, 
                    src.ctic, 
                    src.deleted, 
                    src.desc, 
                    src.drun, 
                    src.earf, 
                    src.estc, 
                    src.etcm, 
                    src.exrv, 
                    src.farv, 
                    src.fper, 
                    src.frgd, 
                    src.fyea, 
                    src.guid, 
                    src.heac, 
                    src.hetc, 
                    src.hrbg, 
                    src.hrct, 
                    src.irby, 
                    src.irby_kw, 
                    src.iror, 
                    src.iror_kw, 
                    src.irsc, 
                    src.irsc_kw, 
                    src.lmus, 
                    src.ltdt, 
                    src.pcmp, 
                    src.peri, 
                    src.pfob, 
                    src.pfob_kw, 
                    src.post, 
                    src.post_kw, 
                    src.prpc, 
                    src.prvt, 
                    src.prvt_kw, 
                    src.pstb, 
                    src.pstb_kw, 
                    src.ramc, 
                    src.ramc_cntc, 
                    src.ramc_dwhc, 
                    src.ramc_prjc, 
                    src.ramc_refc, 
                    src.ramr, 
                    src.ramr_cntc, 
                    src.ramr_dwhc, 
                    src.ramr_prjc, 
                    src.ramr_refc, 
                    src.rate_1, 
                    src.rate_2, 
                    src.rate_3, 
                    src.ratf_1, 
                    src.ratf_2, 
                    src.ratf_3, 
                    src.rdat, 
                    src.rert, 
                    src.rert_ref_compnr, 
                    src.revl, 
                    src.revr, 
                    src.revr_kw, 
                    src.revt, 
                    src.rgdt, 
                    src.rhcc_1, 
                    src.rhcc_2, 
                    src.rhcc_3, 
                    src.rhcr_1, 
                    src.rhcr_2, 
                    src.rhcr_3, 
                    src.rrby, 
                    src.rrby_kw, 
                    src.rrdc, 
                    src.rrdr, 
                    src.rrfc_1, 
                    src.rrfc_2, 
                    src.rrfc_3, 
                    src.rrfr_1, 
                    src.rrfr_2, 
                    src.rrfr_3, 
                    src.rrtc_1, 
                    src.rrtc_2, 
                    src.rrtc_3, 
                    src.rrtr_1, 
                    src.rrtr_2, 
                    src.rrtr_3, 
                    src.rtco, 
                    src.rtco_ref_compnr, 
                    src.rtre, 
                    src.rtre_ref_compnr, 
                    src.rtyp, 
                    src.rtyp_ref_compnr, 
                    src.scds, 
                    src.sequencenumber, 
                    src.serb, 
                    src.sern, 
                    src.timestamp, 
                    src.trpr, 
                    src.txtn, 
                    src.txtn_ref_compnr, 
                    src.username, 
                    src.year,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;