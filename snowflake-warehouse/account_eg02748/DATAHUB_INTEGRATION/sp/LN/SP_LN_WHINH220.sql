create or replace procedure DATAHUB_INTEGRATION.SP_LN_WHINH220()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.LN_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_LN_WHINH220_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_LN.LN_WHINH220 as target using (SELECT * FROM (SELECT 
            strm.acpn, 
            strm.acpn_kw, 
            strm.acvt, 
            strm.acvt_kw, 
            strm.addt, 
            strm.adin, 
            strm.atse, 
            strm.atse_ref_compnr, 
            strm.bcko, 
            strm.bcko_kw, 
            strm.bflh, 
            strm.bflh_kw, 
            strm.bgxc, 
            strm.bgxc_kw, 
            strm.blck, 
            strm.blck_kw, 
            strm.casi, 
            strm.casi_ref_compnr, 
            strm.cdck, 
            strm.cdck_kw, 
            strm.circ, 
            strm.clot, 
            strm.cncl, 
            strm.cncl_kw, 
            strm.comp, 
            strm.compnr, 
            strm.corn, 
            strm.csvc, 
            strm.csvc_ref_compnr, 
            strm.csvl, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dlpt, 
            strm.dtag, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.fact, 
            strm.fcco, 
            strm.fcco_ref_compnr, 
            strm.fisc, 
            strm.fisc_kw, 
            strm.fmln, 
            strm.fmor, 
            strm.fprj, 
            strm.fprj_ref_compnr, 
            strm.fspa, 
            strm.fstl, 
            strm.gefo, 
            strm.gefo_kw, 
            strm.gnld, 
            strm.hstq, 
            strm.hstq_kw, 
            strm.huid, 
            strm.huwt, 
            strm.huwt_kw, 
            strm.ifbp, 
            strm.ifbp_ref_compnr, 
            strm.imcs, 
            strm.inup, 
            strm.inup_kw, 
            strm.iown, 
            strm.iown_kw, 
            strm.ipay, 
            strm.ipay_kw, 
            strm.iscn, 
            strm.iscn_kw, 
            strm.istr, 
            strm.istr_kw, 
            strm.item, 
            strm.item_atse_ref_compnr, 
            strm.item_clot_ref_compnr, 
            strm.item_ref_compnr, 
            strm.iubw, 
            strm.iubw_kw, 
            strm.lsel, 
            strm.lsel_kw, 
            strm.lsta, 
            strm.lsta_kw, 
            strm.masp, 
            strm.masp_kw, 
            strm.oarq, 
            strm.oarq_kw, 
            strm.ocur, 
            strm.ocur_ref_compnr, 
            strm.oorg, 
            strm.oorg_kw, 
            strm.oorg_orno_oset_ref_compnr, 
            strm.orno, 
            strm.orpr, 
            strm.orun, 
            strm.orun_ref_compnr, 
            strm.oset, 
            strm.ovfp, 
            strm.ovfp_kw, 
            strm.ovlp, 
            strm.ovlp_kw, 
            strm.owns, 
            strm.owns_kw, 
            strm.paym, 
            strm.paym_kw, 
            strm.pddt, 
            strm.pkdb, 
            strm.pkdb_kw, 
            strm.pkdf, 
            strm.pkdf_ref_compnr, 
            strm.pono, 
            strm.prdt, 
            strm.prio, 
            strm.prjp, 
            strm.prjp_kw, 
            strm.qacp, 
            strm.qact, 
            strm.qadp, 
            strm.qadv, 
            strm.qapp, 
            strm.qapr, 
            strm.qcad, 
            strm.qcap, 
            strm.qcnl, 
            strm.qcnp, 
            strm.qnpu, 
            strm.qnse, 
            strm.qnsh, 
            strm.qnsp, 
            strm.qoop, 
            strm.qoor, 
            strm.qopu, 
            strm.qord, 
            strm.qoro, 
            strm.qorp, 
            strm.qova, 
            strm.qovd, 
            strm.qovp, 
            strm.qpic, 
            strm.qpip, 
            strm.qprv, 
            strm.qpss, 
            strm.qpsv, 
            strm.qrej, 
            strm.qrel, 
            strm.qrep, 
            strm.qreq, 
            strm.qrpu, 
            strm.qrsc, 
            strm.qrsp, 
            strm.qscl, 
            strm.qscp, 
            strm.qshp, 
            strm.qspu, 
            strm.refe, 
            strm.refs, 
            strm.revi, 
            strm.rorg, 
            strm.rorg_kw, 
            strm.rorn, 
            strm.rowc, 
            strm.rowc_ref_compnr, 
            strm.rown, 
            strm.rown_ref_compnr, 
            strm.rpon, 
            strm.rqpu, 
            strm.rseq, 
            strm.rush, 
            strm.rush_kw, 
            strm.scon, 
            strm.scon_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.serl, 
            strm.shrt, 
            strm.shrt_kw, 
            strm.spcn, 
            strm.ssts, 
            strm.ssts_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.sups, 
            strm.sups_kw, 
            strm.tact, 
            strm.tcco, 
            strm.tcco_ref_compnr, 
            strm.timestamp, 
            strm.tprj, 
            strm.tprj_ref_compnr, 
            strm.tspa, 
            strm.tstl, 
            strm.txtn, 
            strm.txtn_ref_compnr, 
            strm.ubin, 
            strm.ubin_kw, 
            strm.username, 
            strm.uwop, 
            strm.uwop_kw, 
            strm.wmss, 
            strm.wmss_kw, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.oorg,
            strm.orno,
            strm.pono,
            strm.seqn ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_WHINH220 as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.oorg=src.oorg) OR (target.oorg IS NULL AND src.oorg IS NULL)) AND
            ((target.orno=src.orno) OR (target.orno IS NULL AND src.orno IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.seqn=src.seqn) OR (target.seqn IS NULL AND src.seqn IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.acpn=src.acpn, 
                    target.acpn_kw=src.acpn_kw, 
                    target.acvt=src.acvt, 
                    target.acvt_kw=src.acvt_kw, 
                    target.addt=src.addt, 
                    target.adin=src.adin, 
                    target.atse=src.atse, 
                    target.atse_ref_compnr=src.atse_ref_compnr, 
                    target.bcko=src.bcko, 
                    target.bcko_kw=src.bcko_kw, 
                    target.bflh=src.bflh, 
                    target.bflh_kw=src.bflh_kw, 
                    target.bgxc=src.bgxc, 
                    target.bgxc_kw=src.bgxc_kw, 
                    target.blck=src.blck, 
                    target.blck_kw=src.blck_kw, 
                    target.casi=src.casi, 
                    target.casi_ref_compnr=src.casi_ref_compnr, 
                    target.cdck=src.cdck, 
                    target.cdck_kw=src.cdck_kw, 
                    target.circ=src.circ, 
                    target.clot=src.clot, 
                    target.cncl=src.cncl, 
                    target.cncl_kw=src.cncl_kw, 
                    target.comp=src.comp, 
                    target.compnr=src.compnr, 
                    target.corn=src.corn, 
                    target.csvc=src.csvc, 
                    target.csvc_ref_compnr=src.csvc_ref_compnr, 
                    target.csvl=src.csvl, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dlpt=src.dlpt, 
                    target.dtag=src.dtag, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.fact=src.fact, 
                    target.fcco=src.fcco, 
                    target.fcco_ref_compnr=src.fcco_ref_compnr, 
                    target.fisc=src.fisc, 
                    target.fisc_kw=src.fisc_kw, 
                    target.fmln=src.fmln, 
                    target.fmor=src.fmor, 
                    target.fprj=src.fprj, 
                    target.fprj_ref_compnr=src.fprj_ref_compnr, 
                    target.fspa=src.fspa, 
                    target.fstl=src.fstl, 
                    target.gefo=src.gefo, 
                    target.gefo_kw=src.gefo_kw, 
                    target.gnld=src.gnld, 
                    target.hstq=src.hstq, 
                    target.hstq_kw=src.hstq_kw, 
                    target.huid=src.huid, 
                    target.huwt=src.huwt, 
                    target.huwt_kw=src.huwt_kw, 
                    target.ifbp=src.ifbp, 
                    target.ifbp_ref_compnr=src.ifbp_ref_compnr, 
                    target.imcs=src.imcs, 
                    target.inup=src.inup, 
                    target.inup_kw=src.inup_kw, 
                    target.iown=src.iown, 
                    target.iown_kw=src.iown_kw, 
                    target.ipay=src.ipay, 
                    target.ipay_kw=src.ipay_kw, 
                    target.iscn=src.iscn, 
                    target.iscn_kw=src.iscn_kw, 
                    target.istr=src.istr, 
                    target.istr_kw=src.istr_kw, 
                    target.item=src.item, 
                    target.item_atse_ref_compnr=src.item_atse_ref_compnr, 
                    target.item_clot_ref_compnr=src.item_clot_ref_compnr, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.iubw=src.iubw, 
                    target.iubw_kw=src.iubw_kw, 
                    target.lsel=src.lsel, 
                    target.lsel_kw=src.lsel_kw, 
                    target.lsta=src.lsta, 
                    target.lsta_kw=src.lsta_kw, 
                    target.masp=src.masp, 
                    target.masp_kw=src.masp_kw, 
                    target.oarq=src.oarq, 
                    target.oarq_kw=src.oarq_kw, 
                    target.ocur=src.ocur, 
                    target.ocur_ref_compnr=src.ocur_ref_compnr, 
                    target.oorg=src.oorg, 
                    target.oorg_kw=src.oorg_kw, 
                    target.oorg_orno_oset_ref_compnr=src.oorg_orno_oset_ref_compnr, 
                    target.orno=src.orno, 
                    target.orpr=src.orpr, 
                    target.orun=src.orun, 
                    target.orun_ref_compnr=src.orun_ref_compnr, 
                    target.oset=src.oset, 
                    target.ovfp=src.ovfp, 
                    target.ovfp_kw=src.ovfp_kw, 
                    target.ovlp=src.ovlp, 
                    target.ovlp_kw=src.ovlp_kw, 
                    target.owns=src.owns, 
                    target.owns_kw=src.owns_kw, 
                    target.paym=src.paym, 
                    target.paym_kw=src.paym_kw, 
                    target.pddt=src.pddt, 
                    target.pkdb=src.pkdb, 
                    target.pkdb_kw=src.pkdb_kw, 
                    target.pkdf=src.pkdf, 
                    target.pkdf_ref_compnr=src.pkdf_ref_compnr, 
                    target.pono=src.pono, 
                    target.prdt=src.prdt, 
                    target.prio=src.prio, 
                    target.prjp=src.prjp, 
                    target.prjp_kw=src.prjp_kw, 
                    target.qacp=src.qacp, 
                    target.qact=src.qact, 
                    target.qadp=src.qadp, 
                    target.qadv=src.qadv, 
                    target.qapp=src.qapp, 
                    target.qapr=src.qapr, 
                    target.qcad=src.qcad, 
                    target.qcap=src.qcap, 
                    target.qcnl=src.qcnl, 
                    target.qcnp=src.qcnp, 
                    target.qnpu=src.qnpu, 
                    target.qnse=src.qnse, 
                    target.qnsh=src.qnsh, 
                    target.qnsp=src.qnsp, 
                    target.qoop=src.qoop, 
                    target.qoor=src.qoor, 
                    target.qopu=src.qopu, 
                    target.qord=src.qord, 
                    target.qoro=src.qoro, 
                    target.qorp=src.qorp, 
                    target.qova=src.qova, 
                    target.qovd=src.qovd, 
                    target.qovp=src.qovp, 
                    target.qpic=src.qpic, 
                    target.qpip=src.qpip, 
                    target.qprv=src.qprv, 
                    target.qpss=src.qpss, 
                    target.qpsv=src.qpsv, 
                    target.qrej=src.qrej, 
                    target.qrel=src.qrel, 
                    target.qrep=src.qrep, 
                    target.qreq=src.qreq, 
                    target.qrpu=src.qrpu, 
                    target.qrsc=src.qrsc, 
                    target.qrsp=src.qrsp, 
                    target.qscl=src.qscl, 
                    target.qscp=src.qscp, 
                    target.qshp=src.qshp, 
                    target.qspu=src.qspu, 
                    target.refe=src.refe, 
                    target.refs=src.refs, 
                    target.revi=src.revi, 
                    target.rorg=src.rorg, 
                    target.rorg_kw=src.rorg_kw, 
                    target.rorn=src.rorn, 
                    target.rowc=src.rowc, 
                    target.rowc_ref_compnr=src.rowc_ref_compnr, 
                    target.rown=src.rown, 
                    target.rown_ref_compnr=src.rown_ref_compnr, 
                    target.rpon=src.rpon, 
                    target.rqpu=src.rqpu, 
                    target.rseq=src.rseq, 
                    target.rush=src.rush, 
                    target.rush_kw=src.rush_kw, 
                    target.scon=src.scon, 
                    target.scon_kw=src.scon_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serl=src.serl, 
                    target.shrt=src.shrt, 
                    target.shrt_kw=src.shrt_kw, 
                    target.spcn=src.spcn, 
                    target.ssts=src.ssts, 
                    target.ssts_kw=src.ssts_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.sups=src.sups, 
                    target.sups_kw=src.sups_kw, 
                    target.tact=src.tact, 
                    target.tcco=src.tcco, 
                    target.tcco_ref_compnr=src.tcco_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tprj=src.tprj, 
                    target.tprj_ref_compnr=src.tprj_ref_compnr, 
                    target.tspa=src.tspa, 
                    target.tstl=src.tstl, 
                    target.txtn=src.txtn, 
                    target.txtn_ref_compnr=src.txtn_ref_compnr, 
                    target.ubin=src.ubin, 
                    target.ubin_kw=src.ubin_kw, 
                    target.username=src.username, 
                    target.uwop=src.uwop, 
                    target.uwop_kw=src.uwop_kw, 
                    target.wmss=src.wmss, 
                    target.wmss_kw=src.wmss_kw, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    acpn, 
                    acpn_kw, 
                    acvt, 
                    acvt_kw, 
                    addt, 
                    adin, 
                    atse, 
                    atse_ref_compnr, 
                    bcko, 
                    bcko_kw, 
                    bflh, 
                    bflh_kw, 
                    bgxc, 
                    bgxc_kw, 
                    blck, 
                    blck_kw, 
                    casi, 
                    casi_ref_compnr, 
                    cdck, 
                    cdck_kw, 
                    circ, 
                    clot, 
                    cncl, 
                    cncl_kw, 
                    comp, 
                    compnr, 
                    corn, 
                    csvc, 
                    csvc_ref_compnr, 
                    csvl, 
                    cwar, 
                    cwar_ref_compnr, 
                    deleted, 
                    dlpt, 
                    dtag, 
                    effn, 
                    effn_ref_compnr, 
                    fact, 
                    fcco, 
                    fcco_ref_compnr, 
                    fisc, 
                    fisc_kw, 
                    fmln, 
                    fmor, 
                    fprj, 
                    fprj_ref_compnr, 
                    fspa, 
                    fstl, 
                    gefo, 
                    gefo_kw, 
                    gnld, 
                    hstq, 
                    hstq_kw, 
                    huid, 
                    huwt, 
                    huwt_kw, 
                    ifbp, 
                    ifbp_ref_compnr, 
                    imcs, 
                    inup, 
                    inup_kw, 
                    iown, 
                    iown_kw, 
                    ipay, 
                    ipay_kw, 
                    iscn, 
                    iscn_kw, 
                    istr, 
                    istr_kw, 
                    item, 
                    item_atse_ref_compnr, 
                    item_clot_ref_compnr, 
                    item_ref_compnr, 
                    iubw, 
                    iubw_kw, 
                    lsel, 
                    lsel_kw, 
                    lsta, 
                    lsta_kw, 
                    masp, 
                    masp_kw, 
                    oarq, 
                    oarq_kw, 
                    ocur, 
                    ocur_ref_compnr, 
                    oorg, 
                    oorg_kw, 
                    oorg_orno_oset_ref_compnr, 
                    orno, 
                    orpr, 
                    orun, 
                    orun_ref_compnr, 
                    oset, 
                    ovfp, 
                    ovfp_kw, 
                    ovlp, 
                    ovlp_kw, 
                    owns, 
                    owns_kw, 
                    paym, 
                    paym_kw, 
                    pddt, 
                    pkdb, 
                    pkdb_kw, 
                    pkdf, 
                    pkdf_ref_compnr, 
                    pono, 
                    prdt, 
                    prio, 
                    prjp, 
                    prjp_kw, 
                    qacp, 
                    qact, 
                    qadp, 
                    qadv, 
                    qapp, 
                    qapr, 
                    qcad, 
                    qcap, 
                    qcnl, 
                    qcnp, 
                    qnpu, 
                    qnse, 
                    qnsh, 
                    qnsp, 
                    qoop, 
                    qoor, 
                    qopu, 
                    qord, 
                    qoro, 
                    qorp, 
                    qova, 
                    qovd, 
                    qovp, 
                    qpic, 
                    qpip, 
                    qprv, 
                    qpss, 
                    qpsv, 
                    qrej, 
                    qrel, 
                    qrep, 
                    qreq, 
                    qrpu, 
                    qrsc, 
                    qrsp, 
                    qscl, 
                    qscp, 
                    qshp, 
                    qspu, 
                    refe, 
                    refs, 
                    revi, 
                    rorg, 
                    rorg_kw, 
                    rorn, 
                    rowc, 
                    rowc_ref_compnr, 
                    rown, 
                    rown_ref_compnr, 
                    rpon, 
                    rqpu, 
                    rseq, 
                    rush, 
                    rush_kw, 
                    scon, 
                    scon_kw, 
                    seqn, 
                    sequencenumber, 
                    serl, 
                    shrt, 
                    shrt_kw, 
                    spcn, 
                    ssts, 
                    ssts_kw, 
                    stad, 
                    stad_dlpt_ref_compnr, 
                    sups, 
                    sups_kw, 
                    tact, 
                    tcco, 
                    tcco_ref_compnr, 
                    timestamp, 
                    tprj, 
                    tprj_ref_compnr, 
                    tspa, 
                    tstl, 
                    txtn, 
                    txtn_ref_compnr, 
                    ubin, 
                    ubin_kw, 
                    username, 
                    uwop, 
                    uwop_kw, 
                    wmss, 
                    wmss_kw, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.acpn, 
                    src.acpn_kw, 
                    src.acvt, 
                    src.acvt_kw, 
                    src.addt, 
                    src.adin, 
                    src.atse, 
                    src.atse_ref_compnr, 
                    src.bcko, 
                    src.bcko_kw, 
                    src.bflh, 
                    src.bflh_kw, 
                    src.bgxc, 
                    src.bgxc_kw, 
                    src.blck, 
                    src.blck_kw, 
                    src.casi, 
                    src.casi_ref_compnr, 
                    src.cdck, 
                    src.cdck_kw, 
                    src.circ, 
                    src.clot, 
                    src.cncl, 
                    src.cncl_kw, 
                    src.comp, 
                    src.compnr, 
                    src.corn, 
                    src.csvc, 
                    src.csvc_ref_compnr, 
                    src.csvl, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dlpt, 
                    src.dtag, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.fact, 
                    src.fcco, 
                    src.fcco_ref_compnr, 
                    src.fisc, 
                    src.fisc_kw, 
                    src.fmln, 
                    src.fmor, 
                    src.fprj, 
                    src.fprj_ref_compnr, 
                    src.fspa, 
                    src.fstl, 
                    src.gefo, 
                    src.gefo_kw, 
                    src.gnld, 
                    src.hstq, 
                    src.hstq_kw, 
                    src.huid, 
                    src.huwt, 
                    src.huwt_kw, 
                    src.ifbp, 
                    src.ifbp_ref_compnr, 
                    src.imcs, 
                    src.inup, 
                    src.inup_kw, 
                    src.iown, 
                    src.iown_kw, 
                    src.ipay, 
                    src.ipay_kw, 
                    src.iscn, 
                    src.iscn_kw, 
                    src.istr, 
                    src.istr_kw, 
                    src.item, 
                    src.item_atse_ref_compnr, 
                    src.item_clot_ref_compnr, 
                    src.item_ref_compnr, 
                    src.iubw, 
                    src.iubw_kw, 
                    src.lsel, 
                    src.lsel_kw, 
                    src.lsta, 
                    src.lsta_kw, 
                    src.masp, 
                    src.masp_kw, 
                    src.oarq, 
                    src.oarq_kw, 
                    src.ocur, 
                    src.ocur_ref_compnr, 
                    src.oorg, 
                    src.oorg_kw, 
                    src.oorg_orno_oset_ref_compnr, 
                    src.orno, 
                    src.orpr, 
                    src.orun, 
                    src.orun_ref_compnr, 
                    src.oset, 
                    src.ovfp, 
                    src.ovfp_kw, 
                    src.ovlp, 
                    src.ovlp_kw, 
                    src.owns, 
                    src.owns_kw, 
                    src.paym, 
                    src.paym_kw, 
                    src.pddt, 
                    src.pkdb, 
                    src.pkdb_kw, 
                    src.pkdf, 
                    src.pkdf_ref_compnr, 
                    src.pono, 
                    src.prdt, 
                    src.prio, 
                    src.prjp, 
                    src.prjp_kw, 
                    src.qacp, 
                    src.qact, 
                    src.qadp, 
                    src.qadv, 
                    src.qapp, 
                    src.qapr, 
                    src.qcad, 
                    src.qcap, 
                    src.qcnl, 
                    src.qcnp, 
                    src.qnpu, 
                    src.qnse, 
                    src.qnsh, 
                    src.qnsp, 
                    src.qoop, 
                    src.qoor, 
                    src.qopu, 
                    src.qord, 
                    src.qoro, 
                    src.qorp, 
                    src.qova, 
                    src.qovd, 
                    src.qovp, 
                    src.qpic, 
                    src.qpip, 
                    src.qprv, 
                    src.qpss, 
                    src.qpsv, 
                    src.qrej, 
                    src.qrel, 
                    src.qrep, 
                    src.qreq, 
                    src.qrpu, 
                    src.qrsc, 
                    src.qrsp, 
                    src.qscl, 
                    src.qscp, 
                    src.qshp, 
                    src.qspu, 
                    src.refe, 
                    src.refs, 
                    src.revi, 
                    src.rorg, 
                    src.rorg_kw, 
                    src.rorn, 
                    src.rowc, 
                    src.rowc_ref_compnr, 
                    src.rown, 
                    src.rown_ref_compnr, 
                    src.rpon, 
                    src.rqpu, 
                    src.rseq, 
                    src.rush, 
                    src.rush_kw, 
                    src.scon, 
                    src.scon_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.serl, 
                    src.shrt, 
                    src.shrt_kw, 
                    src.spcn, 
                    src.ssts, 
                    src.ssts_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.sups, 
                    src.sups_kw, 
                    src.tact, 
                    src.tcco, 
                    src.tcco_ref_compnr, 
                    src.timestamp, 
                    src.tprj, 
                    src.tprj_ref_compnr, 
                    src.tspa, 
                    src.tstl, 
                    src.txtn, 
                    src.txtn_ref_compnr, 
                    src.ubin, 
                    src.ubin_kw, 
                    src.username, 
                    src.uwop, 
                    src.uwop_kw, 
                    src.wmss, 
                    src.wmss_kw,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_LN.LN_WHINH220_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.acpn, 
            strm.acpn_kw, 
            strm.acvt, 
            strm.acvt_kw, 
            strm.addt, 
            strm.adin, 
            strm.atse, 
            strm.atse_ref_compnr, 
            strm.bcko, 
            strm.bcko_kw, 
            strm.bflh, 
            strm.bflh_kw, 
            strm.bgxc, 
            strm.bgxc_kw, 
            strm.blck, 
            strm.blck_kw, 
            strm.casi, 
            strm.casi_ref_compnr, 
            strm.cdck, 
            strm.cdck_kw, 
            strm.circ, 
            strm.clot, 
            strm.cncl, 
            strm.cncl_kw, 
            strm.comp, 
            strm.compnr, 
            strm.corn, 
            strm.csvc, 
            strm.csvc_ref_compnr, 
            strm.csvl, 
            strm.cwar, 
            strm.cwar_ref_compnr, 
            strm.deleted, 
            strm.dlpt, 
            strm.dtag, 
            strm.effn, 
            strm.effn_ref_compnr, 
            strm.fact, 
            strm.fcco, 
            strm.fcco_ref_compnr, 
            strm.fisc, 
            strm.fisc_kw, 
            strm.fmln, 
            strm.fmor, 
            strm.fprj, 
            strm.fprj_ref_compnr, 
            strm.fspa, 
            strm.fstl, 
            strm.gefo, 
            strm.gefo_kw, 
            strm.gnld, 
            strm.hstq, 
            strm.hstq_kw, 
            strm.huid, 
            strm.huwt, 
            strm.huwt_kw, 
            strm.ifbp, 
            strm.ifbp_ref_compnr, 
            strm.imcs, 
            strm.inup, 
            strm.inup_kw, 
            strm.iown, 
            strm.iown_kw, 
            strm.ipay, 
            strm.ipay_kw, 
            strm.iscn, 
            strm.iscn_kw, 
            strm.istr, 
            strm.istr_kw, 
            strm.item, 
            strm.item_atse_ref_compnr, 
            strm.item_clot_ref_compnr, 
            strm.item_ref_compnr, 
            strm.iubw, 
            strm.iubw_kw, 
            strm.lsel, 
            strm.lsel_kw, 
            strm.lsta, 
            strm.lsta_kw, 
            strm.masp, 
            strm.masp_kw, 
            strm.oarq, 
            strm.oarq_kw, 
            strm.ocur, 
            strm.ocur_ref_compnr, 
            strm.oorg, 
            strm.oorg_kw, 
            strm.oorg_orno_oset_ref_compnr, 
            strm.orno, 
            strm.orpr, 
            strm.orun, 
            strm.orun_ref_compnr, 
            strm.oset, 
            strm.ovfp, 
            strm.ovfp_kw, 
            strm.ovlp, 
            strm.ovlp_kw, 
            strm.owns, 
            strm.owns_kw, 
            strm.paym, 
            strm.paym_kw, 
            strm.pddt, 
            strm.pkdb, 
            strm.pkdb_kw, 
            strm.pkdf, 
            strm.pkdf_ref_compnr, 
            strm.pono, 
            strm.prdt, 
            strm.prio, 
            strm.prjp, 
            strm.prjp_kw, 
            strm.qacp, 
            strm.qact, 
            strm.qadp, 
            strm.qadv, 
            strm.qapp, 
            strm.qapr, 
            strm.qcad, 
            strm.qcap, 
            strm.qcnl, 
            strm.qcnp, 
            strm.qnpu, 
            strm.qnse, 
            strm.qnsh, 
            strm.qnsp, 
            strm.qoop, 
            strm.qoor, 
            strm.qopu, 
            strm.qord, 
            strm.qoro, 
            strm.qorp, 
            strm.qova, 
            strm.qovd, 
            strm.qovp, 
            strm.qpic, 
            strm.qpip, 
            strm.qprv, 
            strm.qpss, 
            strm.qpsv, 
            strm.qrej, 
            strm.qrel, 
            strm.qrep, 
            strm.qreq, 
            strm.qrpu, 
            strm.qrsc, 
            strm.qrsp, 
            strm.qscl, 
            strm.qscp, 
            strm.qshp, 
            strm.qspu, 
            strm.refe, 
            strm.refs, 
            strm.revi, 
            strm.rorg, 
            strm.rorg_kw, 
            strm.rorn, 
            strm.rowc, 
            strm.rowc_ref_compnr, 
            strm.rown, 
            strm.rown_ref_compnr, 
            strm.rpon, 
            strm.rqpu, 
            strm.rseq, 
            strm.rush, 
            strm.rush_kw, 
            strm.scon, 
            strm.scon_kw, 
            strm.seqn, 
            strm.sequencenumber, 
            strm.serl, 
            strm.shrt, 
            strm.shrt_kw, 
            strm.spcn, 
            strm.ssts, 
            strm.ssts_kw, 
            strm.stad, 
            strm.stad_dlpt_ref_compnr, 
            strm.sups, 
            strm.sups_kw, 
            strm.tact, 
            strm.tcco, 
            strm.tcco_ref_compnr, 
            strm.timestamp, 
            strm.tprj, 
            strm.tprj_ref_compnr, 
            strm.tspa, 
            strm.tstl, 
            strm.txtn, 
            strm.txtn_ref_compnr, 
            strm.ubin, 
            strm.ubin_kw, 
            strm.username, 
            strm.uwop, 
            strm.uwop_kw, 
            strm.wmss, 
            strm.wmss_kw, 
            strm.ETL_SEQUENCE_NUMBER,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.compnr,
            strm.oorg,
            strm.orno,
            strm.pono,
            strm.seqn ORDER BY strm.ETL_SEQUENCE_NUMBER desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_LN_WHINH220 as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.compnr=src.compnr) OR (target.compnr IS NULL AND src.compnr IS NULL)) AND
            ((target.oorg=src.oorg) OR (target.oorg IS NULL AND src.oorg IS NULL)) AND
            ((target.orno=src.orno) OR (target.orno IS NULL AND src.orno IS NULL)) AND
            ((target.pono=src.pono) OR (target.pono IS NULL AND src.pono IS NULL)) AND
            ((target.seqn=src.seqn) OR (target.seqn IS NULL AND src.seqn IS NULL)) 
                when matched then update set
                    target.acpn=src.acpn, 
                    target.acpn_kw=src.acpn_kw, 
                    target.acvt=src.acvt, 
                    target.acvt_kw=src.acvt_kw, 
                    target.addt=src.addt, 
                    target.adin=src.adin, 
                    target.atse=src.atse, 
                    target.atse_ref_compnr=src.atse_ref_compnr, 
                    target.bcko=src.bcko, 
                    target.bcko_kw=src.bcko_kw, 
                    target.bflh=src.bflh, 
                    target.bflh_kw=src.bflh_kw, 
                    target.bgxc=src.bgxc, 
                    target.bgxc_kw=src.bgxc_kw, 
                    target.blck=src.blck, 
                    target.blck_kw=src.blck_kw, 
                    target.casi=src.casi, 
                    target.casi_ref_compnr=src.casi_ref_compnr, 
                    target.cdck=src.cdck, 
                    target.cdck_kw=src.cdck_kw, 
                    target.circ=src.circ, 
                    target.clot=src.clot, 
                    target.cncl=src.cncl, 
                    target.cncl_kw=src.cncl_kw, 
                    target.comp=src.comp, 
                    target.compnr=src.compnr, 
                    target.corn=src.corn, 
                    target.csvc=src.csvc, 
                    target.csvc_ref_compnr=src.csvc_ref_compnr, 
                    target.csvl=src.csvl, 
                    target.cwar=src.cwar, 
                    target.cwar_ref_compnr=src.cwar_ref_compnr, 
                    target.deleted=src.deleted, 
                    target.dlpt=src.dlpt, 
                    target.dtag=src.dtag, 
                    target.effn=src.effn, 
                    target.effn_ref_compnr=src.effn_ref_compnr, 
                    target.fact=src.fact, 
                    target.fcco=src.fcco, 
                    target.fcco_ref_compnr=src.fcco_ref_compnr, 
                    target.fisc=src.fisc, 
                    target.fisc_kw=src.fisc_kw, 
                    target.fmln=src.fmln, 
                    target.fmor=src.fmor, 
                    target.fprj=src.fprj, 
                    target.fprj_ref_compnr=src.fprj_ref_compnr, 
                    target.fspa=src.fspa, 
                    target.fstl=src.fstl, 
                    target.gefo=src.gefo, 
                    target.gefo_kw=src.gefo_kw, 
                    target.gnld=src.gnld, 
                    target.hstq=src.hstq, 
                    target.hstq_kw=src.hstq_kw, 
                    target.huid=src.huid, 
                    target.huwt=src.huwt, 
                    target.huwt_kw=src.huwt_kw, 
                    target.ifbp=src.ifbp, 
                    target.ifbp_ref_compnr=src.ifbp_ref_compnr, 
                    target.imcs=src.imcs, 
                    target.inup=src.inup, 
                    target.inup_kw=src.inup_kw, 
                    target.iown=src.iown, 
                    target.iown_kw=src.iown_kw, 
                    target.ipay=src.ipay, 
                    target.ipay_kw=src.ipay_kw, 
                    target.iscn=src.iscn, 
                    target.iscn_kw=src.iscn_kw, 
                    target.istr=src.istr, 
                    target.istr_kw=src.istr_kw, 
                    target.item=src.item, 
                    target.item_atse_ref_compnr=src.item_atse_ref_compnr, 
                    target.item_clot_ref_compnr=src.item_clot_ref_compnr, 
                    target.item_ref_compnr=src.item_ref_compnr, 
                    target.iubw=src.iubw, 
                    target.iubw_kw=src.iubw_kw, 
                    target.lsel=src.lsel, 
                    target.lsel_kw=src.lsel_kw, 
                    target.lsta=src.lsta, 
                    target.lsta_kw=src.lsta_kw, 
                    target.masp=src.masp, 
                    target.masp_kw=src.masp_kw, 
                    target.oarq=src.oarq, 
                    target.oarq_kw=src.oarq_kw, 
                    target.ocur=src.ocur, 
                    target.ocur_ref_compnr=src.ocur_ref_compnr, 
                    target.oorg=src.oorg, 
                    target.oorg_kw=src.oorg_kw, 
                    target.oorg_orno_oset_ref_compnr=src.oorg_orno_oset_ref_compnr, 
                    target.orno=src.orno, 
                    target.orpr=src.orpr, 
                    target.orun=src.orun, 
                    target.orun_ref_compnr=src.orun_ref_compnr, 
                    target.oset=src.oset, 
                    target.ovfp=src.ovfp, 
                    target.ovfp_kw=src.ovfp_kw, 
                    target.ovlp=src.ovlp, 
                    target.ovlp_kw=src.ovlp_kw, 
                    target.owns=src.owns, 
                    target.owns_kw=src.owns_kw, 
                    target.paym=src.paym, 
                    target.paym_kw=src.paym_kw, 
                    target.pddt=src.pddt, 
                    target.pkdb=src.pkdb, 
                    target.pkdb_kw=src.pkdb_kw, 
                    target.pkdf=src.pkdf, 
                    target.pkdf_ref_compnr=src.pkdf_ref_compnr, 
                    target.pono=src.pono, 
                    target.prdt=src.prdt, 
                    target.prio=src.prio, 
                    target.prjp=src.prjp, 
                    target.prjp_kw=src.prjp_kw, 
                    target.qacp=src.qacp, 
                    target.qact=src.qact, 
                    target.qadp=src.qadp, 
                    target.qadv=src.qadv, 
                    target.qapp=src.qapp, 
                    target.qapr=src.qapr, 
                    target.qcad=src.qcad, 
                    target.qcap=src.qcap, 
                    target.qcnl=src.qcnl, 
                    target.qcnp=src.qcnp, 
                    target.qnpu=src.qnpu, 
                    target.qnse=src.qnse, 
                    target.qnsh=src.qnsh, 
                    target.qnsp=src.qnsp, 
                    target.qoop=src.qoop, 
                    target.qoor=src.qoor, 
                    target.qopu=src.qopu, 
                    target.qord=src.qord, 
                    target.qoro=src.qoro, 
                    target.qorp=src.qorp, 
                    target.qova=src.qova, 
                    target.qovd=src.qovd, 
                    target.qovp=src.qovp, 
                    target.qpic=src.qpic, 
                    target.qpip=src.qpip, 
                    target.qprv=src.qprv, 
                    target.qpss=src.qpss, 
                    target.qpsv=src.qpsv, 
                    target.qrej=src.qrej, 
                    target.qrel=src.qrel, 
                    target.qrep=src.qrep, 
                    target.qreq=src.qreq, 
                    target.qrpu=src.qrpu, 
                    target.qrsc=src.qrsc, 
                    target.qrsp=src.qrsp, 
                    target.qscl=src.qscl, 
                    target.qscp=src.qscp, 
                    target.qshp=src.qshp, 
                    target.qspu=src.qspu, 
                    target.refe=src.refe, 
                    target.refs=src.refs, 
                    target.revi=src.revi, 
                    target.rorg=src.rorg, 
                    target.rorg_kw=src.rorg_kw, 
                    target.rorn=src.rorn, 
                    target.rowc=src.rowc, 
                    target.rowc_ref_compnr=src.rowc_ref_compnr, 
                    target.rown=src.rown, 
                    target.rown_ref_compnr=src.rown_ref_compnr, 
                    target.rpon=src.rpon, 
                    target.rqpu=src.rqpu, 
                    target.rseq=src.rseq, 
                    target.rush=src.rush, 
                    target.rush_kw=src.rush_kw, 
                    target.scon=src.scon, 
                    target.scon_kw=src.scon_kw, 
                    target.seqn=src.seqn, 
                    target.sequencenumber=src.sequencenumber, 
                    target.serl=src.serl, 
                    target.shrt=src.shrt, 
                    target.shrt_kw=src.shrt_kw, 
                    target.spcn=src.spcn, 
                    target.ssts=src.ssts, 
                    target.ssts_kw=src.ssts_kw, 
                    target.stad=src.stad, 
                    target.stad_dlpt_ref_compnr=src.stad_dlpt_ref_compnr, 
                    target.sups=src.sups, 
                    target.sups_kw=src.sups_kw, 
                    target.tact=src.tact, 
                    target.tcco=src.tcco, 
                    target.tcco_ref_compnr=src.tcco_ref_compnr, 
                    target.timestamp=src.timestamp, 
                    target.tprj=src.tprj, 
                    target.tprj_ref_compnr=src.tprj_ref_compnr, 
                    target.tspa=src.tspa, 
                    target.tstl=src.tstl, 
                    target.txtn=src.txtn, 
                    target.txtn_ref_compnr=src.txtn_ref_compnr, 
                    target.ubin=src.ubin, 
                    target.ubin_kw=src.ubin_kw, 
                    target.username=src.username, 
                    target.uwop=src.uwop, 
                    target.uwop_kw=src.uwop_kw, 
                    target.wmss=src.wmss, 
                    target.wmss_kw=src.wmss_kw, 
                    target.ETL_SEQUENCE_NUMBER=src.ETL_SEQUENCE_NUMBER,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( acpn, acpn_kw, acvt, acvt_kw, addt, adin, atse, atse_ref_compnr, bcko, bcko_kw, bflh, bflh_kw, bgxc, bgxc_kw, blck, blck_kw, casi, casi_ref_compnr, cdck, cdck_kw, circ, clot, cncl, cncl_kw, comp, compnr, corn, csvc, csvc_ref_compnr, csvl, cwar, cwar_ref_compnr, deleted, dlpt, dtag, effn, effn_ref_compnr, fact, fcco, fcco_ref_compnr, fisc, fisc_kw, fmln, fmor, fprj, fprj_ref_compnr, fspa, fstl, gefo, gefo_kw, gnld, hstq, hstq_kw, huid, huwt, huwt_kw, ifbp, ifbp_ref_compnr, imcs, inup, inup_kw, iown, iown_kw, ipay, ipay_kw, iscn, iscn_kw, istr, istr_kw, item, item_atse_ref_compnr, item_clot_ref_compnr, item_ref_compnr, iubw, iubw_kw, lsel, lsel_kw, lsta, lsta_kw, masp, masp_kw, oarq, oarq_kw, ocur, ocur_ref_compnr, oorg, oorg_kw, oorg_orno_oset_ref_compnr, orno, orpr, orun, orun_ref_compnr, oset, ovfp, ovfp_kw, ovlp, ovlp_kw, owns, owns_kw, paym, paym_kw, pddt, pkdb, pkdb_kw, pkdf, pkdf_ref_compnr, pono, prdt, prio, prjp, prjp_kw, qacp, qact, qadp, qadv, qapp, qapr, qcad, qcap, qcnl, qcnp, qnpu, qnse, qnsh, qnsp, qoop, qoor, qopu, qord, qoro, qorp, qova, qovd, qovp, qpic, qpip, qprv, qpss, qpsv, qrej, qrel, qrep, qreq, qrpu, qrsc, qrsp, qscl, qscp, qshp, qspu, refe, refs, revi, rorg, rorg_kw, rorn, rowc, rowc_ref_compnr, rown, rown_ref_compnr, rpon, rqpu, rseq, rush, rush_kw, scon, scon_kw, seqn, sequencenumber, serl, shrt, shrt_kw, spcn, ssts, ssts_kw, stad, stad_dlpt_ref_compnr, sups, sups_kw, tact, tcco, tcco_ref_compnr, timestamp, tprj, tprj_ref_compnr, tspa, tstl, txtn, txtn_ref_compnr, ubin, ubin_kw, username, uwop, uwop_kw, wmss, wmss_kw, 
                    ETL_SEQUENCE_NUMBER,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.acpn, 
                    src.acpn_kw, 
                    src.acvt, 
                    src.acvt_kw, 
                    src.addt, 
                    src.adin, 
                    src.atse, 
                    src.atse_ref_compnr, 
                    src.bcko, 
                    src.bcko_kw, 
                    src.bflh, 
                    src.bflh_kw, 
                    src.bgxc, 
                    src.bgxc_kw, 
                    src.blck, 
                    src.blck_kw, 
                    src.casi, 
                    src.casi_ref_compnr, 
                    src.cdck, 
                    src.cdck_kw, 
                    src.circ, 
                    src.clot, 
                    src.cncl, 
                    src.cncl_kw, 
                    src.comp, 
                    src.compnr, 
                    src.corn, 
                    src.csvc, 
                    src.csvc_ref_compnr, 
                    src.csvl, 
                    src.cwar, 
                    src.cwar_ref_compnr, 
                    src.deleted, 
                    src.dlpt, 
                    src.dtag, 
                    src.effn, 
                    src.effn_ref_compnr, 
                    src.fact, 
                    src.fcco, 
                    src.fcco_ref_compnr, 
                    src.fisc, 
                    src.fisc_kw, 
                    src.fmln, 
                    src.fmor, 
                    src.fprj, 
                    src.fprj_ref_compnr, 
                    src.fspa, 
                    src.fstl, 
                    src.gefo, 
                    src.gefo_kw, 
                    src.gnld, 
                    src.hstq, 
                    src.hstq_kw, 
                    src.huid, 
                    src.huwt, 
                    src.huwt_kw, 
                    src.ifbp, 
                    src.ifbp_ref_compnr, 
                    src.imcs, 
                    src.inup, 
                    src.inup_kw, 
                    src.iown, 
                    src.iown_kw, 
                    src.ipay, 
                    src.ipay_kw, 
                    src.iscn, 
                    src.iscn_kw, 
                    src.istr, 
                    src.istr_kw, 
                    src.item, 
                    src.item_atse_ref_compnr, 
                    src.item_clot_ref_compnr, 
                    src.item_ref_compnr, 
                    src.iubw, 
                    src.iubw_kw, 
                    src.lsel, 
                    src.lsel_kw, 
                    src.lsta, 
                    src.lsta_kw, 
                    src.masp, 
                    src.masp_kw, 
                    src.oarq, 
                    src.oarq_kw, 
                    src.ocur, 
                    src.ocur_ref_compnr, 
                    src.oorg, 
                    src.oorg_kw, 
                    src.oorg_orno_oset_ref_compnr, 
                    src.orno, 
                    src.orpr, 
                    src.orun, 
                    src.orun_ref_compnr, 
                    src.oset, 
                    src.ovfp, 
                    src.ovfp_kw, 
                    src.ovlp, 
                    src.ovlp_kw, 
                    src.owns, 
                    src.owns_kw, 
                    src.paym, 
                    src.paym_kw, 
                    src.pddt, 
                    src.pkdb, 
                    src.pkdb_kw, 
                    src.pkdf, 
                    src.pkdf_ref_compnr, 
                    src.pono, 
                    src.prdt, 
                    src.prio, 
                    src.prjp, 
                    src.prjp_kw, 
                    src.qacp, 
                    src.qact, 
                    src.qadp, 
                    src.qadv, 
                    src.qapp, 
                    src.qapr, 
                    src.qcad, 
                    src.qcap, 
                    src.qcnl, 
                    src.qcnp, 
                    src.qnpu, 
                    src.qnse, 
                    src.qnsh, 
                    src.qnsp, 
                    src.qoop, 
                    src.qoor, 
                    src.qopu, 
                    src.qord, 
                    src.qoro, 
                    src.qorp, 
                    src.qova, 
                    src.qovd, 
                    src.qovp, 
                    src.qpic, 
                    src.qpip, 
                    src.qprv, 
                    src.qpss, 
                    src.qpsv, 
                    src.qrej, 
                    src.qrel, 
                    src.qrep, 
                    src.qreq, 
                    src.qrpu, 
                    src.qrsc, 
                    src.qrsp, 
                    src.qscl, 
                    src.qscp, 
                    src.qshp, 
                    src.qspu, 
                    src.refe, 
                    src.refs, 
                    src.revi, 
                    src.rorg, 
                    src.rorg_kw, 
                    src.rorn, 
                    src.rowc, 
                    src.rowc_ref_compnr, 
                    src.rown, 
                    src.rown_ref_compnr, 
                    src.rpon, 
                    src.rqpu, 
                    src.rseq, 
                    src.rush, 
                    src.rush_kw, 
                    src.scon, 
                    src.scon_kw, 
                    src.seqn, 
                    src.sequencenumber, 
                    src.serl, 
                    src.shrt, 
                    src.shrt_kw, 
                    src.spcn, 
                    src.ssts, 
                    src.ssts_kw, 
                    src.stad, 
                    src.stad_dlpt_ref_compnr, 
                    src.sups, 
                    src.sups_kw, 
                    src.tact, 
                    src.tcco, 
                    src.tcco_ref_compnr, 
                    src.timestamp, 
                    src.tprj, 
                    src.tprj_ref_compnr, 
                    src.tspa, 
                    src.tstl, 
                    src.txtn, 
                    src.txtn_ref_compnr, 
                    src.ubin, 
                    src.ubin_kw, 
                    src.username, 
                    src.uwop, 
                    src.uwop_kw, 
                    src.wmss, 
                    src.wmss_kw,     
                    src.ETL_SEQUENCE_NUMBER,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;