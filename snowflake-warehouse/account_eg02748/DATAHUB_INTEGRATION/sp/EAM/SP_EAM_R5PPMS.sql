create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5PPMS()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5PPMS_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5PPMS as target using (SELECT * FROM (SELECT 
            strm.PPM_CLASS, 
            strm.PPM_CLASS_ORG, 
            strm.PPM_CODE, 
            strm.PPM_DESC, 
            strm.PPM_DURATION, 
            strm.PPM_ESTWORKLOAD, 
            strm.PPM_FREQ, 
            strm.PPM_GENWINDOW, 
            strm.PPM_ISSTYPE, 
            strm.PPM_JOBTYPE, 
            strm.PPM_LASTSAVED, 
            strm.PPM_METER, 
            strm.PPM_METER2, 
            strm.PPM_METUOM, 
            strm.PPM_METUOM2, 
            strm.PPM_NEARWINDOW, 
            strm.PPM_NESTED, 
            strm.PPM_NESTEDPMSTATUS, 
            strm.PPM_NESTEDTOLMAX, 
            strm.PPM_NESTEDTOLMET2MAX, 
            strm.PPM_NESTEDTOLMET2MIN, 
            strm.PPM_NESTEDTOLMETMAX, 
            strm.PPM_NESTEDTOLMETMIN, 
            strm.PPM_NESTEDTOLMIN, 
            strm.PPM_NOTUSED, 
            strm.PPM_OKWINDOW, 
            strm.PPM_ORG, 
            strm.PPM_PACKAGE, 
            strm.PPM_PERFORMONDAY, 
            strm.PPM_PERFORMONWEEK, 
            strm.PPM_PERIODUOM, 
            strm.PPM_PERMITREVIEWED, 
            strm.PPM_PERMITREVIEWEDBY, 
            strm.PPM_PERMITREVIEWEDNAME, 
            strm.PPM_PERMITREVIEWEDTYPE, 
            strm.PPM_PERMITREVIEWREQUIRED, 
            strm.PPM_PLAN, 
            strm.PPM_PRIORITY, 
            strm.PPM_PRODPRIORITY, 
            strm.PPM_REQUESTEDENDDATEBUFFER, 
            strm.PPM_REQUESTEDSTARTDATEBUFFER, 
            strm.PPM_REVISION, 
            strm.PPM_REVRSTATUS, 
            strm.PPM_REVSTATUS, 
            strm.PPM_SAFETYREVIEWED, 
            strm.PPM_SAFETYREVIEWEDBY, 
            strm.PPM_SAFETYREVIEWEDNAME, 
            strm.PPM_SAFETYREVIEWEDTYPE, 
            strm.PPM_SAFETYREVIEWREQUIRED, 
            strm.PPM_SCHEDGRP, 
            strm.PPM_SPECIAL, 
            strm.PPM_UDFCHAR01, 
            strm.PPM_UDFCHAR02, 
            strm.PPM_UDFCHAR03, 
            strm.PPM_UDFCHAR04, 
            strm.PPM_UDFCHAR05, 
            strm.PPM_UDFCHAR06, 
            strm.PPM_UDFCHAR07, 
            strm.PPM_UDFCHAR08, 
            strm.PPM_UDFCHAR09, 
            strm.PPM_UDFCHAR10, 
            strm.PPM_UDFCHAR11, 
            strm.PPM_UDFCHAR12, 
            strm.PPM_UDFCHAR13, 
            strm.PPM_UDFCHAR14, 
            strm.PPM_UDFCHAR15, 
            strm.PPM_UDFCHAR16, 
            strm.PPM_UDFCHAR17, 
            strm.PPM_UDFCHAR18, 
            strm.PPM_UDFCHAR19, 
            strm.PPM_UDFCHAR20, 
            strm.PPM_UDFCHAR21, 
            strm.PPM_UDFCHAR22, 
            strm.PPM_UDFCHAR23, 
            strm.PPM_UDFCHAR24, 
            strm.PPM_UDFCHAR25, 
            strm.PPM_UDFCHAR26, 
            strm.PPM_UDFCHAR27, 
            strm.PPM_UDFCHAR28, 
            strm.PPM_UDFCHAR29, 
            strm.PPM_UDFCHAR30, 
            strm.PPM_UDFCHAR31, 
            strm.PPM_UDFCHAR32, 
            strm.PPM_UDFCHAR33, 
            strm.PPM_UDFCHAR34, 
            strm.PPM_UDFCHAR35, 
            strm.PPM_UDFCHAR36, 
            strm.PPM_UDFCHAR37, 
            strm.PPM_UDFCHAR38, 
            strm.PPM_UDFCHAR39, 
            strm.PPM_UDFCHAR40, 
            strm.PPM_UDFCHAR41, 
            strm.PPM_UDFCHAR42, 
            strm.PPM_UDFCHAR43, 
            strm.PPM_UDFCHAR44, 
            strm.PPM_UDFCHAR45, 
            strm.PPM_UDFCHKBOX01, 
            strm.PPM_UDFCHKBOX02, 
            strm.PPM_UDFCHKBOX03, 
            strm.PPM_UDFCHKBOX04, 
            strm.PPM_UDFCHKBOX05, 
            strm.PPM_UDFCHKBOX06, 
            strm.PPM_UDFCHKBOX07, 
            strm.PPM_UDFCHKBOX08, 
            strm.PPM_UDFCHKBOX09, 
            strm.PPM_UDFCHKBOX10, 
            strm.PPM_UDFDATE01, 
            strm.PPM_UDFDATE02, 
            strm.PPM_UDFDATE03, 
            strm.PPM_UDFDATE04, 
            strm.PPM_UDFDATE05, 
            strm.PPM_UDFDATE06, 
            strm.PPM_UDFDATE07, 
            strm.PPM_UDFDATE08, 
            strm.PPM_UDFDATE09, 
            strm.PPM_UDFDATE10, 
            strm.PPM_UDFNOTE01, 
            strm.PPM_UDFNOTE02, 
            strm.PPM_UDFNUM01, 
            strm.PPM_UDFNUM02, 
            strm.PPM_UDFNUM03, 
            strm.PPM_UDFNUM04, 
            strm.PPM_UDFNUM05, 
            strm.PPM_UDFNUM06, 
            strm.PPM_UDFNUM07, 
            strm.PPM_UDFNUM08, 
            strm.PPM_UDFNUM09, 
            strm.PPM_UDFNUM10, 
            strm.PPM_UPDATECOUNT, 
            strm.PPM_WOCLASS, 
            strm.PPM_WOCLASS_ORG, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.PPM_CODE,
            strm.PPM_REVISION ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5PPMS as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.PPM_CODE=src.PPM_CODE) OR (target.PPM_CODE IS NULL AND src.PPM_CODE IS NULL)) AND
            ((target.PPM_REVISION=src.PPM_REVISION) OR (target.PPM_REVISION IS NULL AND src.PPM_REVISION IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.PPM_CLASS=src.PPM_CLASS, 
                    target.PPM_CLASS_ORG=src.PPM_CLASS_ORG, 
                    target.PPM_CODE=src.PPM_CODE, 
                    target.PPM_DESC=src.PPM_DESC, 
                    target.PPM_DURATION=src.PPM_DURATION, 
                    target.PPM_ESTWORKLOAD=src.PPM_ESTWORKLOAD, 
                    target.PPM_FREQ=src.PPM_FREQ, 
                    target.PPM_GENWINDOW=src.PPM_GENWINDOW, 
                    target.PPM_ISSTYPE=src.PPM_ISSTYPE, 
                    target.PPM_JOBTYPE=src.PPM_JOBTYPE, 
                    target.PPM_LASTSAVED=src.PPM_LASTSAVED, 
                    target.PPM_METER=src.PPM_METER, 
                    target.PPM_METER2=src.PPM_METER2, 
                    target.PPM_METUOM=src.PPM_METUOM, 
                    target.PPM_METUOM2=src.PPM_METUOM2, 
                    target.PPM_NEARWINDOW=src.PPM_NEARWINDOW, 
                    target.PPM_NESTED=src.PPM_NESTED, 
                    target.PPM_NESTEDPMSTATUS=src.PPM_NESTEDPMSTATUS, 
                    target.PPM_NESTEDTOLMAX=src.PPM_NESTEDTOLMAX, 
                    target.PPM_NESTEDTOLMET2MAX=src.PPM_NESTEDTOLMET2MAX, 
                    target.PPM_NESTEDTOLMET2MIN=src.PPM_NESTEDTOLMET2MIN, 
                    target.PPM_NESTEDTOLMETMAX=src.PPM_NESTEDTOLMETMAX, 
                    target.PPM_NESTEDTOLMETMIN=src.PPM_NESTEDTOLMETMIN, 
                    target.PPM_NESTEDTOLMIN=src.PPM_NESTEDTOLMIN, 
                    target.PPM_NOTUSED=src.PPM_NOTUSED, 
                    target.PPM_OKWINDOW=src.PPM_OKWINDOW, 
                    target.PPM_ORG=src.PPM_ORG, 
                    target.PPM_PACKAGE=src.PPM_PACKAGE, 
                    target.PPM_PERFORMONDAY=src.PPM_PERFORMONDAY, 
                    target.PPM_PERFORMONWEEK=src.PPM_PERFORMONWEEK, 
                    target.PPM_PERIODUOM=src.PPM_PERIODUOM, 
                    target.PPM_PERMITREVIEWED=src.PPM_PERMITREVIEWED, 
                    target.PPM_PERMITREVIEWEDBY=src.PPM_PERMITREVIEWEDBY, 
                    target.PPM_PERMITREVIEWEDNAME=src.PPM_PERMITREVIEWEDNAME, 
                    target.PPM_PERMITREVIEWEDTYPE=src.PPM_PERMITREVIEWEDTYPE, 
                    target.PPM_PERMITREVIEWREQUIRED=src.PPM_PERMITREVIEWREQUIRED, 
                    target.PPM_PLAN=src.PPM_PLAN, 
                    target.PPM_PRIORITY=src.PPM_PRIORITY, 
                    target.PPM_PRODPRIORITY=src.PPM_PRODPRIORITY, 
                    target.PPM_REQUESTEDENDDATEBUFFER=src.PPM_REQUESTEDENDDATEBUFFER, 
                    target.PPM_REQUESTEDSTARTDATEBUFFER=src.PPM_REQUESTEDSTARTDATEBUFFER, 
                    target.PPM_REVISION=src.PPM_REVISION, 
                    target.PPM_REVRSTATUS=src.PPM_REVRSTATUS, 
                    target.PPM_REVSTATUS=src.PPM_REVSTATUS, 
                    target.PPM_SAFETYREVIEWED=src.PPM_SAFETYREVIEWED, 
                    target.PPM_SAFETYREVIEWEDBY=src.PPM_SAFETYREVIEWEDBY, 
                    target.PPM_SAFETYREVIEWEDNAME=src.PPM_SAFETYREVIEWEDNAME, 
                    target.PPM_SAFETYREVIEWEDTYPE=src.PPM_SAFETYREVIEWEDTYPE, 
                    target.PPM_SAFETYREVIEWREQUIRED=src.PPM_SAFETYREVIEWREQUIRED, 
                    target.PPM_SCHEDGRP=src.PPM_SCHEDGRP, 
                    target.PPM_SPECIAL=src.PPM_SPECIAL, 
                    target.PPM_UDFCHAR01=src.PPM_UDFCHAR01, 
                    target.PPM_UDFCHAR02=src.PPM_UDFCHAR02, 
                    target.PPM_UDFCHAR03=src.PPM_UDFCHAR03, 
                    target.PPM_UDFCHAR04=src.PPM_UDFCHAR04, 
                    target.PPM_UDFCHAR05=src.PPM_UDFCHAR05, 
                    target.PPM_UDFCHAR06=src.PPM_UDFCHAR06, 
                    target.PPM_UDFCHAR07=src.PPM_UDFCHAR07, 
                    target.PPM_UDFCHAR08=src.PPM_UDFCHAR08, 
                    target.PPM_UDFCHAR09=src.PPM_UDFCHAR09, 
                    target.PPM_UDFCHAR10=src.PPM_UDFCHAR10, 
                    target.PPM_UDFCHAR11=src.PPM_UDFCHAR11, 
                    target.PPM_UDFCHAR12=src.PPM_UDFCHAR12, 
                    target.PPM_UDFCHAR13=src.PPM_UDFCHAR13, 
                    target.PPM_UDFCHAR14=src.PPM_UDFCHAR14, 
                    target.PPM_UDFCHAR15=src.PPM_UDFCHAR15, 
                    target.PPM_UDFCHAR16=src.PPM_UDFCHAR16, 
                    target.PPM_UDFCHAR17=src.PPM_UDFCHAR17, 
                    target.PPM_UDFCHAR18=src.PPM_UDFCHAR18, 
                    target.PPM_UDFCHAR19=src.PPM_UDFCHAR19, 
                    target.PPM_UDFCHAR20=src.PPM_UDFCHAR20, 
                    target.PPM_UDFCHAR21=src.PPM_UDFCHAR21, 
                    target.PPM_UDFCHAR22=src.PPM_UDFCHAR22, 
                    target.PPM_UDFCHAR23=src.PPM_UDFCHAR23, 
                    target.PPM_UDFCHAR24=src.PPM_UDFCHAR24, 
                    target.PPM_UDFCHAR25=src.PPM_UDFCHAR25, 
                    target.PPM_UDFCHAR26=src.PPM_UDFCHAR26, 
                    target.PPM_UDFCHAR27=src.PPM_UDFCHAR27, 
                    target.PPM_UDFCHAR28=src.PPM_UDFCHAR28, 
                    target.PPM_UDFCHAR29=src.PPM_UDFCHAR29, 
                    target.PPM_UDFCHAR30=src.PPM_UDFCHAR30, 
                    target.PPM_UDFCHAR31=src.PPM_UDFCHAR31, 
                    target.PPM_UDFCHAR32=src.PPM_UDFCHAR32, 
                    target.PPM_UDFCHAR33=src.PPM_UDFCHAR33, 
                    target.PPM_UDFCHAR34=src.PPM_UDFCHAR34, 
                    target.PPM_UDFCHAR35=src.PPM_UDFCHAR35, 
                    target.PPM_UDFCHAR36=src.PPM_UDFCHAR36, 
                    target.PPM_UDFCHAR37=src.PPM_UDFCHAR37, 
                    target.PPM_UDFCHAR38=src.PPM_UDFCHAR38, 
                    target.PPM_UDFCHAR39=src.PPM_UDFCHAR39, 
                    target.PPM_UDFCHAR40=src.PPM_UDFCHAR40, 
                    target.PPM_UDFCHAR41=src.PPM_UDFCHAR41, 
                    target.PPM_UDFCHAR42=src.PPM_UDFCHAR42, 
                    target.PPM_UDFCHAR43=src.PPM_UDFCHAR43, 
                    target.PPM_UDFCHAR44=src.PPM_UDFCHAR44, 
                    target.PPM_UDFCHAR45=src.PPM_UDFCHAR45, 
                    target.PPM_UDFCHKBOX01=src.PPM_UDFCHKBOX01, 
                    target.PPM_UDFCHKBOX02=src.PPM_UDFCHKBOX02, 
                    target.PPM_UDFCHKBOX03=src.PPM_UDFCHKBOX03, 
                    target.PPM_UDFCHKBOX04=src.PPM_UDFCHKBOX04, 
                    target.PPM_UDFCHKBOX05=src.PPM_UDFCHKBOX05, 
                    target.PPM_UDFCHKBOX06=src.PPM_UDFCHKBOX06, 
                    target.PPM_UDFCHKBOX07=src.PPM_UDFCHKBOX07, 
                    target.PPM_UDFCHKBOX08=src.PPM_UDFCHKBOX08, 
                    target.PPM_UDFCHKBOX09=src.PPM_UDFCHKBOX09, 
                    target.PPM_UDFCHKBOX10=src.PPM_UDFCHKBOX10, 
                    target.PPM_UDFDATE01=src.PPM_UDFDATE01, 
                    target.PPM_UDFDATE02=src.PPM_UDFDATE02, 
                    target.PPM_UDFDATE03=src.PPM_UDFDATE03, 
                    target.PPM_UDFDATE04=src.PPM_UDFDATE04, 
                    target.PPM_UDFDATE05=src.PPM_UDFDATE05, 
                    target.PPM_UDFDATE06=src.PPM_UDFDATE06, 
                    target.PPM_UDFDATE07=src.PPM_UDFDATE07, 
                    target.PPM_UDFDATE08=src.PPM_UDFDATE08, 
                    target.PPM_UDFDATE09=src.PPM_UDFDATE09, 
                    target.PPM_UDFDATE10=src.PPM_UDFDATE10, 
                    target.PPM_UDFNOTE01=src.PPM_UDFNOTE01, 
                    target.PPM_UDFNOTE02=src.PPM_UDFNOTE02, 
                    target.PPM_UDFNUM01=src.PPM_UDFNUM01, 
                    target.PPM_UDFNUM02=src.PPM_UDFNUM02, 
                    target.PPM_UDFNUM03=src.PPM_UDFNUM03, 
                    target.PPM_UDFNUM04=src.PPM_UDFNUM04, 
                    target.PPM_UDFNUM05=src.PPM_UDFNUM05, 
                    target.PPM_UDFNUM06=src.PPM_UDFNUM06, 
                    target.PPM_UDFNUM07=src.PPM_UDFNUM07, 
                    target.PPM_UDFNUM08=src.PPM_UDFNUM08, 
                    target.PPM_UDFNUM09=src.PPM_UDFNUM09, 
                    target.PPM_UDFNUM10=src.PPM_UDFNUM10, 
                    target.PPM_UPDATECOUNT=src.PPM_UPDATECOUNT, 
                    target.PPM_WOCLASS=src.PPM_WOCLASS, 
                    target.PPM_WOCLASS_ORG=src.PPM_WOCLASS_ORG, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    PPM_CLASS, 
                    PPM_CLASS_ORG, 
                    PPM_CODE, 
                    PPM_DESC, 
                    PPM_DURATION, 
                    PPM_ESTWORKLOAD, 
                    PPM_FREQ, 
                    PPM_GENWINDOW, 
                    PPM_ISSTYPE, 
                    PPM_JOBTYPE, 
                    PPM_LASTSAVED, 
                    PPM_METER, 
                    PPM_METER2, 
                    PPM_METUOM, 
                    PPM_METUOM2, 
                    PPM_NEARWINDOW, 
                    PPM_NESTED, 
                    PPM_NESTEDPMSTATUS, 
                    PPM_NESTEDTOLMAX, 
                    PPM_NESTEDTOLMET2MAX, 
                    PPM_NESTEDTOLMET2MIN, 
                    PPM_NESTEDTOLMETMAX, 
                    PPM_NESTEDTOLMETMIN, 
                    PPM_NESTEDTOLMIN, 
                    PPM_NOTUSED, 
                    PPM_OKWINDOW, 
                    PPM_ORG, 
                    PPM_PACKAGE, 
                    PPM_PERFORMONDAY, 
                    PPM_PERFORMONWEEK, 
                    PPM_PERIODUOM, 
                    PPM_PERMITREVIEWED, 
                    PPM_PERMITREVIEWEDBY, 
                    PPM_PERMITREVIEWEDNAME, 
                    PPM_PERMITREVIEWEDTYPE, 
                    PPM_PERMITREVIEWREQUIRED, 
                    PPM_PLAN, 
                    PPM_PRIORITY, 
                    PPM_PRODPRIORITY, 
                    PPM_REQUESTEDENDDATEBUFFER, 
                    PPM_REQUESTEDSTARTDATEBUFFER, 
                    PPM_REVISION, 
                    PPM_REVRSTATUS, 
                    PPM_REVSTATUS, 
                    PPM_SAFETYREVIEWED, 
                    PPM_SAFETYREVIEWEDBY, 
                    PPM_SAFETYREVIEWEDNAME, 
                    PPM_SAFETYREVIEWEDTYPE, 
                    PPM_SAFETYREVIEWREQUIRED, 
                    PPM_SCHEDGRP, 
                    PPM_SPECIAL, 
                    PPM_UDFCHAR01, 
                    PPM_UDFCHAR02, 
                    PPM_UDFCHAR03, 
                    PPM_UDFCHAR04, 
                    PPM_UDFCHAR05, 
                    PPM_UDFCHAR06, 
                    PPM_UDFCHAR07, 
                    PPM_UDFCHAR08, 
                    PPM_UDFCHAR09, 
                    PPM_UDFCHAR10, 
                    PPM_UDFCHAR11, 
                    PPM_UDFCHAR12, 
                    PPM_UDFCHAR13, 
                    PPM_UDFCHAR14, 
                    PPM_UDFCHAR15, 
                    PPM_UDFCHAR16, 
                    PPM_UDFCHAR17, 
                    PPM_UDFCHAR18, 
                    PPM_UDFCHAR19, 
                    PPM_UDFCHAR20, 
                    PPM_UDFCHAR21, 
                    PPM_UDFCHAR22, 
                    PPM_UDFCHAR23, 
                    PPM_UDFCHAR24, 
                    PPM_UDFCHAR25, 
                    PPM_UDFCHAR26, 
                    PPM_UDFCHAR27, 
                    PPM_UDFCHAR28, 
                    PPM_UDFCHAR29, 
                    PPM_UDFCHAR30, 
                    PPM_UDFCHAR31, 
                    PPM_UDFCHAR32, 
                    PPM_UDFCHAR33, 
                    PPM_UDFCHAR34, 
                    PPM_UDFCHAR35, 
                    PPM_UDFCHAR36, 
                    PPM_UDFCHAR37, 
                    PPM_UDFCHAR38, 
                    PPM_UDFCHAR39, 
                    PPM_UDFCHAR40, 
                    PPM_UDFCHAR41, 
                    PPM_UDFCHAR42, 
                    PPM_UDFCHAR43, 
                    PPM_UDFCHAR44, 
                    PPM_UDFCHAR45, 
                    PPM_UDFCHKBOX01, 
                    PPM_UDFCHKBOX02, 
                    PPM_UDFCHKBOX03, 
                    PPM_UDFCHKBOX04, 
                    PPM_UDFCHKBOX05, 
                    PPM_UDFCHKBOX06, 
                    PPM_UDFCHKBOX07, 
                    PPM_UDFCHKBOX08, 
                    PPM_UDFCHKBOX09, 
                    PPM_UDFCHKBOX10, 
                    PPM_UDFDATE01, 
                    PPM_UDFDATE02, 
                    PPM_UDFDATE03, 
                    PPM_UDFDATE04, 
                    PPM_UDFDATE05, 
                    PPM_UDFDATE06, 
                    PPM_UDFDATE07, 
                    PPM_UDFDATE08, 
                    PPM_UDFDATE09, 
                    PPM_UDFDATE10, 
                    PPM_UDFNOTE01, 
                    PPM_UDFNOTE02, 
                    PPM_UDFNUM01, 
                    PPM_UDFNUM02, 
                    PPM_UDFNUM03, 
                    PPM_UDFNUM04, 
                    PPM_UDFNUM05, 
                    PPM_UDFNUM06, 
                    PPM_UDFNUM07, 
                    PPM_UDFNUM08, 
                    PPM_UDFNUM09, 
                    PPM_UDFNUM10, 
                    PPM_UPDATECOUNT, 
                    PPM_WOCLASS, 
                    PPM_WOCLASS_ORG, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.PPM_CLASS, 
                    src.PPM_CLASS_ORG, 
                    src.PPM_CODE, 
                    src.PPM_DESC, 
                    src.PPM_DURATION, 
                    src.PPM_ESTWORKLOAD, 
                    src.PPM_FREQ, 
                    src.PPM_GENWINDOW, 
                    src.PPM_ISSTYPE, 
                    src.PPM_JOBTYPE, 
                    src.PPM_LASTSAVED, 
                    src.PPM_METER, 
                    src.PPM_METER2, 
                    src.PPM_METUOM, 
                    src.PPM_METUOM2, 
                    src.PPM_NEARWINDOW, 
                    src.PPM_NESTED, 
                    src.PPM_NESTEDPMSTATUS, 
                    src.PPM_NESTEDTOLMAX, 
                    src.PPM_NESTEDTOLMET2MAX, 
                    src.PPM_NESTEDTOLMET2MIN, 
                    src.PPM_NESTEDTOLMETMAX, 
                    src.PPM_NESTEDTOLMETMIN, 
                    src.PPM_NESTEDTOLMIN, 
                    src.PPM_NOTUSED, 
                    src.PPM_OKWINDOW, 
                    src.PPM_ORG, 
                    src.PPM_PACKAGE, 
                    src.PPM_PERFORMONDAY, 
                    src.PPM_PERFORMONWEEK, 
                    src.PPM_PERIODUOM, 
                    src.PPM_PERMITREVIEWED, 
                    src.PPM_PERMITREVIEWEDBY, 
                    src.PPM_PERMITREVIEWEDNAME, 
                    src.PPM_PERMITREVIEWEDTYPE, 
                    src.PPM_PERMITREVIEWREQUIRED, 
                    src.PPM_PLAN, 
                    src.PPM_PRIORITY, 
                    src.PPM_PRODPRIORITY, 
                    src.PPM_REQUESTEDENDDATEBUFFER, 
                    src.PPM_REQUESTEDSTARTDATEBUFFER, 
                    src.PPM_REVISION, 
                    src.PPM_REVRSTATUS, 
                    src.PPM_REVSTATUS, 
                    src.PPM_SAFETYREVIEWED, 
                    src.PPM_SAFETYREVIEWEDBY, 
                    src.PPM_SAFETYREVIEWEDNAME, 
                    src.PPM_SAFETYREVIEWEDTYPE, 
                    src.PPM_SAFETYREVIEWREQUIRED, 
                    src.PPM_SCHEDGRP, 
                    src.PPM_SPECIAL, 
                    src.PPM_UDFCHAR01, 
                    src.PPM_UDFCHAR02, 
                    src.PPM_UDFCHAR03, 
                    src.PPM_UDFCHAR04, 
                    src.PPM_UDFCHAR05, 
                    src.PPM_UDFCHAR06, 
                    src.PPM_UDFCHAR07, 
                    src.PPM_UDFCHAR08, 
                    src.PPM_UDFCHAR09, 
                    src.PPM_UDFCHAR10, 
                    src.PPM_UDFCHAR11, 
                    src.PPM_UDFCHAR12, 
                    src.PPM_UDFCHAR13, 
                    src.PPM_UDFCHAR14, 
                    src.PPM_UDFCHAR15, 
                    src.PPM_UDFCHAR16, 
                    src.PPM_UDFCHAR17, 
                    src.PPM_UDFCHAR18, 
                    src.PPM_UDFCHAR19, 
                    src.PPM_UDFCHAR20, 
                    src.PPM_UDFCHAR21, 
                    src.PPM_UDFCHAR22, 
                    src.PPM_UDFCHAR23, 
                    src.PPM_UDFCHAR24, 
                    src.PPM_UDFCHAR25, 
                    src.PPM_UDFCHAR26, 
                    src.PPM_UDFCHAR27, 
                    src.PPM_UDFCHAR28, 
                    src.PPM_UDFCHAR29, 
                    src.PPM_UDFCHAR30, 
                    src.PPM_UDFCHAR31, 
                    src.PPM_UDFCHAR32, 
                    src.PPM_UDFCHAR33, 
                    src.PPM_UDFCHAR34, 
                    src.PPM_UDFCHAR35, 
                    src.PPM_UDFCHAR36, 
                    src.PPM_UDFCHAR37, 
                    src.PPM_UDFCHAR38, 
                    src.PPM_UDFCHAR39, 
                    src.PPM_UDFCHAR40, 
                    src.PPM_UDFCHAR41, 
                    src.PPM_UDFCHAR42, 
                    src.PPM_UDFCHAR43, 
                    src.PPM_UDFCHAR44, 
                    src.PPM_UDFCHAR45, 
                    src.PPM_UDFCHKBOX01, 
                    src.PPM_UDFCHKBOX02, 
                    src.PPM_UDFCHKBOX03, 
                    src.PPM_UDFCHKBOX04, 
                    src.PPM_UDFCHKBOX05, 
                    src.PPM_UDFCHKBOX06, 
                    src.PPM_UDFCHKBOX07, 
                    src.PPM_UDFCHKBOX08, 
                    src.PPM_UDFCHKBOX09, 
                    src.PPM_UDFCHKBOX10, 
                    src.PPM_UDFDATE01, 
                    src.PPM_UDFDATE02, 
                    src.PPM_UDFDATE03, 
                    src.PPM_UDFDATE04, 
                    src.PPM_UDFDATE05, 
                    src.PPM_UDFDATE06, 
                    src.PPM_UDFDATE07, 
                    src.PPM_UDFDATE08, 
                    src.PPM_UDFDATE09, 
                    src.PPM_UDFDATE10, 
                    src.PPM_UDFNOTE01, 
                    src.PPM_UDFNOTE02, 
                    src.PPM_UDFNUM01, 
                    src.PPM_UDFNUM02, 
                    src.PPM_UDFNUM03, 
                    src.PPM_UDFNUM04, 
                    src.PPM_UDFNUM05, 
                    src.PPM_UDFNUM06, 
                    src.PPM_UDFNUM07, 
                    src.PPM_UDFNUM08, 
                    src.PPM_UDFNUM09, 
                    src.PPM_UDFNUM10, 
                    src.PPM_UPDATECOUNT, 
                    src.PPM_WOCLASS, 
                    src.PPM_WOCLASS_ORG, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5PPMS_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.PPM_CLASS, 
            strm.PPM_CLASS_ORG, 
            strm.PPM_CODE, 
            strm.PPM_DESC, 
            strm.PPM_DURATION, 
            strm.PPM_ESTWORKLOAD, 
            strm.PPM_FREQ, 
            strm.PPM_GENWINDOW, 
            strm.PPM_ISSTYPE, 
            strm.PPM_JOBTYPE, 
            strm.PPM_LASTSAVED, 
            strm.PPM_METER, 
            strm.PPM_METER2, 
            strm.PPM_METUOM, 
            strm.PPM_METUOM2, 
            strm.PPM_NEARWINDOW, 
            strm.PPM_NESTED, 
            strm.PPM_NESTEDPMSTATUS, 
            strm.PPM_NESTEDTOLMAX, 
            strm.PPM_NESTEDTOLMET2MAX, 
            strm.PPM_NESTEDTOLMET2MIN, 
            strm.PPM_NESTEDTOLMETMAX, 
            strm.PPM_NESTEDTOLMETMIN, 
            strm.PPM_NESTEDTOLMIN, 
            strm.PPM_NOTUSED, 
            strm.PPM_OKWINDOW, 
            strm.PPM_ORG, 
            strm.PPM_PACKAGE, 
            strm.PPM_PERFORMONDAY, 
            strm.PPM_PERFORMONWEEK, 
            strm.PPM_PERIODUOM, 
            strm.PPM_PERMITREVIEWED, 
            strm.PPM_PERMITREVIEWEDBY, 
            strm.PPM_PERMITREVIEWEDNAME, 
            strm.PPM_PERMITREVIEWEDTYPE, 
            strm.PPM_PERMITREVIEWREQUIRED, 
            strm.PPM_PLAN, 
            strm.PPM_PRIORITY, 
            strm.PPM_PRODPRIORITY, 
            strm.PPM_REQUESTEDENDDATEBUFFER, 
            strm.PPM_REQUESTEDSTARTDATEBUFFER, 
            strm.PPM_REVISION, 
            strm.PPM_REVRSTATUS, 
            strm.PPM_REVSTATUS, 
            strm.PPM_SAFETYREVIEWED, 
            strm.PPM_SAFETYREVIEWEDBY, 
            strm.PPM_SAFETYREVIEWEDNAME, 
            strm.PPM_SAFETYREVIEWEDTYPE, 
            strm.PPM_SAFETYREVIEWREQUIRED, 
            strm.PPM_SCHEDGRP, 
            strm.PPM_SPECIAL, 
            strm.PPM_UDFCHAR01, 
            strm.PPM_UDFCHAR02, 
            strm.PPM_UDFCHAR03, 
            strm.PPM_UDFCHAR04, 
            strm.PPM_UDFCHAR05, 
            strm.PPM_UDFCHAR06, 
            strm.PPM_UDFCHAR07, 
            strm.PPM_UDFCHAR08, 
            strm.PPM_UDFCHAR09, 
            strm.PPM_UDFCHAR10, 
            strm.PPM_UDFCHAR11, 
            strm.PPM_UDFCHAR12, 
            strm.PPM_UDFCHAR13, 
            strm.PPM_UDFCHAR14, 
            strm.PPM_UDFCHAR15, 
            strm.PPM_UDFCHAR16, 
            strm.PPM_UDFCHAR17, 
            strm.PPM_UDFCHAR18, 
            strm.PPM_UDFCHAR19, 
            strm.PPM_UDFCHAR20, 
            strm.PPM_UDFCHAR21, 
            strm.PPM_UDFCHAR22, 
            strm.PPM_UDFCHAR23, 
            strm.PPM_UDFCHAR24, 
            strm.PPM_UDFCHAR25, 
            strm.PPM_UDFCHAR26, 
            strm.PPM_UDFCHAR27, 
            strm.PPM_UDFCHAR28, 
            strm.PPM_UDFCHAR29, 
            strm.PPM_UDFCHAR30, 
            strm.PPM_UDFCHAR31, 
            strm.PPM_UDFCHAR32, 
            strm.PPM_UDFCHAR33, 
            strm.PPM_UDFCHAR34, 
            strm.PPM_UDFCHAR35, 
            strm.PPM_UDFCHAR36, 
            strm.PPM_UDFCHAR37, 
            strm.PPM_UDFCHAR38, 
            strm.PPM_UDFCHAR39, 
            strm.PPM_UDFCHAR40, 
            strm.PPM_UDFCHAR41, 
            strm.PPM_UDFCHAR42, 
            strm.PPM_UDFCHAR43, 
            strm.PPM_UDFCHAR44, 
            strm.PPM_UDFCHAR45, 
            strm.PPM_UDFCHKBOX01, 
            strm.PPM_UDFCHKBOX02, 
            strm.PPM_UDFCHKBOX03, 
            strm.PPM_UDFCHKBOX04, 
            strm.PPM_UDFCHKBOX05, 
            strm.PPM_UDFCHKBOX06, 
            strm.PPM_UDFCHKBOX07, 
            strm.PPM_UDFCHKBOX08, 
            strm.PPM_UDFCHKBOX09, 
            strm.PPM_UDFCHKBOX10, 
            strm.PPM_UDFDATE01, 
            strm.PPM_UDFDATE02, 
            strm.PPM_UDFDATE03, 
            strm.PPM_UDFDATE04, 
            strm.PPM_UDFDATE05, 
            strm.PPM_UDFDATE06, 
            strm.PPM_UDFDATE07, 
            strm.PPM_UDFDATE08, 
            strm.PPM_UDFDATE09, 
            strm.PPM_UDFDATE10, 
            strm.PPM_UDFNOTE01, 
            strm.PPM_UDFNOTE02, 
            strm.PPM_UDFNUM01, 
            strm.PPM_UDFNUM02, 
            strm.PPM_UDFNUM03, 
            strm.PPM_UDFNUM04, 
            strm.PPM_UDFNUM05, 
            strm.PPM_UDFNUM06, 
            strm.PPM_UDFNUM07, 
            strm.PPM_UDFNUM08, 
            strm.PPM_UDFNUM09, 
            strm.PPM_UDFNUM10, 
            strm.PPM_UPDATECOUNT, 
            strm.PPM_WOCLASS, 
            strm.PPM_WOCLASS_ORG, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.PPM_CODE,
            strm.PPM_REVISION ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5PPMS as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.PPM_CODE=src.PPM_CODE) OR (target.PPM_CODE IS NULL AND src.PPM_CODE IS NULL)) AND
            ((target.PPM_REVISION=src.PPM_REVISION) OR (target.PPM_REVISION IS NULL AND src.PPM_REVISION IS NULL)) 
                when matched then update set
                    target.PPM_CLASS=src.PPM_CLASS, 
                    target.PPM_CLASS_ORG=src.PPM_CLASS_ORG, 
                    target.PPM_CODE=src.PPM_CODE, 
                    target.PPM_DESC=src.PPM_DESC, 
                    target.PPM_DURATION=src.PPM_DURATION, 
                    target.PPM_ESTWORKLOAD=src.PPM_ESTWORKLOAD, 
                    target.PPM_FREQ=src.PPM_FREQ, 
                    target.PPM_GENWINDOW=src.PPM_GENWINDOW, 
                    target.PPM_ISSTYPE=src.PPM_ISSTYPE, 
                    target.PPM_JOBTYPE=src.PPM_JOBTYPE, 
                    target.PPM_LASTSAVED=src.PPM_LASTSAVED, 
                    target.PPM_METER=src.PPM_METER, 
                    target.PPM_METER2=src.PPM_METER2, 
                    target.PPM_METUOM=src.PPM_METUOM, 
                    target.PPM_METUOM2=src.PPM_METUOM2, 
                    target.PPM_NEARWINDOW=src.PPM_NEARWINDOW, 
                    target.PPM_NESTED=src.PPM_NESTED, 
                    target.PPM_NESTEDPMSTATUS=src.PPM_NESTEDPMSTATUS, 
                    target.PPM_NESTEDTOLMAX=src.PPM_NESTEDTOLMAX, 
                    target.PPM_NESTEDTOLMET2MAX=src.PPM_NESTEDTOLMET2MAX, 
                    target.PPM_NESTEDTOLMET2MIN=src.PPM_NESTEDTOLMET2MIN, 
                    target.PPM_NESTEDTOLMETMAX=src.PPM_NESTEDTOLMETMAX, 
                    target.PPM_NESTEDTOLMETMIN=src.PPM_NESTEDTOLMETMIN, 
                    target.PPM_NESTEDTOLMIN=src.PPM_NESTEDTOLMIN, 
                    target.PPM_NOTUSED=src.PPM_NOTUSED, 
                    target.PPM_OKWINDOW=src.PPM_OKWINDOW, 
                    target.PPM_ORG=src.PPM_ORG, 
                    target.PPM_PACKAGE=src.PPM_PACKAGE, 
                    target.PPM_PERFORMONDAY=src.PPM_PERFORMONDAY, 
                    target.PPM_PERFORMONWEEK=src.PPM_PERFORMONWEEK, 
                    target.PPM_PERIODUOM=src.PPM_PERIODUOM, 
                    target.PPM_PERMITREVIEWED=src.PPM_PERMITREVIEWED, 
                    target.PPM_PERMITREVIEWEDBY=src.PPM_PERMITREVIEWEDBY, 
                    target.PPM_PERMITREVIEWEDNAME=src.PPM_PERMITREVIEWEDNAME, 
                    target.PPM_PERMITREVIEWEDTYPE=src.PPM_PERMITREVIEWEDTYPE, 
                    target.PPM_PERMITREVIEWREQUIRED=src.PPM_PERMITREVIEWREQUIRED, 
                    target.PPM_PLAN=src.PPM_PLAN, 
                    target.PPM_PRIORITY=src.PPM_PRIORITY, 
                    target.PPM_PRODPRIORITY=src.PPM_PRODPRIORITY, 
                    target.PPM_REQUESTEDENDDATEBUFFER=src.PPM_REQUESTEDENDDATEBUFFER, 
                    target.PPM_REQUESTEDSTARTDATEBUFFER=src.PPM_REQUESTEDSTARTDATEBUFFER, 
                    target.PPM_REVISION=src.PPM_REVISION, 
                    target.PPM_REVRSTATUS=src.PPM_REVRSTATUS, 
                    target.PPM_REVSTATUS=src.PPM_REVSTATUS, 
                    target.PPM_SAFETYREVIEWED=src.PPM_SAFETYREVIEWED, 
                    target.PPM_SAFETYREVIEWEDBY=src.PPM_SAFETYREVIEWEDBY, 
                    target.PPM_SAFETYREVIEWEDNAME=src.PPM_SAFETYREVIEWEDNAME, 
                    target.PPM_SAFETYREVIEWEDTYPE=src.PPM_SAFETYREVIEWEDTYPE, 
                    target.PPM_SAFETYREVIEWREQUIRED=src.PPM_SAFETYREVIEWREQUIRED, 
                    target.PPM_SCHEDGRP=src.PPM_SCHEDGRP, 
                    target.PPM_SPECIAL=src.PPM_SPECIAL, 
                    target.PPM_UDFCHAR01=src.PPM_UDFCHAR01, 
                    target.PPM_UDFCHAR02=src.PPM_UDFCHAR02, 
                    target.PPM_UDFCHAR03=src.PPM_UDFCHAR03, 
                    target.PPM_UDFCHAR04=src.PPM_UDFCHAR04, 
                    target.PPM_UDFCHAR05=src.PPM_UDFCHAR05, 
                    target.PPM_UDFCHAR06=src.PPM_UDFCHAR06, 
                    target.PPM_UDFCHAR07=src.PPM_UDFCHAR07, 
                    target.PPM_UDFCHAR08=src.PPM_UDFCHAR08, 
                    target.PPM_UDFCHAR09=src.PPM_UDFCHAR09, 
                    target.PPM_UDFCHAR10=src.PPM_UDFCHAR10, 
                    target.PPM_UDFCHAR11=src.PPM_UDFCHAR11, 
                    target.PPM_UDFCHAR12=src.PPM_UDFCHAR12, 
                    target.PPM_UDFCHAR13=src.PPM_UDFCHAR13, 
                    target.PPM_UDFCHAR14=src.PPM_UDFCHAR14, 
                    target.PPM_UDFCHAR15=src.PPM_UDFCHAR15, 
                    target.PPM_UDFCHAR16=src.PPM_UDFCHAR16, 
                    target.PPM_UDFCHAR17=src.PPM_UDFCHAR17, 
                    target.PPM_UDFCHAR18=src.PPM_UDFCHAR18, 
                    target.PPM_UDFCHAR19=src.PPM_UDFCHAR19, 
                    target.PPM_UDFCHAR20=src.PPM_UDFCHAR20, 
                    target.PPM_UDFCHAR21=src.PPM_UDFCHAR21, 
                    target.PPM_UDFCHAR22=src.PPM_UDFCHAR22, 
                    target.PPM_UDFCHAR23=src.PPM_UDFCHAR23, 
                    target.PPM_UDFCHAR24=src.PPM_UDFCHAR24, 
                    target.PPM_UDFCHAR25=src.PPM_UDFCHAR25, 
                    target.PPM_UDFCHAR26=src.PPM_UDFCHAR26, 
                    target.PPM_UDFCHAR27=src.PPM_UDFCHAR27, 
                    target.PPM_UDFCHAR28=src.PPM_UDFCHAR28, 
                    target.PPM_UDFCHAR29=src.PPM_UDFCHAR29, 
                    target.PPM_UDFCHAR30=src.PPM_UDFCHAR30, 
                    target.PPM_UDFCHAR31=src.PPM_UDFCHAR31, 
                    target.PPM_UDFCHAR32=src.PPM_UDFCHAR32, 
                    target.PPM_UDFCHAR33=src.PPM_UDFCHAR33, 
                    target.PPM_UDFCHAR34=src.PPM_UDFCHAR34, 
                    target.PPM_UDFCHAR35=src.PPM_UDFCHAR35, 
                    target.PPM_UDFCHAR36=src.PPM_UDFCHAR36, 
                    target.PPM_UDFCHAR37=src.PPM_UDFCHAR37, 
                    target.PPM_UDFCHAR38=src.PPM_UDFCHAR38, 
                    target.PPM_UDFCHAR39=src.PPM_UDFCHAR39, 
                    target.PPM_UDFCHAR40=src.PPM_UDFCHAR40, 
                    target.PPM_UDFCHAR41=src.PPM_UDFCHAR41, 
                    target.PPM_UDFCHAR42=src.PPM_UDFCHAR42, 
                    target.PPM_UDFCHAR43=src.PPM_UDFCHAR43, 
                    target.PPM_UDFCHAR44=src.PPM_UDFCHAR44, 
                    target.PPM_UDFCHAR45=src.PPM_UDFCHAR45, 
                    target.PPM_UDFCHKBOX01=src.PPM_UDFCHKBOX01, 
                    target.PPM_UDFCHKBOX02=src.PPM_UDFCHKBOX02, 
                    target.PPM_UDFCHKBOX03=src.PPM_UDFCHKBOX03, 
                    target.PPM_UDFCHKBOX04=src.PPM_UDFCHKBOX04, 
                    target.PPM_UDFCHKBOX05=src.PPM_UDFCHKBOX05, 
                    target.PPM_UDFCHKBOX06=src.PPM_UDFCHKBOX06, 
                    target.PPM_UDFCHKBOX07=src.PPM_UDFCHKBOX07, 
                    target.PPM_UDFCHKBOX08=src.PPM_UDFCHKBOX08, 
                    target.PPM_UDFCHKBOX09=src.PPM_UDFCHKBOX09, 
                    target.PPM_UDFCHKBOX10=src.PPM_UDFCHKBOX10, 
                    target.PPM_UDFDATE01=src.PPM_UDFDATE01, 
                    target.PPM_UDFDATE02=src.PPM_UDFDATE02, 
                    target.PPM_UDFDATE03=src.PPM_UDFDATE03, 
                    target.PPM_UDFDATE04=src.PPM_UDFDATE04, 
                    target.PPM_UDFDATE05=src.PPM_UDFDATE05, 
                    target.PPM_UDFDATE06=src.PPM_UDFDATE06, 
                    target.PPM_UDFDATE07=src.PPM_UDFDATE07, 
                    target.PPM_UDFDATE08=src.PPM_UDFDATE08, 
                    target.PPM_UDFDATE09=src.PPM_UDFDATE09, 
                    target.PPM_UDFDATE10=src.PPM_UDFDATE10, 
                    target.PPM_UDFNOTE01=src.PPM_UDFNOTE01, 
                    target.PPM_UDFNOTE02=src.PPM_UDFNOTE02, 
                    target.PPM_UDFNUM01=src.PPM_UDFNUM01, 
                    target.PPM_UDFNUM02=src.PPM_UDFNUM02, 
                    target.PPM_UDFNUM03=src.PPM_UDFNUM03, 
                    target.PPM_UDFNUM04=src.PPM_UDFNUM04, 
                    target.PPM_UDFNUM05=src.PPM_UDFNUM05, 
                    target.PPM_UDFNUM06=src.PPM_UDFNUM06, 
                    target.PPM_UDFNUM07=src.PPM_UDFNUM07, 
                    target.PPM_UDFNUM08=src.PPM_UDFNUM08, 
                    target.PPM_UDFNUM09=src.PPM_UDFNUM09, 
                    target.PPM_UDFNUM10=src.PPM_UDFNUM10, 
                    target.PPM_UPDATECOUNT=src.PPM_UPDATECOUNT, 
                    target.PPM_WOCLASS=src.PPM_WOCLASS, 
                    target.PPM_WOCLASS_ORG=src.PPM_WOCLASS_ORG, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( PPM_CLASS, PPM_CLASS_ORG, PPM_CODE, PPM_DESC, PPM_DURATION, PPM_ESTWORKLOAD, PPM_FREQ, PPM_GENWINDOW, PPM_ISSTYPE, PPM_JOBTYPE, PPM_LASTSAVED, PPM_METER, PPM_METER2, PPM_METUOM, PPM_METUOM2, PPM_NEARWINDOW, PPM_NESTED, PPM_NESTEDPMSTATUS, PPM_NESTEDTOLMAX, PPM_NESTEDTOLMET2MAX, PPM_NESTEDTOLMET2MIN, PPM_NESTEDTOLMETMAX, PPM_NESTEDTOLMETMIN, PPM_NESTEDTOLMIN, PPM_NOTUSED, PPM_OKWINDOW, PPM_ORG, PPM_PACKAGE, PPM_PERFORMONDAY, PPM_PERFORMONWEEK, PPM_PERIODUOM, PPM_PERMITREVIEWED, PPM_PERMITREVIEWEDBY, PPM_PERMITREVIEWEDNAME, PPM_PERMITREVIEWEDTYPE, PPM_PERMITREVIEWREQUIRED, PPM_PLAN, PPM_PRIORITY, PPM_PRODPRIORITY, PPM_REQUESTEDENDDATEBUFFER, PPM_REQUESTEDSTARTDATEBUFFER, PPM_REVISION, PPM_REVRSTATUS, PPM_REVSTATUS, PPM_SAFETYREVIEWED, PPM_SAFETYREVIEWEDBY, PPM_SAFETYREVIEWEDNAME, PPM_SAFETYREVIEWEDTYPE, PPM_SAFETYREVIEWREQUIRED, PPM_SCHEDGRP, PPM_SPECIAL, PPM_UDFCHAR01, PPM_UDFCHAR02, PPM_UDFCHAR03, PPM_UDFCHAR04, PPM_UDFCHAR05, PPM_UDFCHAR06, PPM_UDFCHAR07, PPM_UDFCHAR08, PPM_UDFCHAR09, PPM_UDFCHAR10, PPM_UDFCHAR11, PPM_UDFCHAR12, PPM_UDFCHAR13, PPM_UDFCHAR14, PPM_UDFCHAR15, PPM_UDFCHAR16, PPM_UDFCHAR17, PPM_UDFCHAR18, PPM_UDFCHAR19, PPM_UDFCHAR20, PPM_UDFCHAR21, PPM_UDFCHAR22, PPM_UDFCHAR23, PPM_UDFCHAR24, PPM_UDFCHAR25, PPM_UDFCHAR26, PPM_UDFCHAR27, PPM_UDFCHAR28, PPM_UDFCHAR29, PPM_UDFCHAR30, PPM_UDFCHAR31, PPM_UDFCHAR32, PPM_UDFCHAR33, PPM_UDFCHAR34, PPM_UDFCHAR35, PPM_UDFCHAR36, PPM_UDFCHAR37, PPM_UDFCHAR38, PPM_UDFCHAR39, PPM_UDFCHAR40, PPM_UDFCHAR41, PPM_UDFCHAR42, PPM_UDFCHAR43, PPM_UDFCHAR44, PPM_UDFCHAR45, PPM_UDFCHKBOX01, PPM_UDFCHKBOX02, PPM_UDFCHKBOX03, PPM_UDFCHKBOX04, PPM_UDFCHKBOX05, PPM_UDFCHKBOX06, PPM_UDFCHKBOX07, PPM_UDFCHKBOX08, PPM_UDFCHKBOX09, PPM_UDFCHKBOX10, PPM_UDFDATE01, PPM_UDFDATE02, PPM_UDFDATE03, PPM_UDFDATE04, PPM_UDFDATE05, PPM_UDFDATE06, PPM_UDFDATE07, PPM_UDFDATE08, PPM_UDFDATE09, PPM_UDFDATE10, PPM_UDFNOTE01, PPM_UDFNOTE02, PPM_UDFNUM01, PPM_UDFNUM02, PPM_UDFNUM03, PPM_UDFNUM04, PPM_UDFNUM05, PPM_UDFNUM06, PPM_UDFNUM07, PPM_UDFNUM08, PPM_UDFNUM09, PPM_UDFNUM10, PPM_UPDATECOUNT, PPM_WOCLASS, PPM_WOCLASS_ORG, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.PPM_CLASS, 
                    src.PPM_CLASS_ORG, 
                    src.PPM_CODE, 
                    src.PPM_DESC, 
                    src.PPM_DURATION, 
                    src.PPM_ESTWORKLOAD, 
                    src.PPM_FREQ, 
                    src.PPM_GENWINDOW, 
                    src.PPM_ISSTYPE, 
                    src.PPM_JOBTYPE, 
                    src.PPM_LASTSAVED, 
                    src.PPM_METER, 
                    src.PPM_METER2, 
                    src.PPM_METUOM, 
                    src.PPM_METUOM2, 
                    src.PPM_NEARWINDOW, 
                    src.PPM_NESTED, 
                    src.PPM_NESTEDPMSTATUS, 
                    src.PPM_NESTEDTOLMAX, 
                    src.PPM_NESTEDTOLMET2MAX, 
                    src.PPM_NESTEDTOLMET2MIN, 
                    src.PPM_NESTEDTOLMETMAX, 
                    src.PPM_NESTEDTOLMETMIN, 
                    src.PPM_NESTEDTOLMIN, 
                    src.PPM_NOTUSED, 
                    src.PPM_OKWINDOW, 
                    src.PPM_ORG, 
                    src.PPM_PACKAGE, 
                    src.PPM_PERFORMONDAY, 
                    src.PPM_PERFORMONWEEK, 
                    src.PPM_PERIODUOM, 
                    src.PPM_PERMITREVIEWED, 
                    src.PPM_PERMITREVIEWEDBY, 
                    src.PPM_PERMITREVIEWEDNAME, 
                    src.PPM_PERMITREVIEWEDTYPE, 
                    src.PPM_PERMITREVIEWREQUIRED, 
                    src.PPM_PLAN, 
                    src.PPM_PRIORITY, 
                    src.PPM_PRODPRIORITY, 
                    src.PPM_REQUESTEDENDDATEBUFFER, 
                    src.PPM_REQUESTEDSTARTDATEBUFFER, 
                    src.PPM_REVISION, 
                    src.PPM_REVRSTATUS, 
                    src.PPM_REVSTATUS, 
                    src.PPM_SAFETYREVIEWED, 
                    src.PPM_SAFETYREVIEWEDBY, 
                    src.PPM_SAFETYREVIEWEDNAME, 
                    src.PPM_SAFETYREVIEWEDTYPE, 
                    src.PPM_SAFETYREVIEWREQUIRED, 
                    src.PPM_SCHEDGRP, 
                    src.PPM_SPECIAL, 
                    src.PPM_UDFCHAR01, 
                    src.PPM_UDFCHAR02, 
                    src.PPM_UDFCHAR03, 
                    src.PPM_UDFCHAR04, 
                    src.PPM_UDFCHAR05, 
                    src.PPM_UDFCHAR06, 
                    src.PPM_UDFCHAR07, 
                    src.PPM_UDFCHAR08, 
                    src.PPM_UDFCHAR09, 
                    src.PPM_UDFCHAR10, 
                    src.PPM_UDFCHAR11, 
                    src.PPM_UDFCHAR12, 
                    src.PPM_UDFCHAR13, 
                    src.PPM_UDFCHAR14, 
                    src.PPM_UDFCHAR15, 
                    src.PPM_UDFCHAR16, 
                    src.PPM_UDFCHAR17, 
                    src.PPM_UDFCHAR18, 
                    src.PPM_UDFCHAR19, 
                    src.PPM_UDFCHAR20, 
                    src.PPM_UDFCHAR21, 
                    src.PPM_UDFCHAR22, 
                    src.PPM_UDFCHAR23, 
                    src.PPM_UDFCHAR24, 
                    src.PPM_UDFCHAR25, 
                    src.PPM_UDFCHAR26, 
                    src.PPM_UDFCHAR27, 
                    src.PPM_UDFCHAR28, 
                    src.PPM_UDFCHAR29, 
                    src.PPM_UDFCHAR30, 
                    src.PPM_UDFCHAR31, 
                    src.PPM_UDFCHAR32, 
                    src.PPM_UDFCHAR33, 
                    src.PPM_UDFCHAR34, 
                    src.PPM_UDFCHAR35, 
                    src.PPM_UDFCHAR36, 
                    src.PPM_UDFCHAR37, 
                    src.PPM_UDFCHAR38, 
                    src.PPM_UDFCHAR39, 
                    src.PPM_UDFCHAR40, 
                    src.PPM_UDFCHAR41, 
                    src.PPM_UDFCHAR42, 
                    src.PPM_UDFCHAR43, 
                    src.PPM_UDFCHAR44, 
                    src.PPM_UDFCHAR45, 
                    src.PPM_UDFCHKBOX01, 
                    src.PPM_UDFCHKBOX02, 
                    src.PPM_UDFCHKBOX03, 
                    src.PPM_UDFCHKBOX04, 
                    src.PPM_UDFCHKBOX05, 
                    src.PPM_UDFCHKBOX06, 
                    src.PPM_UDFCHKBOX07, 
                    src.PPM_UDFCHKBOX08, 
                    src.PPM_UDFCHKBOX09, 
                    src.PPM_UDFCHKBOX10, 
                    src.PPM_UDFDATE01, 
                    src.PPM_UDFDATE02, 
                    src.PPM_UDFDATE03, 
                    src.PPM_UDFDATE04, 
                    src.PPM_UDFDATE05, 
                    src.PPM_UDFDATE06, 
                    src.PPM_UDFDATE07, 
                    src.PPM_UDFDATE08, 
                    src.PPM_UDFDATE09, 
                    src.PPM_UDFDATE10, 
                    src.PPM_UDFNOTE01, 
                    src.PPM_UDFNOTE02, 
                    src.PPM_UDFNUM01, 
                    src.PPM_UDFNUM02, 
                    src.PPM_UDFNUM03, 
                    src.PPM_UDFNUM04, 
                    src.PPM_UDFNUM05, 
                    src.PPM_UDFNUM06, 
                    src.PPM_UDFNUM07, 
                    src.PPM_UDFNUM08, 
                    src.PPM_UDFNUM09, 
                    src.PPM_UDFNUM10, 
                    src.PPM_UPDATECOUNT, 
                    src.PPM_WOCLASS, 
                    src.PPM_WOCLASS_ORG, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;