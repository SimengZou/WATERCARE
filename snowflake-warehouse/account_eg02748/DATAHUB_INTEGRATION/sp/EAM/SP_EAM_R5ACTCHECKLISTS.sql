create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5ACTCHECKLISTS()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5ACTCHECKLISTS_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5ACTCHECKLISTS as target using (SELECT * FROM (SELECT 
            strm.ACK_ACT, 
            strm.ACK_ADJUSTED, 
            strm.ACK_ASMLEVEL, 
            strm.ACK_ASPECT, 
            strm.ACK_CASETASK, 
            strm.ACK_CODE, 
            strm.ACK_COLOR, 
            strm.ACK_COMPLETED, 
            strm.ACK_COMPLEVEL, 
            strm.ACK_COMPLOCATION, 
            strm.ACK_CONDITION, 
            strm.ACK_CONDITION_AS_FOUND, 
            strm.ACK_DEFMAINT, 
            strm.ACK_DESC, 
            strm.ACK_DIRECTION, 
            strm.ACK_ENABLENONCONFORMITIES, 
            strm.ACK_ENTITYKEY, 
            strm.ACK_ENTITYORG, 
            strm.ACK_EVENT, 
            strm.ACK_FINALOCCURRENCE, 
            strm.ACK_FINDING, 
            strm.ACK_FOLLOWUP, 
            strm.ACK_FOLLOWUPACT, 
            strm.ACK_FOLLOWUPEVENT, 
            strm.ACK_FORMULA, 
            strm.ACK_FROMGEOREF, 
            strm.ACK_FROMJOBPLAN, 
            strm.ACK_FROMJOBPLANREV, 
            strm.ACK_FROMPOINT, 
            strm.ACK_FROMREFDESC, 
            strm.ACK_FROM_HORIZONTAL_OFFSET, 
            strm.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
            strm.ACK_FROM_HORIZONTAL_OFFSETUOM, 
            strm.ACK_FROM_LATITUDE, 
            strm.ACK_FROM_LONGITUDE, 
            strm.ACK_FROM_OFFSET, 
            strm.ACK_FROM_OFFSET_DIRECTION, 
            strm.ACK_FROM_OFFSET_PERCENTAGE, 
            strm.ACK_FROM_REFERENCE, 
            strm.ACK_FROM_RELATIONSHIP_TYPE, 
            strm.ACK_FROM_VERTICAL_OFFSET, 
            strm.ACK_FROM_VERTICAL_OFFSETTYPE, 
            strm.ACK_FROM_VERTICAL_OFFSETUOM, 
            strm.ACK_FROM_XCOORDINATE, 
            strm.ACK_FROM_YCOORDINATE, 
            strm.ACK_GOOD, 
            strm.ACK_GROUP_LABEL, 
            strm.ACK_HIDEFOLLOWUP, 
            strm.ACK_HIDELINEARFIELDS, 
            strm.ACK_JOB, 
            strm.ACK_LASTSAVED, 
            strm.ACK_LOTO, 
            strm.ACK_MATLIST, 
            strm.ACK_MAXSLIDERVALUE, 
            strm.ACK_MEASUREMENTRESP, 
            strm.ACK_METRICFRACTIONSLIDER, 
            strm.ACK_MINSLIDERVALUE, 
            strm.ACK_MOBILEDATEUPDATED, 
            strm.ACK_NO, 
            strm.ACK_NONCONFORMITY, 
            strm.ACK_NONCONFORMITYFOUND, 
            strm.ACK_NONCONFORMITYTYPE, 
            strm.ACK_NONCONFORMITYTYPE_ORG, 
            strm.ACK_NOTES, 
            strm.ACK_NOT_APPLICABLE, 
            strm.ACK_OBJECT, 
            strm.ACK_OBJECTLEVEL, 
            strm.ACK_OBJECT_ORG, 
            strm.ACK_OCCURRENCE, 
            strm.ACK_OK, 
            strm.ACK_PARENTKEY, 
            strm.ACK_PART, 
            strm.ACK_PARTCONDITION, 
            strm.ACK_PART_ORG, 
            strm.ACK_POINT, 
            strm.ACK_POINTTYPE, 
            strm.ACK_POOR, 
            strm.ACK_POSSIBLEFINDINGS, 
            strm.ACK_POSSIBLE_CONDS_AS_FOUND, 
            strm.ACK_POSSIBLE_DIRECTIONS, 
            strm.ACK_POSSIBLE_NA_OPTIONS, 
            strm.ACK_POSSIBLE_SEVERITIES, 
            strm.ACK_READING, 
            strm.ACK_REFERENCE, 
            strm.ACK_RELATIONSHIP_TYPE, 
            strm.ACK_RENTITY, 
            strm.ACK_REPAIRSNEEDED, 
            strm.ACK_REQUIREDTOCLOSE, 
            strm.ACK_RESOLUTION, 
            strm.ACK_RESPONSIBILITY, 
            strm.ACK_ROUTESEQUENCE, 
            strm.ACK_SEQUENCE, 
            strm.ACK_SEVERITY, 
            strm.ACK_SRCCALCULATEDVALUE, 
            strm.ACK_SYSLEVEL, 
            strm.ACK_TASK, 
            strm.ACK_TASKCHECKLISTCODE, 
            strm.ACK_TOGEOREF, 
            strm.ACK_TOLERANCECRNONCONFORMITY, 
            strm.ACK_TOLERANCESEVERITY, 
            strm.ACK_TOLERANCE_NCF_TYPE, 
            strm.ACK_TOLERANCE_NCF_TYPE_ORG, 
            strm.ACK_TOPOINT, 
            strm.ACK_TOREFDESC, 
            strm.ACK_TO_HORIZONTAL_OFFSET, 
            strm.ACK_TO_HORIZONTAL_OFFSETTYPE, 
            strm.ACK_TO_HORIZONTAL_OFFSETUOM, 
            strm.ACK_TO_LATITUDE, 
            strm.ACK_TO_LONGITUDE, 
            strm.ACK_TO_OFFSET, 
            strm.ACK_TO_OFFSET_DIRECTION, 
            strm.ACK_TO_OFFSET_PERCENTAGE, 
            strm.ACK_TO_REFERENCE, 
            strm.ACK_TO_RELATIONSHIP_TYPE, 
            strm.ACK_TO_VERTICAL_OFFSET, 
            strm.ACK_TO_VERTICAL_OFFSETTYPE, 
            strm.ACK_TO_VERTICAL_OFFSETUOM, 
            strm.ACK_TO_XCOORDINATE, 
            strm.ACK_TO_YCOORDINATE, 
            strm.ACK_TYPE, 
            strm.ACK_UOM, 
            strm.ACK_UPDATECOUNT, 
            strm.ACK_UPDATED, 
            strm.ACK_UPDATEDBY, 
            strm.ACK_VALUE, 
            strm.ACK_YES, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ACK_CODE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ACTCHECKLISTS as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ACK_CODE=src.ACK_CODE) OR (target.ACK_CODE IS NULL AND src.ACK_CODE IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.ACK_ACT=src.ACK_ACT, 
                    target.ACK_ADJUSTED=src.ACK_ADJUSTED, 
                    target.ACK_ASMLEVEL=src.ACK_ASMLEVEL, 
                    target.ACK_ASPECT=src.ACK_ASPECT, 
                    target.ACK_CASETASK=src.ACK_CASETASK, 
                    target.ACK_CODE=src.ACK_CODE, 
                    target.ACK_COLOR=src.ACK_COLOR, 
                    target.ACK_COMPLETED=src.ACK_COMPLETED, 
                    target.ACK_COMPLEVEL=src.ACK_COMPLEVEL, 
                    target.ACK_COMPLOCATION=src.ACK_COMPLOCATION, 
                    target.ACK_CONDITION=src.ACK_CONDITION, 
                    target.ACK_CONDITION_AS_FOUND=src.ACK_CONDITION_AS_FOUND, 
                    target.ACK_DEFMAINT=src.ACK_DEFMAINT, 
                    target.ACK_DESC=src.ACK_DESC, 
                    target.ACK_DIRECTION=src.ACK_DIRECTION, 
                    target.ACK_ENABLENONCONFORMITIES=src.ACK_ENABLENONCONFORMITIES, 
                    target.ACK_ENTITYKEY=src.ACK_ENTITYKEY, 
                    target.ACK_ENTITYORG=src.ACK_ENTITYORG, 
                    target.ACK_EVENT=src.ACK_EVENT, 
                    target.ACK_FINALOCCURRENCE=src.ACK_FINALOCCURRENCE, 
                    target.ACK_FINDING=src.ACK_FINDING, 
                    target.ACK_FOLLOWUP=src.ACK_FOLLOWUP, 
                    target.ACK_FOLLOWUPACT=src.ACK_FOLLOWUPACT, 
                    target.ACK_FOLLOWUPEVENT=src.ACK_FOLLOWUPEVENT, 
                    target.ACK_FORMULA=src.ACK_FORMULA, 
                    target.ACK_FROMGEOREF=src.ACK_FROMGEOREF, 
                    target.ACK_FROMJOBPLAN=src.ACK_FROMJOBPLAN, 
                    target.ACK_FROMJOBPLANREV=src.ACK_FROMJOBPLANREV, 
                    target.ACK_FROMPOINT=src.ACK_FROMPOINT, 
                    target.ACK_FROMREFDESC=src.ACK_FROMREFDESC, 
                    target.ACK_FROM_HORIZONTAL_OFFSET=src.ACK_FROM_HORIZONTAL_OFFSET, 
                    target.ACK_FROM_HORIZONTAL_OFFSETTYPE=src.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
                    target.ACK_FROM_HORIZONTAL_OFFSETUOM=src.ACK_FROM_HORIZONTAL_OFFSETUOM, 
                    target.ACK_FROM_LATITUDE=src.ACK_FROM_LATITUDE, 
                    target.ACK_FROM_LONGITUDE=src.ACK_FROM_LONGITUDE, 
                    target.ACK_FROM_OFFSET=src.ACK_FROM_OFFSET, 
                    target.ACK_FROM_OFFSET_DIRECTION=src.ACK_FROM_OFFSET_DIRECTION, 
                    target.ACK_FROM_OFFSET_PERCENTAGE=src.ACK_FROM_OFFSET_PERCENTAGE, 
                    target.ACK_FROM_REFERENCE=src.ACK_FROM_REFERENCE, 
                    target.ACK_FROM_RELATIONSHIP_TYPE=src.ACK_FROM_RELATIONSHIP_TYPE, 
                    target.ACK_FROM_VERTICAL_OFFSET=src.ACK_FROM_VERTICAL_OFFSET, 
                    target.ACK_FROM_VERTICAL_OFFSETTYPE=src.ACK_FROM_VERTICAL_OFFSETTYPE, 
                    target.ACK_FROM_VERTICAL_OFFSETUOM=src.ACK_FROM_VERTICAL_OFFSETUOM, 
                    target.ACK_FROM_XCOORDINATE=src.ACK_FROM_XCOORDINATE, 
                    target.ACK_FROM_YCOORDINATE=src.ACK_FROM_YCOORDINATE, 
                    target.ACK_GOOD=src.ACK_GOOD, 
                    target.ACK_GROUP_LABEL=src.ACK_GROUP_LABEL, 
                    target.ACK_HIDEFOLLOWUP=src.ACK_HIDEFOLLOWUP, 
                    target.ACK_HIDELINEARFIELDS=src.ACK_HIDELINEARFIELDS, 
                    target.ACK_JOB=src.ACK_JOB, 
                    target.ACK_LASTSAVED=src.ACK_LASTSAVED, 
                    target.ACK_LOTO=src.ACK_LOTO, 
                    target.ACK_MATLIST=src.ACK_MATLIST, 
                    target.ACK_MAXSLIDERVALUE=src.ACK_MAXSLIDERVALUE, 
                    target.ACK_MEASUREMENTRESP=src.ACK_MEASUREMENTRESP, 
                    target.ACK_METRICFRACTIONSLIDER=src.ACK_METRICFRACTIONSLIDER, 
                    target.ACK_MINSLIDERVALUE=src.ACK_MINSLIDERVALUE, 
                    target.ACK_MOBILEDATEUPDATED=src.ACK_MOBILEDATEUPDATED, 
                    target.ACK_NO=src.ACK_NO, 
                    target.ACK_NONCONFORMITY=src.ACK_NONCONFORMITY, 
                    target.ACK_NONCONFORMITYFOUND=src.ACK_NONCONFORMITYFOUND, 
                    target.ACK_NONCONFORMITYTYPE=src.ACK_NONCONFORMITYTYPE, 
                    target.ACK_NONCONFORMITYTYPE_ORG=src.ACK_NONCONFORMITYTYPE_ORG, 
                    target.ACK_NOTES=src.ACK_NOTES, 
                    target.ACK_NOT_APPLICABLE=src.ACK_NOT_APPLICABLE, 
                    target.ACK_OBJECT=src.ACK_OBJECT, 
                    target.ACK_OBJECTLEVEL=src.ACK_OBJECTLEVEL, 
                    target.ACK_OBJECT_ORG=src.ACK_OBJECT_ORG, 
                    target.ACK_OCCURRENCE=src.ACK_OCCURRENCE, 
                    target.ACK_OK=src.ACK_OK, 
                    target.ACK_PARENTKEY=src.ACK_PARENTKEY, 
                    target.ACK_PART=src.ACK_PART, 
                    target.ACK_PARTCONDITION=src.ACK_PARTCONDITION, 
                    target.ACK_PART_ORG=src.ACK_PART_ORG, 
                    target.ACK_POINT=src.ACK_POINT, 
                    target.ACK_POINTTYPE=src.ACK_POINTTYPE, 
                    target.ACK_POOR=src.ACK_POOR, 
                    target.ACK_POSSIBLEFINDINGS=src.ACK_POSSIBLEFINDINGS, 
                    target.ACK_POSSIBLE_CONDS_AS_FOUND=src.ACK_POSSIBLE_CONDS_AS_FOUND, 
                    target.ACK_POSSIBLE_DIRECTIONS=src.ACK_POSSIBLE_DIRECTIONS, 
                    target.ACK_POSSIBLE_NA_OPTIONS=src.ACK_POSSIBLE_NA_OPTIONS, 
                    target.ACK_POSSIBLE_SEVERITIES=src.ACK_POSSIBLE_SEVERITIES, 
                    target.ACK_READING=src.ACK_READING, 
                    target.ACK_REFERENCE=src.ACK_REFERENCE, 
                    target.ACK_RELATIONSHIP_TYPE=src.ACK_RELATIONSHIP_TYPE, 
                    target.ACK_RENTITY=src.ACK_RENTITY, 
                    target.ACK_REPAIRSNEEDED=src.ACK_REPAIRSNEEDED, 
                    target.ACK_REQUIREDTOCLOSE=src.ACK_REQUIREDTOCLOSE, 
                    target.ACK_RESOLUTION=src.ACK_RESOLUTION, 
                    target.ACK_RESPONSIBILITY=src.ACK_RESPONSIBILITY, 
                    target.ACK_ROUTESEQUENCE=src.ACK_ROUTESEQUENCE, 
                    target.ACK_SEQUENCE=src.ACK_SEQUENCE, 
                    target.ACK_SEVERITY=src.ACK_SEVERITY, 
                    target.ACK_SRCCALCULATEDVALUE=src.ACK_SRCCALCULATEDVALUE, 
                    target.ACK_SYSLEVEL=src.ACK_SYSLEVEL, 
                    target.ACK_TASK=src.ACK_TASK, 
                    target.ACK_TASKCHECKLISTCODE=src.ACK_TASKCHECKLISTCODE, 
                    target.ACK_TOGEOREF=src.ACK_TOGEOREF, 
                    target.ACK_TOLERANCECRNONCONFORMITY=src.ACK_TOLERANCECRNONCONFORMITY, 
                    target.ACK_TOLERANCESEVERITY=src.ACK_TOLERANCESEVERITY, 
                    target.ACK_TOLERANCE_NCF_TYPE=src.ACK_TOLERANCE_NCF_TYPE, 
                    target.ACK_TOLERANCE_NCF_TYPE_ORG=src.ACK_TOLERANCE_NCF_TYPE_ORG, 
                    target.ACK_TOPOINT=src.ACK_TOPOINT, 
                    target.ACK_TOREFDESC=src.ACK_TOREFDESC, 
                    target.ACK_TO_HORIZONTAL_OFFSET=src.ACK_TO_HORIZONTAL_OFFSET, 
                    target.ACK_TO_HORIZONTAL_OFFSETTYPE=src.ACK_TO_HORIZONTAL_OFFSETTYPE, 
                    target.ACK_TO_HORIZONTAL_OFFSETUOM=src.ACK_TO_HORIZONTAL_OFFSETUOM, 
                    target.ACK_TO_LATITUDE=src.ACK_TO_LATITUDE, 
                    target.ACK_TO_LONGITUDE=src.ACK_TO_LONGITUDE, 
                    target.ACK_TO_OFFSET=src.ACK_TO_OFFSET, 
                    target.ACK_TO_OFFSET_DIRECTION=src.ACK_TO_OFFSET_DIRECTION, 
                    target.ACK_TO_OFFSET_PERCENTAGE=src.ACK_TO_OFFSET_PERCENTAGE, 
                    target.ACK_TO_REFERENCE=src.ACK_TO_REFERENCE, 
                    target.ACK_TO_RELATIONSHIP_TYPE=src.ACK_TO_RELATIONSHIP_TYPE, 
                    target.ACK_TO_VERTICAL_OFFSET=src.ACK_TO_VERTICAL_OFFSET, 
                    target.ACK_TO_VERTICAL_OFFSETTYPE=src.ACK_TO_VERTICAL_OFFSETTYPE, 
                    target.ACK_TO_VERTICAL_OFFSETUOM=src.ACK_TO_VERTICAL_OFFSETUOM, 
                    target.ACK_TO_XCOORDINATE=src.ACK_TO_XCOORDINATE, 
                    target.ACK_TO_YCOORDINATE=src.ACK_TO_YCOORDINATE, 
                    target.ACK_TYPE=src.ACK_TYPE, 
                    target.ACK_UOM=src.ACK_UOM, 
                    target.ACK_UPDATECOUNT=src.ACK_UPDATECOUNT, 
                    target.ACK_UPDATED=src.ACK_UPDATED, 
                    target.ACK_UPDATEDBY=src.ACK_UPDATEDBY, 
                    target.ACK_VALUE=src.ACK_VALUE, 
                    target.ACK_YES=src.ACK_YES, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    ACK_ACT, 
                    ACK_ADJUSTED, 
                    ACK_ASMLEVEL, 
                    ACK_ASPECT, 
                    ACK_CASETASK, 
                    ACK_CODE, 
                    ACK_COLOR, 
                    ACK_COMPLETED, 
                    ACK_COMPLEVEL, 
                    ACK_COMPLOCATION, 
                    ACK_CONDITION, 
                    ACK_CONDITION_AS_FOUND, 
                    ACK_DEFMAINT, 
                    ACK_DESC, 
                    ACK_DIRECTION, 
                    ACK_ENABLENONCONFORMITIES, 
                    ACK_ENTITYKEY, 
                    ACK_ENTITYORG, 
                    ACK_EVENT, 
                    ACK_FINALOCCURRENCE, 
                    ACK_FINDING, 
                    ACK_FOLLOWUP, 
                    ACK_FOLLOWUPACT, 
                    ACK_FOLLOWUPEVENT, 
                    ACK_FORMULA, 
                    ACK_FROMGEOREF, 
                    ACK_FROMJOBPLAN, 
                    ACK_FROMJOBPLANREV, 
                    ACK_FROMPOINT, 
                    ACK_FROMREFDESC, 
                    ACK_FROM_HORIZONTAL_OFFSET, 
                    ACK_FROM_HORIZONTAL_OFFSETTYPE, 
                    ACK_FROM_HORIZONTAL_OFFSETUOM, 
                    ACK_FROM_LATITUDE, 
                    ACK_FROM_LONGITUDE, 
                    ACK_FROM_OFFSET, 
                    ACK_FROM_OFFSET_DIRECTION, 
                    ACK_FROM_OFFSET_PERCENTAGE, 
                    ACK_FROM_REFERENCE, 
                    ACK_FROM_RELATIONSHIP_TYPE, 
                    ACK_FROM_VERTICAL_OFFSET, 
                    ACK_FROM_VERTICAL_OFFSETTYPE, 
                    ACK_FROM_VERTICAL_OFFSETUOM, 
                    ACK_FROM_XCOORDINATE, 
                    ACK_FROM_YCOORDINATE, 
                    ACK_GOOD, 
                    ACK_GROUP_LABEL, 
                    ACK_HIDEFOLLOWUP, 
                    ACK_HIDELINEARFIELDS, 
                    ACK_JOB, 
                    ACK_LASTSAVED, 
                    ACK_LOTO, 
                    ACK_MATLIST, 
                    ACK_MAXSLIDERVALUE, 
                    ACK_MEASUREMENTRESP, 
                    ACK_METRICFRACTIONSLIDER, 
                    ACK_MINSLIDERVALUE, 
                    ACK_MOBILEDATEUPDATED, 
                    ACK_NO, 
                    ACK_NONCONFORMITY, 
                    ACK_NONCONFORMITYFOUND, 
                    ACK_NONCONFORMITYTYPE, 
                    ACK_NONCONFORMITYTYPE_ORG, 
                    ACK_NOTES, 
                    ACK_NOT_APPLICABLE, 
                    ACK_OBJECT, 
                    ACK_OBJECTLEVEL, 
                    ACK_OBJECT_ORG, 
                    ACK_OCCURRENCE, 
                    ACK_OK, 
                    ACK_PARENTKEY, 
                    ACK_PART, 
                    ACK_PARTCONDITION, 
                    ACK_PART_ORG, 
                    ACK_POINT, 
                    ACK_POINTTYPE, 
                    ACK_POOR, 
                    ACK_POSSIBLEFINDINGS, 
                    ACK_POSSIBLE_CONDS_AS_FOUND, 
                    ACK_POSSIBLE_DIRECTIONS, 
                    ACK_POSSIBLE_NA_OPTIONS, 
                    ACK_POSSIBLE_SEVERITIES, 
                    ACK_READING, 
                    ACK_REFERENCE, 
                    ACK_RELATIONSHIP_TYPE, 
                    ACK_RENTITY, 
                    ACK_REPAIRSNEEDED, 
                    ACK_REQUIREDTOCLOSE, 
                    ACK_RESOLUTION, 
                    ACK_RESPONSIBILITY, 
                    ACK_ROUTESEQUENCE, 
                    ACK_SEQUENCE, 
                    ACK_SEVERITY, 
                    ACK_SRCCALCULATEDVALUE, 
                    ACK_SYSLEVEL, 
                    ACK_TASK, 
                    ACK_TASKCHECKLISTCODE, 
                    ACK_TOGEOREF, 
                    ACK_TOLERANCECRNONCONFORMITY, 
                    ACK_TOLERANCESEVERITY, 
                    ACK_TOLERANCE_NCF_TYPE, 
                    ACK_TOLERANCE_NCF_TYPE_ORG, 
                    ACK_TOPOINT, 
                    ACK_TOREFDESC, 
                    ACK_TO_HORIZONTAL_OFFSET, 
                    ACK_TO_HORIZONTAL_OFFSETTYPE, 
                    ACK_TO_HORIZONTAL_OFFSETUOM, 
                    ACK_TO_LATITUDE, 
                    ACK_TO_LONGITUDE, 
                    ACK_TO_OFFSET, 
                    ACK_TO_OFFSET_DIRECTION, 
                    ACK_TO_OFFSET_PERCENTAGE, 
                    ACK_TO_REFERENCE, 
                    ACK_TO_RELATIONSHIP_TYPE, 
                    ACK_TO_VERTICAL_OFFSET, 
                    ACK_TO_VERTICAL_OFFSETTYPE, 
                    ACK_TO_VERTICAL_OFFSETUOM, 
                    ACK_TO_XCOORDINATE, 
                    ACK_TO_YCOORDINATE, 
                    ACK_TYPE, 
                    ACK_UOM, 
                    ACK_UPDATECOUNT, 
                    ACK_UPDATED, 
                    ACK_UPDATEDBY, 
                    ACK_VALUE, 
                    ACK_YES, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.ACK_ACT, 
                    src.ACK_ADJUSTED, 
                    src.ACK_ASMLEVEL, 
                    src.ACK_ASPECT, 
                    src.ACK_CASETASK, 
                    src.ACK_CODE, 
                    src.ACK_COLOR, 
                    src.ACK_COMPLETED, 
                    src.ACK_COMPLEVEL, 
                    src.ACK_COMPLOCATION, 
                    src.ACK_CONDITION, 
                    src.ACK_CONDITION_AS_FOUND, 
                    src.ACK_DEFMAINT, 
                    src.ACK_DESC, 
                    src.ACK_DIRECTION, 
                    src.ACK_ENABLENONCONFORMITIES, 
                    src.ACK_ENTITYKEY, 
                    src.ACK_ENTITYORG, 
                    src.ACK_EVENT, 
                    src.ACK_FINALOCCURRENCE, 
                    src.ACK_FINDING, 
                    src.ACK_FOLLOWUP, 
                    src.ACK_FOLLOWUPACT, 
                    src.ACK_FOLLOWUPEVENT, 
                    src.ACK_FORMULA, 
                    src.ACK_FROMGEOREF, 
                    src.ACK_FROMJOBPLAN, 
                    src.ACK_FROMJOBPLANREV, 
                    src.ACK_FROMPOINT, 
                    src.ACK_FROMREFDESC, 
                    src.ACK_FROM_HORIZONTAL_OFFSET, 
                    src.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
                    src.ACK_FROM_HORIZONTAL_OFFSETUOM, 
                    src.ACK_FROM_LATITUDE, 
                    src.ACK_FROM_LONGITUDE, 
                    src.ACK_FROM_OFFSET, 
                    src.ACK_FROM_OFFSET_DIRECTION, 
                    src.ACK_FROM_OFFSET_PERCENTAGE, 
                    src.ACK_FROM_REFERENCE, 
                    src.ACK_FROM_RELATIONSHIP_TYPE, 
                    src.ACK_FROM_VERTICAL_OFFSET, 
                    src.ACK_FROM_VERTICAL_OFFSETTYPE, 
                    src.ACK_FROM_VERTICAL_OFFSETUOM, 
                    src.ACK_FROM_XCOORDINATE, 
                    src.ACK_FROM_YCOORDINATE, 
                    src.ACK_GOOD, 
                    src.ACK_GROUP_LABEL, 
                    src.ACK_HIDEFOLLOWUP, 
                    src.ACK_HIDELINEARFIELDS, 
                    src.ACK_JOB, 
                    src.ACK_LASTSAVED, 
                    src.ACK_LOTO, 
                    src.ACK_MATLIST, 
                    src.ACK_MAXSLIDERVALUE, 
                    src.ACK_MEASUREMENTRESP, 
                    src.ACK_METRICFRACTIONSLIDER, 
                    src.ACK_MINSLIDERVALUE, 
                    src.ACK_MOBILEDATEUPDATED, 
                    src.ACK_NO, 
                    src.ACK_NONCONFORMITY, 
                    src.ACK_NONCONFORMITYFOUND, 
                    src.ACK_NONCONFORMITYTYPE, 
                    src.ACK_NONCONFORMITYTYPE_ORG, 
                    src.ACK_NOTES, 
                    src.ACK_NOT_APPLICABLE, 
                    src.ACK_OBJECT, 
                    src.ACK_OBJECTLEVEL, 
                    src.ACK_OBJECT_ORG, 
                    src.ACK_OCCURRENCE, 
                    src.ACK_OK, 
                    src.ACK_PARENTKEY, 
                    src.ACK_PART, 
                    src.ACK_PARTCONDITION, 
                    src.ACK_PART_ORG, 
                    src.ACK_POINT, 
                    src.ACK_POINTTYPE, 
                    src.ACK_POOR, 
                    src.ACK_POSSIBLEFINDINGS, 
                    src.ACK_POSSIBLE_CONDS_AS_FOUND, 
                    src.ACK_POSSIBLE_DIRECTIONS, 
                    src.ACK_POSSIBLE_NA_OPTIONS, 
                    src.ACK_POSSIBLE_SEVERITIES, 
                    src.ACK_READING, 
                    src.ACK_REFERENCE, 
                    src.ACK_RELATIONSHIP_TYPE, 
                    src.ACK_RENTITY, 
                    src.ACK_REPAIRSNEEDED, 
                    src.ACK_REQUIREDTOCLOSE, 
                    src.ACK_RESOLUTION, 
                    src.ACK_RESPONSIBILITY, 
                    src.ACK_ROUTESEQUENCE, 
                    src.ACK_SEQUENCE, 
                    src.ACK_SEVERITY, 
                    src.ACK_SRCCALCULATEDVALUE, 
                    src.ACK_SYSLEVEL, 
                    src.ACK_TASK, 
                    src.ACK_TASKCHECKLISTCODE, 
                    src.ACK_TOGEOREF, 
                    src.ACK_TOLERANCECRNONCONFORMITY, 
                    src.ACK_TOLERANCESEVERITY, 
                    src.ACK_TOLERANCE_NCF_TYPE, 
                    src.ACK_TOLERANCE_NCF_TYPE_ORG, 
                    src.ACK_TOPOINT, 
                    src.ACK_TOREFDESC, 
                    src.ACK_TO_HORIZONTAL_OFFSET, 
                    src.ACK_TO_HORIZONTAL_OFFSETTYPE, 
                    src.ACK_TO_HORIZONTAL_OFFSETUOM, 
                    src.ACK_TO_LATITUDE, 
                    src.ACK_TO_LONGITUDE, 
                    src.ACK_TO_OFFSET, 
                    src.ACK_TO_OFFSET_DIRECTION, 
                    src.ACK_TO_OFFSET_PERCENTAGE, 
                    src.ACK_TO_REFERENCE, 
                    src.ACK_TO_RELATIONSHIP_TYPE, 
                    src.ACK_TO_VERTICAL_OFFSET, 
                    src.ACK_TO_VERTICAL_OFFSETTYPE, 
                    src.ACK_TO_VERTICAL_OFFSETUOM, 
                    src.ACK_TO_XCOORDINATE, 
                    src.ACK_TO_YCOORDINATE, 
                    src.ACK_TYPE, 
                    src.ACK_UOM, 
                    src.ACK_UPDATECOUNT, 
                    src.ACK_UPDATED, 
                    src.ACK_UPDATEDBY, 
                    src.ACK_VALUE, 
                    src.ACK_YES, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5ACTCHECKLISTS_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.ACK_ACT, 
            strm.ACK_ADJUSTED, 
            strm.ACK_ASMLEVEL, 
            strm.ACK_ASPECT, 
            strm.ACK_CASETASK, 
            strm.ACK_CODE, 
            strm.ACK_COLOR, 
            strm.ACK_COMPLETED, 
            strm.ACK_COMPLEVEL, 
            strm.ACK_COMPLOCATION, 
            strm.ACK_CONDITION, 
            strm.ACK_CONDITION_AS_FOUND, 
            strm.ACK_DEFMAINT, 
            strm.ACK_DESC, 
            strm.ACK_DIRECTION, 
            strm.ACK_ENABLENONCONFORMITIES, 
            strm.ACK_ENTITYKEY, 
            strm.ACK_ENTITYORG, 
            strm.ACK_EVENT, 
            strm.ACK_FINALOCCURRENCE, 
            strm.ACK_FINDING, 
            strm.ACK_FOLLOWUP, 
            strm.ACK_FOLLOWUPACT, 
            strm.ACK_FOLLOWUPEVENT, 
            strm.ACK_FORMULA, 
            strm.ACK_FROMGEOREF, 
            strm.ACK_FROMJOBPLAN, 
            strm.ACK_FROMJOBPLANREV, 
            strm.ACK_FROMPOINT, 
            strm.ACK_FROMREFDESC, 
            strm.ACK_FROM_HORIZONTAL_OFFSET, 
            strm.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
            strm.ACK_FROM_HORIZONTAL_OFFSETUOM, 
            strm.ACK_FROM_LATITUDE, 
            strm.ACK_FROM_LONGITUDE, 
            strm.ACK_FROM_OFFSET, 
            strm.ACK_FROM_OFFSET_DIRECTION, 
            strm.ACK_FROM_OFFSET_PERCENTAGE, 
            strm.ACK_FROM_REFERENCE, 
            strm.ACK_FROM_RELATIONSHIP_TYPE, 
            strm.ACK_FROM_VERTICAL_OFFSET, 
            strm.ACK_FROM_VERTICAL_OFFSETTYPE, 
            strm.ACK_FROM_VERTICAL_OFFSETUOM, 
            strm.ACK_FROM_XCOORDINATE, 
            strm.ACK_FROM_YCOORDINATE, 
            strm.ACK_GOOD, 
            strm.ACK_GROUP_LABEL, 
            strm.ACK_HIDEFOLLOWUP, 
            strm.ACK_HIDELINEARFIELDS, 
            strm.ACK_JOB, 
            strm.ACK_LASTSAVED, 
            strm.ACK_LOTO, 
            strm.ACK_MATLIST, 
            strm.ACK_MAXSLIDERVALUE, 
            strm.ACK_MEASUREMENTRESP, 
            strm.ACK_METRICFRACTIONSLIDER, 
            strm.ACK_MINSLIDERVALUE, 
            strm.ACK_MOBILEDATEUPDATED, 
            strm.ACK_NO, 
            strm.ACK_NONCONFORMITY, 
            strm.ACK_NONCONFORMITYFOUND, 
            strm.ACK_NONCONFORMITYTYPE, 
            strm.ACK_NONCONFORMITYTYPE_ORG, 
            strm.ACK_NOTES, 
            strm.ACK_NOT_APPLICABLE, 
            strm.ACK_OBJECT, 
            strm.ACK_OBJECTLEVEL, 
            strm.ACK_OBJECT_ORG, 
            strm.ACK_OCCURRENCE, 
            strm.ACK_OK, 
            strm.ACK_PARENTKEY, 
            strm.ACK_PART, 
            strm.ACK_PARTCONDITION, 
            strm.ACK_PART_ORG, 
            strm.ACK_POINT, 
            strm.ACK_POINTTYPE, 
            strm.ACK_POOR, 
            strm.ACK_POSSIBLEFINDINGS, 
            strm.ACK_POSSIBLE_CONDS_AS_FOUND, 
            strm.ACK_POSSIBLE_DIRECTIONS, 
            strm.ACK_POSSIBLE_NA_OPTIONS, 
            strm.ACK_POSSIBLE_SEVERITIES, 
            strm.ACK_READING, 
            strm.ACK_REFERENCE, 
            strm.ACK_RELATIONSHIP_TYPE, 
            strm.ACK_RENTITY, 
            strm.ACK_REPAIRSNEEDED, 
            strm.ACK_REQUIREDTOCLOSE, 
            strm.ACK_RESOLUTION, 
            strm.ACK_RESPONSIBILITY, 
            strm.ACK_ROUTESEQUENCE, 
            strm.ACK_SEQUENCE, 
            strm.ACK_SEVERITY, 
            strm.ACK_SRCCALCULATEDVALUE, 
            strm.ACK_SYSLEVEL, 
            strm.ACK_TASK, 
            strm.ACK_TASKCHECKLISTCODE, 
            strm.ACK_TOGEOREF, 
            strm.ACK_TOLERANCECRNONCONFORMITY, 
            strm.ACK_TOLERANCESEVERITY, 
            strm.ACK_TOLERANCE_NCF_TYPE, 
            strm.ACK_TOLERANCE_NCF_TYPE_ORG, 
            strm.ACK_TOPOINT, 
            strm.ACK_TOREFDESC, 
            strm.ACK_TO_HORIZONTAL_OFFSET, 
            strm.ACK_TO_HORIZONTAL_OFFSETTYPE, 
            strm.ACK_TO_HORIZONTAL_OFFSETUOM, 
            strm.ACK_TO_LATITUDE, 
            strm.ACK_TO_LONGITUDE, 
            strm.ACK_TO_OFFSET, 
            strm.ACK_TO_OFFSET_DIRECTION, 
            strm.ACK_TO_OFFSET_PERCENTAGE, 
            strm.ACK_TO_REFERENCE, 
            strm.ACK_TO_RELATIONSHIP_TYPE, 
            strm.ACK_TO_VERTICAL_OFFSET, 
            strm.ACK_TO_VERTICAL_OFFSETTYPE, 
            strm.ACK_TO_VERTICAL_OFFSETUOM, 
            strm.ACK_TO_XCOORDINATE, 
            strm.ACK_TO_YCOORDINATE, 
            strm.ACK_TYPE, 
            strm.ACK_UOM, 
            strm.ACK_UPDATECOUNT, 
            strm.ACK_UPDATED, 
            strm.ACK_UPDATEDBY, 
            strm.ACK_VALUE, 
            strm.ACK_YES, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ACK_CODE ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5ACTCHECKLISTS as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ACK_CODE=src.ACK_CODE) OR (target.ACK_CODE IS NULL AND src.ACK_CODE IS NULL)) 
                when matched then update set
                    target.ACK_ACT=src.ACK_ACT, 
                    target.ACK_ADJUSTED=src.ACK_ADJUSTED, 
                    target.ACK_ASMLEVEL=src.ACK_ASMLEVEL, 
                    target.ACK_ASPECT=src.ACK_ASPECT, 
                    target.ACK_CASETASK=src.ACK_CASETASK, 
                    target.ACK_CODE=src.ACK_CODE, 
                    target.ACK_COLOR=src.ACK_COLOR, 
                    target.ACK_COMPLETED=src.ACK_COMPLETED, 
                    target.ACK_COMPLEVEL=src.ACK_COMPLEVEL, 
                    target.ACK_COMPLOCATION=src.ACK_COMPLOCATION, 
                    target.ACK_CONDITION=src.ACK_CONDITION, 
                    target.ACK_CONDITION_AS_FOUND=src.ACK_CONDITION_AS_FOUND, 
                    target.ACK_DEFMAINT=src.ACK_DEFMAINT, 
                    target.ACK_DESC=src.ACK_DESC, 
                    target.ACK_DIRECTION=src.ACK_DIRECTION, 
                    target.ACK_ENABLENONCONFORMITIES=src.ACK_ENABLENONCONFORMITIES, 
                    target.ACK_ENTITYKEY=src.ACK_ENTITYKEY, 
                    target.ACK_ENTITYORG=src.ACK_ENTITYORG, 
                    target.ACK_EVENT=src.ACK_EVENT, 
                    target.ACK_FINALOCCURRENCE=src.ACK_FINALOCCURRENCE, 
                    target.ACK_FINDING=src.ACK_FINDING, 
                    target.ACK_FOLLOWUP=src.ACK_FOLLOWUP, 
                    target.ACK_FOLLOWUPACT=src.ACK_FOLLOWUPACT, 
                    target.ACK_FOLLOWUPEVENT=src.ACK_FOLLOWUPEVENT, 
                    target.ACK_FORMULA=src.ACK_FORMULA, 
                    target.ACK_FROMGEOREF=src.ACK_FROMGEOREF, 
                    target.ACK_FROMJOBPLAN=src.ACK_FROMJOBPLAN, 
                    target.ACK_FROMJOBPLANREV=src.ACK_FROMJOBPLANREV, 
                    target.ACK_FROMPOINT=src.ACK_FROMPOINT, 
                    target.ACK_FROMREFDESC=src.ACK_FROMREFDESC, 
                    target.ACK_FROM_HORIZONTAL_OFFSET=src.ACK_FROM_HORIZONTAL_OFFSET, 
                    target.ACK_FROM_HORIZONTAL_OFFSETTYPE=src.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
                    target.ACK_FROM_HORIZONTAL_OFFSETUOM=src.ACK_FROM_HORIZONTAL_OFFSETUOM, 
                    target.ACK_FROM_LATITUDE=src.ACK_FROM_LATITUDE, 
                    target.ACK_FROM_LONGITUDE=src.ACK_FROM_LONGITUDE, 
                    target.ACK_FROM_OFFSET=src.ACK_FROM_OFFSET, 
                    target.ACK_FROM_OFFSET_DIRECTION=src.ACK_FROM_OFFSET_DIRECTION, 
                    target.ACK_FROM_OFFSET_PERCENTAGE=src.ACK_FROM_OFFSET_PERCENTAGE, 
                    target.ACK_FROM_REFERENCE=src.ACK_FROM_REFERENCE, 
                    target.ACK_FROM_RELATIONSHIP_TYPE=src.ACK_FROM_RELATIONSHIP_TYPE, 
                    target.ACK_FROM_VERTICAL_OFFSET=src.ACK_FROM_VERTICAL_OFFSET, 
                    target.ACK_FROM_VERTICAL_OFFSETTYPE=src.ACK_FROM_VERTICAL_OFFSETTYPE, 
                    target.ACK_FROM_VERTICAL_OFFSETUOM=src.ACK_FROM_VERTICAL_OFFSETUOM, 
                    target.ACK_FROM_XCOORDINATE=src.ACK_FROM_XCOORDINATE, 
                    target.ACK_FROM_YCOORDINATE=src.ACK_FROM_YCOORDINATE, 
                    target.ACK_GOOD=src.ACK_GOOD, 
                    target.ACK_GROUP_LABEL=src.ACK_GROUP_LABEL, 
                    target.ACK_HIDEFOLLOWUP=src.ACK_HIDEFOLLOWUP, 
                    target.ACK_HIDELINEARFIELDS=src.ACK_HIDELINEARFIELDS, 
                    target.ACK_JOB=src.ACK_JOB, 
                    target.ACK_LASTSAVED=src.ACK_LASTSAVED, 
                    target.ACK_LOTO=src.ACK_LOTO, 
                    target.ACK_MATLIST=src.ACK_MATLIST, 
                    target.ACK_MAXSLIDERVALUE=src.ACK_MAXSLIDERVALUE, 
                    target.ACK_MEASUREMENTRESP=src.ACK_MEASUREMENTRESP, 
                    target.ACK_METRICFRACTIONSLIDER=src.ACK_METRICFRACTIONSLIDER, 
                    target.ACK_MINSLIDERVALUE=src.ACK_MINSLIDERVALUE, 
                    target.ACK_MOBILEDATEUPDATED=src.ACK_MOBILEDATEUPDATED, 
                    target.ACK_NO=src.ACK_NO, 
                    target.ACK_NONCONFORMITY=src.ACK_NONCONFORMITY, 
                    target.ACK_NONCONFORMITYFOUND=src.ACK_NONCONFORMITYFOUND, 
                    target.ACK_NONCONFORMITYTYPE=src.ACK_NONCONFORMITYTYPE, 
                    target.ACK_NONCONFORMITYTYPE_ORG=src.ACK_NONCONFORMITYTYPE_ORG, 
                    target.ACK_NOTES=src.ACK_NOTES, 
                    target.ACK_NOT_APPLICABLE=src.ACK_NOT_APPLICABLE, 
                    target.ACK_OBJECT=src.ACK_OBJECT, 
                    target.ACK_OBJECTLEVEL=src.ACK_OBJECTLEVEL, 
                    target.ACK_OBJECT_ORG=src.ACK_OBJECT_ORG, 
                    target.ACK_OCCURRENCE=src.ACK_OCCURRENCE, 
                    target.ACK_OK=src.ACK_OK, 
                    target.ACK_PARENTKEY=src.ACK_PARENTKEY, 
                    target.ACK_PART=src.ACK_PART, 
                    target.ACK_PARTCONDITION=src.ACK_PARTCONDITION, 
                    target.ACK_PART_ORG=src.ACK_PART_ORG, 
                    target.ACK_POINT=src.ACK_POINT, 
                    target.ACK_POINTTYPE=src.ACK_POINTTYPE, 
                    target.ACK_POOR=src.ACK_POOR, 
                    target.ACK_POSSIBLEFINDINGS=src.ACK_POSSIBLEFINDINGS, 
                    target.ACK_POSSIBLE_CONDS_AS_FOUND=src.ACK_POSSIBLE_CONDS_AS_FOUND, 
                    target.ACK_POSSIBLE_DIRECTIONS=src.ACK_POSSIBLE_DIRECTIONS, 
                    target.ACK_POSSIBLE_NA_OPTIONS=src.ACK_POSSIBLE_NA_OPTIONS, 
                    target.ACK_POSSIBLE_SEVERITIES=src.ACK_POSSIBLE_SEVERITIES, 
                    target.ACK_READING=src.ACK_READING, 
                    target.ACK_REFERENCE=src.ACK_REFERENCE, 
                    target.ACK_RELATIONSHIP_TYPE=src.ACK_RELATIONSHIP_TYPE, 
                    target.ACK_RENTITY=src.ACK_RENTITY, 
                    target.ACK_REPAIRSNEEDED=src.ACK_REPAIRSNEEDED, 
                    target.ACK_REQUIREDTOCLOSE=src.ACK_REQUIREDTOCLOSE, 
                    target.ACK_RESOLUTION=src.ACK_RESOLUTION, 
                    target.ACK_RESPONSIBILITY=src.ACK_RESPONSIBILITY, 
                    target.ACK_ROUTESEQUENCE=src.ACK_ROUTESEQUENCE, 
                    target.ACK_SEQUENCE=src.ACK_SEQUENCE, 
                    target.ACK_SEVERITY=src.ACK_SEVERITY, 
                    target.ACK_SRCCALCULATEDVALUE=src.ACK_SRCCALCULATEDVALUE, 
                    target.ACK_SYSLEVEL=src.ACK_SYSLEVEL, 
                    target.ACK_TASK=src.ACK_TASK, 
                    target.ACK_TASKCHECKLISTCODE=src.ACK_TASKCHECKLISTCODE, 
                    target.ACK_TOGEOREF=src.ACK_TOGEOREF, 
                    target.ACK_TOLERANCECRNONCONFORMITY=src.ACK_TOLERANCECRNONCONFORMITY, 
                    target.ACK_TOLERANCESEVERITY=src.ACK_TOLERANCESEVERITY, 
                    target.ACK_TOLERANCE_NCF_TYPE=src.ACK_TOLERANCE_NCF_TYPE, 
                    target.ACK_TOLERANCE_NCF_TYPE_ORG=src.ACK_TOLERANCE_NCF_TYPE_ORG, 
                    target.ACK_TOPOINT=src.ACK_TOPOINT, 
                    target.ACK_TOREFDESC=src.ACK_TOREFDESC, 
                    target.ACK_TO_HORIZONTAL_OFFSET=src.ACK_TO_HORIZONTAL_OFFSET, 
                    target.ACK_TO_HORIZONTAL_OFFSETTYPE=src.ACK_TO_HORIZONTAL_OFFSETTYPE, 
                    target.ACK_TO_HORIZONTAL_OFFSETUOM=src.ACK_TO_HORIZONTAL_OFFSETUOM, 
                    target.ACK_TO_LATITUDE=src.ACK_TO_LATITUDE, 
                    target.ACK_TO_LONGITUDE=src.ACK_TO_LONGITUDE, 
                    target.ACK_TO_OFFSET=src.ACK_TO_OFFSET, 
                    target.ACK_TO_OFFSET_DIRECTION=src.ACK_TO_OFFSET_DIRECTION, 
                    target.ACK_TO_OFFSET_PERCENTAGE=src.ACK_TO_OFFSET_PERCENTAGE, 
                    target.ACK_TO_REFERENCE=src.ACK_TO_REFERENCE, 
                    target.ACK_TO_RELATIONSHIP_TYPE=src.ACK_TO_RELATIONSHIP_TYPE, 
                    target.ACK_TO_VERTICAL_OFFSET=src.ACK_TO_VERTICAL_OFFSET, 
                    target.ACK_TO_VERTICAL_OFFSETTYPE=src.ACK_TO_VERTICAL_OFFSETTYPE, 
                    target.ACK_TO_VERTICAL_OFFSETUOM=src.ACK_TO_VERTICAL_OFFSETUOM, 
                    target.ACK_TO_XCOORDINATE=src.ACK_TO_XCOORDINATE, 
                    target.ACK_TO_YCOORDINATE=src.ACK_TO_YCOORDINATE, 
                    target.ACK_TYPE=src.ACK_TYPE, 
                    target.ACK_UOM=src.ACK_UOM, 
                    target.ACK_UPDATECOUNT=src.ACK_UPDATECOUNT, 
                    target.ACK_UPDATED=src.ACK_UPDATED, 
                    target.ACK_UPDATEDBY=src.ACK_UPDATEDBY, 
                    target.ACK_VALUE=src.ACK_VALUE, 
                    target.ACK_YES=src.ACK_YES, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( ACK_ACT, ACK_ADJUSTED, ACK_ASMLEVEL, ACK_ASPECT, ACK_CASETASK, ACK_CODE, ACK_COLOR, ACK_COMPLETED, ACK_COMPLEVEL, ACK_COMPLOCATION, ACK_CONDITION, ACK_CONDITION_AS_FOUND, ACK_DEFMAINT, ACK_DESC, ACK_DIRECTION, ACK_ENABLENONCONFORMITIES, ACK_ENTITYKEY, ACK_ENTITYORG, ACK_EVENT, ACK_FINALOCCURRENCE, ACK_FINDING, ACK_FOLLOWUP, ACK_FOLLOWUPACT, ACK_FOLLOWUPEVENT, ACK_FORMULA, ACK_FROMGEOREF, ACK_FROMJOBPLAN, ACK_FROMJOBPLANREV, ACK_FROMPOINT, ACK_FROMREFDESC, ACK_FROM_HORIZONTAL_OFFSET, ACK_FROM_HORIZONTAL_OFFSETTYPE, ACK_FROM_HORIZONTAL_OFFSETUOM, ACK_FROM_LATITUDE, ACK_FROM_LONGITUDE, ACK_FROM_OFFSET, ACK_FROM_OFFSET_DIRECTION, ACK_FROM_OFFSET_PERCENTAGE, ACK_FROM_REFERENCE, ACK_FROM_RELATIONSHIP_TYPE, ACK_FROM_VERTICAL_OFFSET, ACK_FROM_VERTICAL_OFFSETTYPE, ACK_FROM_VERTICAL_OFFSETUOM, ACK_FROM_XCOORDINATE, ACK_FROM_YCOORDINATE, ACK_GOOD, ACK_GROUP_LABEL, ACK_HIDEFOLLOWUP, ACK_HIDELINEARFIELDS, ACK_JOB, ACK_LASTSAVED, ACK_LOTO, ACK_MATLIST, ACK_MAXSLIDERVALUE, ACK_MEASUREMENTRESP, ACK_METRICFRACTIONSLIDER, ACK_MINSLIDERVALUE, ACK_MOBILEDATEUPDATED, ACK_NO, ACK_NONCONFORMITY, ACK_NONCONFORMITYFOUND, ACK_NONCONFORMITYTYPE, ACK_NONCONFORMITYTYPE_ORG, ACK_NOTES, ACK_NOT_APPLICABLE, ACK_OBJECT, ACK_OBJECTLEVEL, ACK_OBJECT_ORG, ACK_OCCURRENCE, ACK_OK, ACK_PARENTKEY, ACK_PART, ACK_PARTCONDITION, ACK_PART_ORG, ACK_POINT, ACK_POINTTYPE, ACK_POOR, ACK_POSSIBLEFINDINGS, ACK_POSSIBLE_CONDS_AS_FOUND, ACK_POSSIBLE_DIRECTIONS, ACK_POSSIBLE_NA_OPTIONS, ACK_POSSIBLE_SEVERITIES, ACK_READING, ACK_REFERENCE, ACK_RELATIONSHIP_TYPE, ACK_RENTITY, ACK_REPAIRSNEEDED, ACK_REQUIREDTOCLOSE, ACK_RESOLUTION, ACK_RESPONSIBILITY, ACK_ROUTESEQUENCE, ACK_SEQUENCE, ACK_SEVERITY, ACK_SRCCALCULATEDVALUE, ACK_SYSLEVEL, ACK_TASK, ACK_TASKCHECKLISTCODE, ACK_TOGEOREF, ACK_TOLERANCECRNONCONFORMITY, ACK_TOLERANCESEVERITY, ACK_TOLERANCE_NCF_TYPE, ACK_TOLERANCE_NCF_TYPE_ORG, ACK_TOPOINT, ACK_TOREFDESC, ACK_TO_HORIZONTAL_OFFSET, ACK_TO_HORIZONTAL_OFFSETTYPE, ACK_TO_HORIZONTAL_OFFSETUOM, ACK_TO_LATITUDE, ACK_TO_LONGITUDE, ACK_TO_OFFSET, ACK_TO_OFFSET_DIRECTION, ACK_TO_OFFSET_PERCENTAGE, ACK_TO_REFERENCE, ACK_TO_RELATIONSHIP_TYPE, ACK_TO_VERTICAL_OFFSET, ACK_TO_VERTICAL_OFFSETTYPE, ACK_TO_VERTICAL_OFFSETUOM, ACK_TO_XCOORDINATE, ACK_TO_YCOORDINATE, ACK_TYPE, ACK_UOM, ACK_UPDATECOUNT, ACK_UPDATED, ACK_UPDATEDBY, ACK_VALUE, ACK_YES, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.ACK_ACT, 
                    src.ACK_ADJUSTED, 
                    src.ACK_ASMLEVEL, 
                    src.ACK_ASPECT, 
                    src.ACK_CASETASK, 
                    src.ACK_CODE, 
                    src.ACK_COLOR, 
                    src.ACK_COMPLETED, 
                    src.ACK_COMPLEVEL, 
                    src.ACK_COMPLOCATION, 
                    src.ACK_CONDITION, 
                    src.ACK_CONDITION_AS_FOUND, 
                    src.ACK_DEFMAINT, 
                    src.ACK_DESC, 
                    src.ACK_DIRECTION, 
                    src.ACK_ENABLENONCONFORMITIES, 
                    src.ACK_ENTITYKEY, 
                    src.ACK_ENTITYORG, 
                    src.ACK_EVENT, 
                    src.ACK_FINALOCCURRENCE, 
                    src.ACK_FINDING, 
                    src.ACK_FOLLOWUP, 
                    src.ACK_FOLLOWUPACT, 
                    src.ACK_FOLLOWUPEVENT, 
                    src.ACK_FORMULA, 
                    src.ACK_FROMGEOREF, 
                    src.ACK_FROMJOBPLAN, 
                    src.ACK_FROMJOBPLANREV, 
                    src.ACK_FROMPOINT, 
                    src.ACK_FROMREFDESC, 
                    src.ACK_FROM_HORIZONTAL_OFFSET, 
                    src.ACK_FROM_HORIZONTAL_OFFSETTYPE, 
                    src.ACK_FROM_HORIZONTAL_OFFSETUOM, 
                    src.ACK_FROM_LATITUDE, 
                    src.ACK_FROM_LONGITUDE, 
                    src.ACK_FROM_OFFSET, 
                    src.ACK_FROM_OFFSET_DIRECTION, 
                    src.ACK_FROM_OFFSET_PERCENTAGE, 
                    src.ACK_FROM_REFERENCE, 
                    src.ACK_FROM_RELATIONSHIP_TYPE, 
                    src.ACK_FROM_VERTICAL_OFFSET, 
                    src.ACK_FROM_VERTICAL_OFFSETTYPE, 
                    src.ACK_FROM_VERTICAL_OFFSETUOM, 
                    src.ACK_FROM_XCOORDINATE, 
                    src.ACK_FROM_YCOORDINATE, 
                    src.ACK_GOOD, 
                    src.ACK_GROUP_LABEL, 
                    src.ACK_HIDEFOLLOWUP, 
                    src.ACK_HIDELINEARFIELDS, 
                    src.ACK_JOB, 
                    src.ACK_LASTSAVED, 
                    src.ACK_LOTO, 
                    src.ACK_MATLIST, 
                    src.ACK_MAXSLIDERVALUE, 
                    src.ACK_MEASUREMENTRESP, 
                    src.ACK_METRICFRACTIONSLIDER, 
                    src.ACK_MINSLIDERVALUE, 
                    src.ACK_MOBILEDATEUPDATED, 
                    src.ACK_NO, 
                    src.ACK_NONCONFORMITY, 
                    src.ACK_NONCONFORMITYFOUND, 
                    src.ACK_NONCONFORMITYTYPE, 
                    src.ACK_NONCONFORMITYTYPE_ORG, 
                    src.ACK_NOTES, 
                    src.ACK_NOT_APPLICABLE, 
                    src.ACK_OBJECT, 
                    src.ACK_OBJECTLEVEL, 
                    src.ACK_OBJECT_ORG, 
                    src.ACK_OCCURRENCE, 
                    src.ACK_OK, 
                    src.ACK_PARENTKEY, 
                    src.ACK_PART, 
                    src.ACK_PARTCONDITION, 
                    src.ACK_PART_ORG, 
                    src.ACK_POINT, 
                    src.ACK_POINTTYPE, 
                    src.ACK_POOR, 
                    src.ACK_POSSIBLEFINDINGS, 
                    src.ACK_POSSIBLE_CONDS_AS_FOUND, 
                    src.ACK_POSSIBLE_DIRECTIONS, 
                    src.ACK_POSSIBLE_NA_OPTIONS, 
                    src.ACK_POSSIBLE_SEVERITIES, 
                    src.ACK_READING, 
                    src.ACK_REFERENCE, 
                    src.ACK_RELATIONSHIP_TYPE, 
                    src.ACK_RENTITY, 
                    src.ACK_REPAIRSNEEDED, 
                    src.ACK_REQUIREDTOCLOSE, 
                    src.ACK_RESOLUTION, 
                    src.ACK_RESPONSIBILITY, 
                    src.ACK_ROUTESEQUENCE, 
                    src.ACK_SEQUENCE, 
                    src.ACK_SEVERITY, 
                    src.ACK_SRCCALCULATEDVALUE, 
                    src.ACK_SYSLEVEL, 
                    src.ACK_TASK, 
                    src.ACK_TASKCHECKLISTCODE, 
                    src.ACK_TOGEOREF, 
                    src.ACK_TOLERANCECRNONCONFORMITY, 
                    src.ACK_TOLERANCESEVERITY, 
                    src.ACK_TOLERANCE_NCF_TYPE, 
                    src.ACK_TOLERANCE_NCF_TYPE_ORG, 
                    src.ACK_TOPOINT, 
                    src.ACK_TOREFDESC, 
                    src.ACK_TO_HORIZONTAL_OFFSET, 
                    src.ACK_TO_HORIZONTAL_OFFSETTYPE, 
                    src.ACK_TO_HORIZONTAL_OFFSETUOM, 
                    src.ACK_TO_LATITUDE, 
                    src.ACK_TO_LONGITUDE, 
                    src.ACK_TO_OFFSET, 
                    src.ACK_TO_OFFSET_DIRECTION, 
                    src.ACK_TO_OFFSET_PERCENTAGE, 
                    src.ACK_TO_REFERENCE, 
                    src.ACK_TO_RELATIONSHIP_TYPE, 
                    src.ACK_TO_VERTICAL_OFFSET, 
                    src.ACK_TO_VERTICAL_OFFSETTYPE, 
                    src.ACK_TO_VERTICAL_OFFSETUOM, 
                    src.ACK_TO_XCOORDINATE, 
                    src.ACK_TO_YCOORDINATE, 
                    src.ACK_TYPE, 
                    src.ACK_UOM, 
                    src.ACK_UPDATECOUNT, 
                    src.ACK_UPDATED, 
                    src.ACK_UPDATEDBY, 
                    src.ACK_VALUE, 
                    src.ACK_YES, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;