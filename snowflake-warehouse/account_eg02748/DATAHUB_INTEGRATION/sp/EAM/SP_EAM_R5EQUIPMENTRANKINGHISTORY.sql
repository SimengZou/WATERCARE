create or replace procedure DATAHUB_INTEGRATION.SP_EAM_R5EQUIPMENTRANKINGHISTORY()
    returns varchar not null
                language javascript
                as
                $$

//  Variables

var result = "";                                    // return status of this proc call
const process_name = Object.keys(this)[0];          // name of currently executing process
var number_of_rows_inserted = 0;                             // track number of rows we have inserted
var number_of_rows_updated = 0;                             // track number of rows we have updated


//  Step 1.

//  Start execution - log start

log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', 0,0,0);";
snowflake.execute({sqlText: log_sql_command});

snowflake.execute( {sqlText: "begin transaction;"} );
try
    {
        var sql_command = `
                            INSERT INTO LANDING_ERROR.EAM_RAW_ERROR
                            SELECT * FROM LANDING_ERROR.VW_STREAM_EAM_R5EQUIPMENTRANKINGHISTORY_ERROR`;
    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();
        
        var sql_command = ` 
                            merge into  TARGET_EAM.EAM_R5EQUIPMENTRANKINGHISTORY as target using (SELECT * FROM (SELECT 
            strm.ERH_AVAILABLECAPACITY, 
            strm.ERH_CAPACITYCODE, 
            strm.ERH_CAPACITYRATING, 
            strm.ERH_CONDITIONPROTOCOL, 
            strm.ERH_CONDITIONRATING, 
            strm.ERH_CONDSCOREEND, 
            strm.ERH_CONDSCORESTART, 
            strm.ERH_CONDSCORETHRESHOLD, 
            strm.ERH_CORRCONDITIONDATE, 
            strm.ERH_CORRCONDITIONREASON, 
            strm.ERH_CORRCONDITIONSCORE, 
            strm.ERH_CORRCONDITIONUSAGE, 
            strm.ERH_CREATED, 
            strm.ERH_CREATEDBY, 
            strm.ERH_DAILYUSAGEUOM, 
            strm.ERH_DATE, 
            strm.ERH_DECAYCURVE, 
            strm.ERH_DECAYCURVE_ORG, 
            strm.ERH_DESIREDCAPACITY, 
            strm.ERH_ENDOFUSEFULLIFE, 
            strm.ERH_FROMGEOREF, 
            strm.ERH_FROMPOINT, 
            strm.ERH_FROMREFDESC, 
            strm.ERH_INDEX, 
            strm.ERH_LASTSAVED, 
            strm.ERH_MTBFDAYS, 
            strm.ERH_MTBFRATING, 
            strm.ERH_MTTRHRS, 
            strm.ERH_MTTRRATING, 
            strm.ERH_MUBF, 
            strm.ERH_MUBFRATING, 
            strm.ERH_NUMBEROFFAILURES, 
            strm.ERH_OBJCODE, 
            strm.ERH_OBJORG, 
            strm.ERH_PERFORMANCE, 
            strm.ERH_PERFORMANCEFORMULA, 
            strm.ERH_PERFORMANCEFORMULA_ORG, 
            strm.ERH_PK, 
            strm.ERH_PRIMARYUOM, 
            strm.ERH_RANKINGCODE, 
            strm.ERH_RANKINGORG, 
            strm.ERH_RANKINGREVISION, 
            strm.ERH_RANKINGTYPE, 
            strm.ERH_RISKLEVEL, 
            strm.ERH_SCORE, 
            strm.ERH_SERVICELIFE, 
            strm.ERH_SERVICELIFEUSAGE, 
            strm.ERH_TOGEOREF, 
            strm.ERH_TOPOINT, 
            strm.ERH_TOREFDESC, 
            strm.ERH_UDFCHAR01, 
            strm.ERH_UDFCHAR02, 
            strm.ERH_UDFCHAR03, 
            strm.ERH_UDFCHAR04, 
            strm.ERH_UDFCHAR05, 
            strm.ERH_UDFCHAR06, 
            strm.ERH_UDFCHAR07, 
            strm.ERH_UDFCHAR08, 
            strm.ERH_UDFCHAR09, 
            strm.ERH_UDFCHAR10, 
            strm.ERH_UDFCHAR11, 
            strm.ERH_UDFCHAR12, 
            strm.ERH_UDFCHAR13, 
            strm.ERH_UDFCHAR14, 
            strm.ERH_UDFCHAR15, 
            strm.ERH_UDFCHAR16, 
            strm.ERH_UDFCHAR17, 
            strm.ERH_UDFCHAR18, 
            strm.ERH_UDFCHAR19, 
            strm.ERH_UDFCHAR20, 
            strm.ERH_UDFCHAR21, 
            strm.ERH_UDFCHAR22, 
            strm.ERH_UDFCHAR23, 
            strm.ERH_UDFCHAR24, 
            strm.ERH_UDFCHAR25, 
            strm.ERH_UDFCHAR26, 
            strm.ERH_UDFCHAR27, 
            strm.ERH_UDFCHAR28, 
            strm.ERH_UDFCHAR29, 
            strm.ERH_UDFCHAR30, 
            strm.ERH_UDFCHKBOX01, 
            strm.ERH_UDFCHKBOX02, 
            strm.ERH_UDFCHKBOX03, 
            strm.ERH_UDFCHKBOX04, 
            strm.ERH_UDFCHKBOX05, 
            strm.ERH_UDFDATE01, 
            strm.ERH_UDFDATE02, 
            strm.ERH_UDFDATE03, 
            strm.ERH_UDFDATE04, 
            strm.ERH_UDFDATE05, 
            strm.ERH_UDFNUM01, 
            strm.ERH_UDFNUM02, 
            strm.ERH_UDFNUM03, 
            strm.ERH_UDFNUM04, 
            strm.ERH_UDFNUM05, 
            strm.ERH_UPDATECOUNT, 
            strm.ERH_UPDATED, 
            strm.ERH_UPDATEDBY, 
            strm.ERH_USAGE, 
            strm.ERH_VARIABLERATING1, 
            strm.ERH_VARIABLERATING2, 
            strm.ERH_VARIABLERATING3, 
            strm.ERH_VARIABLERATING4, 
            strm.ERH_VARIABLERATING5, 
            strm.ERH_VARIABLERATING6, 
            strm.ERH_VARIABLERESULT1, 
            strm.ERH_VARIABLERESULT2, 
            strm.ERH_VARIABLERESULT3, 
            strm.ERH_VARIABLERESULT4, 
            strm.ERH_VARIABLERESULT5, 
            strm.ERH_VARIABLERESULT6, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ERH_PK ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5EQUIPMENTRANKINGHISTORY as  strm
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ERH_PK=src.ERH_PK) OR (target.ERH_PK IS NULL AND src.ERH_PK IS NULL)) 
                when matched and src.ETL_DELETED=TRUE THEN DELETE
                when matched then update set
                    target.ERH_AVAILABLECAPACITY=src.ERH_AVAILABLECAPACITY, 
                    target.ERH_CAPACITYCODE=src.ERH_CAPACITYCODE, 
                    target.ERH_CAPACITYRATING=src.ERH_CAPACITYRATING, 
                    target.ERH_CONDITIONPROTOCOL=src.ERH_CONDITIONPROTOCOL, 
                    target.ERH_CONDITIONRATING=src.ERH_CONDITIONRATING, 
                    target.ERH_CONDSCOREEND=src.ERH_CONDSCOREEND, 
                    target.ERH_CONDSCORESTART=src.ERH_CONDSCORESTART, 
                    target.ERH_CONDSCORETHRESHOLD=src.ERH_CONDSCORETHRESHOLD, 
                    target.ERH_CORRCONDITIONDATE=src.ERH_CORRCONDITIONDATE, 
                    target.ERH_CORRCONDITIONREASON=src.ERH_CORRCONDITIONREASON, 
                    target.ERH_CORRCONDITIONSCORE=src.ERH_CORRCONDITIONSCORE, 
                    target.ERH_CORRCONDITIONUSAGE=src.ERH_CORRCONDITIONUSAGE, 
                    target.ERH_CREATED=src.ERH_CREATED, 
                    target.ERH_CREATEDBY=src.ERH_CREATEDBY, 
                    target.ERH_DAILYUSAGEUOM=src.ERH_DAILYUSAGEUOM, 
                    target.ERH_DATE=src.ERH_DATE, 
                    target.ERH_DECAYCURVE=src.ERH_DECAYCURVE, 
                    target.ERH_DECAYCURVE_ORG=src.ERH_DECAYCURVE_ORG, 
                    target.ERH_DESIREDCAPACITY=src.ERH_DESIREDCAPACITY, 
                    target.ERH_ENDOFUSEFULLIFE=src.ERH_ENDOFUSEFULLIFE, 
                    target.ERH_FROMGEOREF=src.ERH_FROMGEOREF, 
                    target.ERH_FROMPOINT=src.ERH_FROMPOINT, 
                    target.ERH_FROMREFDESC=src.ERH_FROMREFDESC, 
                    target.ERH_INDEX=src.ERH_INDEX, 
                    target.ERH_LASTSAVED=src.ERH_LASTSAVED, 
                    target.ERH_MTBFDAYS=src.ERH_MTBFDAYS, 
                    target.ERH_MTBFRATING=src.ERH_MTBFRATING, 
                    target.ERH_MTTRHRS=src.ERH_MTTRHRS, 
                    target.ERH_MTTRRATING=src.ERH_MTTRRATING, 
                    target.ERH_MUBF=src.ERH_MUBF, 
                    target.ERH_MUBFRATING=src.ERH_MUBFRATING, 
                    target.ERH_NUMBEROFFAILURES=src.ERH_NUMBEROFFAILURES, 
                    target.ERH_OBJCODE=src.ERH_OBJCODE, 
                    target.ERH_OBJORG=src.ERH_OBJORG, 
                    target.ERH_PERFORMANCE=src.ERH_PERFORMANCE, 
                    target.ERH_PERFORMANCEFORMULA=src.ERH_PERFORMANCEFORMULA, 
                    target.ERH_PERFORMANCEFORMULA_ORG=src.ERH_PERFORMANCEFORMULA_ORG, 
                    target.ERH_PK=src.ERH_PK, 
                    target.ERH_PRIMARYUOM=src.ERH_PRIMARYUOM, 
                    target.ERH_RANKINGCODE=src.ERH_RANKINGCODE, 
                    target.ERH_RANKINGORG=src.ERH_RANKINGORG, 
                    target.ERH_RANKINGREVISION=src.ERH_RANKINGREVISION, 
                    target.ERH_RANKINGTYPE=src.ERH_RANKINGTYPE, 
                    target.ERH_RISKLEVEL=src.ERH_RISKLEVEL, 
                    target.ERH_SCORE=src.ERH_SCORE, 
                    target.ERH_SERVICELIFE=src.ERH_SERVICELIFE, 
                    target.ERH_SERVICELIFEUSAGE=src.ERH_SERVICELIFEUSAGE, 
                    target.ERH_TOGEOREF=src.ERH_TOGEOREF, 
                    target.ERH_TOPOINT=src.ERH_TOPOINT, 
                    target.ERH_TOREFDESC=src.ERH_TOREFDESC, 
                    target.ERH_UDFCHAR01=src.ERH_UDFCHAR01, 
                    target.ERH_UDFCHAR02=src.ERH_UDFCHAR02, 
                    target.ERH_UDFCHAR03=src.ERH_UDFCHAR03, 
                    target.ERH_UDFCHAR04=src.ERH_UDFCHAR04, 
                    target.ERH_UDFCHAR05=src.ERH_UDFCHAR05, 
                    target.ERH_UDFCHAR06=src.ERH_UDFCHAR06, 
                    target.ERH_UDFCHAR07=src.ERH_UDFCHAR07, 
                    target.ERH_UDFCHAR08=src.ERH_UDFCHAR08, 
                    target.ERH_UDFCHAR09=src.ERH_UDFCHAR09, 
                    target.ERH_UDFCHAR10=src.ERH_UDFCHAR10, 
                    target.ERH_UDFCHAR11=src.ERH_UDFCHAR11, 
                    target.ERH_UDFCHAR12=src.ERH_UDFCHAR12, 
                    target.ERH_UDFCHAR13=src.ERH_UDFCHAR13, 
                    target.ERH_UDFCHAR14=src.ERH_UDFCHAR14, 
                    target.ERH_UDFCHAR15=src.ERH_UDFCHAR15, 
                    target.ERH_UDFCHAR16=src.ERH_UDFCHAR16, 
                    target.ERH_UDFCHAR17=src.ERH_UDFCHAR17, 
                    target.ERH_UDFCHAR18=src.ERH_UDFCHAR18, 
                    target.ERH_UDFCHAR19=src.ERH_UDFCHAR19, 
                    target.ERH_UDFCHAR20=src.ERH_UDFCHAR20, 
                    target.ERH_UDFCHAR21=src.ERH_UDFCHAR21, 
                    target.ERH_UDFCHAR22=src.ERH_UDFCHAR22, 
                    target.ERH_UDFCHAR23=src.ERH_UDFCHAR23, 
                    target.ERH_UDFCHAR24=src.ERH_UDFCHAR24, 
                    target.ERH_UDFCHAR25=src.ERH_UDFCHAR25, 
                    target.ERH_UDFCHAR26=src.ERH_UDFCHAR26, 
                    target.ERH_UDFCHAR27=src.ERH_UDFCHAR27, 
                    target.ERH_UDFCHAR28=src.ERH_UDFCHAR28, 
                    target.ERH_UDFCHAR29=src.ERH_UDFCHAR29, 
                    target.ERH_UDFCHAR30=src.ERH_UDFCHAR30, 
                    target.ERH_UDFCHKBOX01=src.ERH_UDFCHKBOX01, 
                    target.ERH_UDFCHKBOX02=src.ERH_UDFCHKBOX02, 
                    target.ERH_UDFCHKBOX03=src.ERH_UDFCHKBOX03, 
                    target.ERH_UDFCHKBOX04=src.ERH_UDFCHKBOX04, 
                    target.ERH_UDFCHKBOX05=src.ERH_UDFCHKBOX05, 
                    target.ERH_UDFDATE01=src.ERH_UDFDATE01, 
                    target.ERH_UDFDATE02=src.ERH_UDFDATE02, 
                    target.ERH_UDFDATE03=src.ERH_UDFDATE03, 
                    target.ERH_UDFDATE04=src.ERH_UDFDATE04, 
                    target.ERH_UDFDATE05=src.ERH_UDFDATE05, 
                    target.ERH_UDFNUM01=src.ERH_UDFNUM01, 
                    target.ERH_UDFNUM02=src.ERH_UDFNUM02, 
                    target.ERH_UDFNUM03=src.ERH_UDFNUM03, 
                    target.ERH_UDFNUM04=src.ERH_UDFNUM04, 
                    target.ERH_UDFNUM05=src.ERH_UDFNUM05, 
                    target.ERH_UPDATECOUNT=src.ERH_UPDATECOUNT, 
                    target.ERH_UPDATED=src.ERH_UPDATED, 
                    target.ERH_UPDATEDBY=src.ERH_UPDATEDBY, 
                    target.ERH_USAGE=src.ERH_USAGE, 
                    target.ERH_VARIABLERATING1=src.ERH_VARIABLERATING1, 
                    target.ERH_VARIABLERATING2=src.ERH_VARIABLERATING2, 
                    target.ERH_VARIABLERATING3=src.ERH_VARIABLERATING3, 
                    target.ERH_VARIABLERATING4=src.ERH_VARIABLERATING4, 
                    target.ERH_VARIABLERATING5=src.ERH_VARIABLERATING5, 
                    target.ERH_VARIABLERATING6=src.ERH_VARIABLERATING6, 
                    target.ERH_VARIABLERESULT1=src.ERH_VARIABLERESULT1, 
                    target.ERH_VARIABLERESULT2=src.ERH_VARIABLERESULT2, 
                    target.ERH_VARIABLERESULT3=src.ERH_VARIABLERESULT3, 
                    target.ERH_VARIABLERESULT4=src.ERH_VARIABLERESULT4, 
                    target.ERH_VARIABLERESULT5=src.ERH_VARIABLERESULT5, 
                    target.ERH_VARIABLERESULT6=src.ERH_VARIABLERESULT6, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename
        when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                    ERH_AVAILABLECAPACITY, 
                    ERH_CAPACITYCODE, 
                    ERH_CAPACITYRATING, 
                    ERH_CONDITIONPROTOCOL, 
                    ERH_CONDITIONRATING, 
                    ERH_CONDSCOREEND, 
                    ERH_CONDSCORESTART, 
                    ERH_CONDSCORETHRESHOLD, 
                    ERH_CORRCONDITIONDATE, 
                    ERH_CORRCONDITIONREASON, 
                    ERH_CORRCONDITIONSCORE, 
                    ERH_CORRCONDITIONUSAGE, 
                    ERH_CREATED, 
                    ERH_CREATEDBY, 
                    ERH_DAILYUSAGEUOM, 
                    ERH_DATE, 
                    ERH_DECAYCURVE, 
                    ERH_DECAYCURVE_ORG, 
                    ERH_DESIREDCAPACITY, 
                    ERH_ENDOFUSEFULLIFE, 
                    ERH_FROMGEOREF, 
                    ERH_FROMPOINT, 
                    ERH_FROMREFDESC, 
                    ERH_INDEX, 
                    ERH_LASTSAVED, 
                    ERH_MTBFDAYS, 
                    ERH_MTBFRATING, 
                    ERH_MTTRHRS, 
                    ERH_MTTRRATING, 
                    ERH_MUBF, 
                    ERH_MUBFRATING, 
                    ERH_NUMBEROFFAILURES, 
                    ERH_OBJCODE, 
                    ERH_OBJORG, 
                    ERH_PERFORMANCE, 
                    ERH_PERFORMANCEFORMULA, 
                    ERH_PERFORMANCEFORMULA_ORG, 
                    ERH_PK, 
                    ERH_PRIMARYUOM, 
                    ERH_RANKINGCODE, 
                    ERH_RANKINGORG, 
                    ERH_RANKINGREVISION, 
                    ERH_RANKINGTYPE, 
                    ERH_RISKLEVEL, 
                    ERH_SCORE, 
                    ERH_SERVICELIFE, 
                    ERH_SERVICELIFEUSAGE, 
                    ERH_TOGEOREF, 
                    ERH_TOPOINT, 
                    ERH_TOREFDESC, 
                    ERH_UDFCHAR01, 
                    ERH_UDFCHAR02, 
                    ERH_UDFCHAR03, 
                    ERH_UDFCHAR04, 
                    ERH_UDFCHAR05, 
                    ERH_UDFCHAR06, 
                    ERH_UDFCHAR07, 
                    ERH_UDFCHAR08, 
                    ERH_UDFCHAR09, 
                    ERH_UDFCHAR10, 
                    ERH_UDFCHAR11, 
                    ERH_UDFCHAR12, 
                    ERH_UDFCHAR13, 
                    ERH_UDFCHAR14, 
                    ERH_UDFCHAR15, 
                    ERH_UDFCHAR16, 
                    ERH_UDFCHAR17, 
                    ERH_UDFCHAR18, 
                    ERH_UDFCHAR19, 
                    ERH_UDFCHAR20, 
                    ERH_UDFCHAR21, 
                    ERH_UDFCHAR22, 
                    ERH_UDFCHAR23, 
                    ERH_UDFCHAR24, 
                    ERH_UDFCHAR25, 
                    ERH_UDFCHAR26, 
                    ERH_UDFCHAR27, 
                    ERH_UDFCHAR28, 
                    ERH_UDFCHAR29, 
                    ERH_UDFCHAR30, 
                    ERH_UDFCHKBOX01, 
                    ERH_UDFCHKBOX02, 
                    ERH_UDFCHKBOX03, 
                    ERH_UDFCHKBOX04, 
                    ERH_UDFCHKBOX05, 
                    ERH_UDFDATE01, 
                    ERH_UDFDATE02, 
                    ERH_UDFDATE03, 
                    ERH_UDFDATE04, 
                    ERH_UDFDATE05, 
                    ERH_UDFNUM01, 
                    ERH_UDFNUM02, 
                    ERH_UDFNUM03, 
                    ERH_UDFNUM04, 
                    ERH_UDFNUM05, 
                    ERH_UPDATECOUNT, 
                    ERH_UPDATED, 
                    ERH_UPDATEDBY, 
                    ERH_USAGE, 
                    ERH_VARIABLERATING1, 
                    ERH_VARIABLERATING2, 
                    ERH_VARIABLERATING3, 
                    ERH_VARIABLERATING4, 
                    ERH_VARIABLERATING5, 
                    ERH_VARIABLERATING6, 
                    ERH_VARIABLERESULT1, 
                    ERH_VARIABLERESULT2, 
                    ERH_VARIABLERESULT3, 
                    ERH_VARIABLERESULT4, 
                    ERH_VARIABLERESULT5, 
                    ERH_VARIABLERESULT6, 
                    _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename) 
            values (
                    src.ERH_AVAILABLECAPACITY, 
                    src.ERH_CAPACITYCODE, 
                    src.ERH_CAPACITYRATING, 
                    src.ERH_CONDITIONPROTOCOL, 
                    src.ERH_CONDITIONRATING, 
                    src.ERH_CONDSCOREEND, 
                    src.ERH_CONDSCORESTART, 
                    src.ERH_CONDSCORETHRESHOLD, 
                    src.ERH_CORRCONDITIONDATE, 
                    src.ERH_CORRCONDITIONREASON, 
                    src.ERH_CORRCONDITIONSCORE, 
                    src.ERH_CORRCONDITIONUSAGE, 
                    src.ERH_CREATED, 
                    src.ERH_CREATEDBY, 
                    src.ERH_DAILYUSAGEUOM, 
                    src.ERH_DATE, 
                    src.ERH_DECAYCURVE, 
                    src.ERH_DECAYCURVE_ORG, 
                    src.ERH_DESIREDCAPACITY, 
                    src.ERH_ENDOFUSEFULLIFE, 
                    src.ERH_FROMGEOREF, 
                    src.ERH_FROMPOINT, 
                    src.ERH_FROMREFDESC, 
                    src.ERH_INDEX, 
                    src.ERH_LASTSAVED, 
                    src.ERH_MTBFDAYS, 
                    src.ERH_MTBFRATING, 
                    src.ERH_MTTRHRS, 
                    src.ERH_MTTRRATING, 
                    src.ERH_MUBF, 
                    src.ERH_MUBFRATING, 
                    src.ERH_NUMBEROFFAILURES, 
                    src.ERH_OBJCODE, 
                    src.ERH_OBJORG, 
                    src.ERH_PERFORMANCE, 
                    src.ERH_PERFORMANCEFORMULA, 
                    src.ERH_PERFORMANCEFORMULA_ORG, 
                    src.ERH_PK, 
                    src.ERH_PRIMARYUOM, 
                    src.ERH_RANKINGCODE, 
                    src.ERH_RANKINGORG, 
                    src.ERH_RANKINGREVISION, 
                    src.ERH_RANKINGTYPE, 
                    src.ERH_RISKLEVEL, 
                    src.ERH_SCORE, 
                    src.ERH_SERVICELIFE, 
                    src.ERH_SERVICELIFEUSAGE, 
                    src.ERH_TOGEOREF, 
                    src.ERH_TOPOINT, 
                    src.ERH_TOREFDESC, 
                    src.ERH_UDFCHAR01, 
                    src.ERH_UDFCHAR02, 
                    src.ERH_UDFCHAR03, 
                    src.ERH_UDFCHAR04, 
                    src.ERH_UDFCHAR05, 
                    src.ERH_UDFCHAR06, 
                    src.ERH_UDFCHAR07, 
                    src.ERH_UDFCHAR08, 
                    src.ERH_UDFCHAR09, 
                    src.ERH_UDFCHAR10, 
                    src.ERH_UDFCHAR11, 
                    src.ERH_UDFCHAR12, 
                    src.ERH_UDFCHAR13, 
                    src.ERH_UDFCHAR14, 
                    src.ERH_UDFCHAR15, 
                    src.ERH_UDFCHAR16, 
                    src.ERH_UDFCHAR17, 
                    src.ERH_UDFCHAR18, 
                    src.ERH_UDFCHAR19, 
                    src.ERH_UDFCHAR20, 
                    src.ERH_UDFCHAR21, 
                    src.ERH_UDFCHAR22, 
                    src.ERH_UDFCHAR23, 
                    src.ERH_UDFCHAR24, 
                    src.ERH_UDFCHAR25, 
                    src.ERH_UDFCHAR26, 
                    src.ERH_UDFCHAR27, 
                    src.ERH_UDFCHAR28, 
                    src.ERH_UDFCHAR29, 
                    src.ERH_UDFCHAR30, 
                    src.ERH_UDFCHKBOX01, 
                    src.ERH_UDFCHKBOX02, 
                    src.ERH_UDFCHKBOX03, 
                    src.ERH_UDFCHKBOX04, 
                    src.ERH_UDFCHKBOX05, 
                    src.ERH_UDFDATE01, 
                    src.ERH_UDFDATE02, 
                    src.ERH_UDFDATE03, 
                    src.ERH_UDFDATE04, 
                    src.ERH_UDFDATE05, 
                    src.ERH_UDFNUM01, 
                    src.ERH_UDFNUM02, 
                    src.ERH_UDFNUM03, 
                    src.ERH_UDFNUM04, 
                    src.ERH_UDFNUM05, 
                    src.ERH_UPDATECOUNT, 
                    src.ERH_UPDATED, 
                    src.ERH_UPDATEDBY, 
                    src.ERH_USAGE, 
                    src.ERH_VARIABLERATING1, 
                    src.ERH_VARIABLERATING2, 
                    src.ERH_VARIABLERATING3, 
                    src.ERH_VARIABLERATING4, 
                    src.ERH_VARIABLERATING5, 
                    src.ERH_VARIABLERATING6, 
                    src.ERH_VARIABLERESULT1, 
                    src.ERH_VARIABLERESULT2, 
                    src.ERH_VARIABLERESULT3, 
                    src.ERH_VARIABLERESULT4, 
                    src.ERH_VARIABLERESULT5, 
                    src.ERH_VARIABLERESULT6, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename);`;

    var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
    var rs = sqlStmt.execute();

    snowflake.execute( {sqlText: `merge into TARGET_HISTORY_EAM.EAM_R5EQUIPMENTRANKINGHISTORY_DELETED as target using (
                SELECT * FROM (SELECT 
            strm.ERH_AVAILABLECAPACITY, 
            strm.ERH_CAPACITYCODE, 
            strm.ERH_CAPACITYRATING, 
            strm.ERH_CONDITIONPROTOCOL, 
            strm.ERH_CONDITIONRATING, 
            strm.ERH_CONDSCOREEND, 
            strm.ERH_CONDSCORESTART, 
            strm.ERH_CONDSCORETHRESHOLD, 
            strm.ERH_CORRCONDITIONDATE, 
            strm.ERH_CORRCONDITIONREASON, 
            strm.ERH_CORRCONDITIONSCORE, 
            strm.ERH_CORRCONDITIONUSAGE, 
            strm.ERH_CREATED, 
            strm.ERH_CREATEDBY, 
            strm.ERH_DAILYUSAGEUOM, 
            strm.ERH_DATE, 
            strm.ERH_DECAYCURVE, 
            strm.ERH_DECAYCURVE_ORG, 
            strm.ERH_DESIREDCAPACITY, 
            strm.ERH_ENDOFUSEFULLIFE, 
            strm.ERH_FROMGEOREF, 
            strm.ERH_FROMPOINT, 
            strm.ERH_FROMREFDESC, 
            strm.ERH_INDEX, 
            strm.ERH_LASTSAVED, 
            strm.ERH_MTBFDAYS, 
            strm.ERH_MTBFRATING, 
            strm.ERH_MTTRHRS, 
            strm.ERH_MTTRRATING, 
            strm.ERH_MUBF, 
            strm.ERH_MUBFRATING, 
            strm.ERH_NUMBEROFFAILURES, 
            strm.ERH_OBJCODE, 
            strm.ERH_OBJORG, 
            strm.ERH_PERFORMANCE, 
            strm.ERH_PERFORMANCEFORMULA, 
            strm.ERH_PERFORMANCEFORMULA_ORG, 
            strm.ERH_PK, 
            strm.ERH_PRIMARYUOM, 
            strm.ERH_RANKINGCODE, 
            strm.ERH_RANKINGORG, 
            strm.ERH_RANKINGREVISION, 
            strm.ERH_RANKINGTYPE, 
            strm.ERH_RISKLEVEL, 
            strm.ERH_SCORE, 
            strm.ERH_SERVICELIFE, 
            strm.ERH_SERVICELIFEUSAGE, 
            strm.ERH_TOGEOREF, 
            strm.ERH_TOPOINT, 
            strm.ERH_TOREFDESC, 
            strm.ERH_UDFCHAR01, 
            strm.ERH_UDFCHAR02, 
            strm.ERH_UDFCHAR03, 
            strm.ERH_UDFCHAR04, 
            strm.ERH_UDFCHAR05, 
            strm.ERH_UDFCHAR06, 
            strm.ERH_UDFCHAR07, 
            strm.ERH_UDFCHAR08, 
            strm.ERH_UDFCHAR09, 
            strm.ERH_UDFCHAR10, 
            strm.ERH_UDFCHAR11, 
            strm.ERH_UDFCHAR12, 
            strm.ERH_UDFCHAR13, 
            strm.ERH_UDFCHAR14, 
            strm.ERH_UDFCHAR15, 
            strm.ERH_UDFCHAR16, 
            strm.ERH_UDFCHAR17, 
            strm.ERH_UDFCHAR18, 
            strm.ERH_UDFCHAR19, 
            strm.ERH_UDFCHAR20, 
            strm.ERH_UDFCHAR21, 
            strm.ERH_UDFCHAR22, 
            strm.ERH_UDFCHAR23, 
            strm.ERH_UDFCHAR24, 
            strm.ERH_UDFCHAR25, 
            strm.ERH_UDFCHAR26, 
            strm.ERH_UDFCHAR27, 
            strm.ERH_UDFCHAR28, 
            strm.ERH_UDFCHAR29, 
            strm.ERH_UDFCHAR30, 
            strm.ERH_UDFCHKBOX01, 
            strm.ERH_UDFCHKBOX02, 
            strm.ERH_UDFCHKBOX03, 
            strm.ERH_UDFCHKBOX04, 
            strm.ERH_UDFCHKBOX05, 
            strm.ERH_UDFDATE01, 
            strm.ERH_UDFDATE02, 
            strm.ERH_UDFDATE03, 
            strm.ERH_UDFDATE04, 
            strm.ERH_UDFDATE05, 
            strm.ERH_UDFNUM01, 
            strm.ERH_UDFNUM02, 
            strm.ERH_UDFNUM03, 
            strm.ERH_UDFNUM04, 
            strm.ERH_UDFNUM05, 
            strm.ERH_UPDATECOUNT, 
            strm.ERH_UPDATED, 
            strm.ERH_UPDATEDBY, 
            strm.ERH_USAGE, 
            strm.ERH_VARIABLERATING1, 
            strm.ERH_VARIABLERATING2, 
            strm.ERH_VARIABLERATING3, 
            strm.ERH_VARIABLERATING4, 
            strm.ERH_VARIABLERATING5, 
            strm.ERH_VARIABLERATING6, 
            strm.ERH_VARIABLERESULT1, 
            strm.ERH_VARIABLERESULT2, 
            strm.ERH_VARIABLERESULT3, 
            strm.ERH_VARIABLERESULT4, 
            strm.ERH_VARIABLERESULT5, 
            strm.ERH_VARIABLERESULT6, 
            strm._DELETED, 
            strm.ETL_LASTSAVED,
            strm.ETL_DELETED,
            strm.etl_load_datetime,
            strm.etl_load_metadatafilename,
            ROW_NUMBER() OVER (PARTITION BY 
            strm.ERH_PK ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
        FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5EQUIPMENTRANKINGHISTORY as  strm
        WHERE strm.ETL_DELETED=TRUE
                    )   
            WHERE ROWNUMBER=1  
            
                    ) as src on
            ((target.ERH_PK=src.ERH_PK) OR (target.ERH_PK IS NULL AND src.ERH_PK IS NULL)) 
                when matched then update set
                    target.ERH_AVAILABLECAPACITY=src.ERH_AVAILABLECAPACITY, 
                    target.ERH_CAPACITYCODE=src.ERH_CAPACITYCODE, 
                    target.ERH_CAPACITYRATING=src.ERH_CAPACITYRATING, 
                    target.ERH_CONDITIONPROTOCOL=src.ERH_CONDITIONPROTOCOL, 
                    target.ERH_CONDITIONRATING=src.ERH_CONDITIONRATING, 
                    target.ERH_CONDSCOREEND=src.ERH_CONDSCOREEND, 
                    target.ERH_CONDSCORESTART=src.ERH_CONDSCORESTART, 
                    target.ERH_CONDSCORETHRESHOLD=src.ERH_CONDSCORETHRESHOLD, 
                    target.ERH_CORRCONDITIONDATE=src.ERH_CORRCONDITIONDATE, 
                    target.ERH_CORRCONDITIONREASON=src.ERH_CORRCONDITIONREASON, 
                    target.ERH_CORRCONDITIONSCORE=src.ERH_CORRCONDITIONSCORE, 
                    target.ERH_CORRCONDITIONUSAGE=src.ERH_CORRCONDITIONUSAGE, 
                    target.ERH_CREATED=src.ERH_CREATED, 
                    target.ERH_CREATEDBY=src.ERH_CREATEDBY, 
                    target.ERH_DAILYUSAGEUOM=src.ERH_DAILYUSAGEUOM, 
                    target.ERH_DATE=src.ERH_DATE, 
                    target.ERH_DECAYCURVE=src.ERH_DECAYCURVE, 
                    target.ERH_DECAYCURVE_ORG=src.ERH_DECAYCURVE_ORG, 
                    target.ERH_DESIREDCAPACITY=src.ERH_DESIREDCAPACITY, 
                    target.ERH_ENDOFUSEFULLIFE=src.ERH_ENDOFUSEFULLIFE, 
                    target.ERH_FROMGEOREF=src.ERH_FROMGEOREF, 
                    target.ERH_FROMPOINT=src.ERH_FROMPOINT, 
                    target.ERH_FROMREFDESC=src.ERH_FROMREFDESC, 
                    target.ERH_INDEX=src.ERH_INDEX, 
                    target.ERH_LASTSAVED=src.ERH_LASTSAVED, 
                    target.ERH_MTBFDAYS=src.ERH_MTBFDAYS, 
                    target.ERH_MTBFRATING=src.ERH_MTBFRATING, 
                    target.ERH_MTTRHRS=src.ERH_MTTRHRS, 
                    target.ERH_MTTRRATING=src.ERH_MTTRRATING, 
                    target.ERH_MUBF=src.ERH_MUBF, 
                    target.ERH_MUBFRATING=src.ERH_MUBFRATING, 
                    target.ERH_NUMBEROFFAILURES=src.ERH_NUMBEROFFAILURES, 
                    target.ERH_OBJCODE=src.ERH_OBJCODE, 
                    target.ERH_OBJORG=src.ERH_OBJORG, 
                    target.ERH_PERFORMANCE=src.ERH_PERFORMANCE, 
                    target.ERH_PERFORMANCEFORMULA=src.ERH_PERFORMANCEFORMULA, 
                    target.ERH_PERFORMANCEFORMULA_ORG=src.ERH_PERFORMANCEFORMULA_ORG, 
                    target.ERH_PK=src.ERH_PK, 
                    target.ERH_PRIMARYUOM=src.ERH_PRIMARYUOM, 
                    target.ERH_RANKINGCODE=src.ERH_RANKINGCODE, 
                    target.ERH_RANKINGORG=src.ERH_RANKINGORG, 
                    target.ERH_RANKINGREVISION=src.ERH_RANKINGREVISION, 
                    target.ERH_RANKINGTYPE=src.ERH_RANKINGTYPE, 
                    target.ERH_RISKLEVEL=src.ERH_RISKLEVEL, 
                    target.ERH_SCORE=src.ERH_SCORE, 
                    target.ERH_SERVICELIFE=src.ERH_SERVICELIFE, 
                    target.ERH_SERVICELIFEUSAGE=src.ERH_SERVICELIFEUSAGE, 
                    target.ERH_TOGEOREF=src.ERH_TOGEOREF, 
                    target.ERH_TOPOINT=src.ERH_TOPOINT, 
                    target.ERH_TOREFDESC=src.ERH_TOREFDESC, 
                    target.ERH_UDFCHAR01=src.ERH_UDFCHAR01, 
                    target.ERH_UDFCHAR02=src.ERH_UDFCHAR02, 
                    target.ERH_UDFCHAR03=src.ERH_UDFCHAR03, 
                    target.ERH_UDFCHAR04=src.ERH_UDFCHAR04, 
                    target.ERH_UDFCHAR05=src.ERH_UDFCHAR05, 
                    target.ERH_UDFCHAR06=src.ERH_UDFCHAR06, 
                    target.ERH_UDFCHAR07=src.ERH_UDFCHAR07, 
                    target.ERH_UDFCHAR08=src.ERH_UDFCHAR08, 
                    target.ERH_UDFCHAR09=src.ERH_UDFCHAR09, 
                    target.ERH_UDFCHAR10=src.ERH_UDFCHAR10, 
                    target.ERH_UDFCHAR11=src.ERH_UDFCHAR11, 
                    target.ERH_UDFCHAR12=src.ERH_UDFCHAR12, 
                    target.ERH_UDFCHAR13=src.ERH_UDFCHAR13, 
                    target.ERH_UDFCHAR14=src.ERH_UDFCHAR14, 
                    target.ERH_UDFCHAR15=src.ERH_UDFCHAR15, 
                    target.ERH_UDFCHAR16=src.ERH_UDFCHAR16, 
                    target.ERH_UDFCHAR17=src.ERH_UDFCHAR17, 
                    target.ERH_UDFCHAR18=src.ERH_UDFCHAR18, 
                    target.ERH_UDFCHAR19=src.ERH_UDFCHAR19, 
                    target.ERH_UDFCHAR20=src.ERH_UDFCHAR20, 
                    target.ERH_UDFCHAR21=src.ERH_UDFCHAR21, 
                    target.ERH_UDFCHAR22=src.ERH_UDFCHAR22, 
                    target.ERH_UDFCHAR23=src.ERH_UDFCHAR23, 
                    target.ERH_UDFCHAR24=src.ERH_UDFCHAR24, 
                    target.ERH_UDFCHAR25=src.ERH_UDFCHAR25, 
                    target.ERH_UDFCHAR26=src.ERH_UDFCHAR26, 
                    target.ERH_UDFCHAR27=src.ERH_UDFCHAR27, 
                    target.ERH_UDFCHAR28=src.ERH_UDFCHAR28, 
                    target.ERH_UDFCHAR29=src.ERH_UDFCHAR29, 
                    target.ERH_UDFCHAR30=src.ERH_UDFCHAR30, 
                    target.ERH_UDFCHKBOX01=src.ERH_UDFCHKBOX01, 
                    target.ERH_UDFCHKBOX02=src.ERH_UDFCHKBOX02, 
                    target.ERH_UDFCHKBOX03=src.ERH_UDFCHKBOX03, 
                    target.ERH_UDFCHKBOX04=src.ERH_UDFCHKBOX04, 
                    target.ERH_UDFCHKBOX05=src.ERH_UDFCHKBOX05, 
                    target.ERH_UDFDATE01=src.ERH_UDFDATE01, 
                    target.ERH_UDFDATE02=src.ERH_UDFDATE02, 
                    target.ERH_UDFDATE03=src.ERH_UDFDATE03, 
                    target.ERH_UDFDATE04=src.ERH_UDFDATE04, 
                    target.ERH_UDFDATE05=src.ERH_UDFDATE05, 
                    target.ERH_UDFNUM01=src.ERH_UDFNUM01, 
                    target.ERH_UDFNUM02=src.ERH_UDFNUM02, 
                    target.ERH_UDFNUM03=src.ERH_UDFNUM03, 
                    target.ERH_UDFNUM04=src.ERH_UDFNUM04, 
                    target.ERH_UDFNUM05=src.ERH_UDFNUM05, 
                    target.ERH_UPDATECOUNT=src.ERH_UPDATECOUNT, 
                    target.ERH_UPDATED=src.ERH_UPDATED, 
                    target.ERH_UPDATEDBY=src.ERH_UPDATEDBY, 
                    target.ERH_USAGE=src.ERH_USAGE, 
                    target.ERH_VARIABLERATING1=src.ERH_VARIABLERATING1, 
                    target.ERH_VARIABLERATING2=src.ERH_VARIABLERATING2, 
                    target.ERH_VARIABLERATING3=src.ERH_VARIABLERATING3, 
                    target.ERH_VARIABLERATING4=src.ERH_VARIABLERATING4, 
                    target.ERH_VARIABLERATING5=src.ERH_VARIABLERATING5, 
                    target.ERH_VARIABLERATING6=src.ERH_VARIABLERATING6, 
                    target.ERH_VARIABLERESULT1=src.ERH_VARIABLERESULT1, 
                    target.ERH_VARIABLERESULT2=src.ERH_VARIABLERESULT2, 
                    target.ERH_VARIABLERESULT3=src.ERH_VARIABLERESULT3, 
                    target.ERH_VARIABLERESULT4=src.ERH_VARIABLERESULT4, 
                    target.ERH_VARIABLERESULT5=src.ERH_VARIABLERESULT5, 
                    target.ERH_VARIABLERESULT6=src.ERH_VARIABLERESULT6, 
                    target._DELETED=src._DELETED, 
                    target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                    target.etl_load_datetime=CURRENT_TIMESTAMP,
                    target.etl_load_metadatafilename=src.etl_load_metadatafilename,
                    target.ETL_DELETED=src.ETL_DELETED
        when not matched   then insert ( ERH_AVAILABLECAPACITY, ERH_CAPACITYCODE, ERH_CAPACITYRATING, ERH_CONDITIONPROTOCOL, ERH_CONDITIONRATING, ERH_CONDSCOREEND, ERH_CONDSCORESTART, ERH_CONDSCORETHRESHOLD, ERH_CORRCONDITIONDATE, ERH_CORRCONDITIONREASON, ERH_CORRCONDITIONSCORE, ERH_CORRCONDITIONUSAGE, ERH_CREATED, ERH_CREATEDBY, ERH_DAILYUSAGEUOM, ERH_DATE, ERH_DECAYCURVE, ERH_DECAYCURVE_ORG, ERH_DESIREDCAPACITY, ERH_ENDOFUSEFULLIFE, ERH_FROMGEOREF, ERH_FROMPOINT, ERH_FROMREFDESC, ERH_INDEX, ERH_LASTSAVED, ERH_MTBFDAYS, ERH_MTBFRATING, ERH_MTTRHRS, ERH_MTTRRATING, ERH_MUBF, ERH_MUBFRATING, ERH_NUMBEROFFAILURES, ERH_OBJCODE, ERH_OBJORG, ERH_PERFORMANCE, ERH_PERFORMANCEFORMULA, ERH_PERFORMANCEFORMULA_ORG, ERH_PK, ERH_PRIMARYUOM, ERH_RANKINGCODE, ERH_RANKINGORG, ERH_RANKINGREVISION, ERH_RANKINGTYPE, ERH_RISKLEVEL, ERH_SCORE, ERH_SERVICELIFE, ERH_SERVICELIFEUSAGE, ERH_TOGEOREF, ERH_TOPOINT, ERH_TOREFDESC, ERH_UDFCHAR01, ERH_UDFCHAR02, ERH_UDFCHAR03, ERH_UDFCHAR04, ERH_UDFCHAR05, ERH_UDFCHAR06, ERH_UDFCHAR07, ERH_UDFCHAR08, ERH_UDFCHAR09, ERH_UDFCHAR10, ERH_UDFCHAR11, ERH_UDFCHAR12, ERH_UDFCHAR13, ERH_UDFCHAR14, ERH_UDFCHAR15, ERH_UDFCHAR16, ERH_UDFCHAR17, ERH_UDFCHAR18, ERH_UDFCHAR19, ERH_UDFCHAR20, ERH_UDFCHAR21, ERH_UDFCHAR22, ERH_UDFCHAR23, ERH_UDFCHAR24, ERH_UDFCHAR25, ERH_UDFCHAR26, ERH_UDFCHAR27, ERH_UDFCHAR28, ERH_UDFCHAR29, ERH_UDFCHAR30, ERH_UDFCHKBOX01, ERH_UDFCHKBOX02, ERH_UDFCHKBOX03, ERH_UDFCHKBOX04, ERH_UDFCHKBOX05, ERH_UDFDATE01, ERH_UDFDATE02, ERH_UDFDATE03, ERH_UDFDATE04, ERH_UDFDATE05, ERH_UDFNUM01, ERH_UDFNUM02, ERH_UDFNUM03, ERH_UDFNUM04, ERH_UDFNUM05, ERH_UPDATECOUNT, ERH_UPDATED, ERH_UPDATEDBY, ERH_USAGE, ERH_VARIABLERATING1, ERH_VARIABLERATING2, ERH_VARIABLERATING3, ERH_VARIABLERATING4, ERH_VARIABLERATING5, ERH_VARIABLERATING6, ERH_VARIABLERESULT1, ERH_VARIABLERESULT2, ERH_VARIABLERESULT3, ERH_VARIABLERESULT4, ERH_VARIABLERESULT5, ERH_VARIABLERESULT6, _DELETED, 
                    ETL_LASTSAVED,                       
                    etl_load_datetime,
                    etl_load_metadatafilename,
                    etl_is_deleted,
                    ETL_DELETED) 
            values (
                    src.ERH_AVAILABLECAPACITY, 
                    src.ERH_CAPACITYCODE, 
                    src.ERH_CAPACITYRATING, 
                    src.ERH_CONDITIONPROTOCOL, 
                    src.ERH_CONDITIONRATING, 
                    src.ERH_CONDSCOREEND, 
                    src.ERH_CONDSCORESTART, 
                    src.ERH_CONDSCORETHRESHOLD, 
                    src.ERH_CORRCONDITIONDATE, 
                    src.ERH_CORRCONDITIONREASON, 
                    src.ERH_CORRCONDITIONSCORE, 
                    src.ERH_CORRCONDITIONUSAGE, 
                    src.ERH_CREATED, 
                    src.ERH_CREATEDBY, 
                    src.ERH_DAILYUSAGEUOM, 
                    src.ERH_DATE, 
                    src.ERH_DECAYCURVE, 
                    src.ERH_DECAYCURVE_ORG, 
                    src.ERH_DESIREDCAPACITY, 
                    src.ERH_ENDOFUSEFULLIFE, 
                    src.ERH_FROMGEOREF, 
                    src.ERH_FROMPOINT, 
                    src.ERH_FROMREFDESC, 
                    src.ERH_INDEX, 
                    src.ERH_LASTSAVED, 
                    src.ERH_MTBFDAYS, 
                    src.ERH_MTBFRATING, 
                    src.ERH_MTTRHRS, 
                    src.ERH_MTTRRATING, 
                    src.ERH_MUBF, 
                    src.ERH_MUBFRATING, 
                    src.ERH_NUMBEROFFAILURES, 
                    src.ERH_OBJCODE, 
                    src.ERH_OBJORG, 
                    src.ERH_PERFORMANCE, 
                    src.ERH_PERFORMANCEFORMULA, 
                    src.ERH_PERFORMANCEFORMULA_ORG, 
                    src.ERH_PK, 
                    src.ERH_PRIMARYUOM, 
                    src.ERH_RANKINGCODE, 
                    src.ERH_RANKINGORG, 
                    src.ERH_RANKINGREVISION, 
                    src.ERH_RANKINGTYPE, 
                    src.ERH_RISKLEVEL, 
                    src.ERH_SCORE, 
                    src.ERH_SERVICELIFE, 
                    src.ERH_SERVICELIFEUSAGE, 
                    src.ERH_TOGEOREF, 
                    src.ERH_TOPOINT, 
                    src.ERH_TOREFDESC, 
                    src.ERH_UDFCHAR01, 
                    src.ERH_UDFCHAR02, 
                    src.ERH_UDFCHAR03, 
                    src.ERH_UDFCHAR04, 
                    src.ERH_UDFCHAR05, 
                    src.ERH_UDFCHAR06, 
                    src.ERH_UDFCHAR07, 
                    src.ERH_UDFCHAR08, 
                    src.ERH_UDFCHAR09, 
                    src.ERH_UDFCHAR10, 
                    src.ERH_UDFCHAR11, 
                    src.ERH_UDFCHAR12, 
                    src.ERH_UDFCHAR13, 
                    src.ERH_UDFCHAR14, 
                    src.ERH_UDFCHAR15, 
                    src.ERH_UDFCHAR16, 
                    src.ERH_UDFCHAR17, 
                    src.ERH_UDFCHAR18, 
                    src.ERH_UDFCHAR19, 
                    src.ERH_UDFCHAR20, 
                    src.ERH_UDFCHAR21, 
                    src.ERH_UDFCHAR22, 
                    src.ERH_UDFCHAR23, 
                    src.ERH_UDFCHAR24, 
                    src.ERH_UDFCHAR25, 
                    src.ERH_UDFCHAR26, 
                    src.ERH_UDFCHAR27, 
                    src.ERH_UDFCHAR28, 
                    src.ERH_UDFCHAR29, 
                    src.ERH_UDFCHAR30, 
                    src.ERH_UDFCHKBOX01, 
                    src.ERH_UDFCHKBOX02, 
                    src.ERH_UDFCHKBOX03, 
                    src.ERH_UDFCHKBOX04, 
                    src.ERH_UDFCHKBOX05, 
                    src.ERH_UDFDATE01, 
                    src.ERH_UDFDATE02, 
                    src.ERH_UDFDATE03, 
                    src.ERH_UDFDATE04, 
                    src.ERH_UDFDATE05, 
                    src.ERH_UDFNUM01, 
                    src.ERH_UDFNUM02, 
                    src.ERH_UDFNUM03, 
                    src.ERH_UDFNUM04, 
                    src.ERH_UDFNUM05, 
                    src.ERH_UPDATECOUNT, 
                    src.ERH_UPDATED, 
                    src.ERH_UPDATEDBY, 
                    src.ERH_USAGE, 
                    src.ERH_VARIABLERATING1, 
                    src.ERH_VARIABLERATING2, 
                    src.ERH_VARIABLERATING3, 
                    src.ERH_VARIABLERATING4, 
                    src.ERH_VARIABLERATING5, 
                    src.ERH_VARIABLERATING6, 
                    src.ERH_VARIABLERESULT1, 
                    src.ERH_VARIABLERESULT2, 
                    src.ERH_VARIABLERESULT3, 
                    src.ERH_VARIABLERESULT4, 
                    src.ERH_VARIABLERESULT5, 
                    src.ERH_VARIABLERESULT6, 
                    src._DELETED,     
                    src.ETL_LASTSAVED,
                    CURRENT_TIMESTAMP,
                    src.etl_load_metadatafilename,
                    case when ETL_DELETED=TRUE then TRUE else FALSE end,
                    ETL_DELETED);
    `
} );

                    
//  Get number of rows inserted
        
        var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
        var rs = sqlStmt.execute();
        var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
        var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
                    

        
    snowflake.execute ({sqlText: "commit"});

    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', 0 ," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
    snowflake.execute({sqlText: log_sql_command});

    result = "Success"; 

    }       

    catch (err)  {
        snowflake.execute( {sqlText: "rollback;"} )
        var clean_error_msg = err.message.replace(/[^\w\s]/gi, '');
    //  Create a log entry to say INSERT STATEMENT failed
    
    log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','MERGE Failed. Error:" + err.code.toString()+" : "+ clean_error_msg  + "', 0 ,0,0);";
    snowflake.execute({sqlText: log_sql_command});
        ;
        throw "Failed: " + err.message;   // Return a success/error indicator.
        }
    return result;
    $$;