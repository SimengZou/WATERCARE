CREATE OR REPLACE VIEW DATAHUB_INTEGRATION.VW_STREAM_DEPM_R100REPORTING AS SELECT
                        src:CategoryCode::varchar AS CategoryCode, 
                        src:CategoryName::varchar AS CategoryName, 
                        src:I_Actions::varchar AS I_Actions, 
                        src:I_DataChanged::varchar AS I_DataChanged, 
                        src:I_Description::varchar AS I_Description, 
                        src:I_DueDate::datetime AS I_DueDate, 
                        src:I_Impact_Cost::varchar AS I_Impact_Cost, 
                        src:I_Impact_Rank::varchar AS I_Impact_Rank, 
                        src:I_Impact_Time::varchar AS I_Impact_Time, 
                        src:I_Owner::varchar AS I_Owner, 
                        src:I_Priority::varchar AS I_Priority, 
                        src:I_Status::varchar AS I_Status, 
                        src:ProjectCode::varchar AS ProjectCode, 
                        src:ProjectName::varchar AS ProjectName, 
                        src:R_ActionsCompleted::varchar AS R_ActionsCompleted, 
                        src:R_ActionsTotal::varchar AS R_ActionsTotal, 
                        src:R_Cause::varchar AS R_Cause, 
                        src:R_Description::varchar AS R_Description, 
                        src:R_DueDate::datetime AS R_DueDate, 
                        src:R_Impact_Cost::varchar AS R_Impact_Cost, 
                        src:R_Impact_Rank::varchar AS R_Impact_Rank, 
                        src:R_Impact_Time::varchar AS R_Impact_Time, 
                        src:R_InUse::varchar AS R_InUse, 
                        src:R_IsIssue::varchar AS R_IsIssue, 
                        src:R_Mitig_Cost::varchar AS R_Mitig_Cost, 
                        src:R_Mitig_Desc::varchar AS R_Mitig_Desc, 
                        src:R_Mitig_DueDate::datetime AS R_Mitig_DueDate, 
                        src:R_Mitig_Impact_Cost::varchar AS R_Mitig_Impact_Cost, 
                        src:R_Mitig_Impact_Rank::varchar AS R_Mitig_Impact_Rank, 
                        src:R_Mitig_Impact_Time::varchar AS R_Mitig_Impact_Time, 
                        src:R_Mitig_InUse::varchar AS R_Mitig_InUse, 
                        src:R_Mitig_NotInUse::varchar AS R_Mitig_NotInUse, 
                        src:R_Mitig_Owner::varchar AS R_Mitig_Owner, 
                        src:R_Mitig_Probability_Rank::varchar AS R_Mitig_Probability_Rank, 
                        src:R_Mitig_Probability_Rate::varchar AS R_Mitig_Probability_Rate, 
                        src:R_Mitig_Risk_Cost::varchar AS R_Mitig_Risk_Cost, 
                        src:R_Mitig_Risk_Rank::varchar AS R_Mitig_Risk_Rank, 
                        src:R_Mitig_Status::varchar AS R_Mitig_Status, 
                        src:R_NotInUse::varchar AS R_NotInUse, 
                        src:R_Owner::varchar AS R_Owner, 
                        src:R_Probability_Rank::varchar AS R_Probability_Rank, 
                        src:R_Probability_Rate::varchar AS R_Probability_Rate, 
                        src:R_RiskNum::varchar AS R_RiskNum, 
                        src:R_Risk_Cost::varchar AS R_Risk_Cost, 
                        src:R_Risk_Rank::varchar AS R_Risk_Rank, 
                        src:R_Status::varchar AS R_Status, 
                        src:R_Status_Msg::varchar AS R_Status_Msg, 
                        src:R_Title::varchar AS R_Title, 
                        src:R_Treatment::varchar AS R_Treatment, 
                        src:RiskActionID::varchar AS RiskActionID, 
                        src:RiskID::varchar AS RiskID, 
                        src:TimeStamp::datetime AS TimeStamp, 
                        src:Type::varchar AS Type, 
                        src:Version::varchar AS Version, 
                        src:WBSCode::varchar AS WBSCode, 
                        src:WBSName::varchar AS WBSName, 
                        src:TimeStamp::datetime as ETL_LASTSAVED,etl_load_datetime, etl_load_metadatafilename FROM (SELECT * FROM ( SELECT
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:ProjectCode,
                src:R_ActionsCompleted,
                src:R_Status,
                src:ProjectName,
                src:R_Treatment,
                src:R_Mitig_Impact_Cost,
                src:R_Probability_Rank,
                src:R_Description,
                src:R_Risk_Rank,
                src:CategoryName,
                src:R_ActionsTotal,
                src:R_Owner,
                src:R_RiskNum,
                src:TimeStamp,
                src:I_Status,
                src:R_Mitig_Risk_Rank,
                src:WBSCode,
                src:R_Mitig_Impact_Rank,
                src:I_Impact_Rank,
                src:R_Title,
                src:R_Mitig_Risk_Cost,
                src:I_DataChanged,
                src:R_Mitig_DueDate,
                src:R_Mitig_Probability_Rank,
                src:CategoryCode,
                src:R_Impact_Rank,
                src:R_Risk_Cost,
                src:R_DueDate,
                src:R_Mitig_Probability_Rate,
                src:I_Description,
                src:R_Cause,
                src:R_Mitig_Cost,
                src:Version,
                src:R_InUse,
                src:RiskActionID,
                src:I_Owner,
                src:R_Mitig_InUse,
                src:I_Actions,
                src:I_Priority,
                src:R_Impact_Time,
                src:R_Probability_Rate,
                src:R_Mitig_Owner,
                src:WBSName,
                src:R_Mitig_NotInUse,
                src:I_Impact_Time,
                src:R_Mitig_Desc,
                src:RiskID,
                src:R_IsIssue,
                src:R_NotInUse,
                src:I_Impact_Cost,
                src:R_Impact_Cost,
                src:R_Status_Msg,
                src:R_Mitig_Impact_Time,
                src:Type,
                src:I_DueDate,
                src:R_Mitig_Status  ORDER BY 
            src:Timestamp desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_INTEGRATION.STREAM_DEPM_R100REPORTING as strm)
                WHERE
                ROWNUMBER=1) where 
                    TRY_TO_TIMESTAMP(nvl(AS_VARCHAR(src:I_DueDate), '1900-01-01')) is not null and 
                    TRY_TO_TIMESTAMP(nvl(AS_VARCHAR(src:R_DueDate), '1900-01-01')) is not null and 
                    TRY_TO_TIMESTAMP(nvl(AS_VARCHAR(src:R_Mitig_DueDate), '1900-01-01')) is not null and 
                    TRY_TO_TIMESTAMP(nvl(AS_VARCHAR(src:TimeStamp), '1900-01-01')) is not null and 
                TRY_TO_TIMESTAMP(nvl(AS_VARCHAR(src:Timestamp), '1900-01-01')) is not null