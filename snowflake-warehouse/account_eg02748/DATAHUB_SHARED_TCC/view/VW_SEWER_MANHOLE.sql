CREATE OR REPLACE VIEW DATAHUB_SHARED_TCC.VW_SEWER_MANHOLE
AS
SELECT 
 A2."COMPKEY"::NUMBER(38) AS "CompKey"
, A2."ADDRKEY"::NUMBER(38) AS "Address"
, A2."BGTNO"::VARCHAR(24) AS "Equipment No"
, A2."UNITDESC"::VARCHAR(300) AS "Description"
, A1."DRAWINGNO"::VARCHAR(30) AS "Drawing No"
, A1."DRAWINGNOREF"::VARCHAR(30) AS "Drawing No Ref"
, A2."ASBLT"::VARCHAR(10) AS "Legacy Key"
, A2."AREA"::VARCHAR(10) AS "Facility Code"
, 'TBD'::VARCHAR(3) AS "Facility Description"
, A2."SUBAREA"::VARCHAR(10) AS "Process Code"
, 'TBD'::VARCHAR(3) AS "Process Description"
, A2."DISTRICT"::VARCHAR(10) AS "System Code"
, 'TBD'::VARCHAR(3) AS "System Description"
, A2."LOC"::VARCHAR(10) AS "Set Code"
, 'TBD'::VARCHAR(3) AS "Set Description"
, A2."MAPNO"::VARCHAR(14) AS "Position"
, A2."UNITTYPE"::VARCHAR(10) AS "Unit Type Code"
, 'TBD'::VARCHAR(3) AS "Unit Type Description"
, A2."UNITID"::VARCHAR(50) AS "Manhole ID"
, A1."MODELNO"::VARCHAR(30) AS "Model #"
, A2."SURF"::VARCHAR(10) AS "Surface Cover Code"
, 'TBD'::VARCHAR(3) AS "Surface Cover Description"
, A2."WALLTYPE"::VARCHAR(10) AS "Wall Material Code"
, 'TBD'::VARCHAR(3) AS "Wall Material Description"
, A2."BARLDIAM"::FLOAT AS "Barrel Diameter"
, A2."MHDPTH"::FLOAT AS "Depth"
, A2."DROPMH"::VARCHAR(1) AS "Drop Manhole"
, A2."INSTDATE"::TIMESTAMP_NTZ(9) AS "Installed"
, A1."ACQTYPE"::VARCHAR(10) AS "Acquistion Type"
, A1."CRITICALITY"::VARCHAR(10) AS "Criticality Code"
, 'TBD'::VARCHAR(3) AS "Criticality Description"
, A1."SAFETYCRITICAL"::VARCHAR(1) AS "Safety Critical Element"
, A2."SERVSTAT"::VARCHAR(10) AS "Service Status"
, A2."OWN"::VARCHAR(10) AS "Ownership Code"
, 'TBD'::VARCHAR(3) AS "Ownership Description"
, A1."COSTCENTRE"::VARCHAR(10) AS "Cost Centre Code"
, 'TBD'::VARCHAR(3) AS "Cost Centre Description"
, A2.CVRDIAM::FLOAT AS "Cover Diameter"
, A2."EXPDATE"::TIMESTAMP_NTZ(9) AS "Expire Date"
, A1."FORDISPOSAL"::VARCHAR(10) AS "Disposal Reason"
, ad."NZHOUSENO"::VARCHAR(10) AS "Street Number"
, CONCAT(ad."NZSTNAME",' ',ad."NZSTTYPE")::VARCHAR(33) AS "Street Name"
, ad."NZSUBURB"::VARCHAR(30) AS "City"
, ad."NZPOSTCODE"::VARCHAR(5) AS "Postal Code"
, A1.MAKE::VARCHAR(10) AS Make
, A1.ZONECATCHMENT::VARCHAR(10) AS "Water Zone/Sewer Catchment"
, XSEWERMANHOLES.BOLTDOWN::VARCHAR(1) AS "Boltdown"
, CVRTYPE::VARCHAR(10) AS "Cover Type"
, XSEWERMANHOLES.DIAMEXT::FLOAT AS "Diameter External (mm)"
, XSEWERMANHOLES.DIAMINT::FLOAT AS "Diameter Internal (mm)"
, XSEWERMANHOLES.HINGED::VARCHAR(1) AS "Hinged "
, XSEWERMANHOLES.INVLEVEL::FLOAT AS "Invert Level (M)"
, DROPMH::VARCHAR(1) AS "Is Drop Manhole"
, XSEWERMANHOLES.LidLevel::FLOAT AS "Lid Level (M)"
, XSEWERMANHOLES.Lockable::VARCHAR(1) AS "Lockable"
, XSEWERMANHOLES.Removable::VARCHAR(1) AS "Removable"
, XSEWERMANHOLES.SubTypeFeatures::VARCHAR(10) AS "SubType Features"
, A1.WARRANTYEND::TIMESTAMP_NTZ(9) AS "Warranty End Date"
, A1.WARRANTYSTART::TIMESTAMP_NTZ(9) AS "Warranty Start Date"
, XSEWERMANHOLES.DesignResilience::VARCHAR(10) AS "Design Resilience"
, XSEWERMANHOLES.QuakeDesign::VARCHAR(10) AS "Earthquake Design Level"
, XSEWERMANHOLES.FallProtect::VARCHAR(1) AS "Fall Protection"
, XSEWERMANHOLES.FuncArea::VARCHAR(10) AS "Functional Area"
, XSEWERMANHOLES.GRDLEVEL::FLOAT AS "Ground Level"
, XSEWERMANHOLES.INTLINING::VARCHAR(10) AS "Internal Lining"
, XSEWERMANHOLES.LoadRating::FLOAT AS "Load Rating (kN)"
, XSEWERMANHOLES.Locality::VARCHAR(10) AS "Locality"
, XSEWERMANHOLES.MediaType::VARCHAR(10) AS "Media Type"
, XSEWERMANHOLES.Photo3D::VARCHAR(300) AS "Photo/3D Model"
FROM
 "DATAHUB_TARGET"."IPS_ASSETMANAGEMENT_SEWER_COMPSMH" AS A2
 INNER JOIN "DATAHUB_TARGET"."IPS_WSLASSETS_XALLASSETSDP02" AS A1 ON A2.COMPKEY = A1.COMPKEY AND A1.BUSINESSAREA = 'TCC'
 LEFT OUTER JOIN "DATAHUB_TARGET"."IPS_PROPERTY_ADDRESS" AS ad ON ad.ADDRKEY = a2.ADDRKEY AND ad.OPTA = 'TCC'
 LEFT OUTER JOIN DATAHUB_TARGET.IPS_WSLASSETSSEWER_XSEWERMANHOLES AS XSEWERMANHOLES ON A2.COMPKEY = XSEWERMANHOLES.COMPKEY 
 WHERE A2.BLDGFLOOR = 1002;
 

