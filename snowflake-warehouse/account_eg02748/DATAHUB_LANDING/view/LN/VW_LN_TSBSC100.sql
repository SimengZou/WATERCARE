CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_TSBSC100 AS SELECT
                        src:bfad::varchar AS bfad, 
                        src:bfad_ref_compnr::integer AS bfad_ref_compnr, 
                        src:bfbp::varchar AS bfbp, 
                        src:bfbp_ref_compnr::integer AS bfbp_ref_compnr, 
                        src:bfcn::varchar AS bfcn, 
                        src:bfcn_ref_compnr::integer AS bfcn_ref_compnr, 
                        src:ccal::varchar AS ccal, 
                        src:ccal_ref_compnr::integer AS ccal_ref_compnr, 
                        src:ccha::numeric(38, 17) AS ccha, 
                        src:ccur::varchar AS ccur, 
                        src:ccur_ref_compnr::integer AS ccur_ref_compnr, 
                        src:clrt::varchar AS clrt, 
                        src:clrt_ref_compnr::integer AS clrt_ref_compnr, 
                        src:clst::varchar AS clst, 
                        src:cnln::varchar AS cnln, 
                        src:compnr::integer AS compnr, 
                        src:csar::varchar AS csar, 
                        src:csar_ref_compnr::integer AS csar_ref_compnr, 
                        src:cusc::varchar AS cusc, 
                        src:cusc_ref_compnr::integer AS cusc_ref_compnr, 
                        src:cwar::varchar AS cwar, 
                        src:cwar_ref_compnr::integer AS cwar_ref_compnr, 
                        src:czon::varchar AS czon, 
                        src:czon_ref_compnr::integer AS czon_ref_compnr, 
                        src:dbpo::integer AS dbpo, 
                        src:dbpo_kw::varchar AS dbpo_kw, 
                        src:deleted::boolean AS deleted, 
                        src:desc::object AS desc, 
                        src:dlad::varchar AS dlad, 
                        src:dlad_ref_compnr::integer AS dlad_ref_compnr, 
                        src:dlcn::varchar AS dlcn, 
                        src:dlcn_ref_compnr::integer AS dlcn_ref_compnr, 
                        src:dler::varchar AS dler, 
                        src:dler_ref_compnr::integer AS dler_ref_compnr, 
                        src:eftm::datetime AS eftm, 
                        src:exin::object AS exin, 
                        src:imag::varchar AS imag, 
                        src:lcad::varchar AS lcad, 
                        src:lcad_ref_compnr::integer AS lcad_ref_compnr, 
                        src:lcmp::integer AS lcmp, 
                        src:lcmp_ref_compnr::integer AS lcmp_ref_compnr, 
                        src:lste::varchar AS lste, 
                        src:lste_ref_compnr::integer AS lste_ref_compnr, 
                        src:mdnr::varchar AS mdnr, 
                        src:mdpt::varchar AS mdpt, 
                        src:mdpt_ref_compnr::integer AS mdpt_ref_compnr, 
                        src:odpt::varchar AS odpt, 
                        src:odpt_ref_compnr::integer AS odpt_ref_compnr, 
                        src:ofad::varchar AS ofad, 
                        src:ofad_ref_compnr::integer AS ofad_ref_compnr, 
                        src:ofbp::varchar AS ofbp, 
                        src:ofbp_ref_compnr::integer AS ofbp_ref_compnr, 
                        src:ofcn::varchar AS ofcn, 
                        src:ofcn_ref_compnr::integer AS ofcn_ref_compnr, 
                        src:ortp::integer AS ortp, 
                        src:ortp_kw::varchar AS ortp_kw, 
                        src:owtp::integer AS owtp, 
                        src:owtp_kw::varchar AS owtp_kw, 
                        src:prfa::varchar AS prfa, 
                        src:prfa_ref_compnr::integer AS prfa_ref_compnr, 
                        src:prfb::varchar AS prfb, 
                        src:prfb_ref_compnr::integer AS prfb_ref_compnr, 
                        src:prio::integer AS prio, 
                        src:prio_ref_compnr::integer AS prio_ref_compnr, 
                        src:rspe::varchar AS rspe, 
                        src:rspe_ref_compnr::integer AS rspe_ref_compnr, 
                        src:rste::varchar AS rste, 
                        src:rste_ref_compnr::integer AS rste_ref_compnr, 
                        src:sdno::integer AS sdno, 
                        src:sear::object AS sear, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:soff::varchar AS soff, 
                        src:soff_ref_compnr::integer AS soff_ref_compnr, 
                        src:spno::integer AS spno, 
                        src:srno::varchar AS srno, 
                        src:timestamp::datetime AS timestamp, 
                        src:trdt::numeric(38, 17) AS trdt, 
                        src:trtm::numeric(38, 17) AS trtm, 
                        src:txta::integer AS txta, 
                        src:txta_ref_compnr::integer AS txta_ref_compnr, 
                        src:ubad::varchar AS ubad, 
                        src:ubad_ref_compnr::integer AS ubad_ref_compnr, 
                        src:ubbp::varchar AS ubbp, 
                        src:ubbp_ref_compnr::integer AS ubbp_ref_compnr, 
                        src:ubcn::varchar AS ubcn, 
                        src:ubcn_ref_compnr::integer AS ubcn_ref_compnr, 
                        src:ubop::varchar AS ubop, 
                        src:ubop_ref_compnr::integer AS ubop_ref_compnr, 
                        src:ubpc::integer AS ubpc, 
                        src:ubpc_kw::varchar AS ubpc_kw, 
                        src:username::varchar AS username, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:compnr,
                src:clst,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:compnr,
                src:clst  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_TSBSC100 as strm))