CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_TPPDM605 AS SELECT
                        src:abpp::integer AS abpp, 
                        src:abpp_kw::varchar AS abpp_kw, 
                        src:abrf::integer AS abrf, 
                        src:abrf_kw::varchar AS abrf_kw, 
                        src:acgm::integer AS acgm, 
                        src:acgm_kw::varchar AS acgm_kw, 
                        src:acmp::integer AS acmp, 
                        src:acmp_kw::varchar AS acmp_kw, 
                        src:acpc::numeric(38, 17) AS acpc, 
                        src:aerf::numeric(38, 17) AS aerf, 
                        src:aext::varchar AS aext, 
                        src:agty::integer AS agty, 
                        src:agty_kw::varchar AS agty_kw, 
                        src:anbr::varchar AS anbr, 
                        src:aprp::numeric(38, 17) AS aprp, 
                        src:arpc::numeric(38, 17) AS arpc, 
                        src:arrl::numeric(38, 17) AS arrl, 
                        src:arrm::integer AS arrm, 
                        src:arrm_kw::varchar AS arrm_kw, 
                        src:arrt::numeric(38, 17) AS arrt, 
                        src:ascd::object AS ascd, 
                        src:avtp::varchar AS avtp, 
                        src:avtp_ref_compnr::integer AS avtp_ref_compnr, 
                        src:bdmt::integer AS bdmt, 
                        src:bdmt_kw::varchar AS bdmt_kw, 
                        src:bfpp::integer AS bfpp, 
                        src:bfpp_kw::varchar AS bfpp_kw, 
                        src:bfrf::integer AS bfrf, 
                        src:bfrf_kw::varchar AS bfrf_kw, 
                        src:btco::integer AS btco, 
                        src:btco_kw::varchar AS btco_kw, 
                        src:btdt::datetime AS btdt, 
                        src:btpr::integer AS btpr, 
                        src:btpr_kw::varchar AS btpr_kw, 
                        src:capp::integer AS capp, 
                        src:capp_kw::varchar AS capp_kw, 
                        src:carr::varchar AS carr, 
                        src:carr_ref_compnr::integer AS carr_ref_compnr, 
                        src:ccal::varchar AS ccal, 
                        src:ccam::varchar AS ccam, 
                        src:ccam_ref_compnr::integer AS ccam_ref_compnr, 
                        src:ccat::varchar AS ccat, 
                        src:ccat_ref_compnr::integer AS ccat_ref_compnr, 
                        src:ccdt::datetime AS ccdt, 
                        src:ccot::varchar AS ccot, 
                        src:ccot_ref_compnr::integer AS ccot_ref_compnr, 
                        src:ccur::varchar AS ccur, 
                        src:ccur_ref_compnr::integer AS ccur_ref_compnr, 
                        src:cdis::varchar AS cdis, 
                        src:cdis_ref_compnr::integer AS cdis_ref_compnr, 
                        src:cfac::varchar AS cfac, 
                        src:cfac_ref_compnr::integer AS cfac_ref_compnr, 
                        src:cfpr::integer AS cfpr, 
                        src:cfye::integer AS cfye, 
                        src:cldr::varchar AS cldr, 
                        src:cldr_ref_compnr::integer AS cldr_ref_compnr, 
                        src:cmog::integer AS cmog, 
                        src:cmog_kw::varchar AS cmog_kw, 
                        src:cmpc::integer AS cmpc, 
                        src:cmpc_kw::varchar AS cmpc_kw, 
                        src:cmud::varchar AS cmud, 
                        src:cmud_ref_compnr::integer AS cmud_ref_compnr, 
                        src:cobs::varchar AS cobs, 
                        src:cobs_ref_compnr::integer AS cobs_ref_compnr, 
                        src:cogc::numeric(38, 17) AS cogc, 
                        src:cogs::integer AS cogs, 
                        src:cogs_kw::varchar AS cogs_kw, 
                        src:compnr::integer AS compnr, 
                        src:copr::numeric(38, 17) AS copr, 
                        src:coty::integer AS coty, 
                        src:coty_kw::varchar AS coty_kw, 
                        src:cpla::varchar AS cpla, 
                        src:cprj::varchar AS cprj, 
                        src:cprj_ccal_ref_compnr::integer AS cprj_ccal_ref_compnr, 
                        src:cprj_cpla_ref_compnr::integer AS cprj_cpla_ref_compnr, 
                        src:cprj_cpla_rsac_ref_compnr::integer AS cprj_cpla_rsac_ref_compnr, 
                        src:cprj_cspa_ref_compnr::integer AS cprj_cspa_ref_compnr, 
                        src:cprj_ref_compnr::integer AS cprj_ref_compnr, 
                        src:cprq::integer AS cprq, 
                        src:cprq_kw::varchar AS cprq_kw, 
                        src:creg::varchar AS creg, 
                        src:creg_ref_compnr::integer AS creg_ref_compnr, 
                        src:crte::varchar AS crte, 
                        src:crte_ref_compnr::integer AS crte_ref_compnr, 
                        src:crtp::varchar AS crtp, 
                        src:crtp_ref_compnr::integer AS crtp_ref_compnr, 
                        src:csec::varchar AS csec, 
                        src:csec_ref_compnr::integer AS csec_ref_compnr, 
                        src:cspa::varchar AS cspa, 
                        src:cstg::varchar AS cstg, 
                        src:cstg_ref_compnr::integer AS cstg_ref_compnr, 
                        src:cuni::varchar AS cuni, 
                        src:cuni_ref_compnr::integer AS cuni_ref_compnr, 
                        src:deleted::boolean AS deleted, 
                        src:dlau::datetime AS dlau, 
                        src:dldt::datetime AS dldt, 
                        src:dsca::object AS dsca, 
                        src:dscb::object AS dscb, 
                        src:dscc::object AS dscc, 
                        src:dscd::object AS dscd, 
                        src:dwar::varchar AS dwar, 
                        src:dwar_ref_compnr::integer AS dwar_ref_compnr, 
                        src:earf::numeric(38, 17) AS earf, 
                        src:entu::varchar AS entu, 
                        src:espt::numeric(38, 17) AS espt, 
                        src:fddt::datetime AS fddt, 
                        src:guid::varchar AS guid, 
                        src:hbpc::numeric(38, 17) AS hbpc, 
                        src:hdat::datetime AS hdat, 
                        src:hsts::integer AS hsts, 
                        src:hsts_kw::varchar AS hsts_kw, 
                        src:husr::varchar AS husr, 
                        src:igcd::integer AS igcd, 
                        src:igcd_kw::varchar AS igcd_kw, 
                        src:inst::varchar AS inst, 
                        src:intp::integer AS intp, 
                        src:intp_kw::varchar AS intp_kw, 
                        src:invm::integer AS invm, 
                        src:invm_kw::varchar AS invm_kw, 
                        src:invr::integer AS invr, 
                        src:invr_kw::varchar AS invr_kw, 
                        src:ipin::integer AS ipin, 
                        src:ipin_kw::varchar AS ipin_kw, 
                        src:kopr::integer AS kopr, 
                        src:kopr_kw::varchar AS kopr_kw, 
                        src:kptm::integer AS kptm, 
                        src:kptm_kw::varchar AS kptm_kw, 
                        src:lcdt::datetime AS lcdt, 
                        src:lcla::varchar AS lcla, 
                        src:lclg::varchar AS lclg, 
                        src:lmdt::datetime AS lmdt, 
                        src:lmus::varchar AS lmus, 
                        src:logc::varchar AS logc, 
                        src:logh::varchar AS logh, 
                        src:lpdt::datetime AS lpdt, 
                        src:ltrc::datetime AS ltrc, 
                        src:ltrs::datetime AS ltrs, 
                        src:lwha::integer AS lwha, 
                        src:lwha_kw::varchar AS lwha_kw, 
                        src:lwhb::integer AS lwhb, 
                        src:lwhb_kw::varchar AS lwhb_kw, 
                        src:lwhc::integer AS lwhc, 
                        src:lwhc_kw::varchar AS lwhc_kw, 
                        src:lwhd::integer AS lwhd, 
                        src:lwhd_kw::varchar AS lwhd_kw, 
                        src:lwta::integer AS lwta, 
                        src:lwta_kw::varchar AS lwta_kw, 
                        src:lwtb::integer AS lwtb, 
                        src:lwtb_kw::varchar AS lwtb_kw, 
                        src:lwtc::integer AS lwtc, 
                        src:lwtc_kw::varchar AS lwtc_kw, 
                        src:mprj::varchar AS mprj, 
                        src:ncmp::integer AS ncmp, 
                        src:njsp::integer AS njsp, 
                        src:ofes::varchar AS ofes, 
                        src:ofes_ref_compnr::integer AS ofes_ref_compnr, 
                        src:ofpr::varchar AS ofpr, 
                        src:ofpr_ref_compnr::integer AS ofpr_ref_compnr, 
                        src:padr::varchar AS padr, 
                        src:padr_ref_compnr::integer AS padr_ref_compnr, 
                        src:pcba::numeric(38, 17) AS pcba, 
                        src:pceq::numeric(38, 17) AS pceq, 
                        src:pcic::numeric(38, 17) AS pcic, 
                        src:pcit::numeric(38, 17) AS pcit, 
                        src:pcmp::numeric(38, 17) AS pcmp, 
                        src:pcrd::datetime AS pcrd, 
                        src:pcsb::numeric(38, 17) AS pcsb, 
                        src:pcts::numeric(38, 17) AS pcts, 
                        src:pcwa::numeric(38, 17) AS pcwa, 
                        src:peri::integer AS peri, 
                        src:plcd::integer AS plcd, 
                        src:plcd_kw::varchar AS plcd_kw, 
                        src:plgr::varchar AS plgr, 
                        src:plgr_ref_compnr::integer AS plgr_ref_compnr, 
                        src:pmfc::varchar AS pmfc, 
                        src:pmfc_ref_compnr::integer AS pmfc_ref_compnr, 
                        src:pmng::varchar AS pmng, 
                        src:pmng_ref_compnr::integer AS pmng_ref_compnr, 
                        src:potp::varchar AS potp, 
                        src:potp_ref_compnr::integer AS potp_ref_compnr, 
                        src:preq::integer AS preq, 
                        src:preq_kw::varchar AS preq_kw, 
                        src:prgm::varchar AS prgm, 
                        src:prgm_ref_compnr::integer AS prgm_ref_compnr, 
                        src:pric::integer AS pric, 
                        src:pric_kw::varchar AS pric_kw, 
                        src:prit::integer AS prit, 
                        src:prit_kw::varchar AS prit_kw, 
                        src:pror::integer AS pror, 
                        src:pror_kw::varchar AS pror_kw, 
                        src:prpc::numeric(38, 17) AS prpc, 
                        src:prre::integer AS prre, 
                        src:prre_kw::varchar AS prre_kw, 
                        src:prsb::integer AS prsb, 
                        src:prsb_kw::varchar AS prsb_kw, 
                        src:prts::integer AS prts, 
                        src:prts_kw::varchar AS prts_kw, 
                        src:pscd::object AS pscd, 
                        src:pseq::integer AS pseq, 
                        src:psic::integer AS psic, 
                        src:psit::integer AS psit, 
                        src:pssc::integer AS pssc, 
                        src:psta::integer AS psta, 
                        src:pstf::integer AS pstf, 
                        src:pstf_kw::varchar AS pstf_kw, 
                        src:psts::integer AS psts, 
                        src:psts_kw::varchar AS psts_kw, 
                        src:ptcs::numeric(38, 17) AS ptcs, 
                        src:pwar::varchar AS pwar, 
                        src:pwar_ref_compnr::integer AS pwar_ref_compnr, 
                        src:ratc::numeric(38, 17) AS ratc, 
                        src:rate_1::numeric(38, 17) AS rate_1, 
                        src:rate_2::numeric(38, 17) AS rate_2, 
                        src:rate_3::numeric(38, 17) AS rate_3, 
                        src:ratf_1::integer AS ratf_1, 
                        src:ratf_2::integer AS ratf_2, 
                        src:ratf_3::integer AS ratf_3, 
                        src:rats::numeric(38, 17) AS rats, 
                        src:rcmc_1::numeric(38, 17) AS rcmc_1, 
                        src:rcmc_2::numeric(38, 17) AS rcmc_2, 
                        src:rcmc_3::numeric(38, 17) AS rcmc_3, 
                        src:rdat::datetime AS rdat, 
                        src:revl::numeric(38, 17) AS revl, 
                        src:revr::integer AS revr, 
                        src:revr_kw::varchar AS revr_kw, 
                        src:revt::numeric(38, 17) AS revt, 
                        src:rfcu::object AS rfcu, 
                        src:ripr::varchar AS ripr, 
                        src:ripr_ref_compnr::integer AS ripr_ref_compnr, 
                        src:rjct::integer AS rjct, 
                        src:rjct_kw::varchar AS rjct_kw, 
                        src:rrtp::varchar AS rrtp, 
                        src:rrtp_ref_compnr::integer AS rrtp_ref_compnr, 
                        src:rsac::varchar AS rsac, 
                        src:rsip::varchar AS rsip, 
                        src:rsmc_1::numeric(38, 17) AS rsmc_1, 
                        src:rsmc_2::numeric(38, 17) AS rsmc_2, 
                        src:rsmc_3::numeric(38, 17) AS rsmc_3, 
                        src:rsrv::integer AS rsrv, 
                        src:rtyp::varchar AS rtyp, 
                        src:rtyp_ref_compnr::integer AS rtyp_ref_compnr, 
                        src:sadr::varchar AS sadr, 
                        src:sadr_ref_compnr::integer AS sadr_ref_compnr, 
                        src:seak::object AS seak, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:stdt::datetime AS stdt, 
                        src:stus::integer AS stus, 
                        src:stus_kw::varchar AS stus_kw, 
                        src:tbdg::integer AS tbdg, 
                        src:tbdg_kw::varchar AS tbdg_kw, 
                        src:timestamp::datetime AS timestamp, 
                        src:tmpl::integer AS tmpl, 
                        src:tmpl_kw::varchar AS tmpl_kw, 
                        src:tpac::varchar AS tpac, 
                        src:txta::integer AS txta, 
                        src:txta_ref_compnr::integer AS txta_ref_compnr, 
                        src:uobs::integer AS uobs, 
                        src:uobs_kw::varchar AS uobs_kw, 
                        src:upal::integer AS upal, 
                        src:upal_kw::varchar AS upal_kw, 
                        src:user::varchar AS user, 
                        src:username::varchar AS username, 
                        src:ussu::integer AS ussu, 
                        src:ussu_kw::varchar AS ussu_kw, 
                        src:wipc::numeric(38, 17) AS wipc, 
                        src:year::integer AS year, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:hdat,
                src:cprj,
                src:compnr,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:hdat,
                src:cprj,
                src:compnr  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_TPPDM605 as strm))