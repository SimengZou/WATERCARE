CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_TPPSS200 AS SELECT
                        src:acmn::varchar AS acmn, 
                        src:acmn_ref_compnr::integer AS acmn_ref_compnr, 
                        src:actp::integer AS actp, 
                        src:addr::varchar AS addr, 
                        src:addr_ref_compnr::integer AS addr_ref_compnr, 
                        src:aext::varchar AS aext, 
                        src:afdt::datetime AS afdt, 
                        src:afrt::integer AS afrt, 
                        src:afrt_kw::varchar AS afrt_kw, 
                        src:anbr::varchar AS anbr, 
                        src:asdt::datetime AS asdt, 
                        src:avtp::varchar AS avtp, 
                        src:avtp_ref_compnr::integer AS avtp_ref_compnr, 
                        src:blbl::integer AS blbl, 
                        src:blbl_kw::varchar AS blbl_kw, 
                        src:cact::varchar AS cact, 
                        src:capa::integer AS capa, 
                        src:capa_kw::varchar AS capa_kw, 
                        src:capt::integer AS capt, 
                        src:capt_kw::varchar AS capt_kw, 
                        src:ccal::varchar AS ccal, 
                        src:ccat::varchar AS ccat, 
                        src:ccat_ref_compnr::integer AS ccat_ref_compnr, 
                        src:cctr::integer AS cctr, 
                        src:cctr_kw::varchar AS cctr_kw, 
                        src:cdf_awip::numeric(38, 17) AS cdf_awip, 
                        src:cdf_camt::numeric(38, 17) AS cdf_camt, 
                        src:cdf_depm::integer AS cdf_depm, 
                        src:cdf_depm_kw::varchar AS cdf_depm_kw, 
                        src:cdf_uamt::numeric(38, 17) AS cdf_uamt, 
                        src:cloc::varchar AS cloc, 
                        src:cnsd::datetime AS cnsd, 
                        src:cnst::integer AS cnst, 
                        src:cnst_kw::varchar AS cnst_kw, 
                        src:coel::varchar AS coel, 
                        src:coel_rcmp::integer AS coel_rcmp, 
                        src:compnr::integer AS compnr, 
                        src:cpla::varchar AS cpla, 
                        src:cprj::varchar AS cprj, 
                        src:cprj_cloc_ref_compnr::integer AS cprj_cloc_ref_compnr, 
                        src:cprj_cpla_lact_ref_compnr::integer AS cprj_cpla_lact_ref_compnr, 
                        src:cprj_cpla_pact_ref_compnr::integer AS cprj_cpla_pact_ref_compnr, 
                        src:cprj_cpla_ref_compnr::integer AS cprj_cpla_ref_compnr, 
                        src:cprj_cstl_ref_compnr::integer AS cprj_cstl_ref_compnr, 
                        src:cprj_ref_compnr::integer AS cprj_ref_compnr, 
                        src:creg::varchar AS creg, 
                        src:creg_ref_compnr::integer AS creg_ref_compnr, 
                        src:csec::varchar AS csec, 
                        src:csec_ref_compnr::integer AS csec_ref_compnr, 
                        src:cspt::integer AS cspt, 
                        src:cspt_kw::varchar AS cspt_kw, 
                        src:cstg::varchar AS cstg, 
                        src:cstg_ref_compnr::integer AS cstg_ref_compnr, 
                        src:cstl::varchar AS cstl, 
                        src:cstv::numeric(38, 17) AS cstv, 
                        src:cuni::varchar AS cuni, 
                        src:cuni_ref_compnr::integer AS cuni_ref_compnr, 
                        src:cuti::varchar AS cuti, 
                        src:cuti_ref_compnr::integer AS cuti_ref_compnr, 
                        src:cuvc::varchar AS cuvc, 
                        src:cuvc_ref_compnr::integer AS cuvc_ref_compnr, 
                        src:ddln::datetime AS ddln, 
                        src:deleted::boolean AS deleted, 
                        src:desc::object AS desc, 
                        src:dfac::varchar AS dfac, 
                        src:dfac_ref_compnr::integer AS dfac_ref_compnr, 
                        src:dura::numeric(38, 17) AS dura, 
                        src:dwar::varchar AS dwar, 
                        src:dwar_ref_compnr::integer AS dwar_ref_compnr, 
                        src:efdt::datetime AS efdt, 
                        src:eoid::varchar AS eoid, 
                        src:eoty::integer AS eoty, 
                        src:eoty_kw::varchar AS eoty_kw, 
                        src:esdt::datetime AS esdt, 
                        src:ffhr::numeric(38, 17) AS ffhr, 
                        src:fref::numeric(38, 17) AS fref, 
                        src:freq::numeric(38, 17) AS freq, 
                        src:glat::numeric(38, 17) AS glat, 
                        src:glon::numeric(38, 17) AS glon, 
                        src:gris::integer AS gris, 
                        src:hbyn::integer AS hbyn, 
                        src:hbyn_kw::varchar AS hbyn_kw, 
                        src:lact::varchar AS lact, 
                        src:levl::integer AS levl, 
                        src:lfdt::datetime AS lfdt, 
                        src:litm::varchar AS litm, 
                        src:litm_ref_compnr::integer AS litm_ref_compnr, 
                        src:llnr::integer AS llnr, 
                        src:lsdt::datetime AS lsdt, 
                        src:lvps::integer AS lvps, 
                        src:lvps_kw::varchar AS lvps_kw, 
                        src:mamt::numeric(38, 17) AS mamt, 
                        src:mevl::integer AS mevl, 
                        src:mevl_kw::varchar AS mevl_kw, 
                        src:ohdt::datetime AS ohdt, 
                        src:pact::varchar AS pact, 
                        src:pcom::numeric(38, 17) AS pcom, 
                        src:plmc::integer AS plmc, 
                        src:plmp::varchar AS plmp, 
                        src:prin::integer AS prin, 
                        src:prin_kw::varchar AS prin_kw, 
                        src:pris::numeric(38, 17) AS pris, 
                        src:prms::numeric(38, 17) AS prms, 
                        src:prnd::numeric(38, 17) AS prnd, 
                        src:prsp::numeric(38, 17) AS prsp, 
                        src:prss::numeric(38, 17) AS prss, 
                        src:prst::numeric(38, 17) AS prst, 
                        src:pwar::varchar AS pwar, 
                        src:pwar_ref_compnr::integer AS pwar_ref_compnr, 
                        src:qans::numeric(38, 17) AS qans, 
                        src:quan::numeric(38, 17) AS quan, 
                        src:qutm::numeric(38, 17) AS qutm, 
                        src:rcod::varchar AS rcod, 
                        src:rcod_ref_compnr::integer AS rcod_ref_compnr, 
                        src:rdas::datetime AS rdas, 
                        src:rdse::datetime AS rdse, 
                        src:rent::integer AS rent, 
                        src:rent_kw::varchar AS rent_kw, 
                        src:rfac::varchar AS rfac, 
                        src:rfsa_1::integer AS rfsa_1, 
                        src:rfsa_2::integer AS rfsa_2, 
                        src:rfsa_3::integer AS rfsa_3, 
                        src:rfse_1::integer AS rfse_1, 
                        src:rfse_2::integer AS rfse_2, 
                        src:rfse_3::integer AS rfse_3, 
                        src:rout::varchar AS rout, 
                        src:rtsa_1::numeric(38, 17) AS rtsa_1, 
                        src:rtsa_2::numeric(38, 17) AS rtsa_2, 
                        src:rtsa_3::numeric(38, 17) AS rtsa_3, 
                        src:rtse_1::numeric(38, 17) AS rtse_1, 
                        src:rtse_2::numeric(38, 17) AS rtse_2, 
                        src:rtse_3::numeric(38, 17) AS rtse_3, 
                        src:sacu::varchar AS sacu, 
                        src:sacu_ref_compnr::integer AS sacu_ref_compnr, 
                        src:scmd::integer AS scmd, 
                        src:scmd_kw::varchar AS scmd_kw, 
                        src:sdch::integer AS sdch, 
                        src:sdch_kw::varchar AS sdch_kw, 
                        src:seak::object AS seak, 
                        src:secu::varchar AS secu, 
                        src:secu_ref_compnr::integer AS secu_ref_compnr, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:setl::integer AS setl, 
                        src:setl_kw::varchar AS setl_kw, 
                        src:sfdt::datetime AS sfdt, 
                        src:ssdt::datetime AS ssdt, 
                        src:stat::integer AS stat, 
                        src:stat_kw::varchar AS stat_kw, 
                        src:tact::integer AS tact, 
                        src:tact_kw::varchar AS tact_kw, 
                        src:tfhr::numeric(38, 17) AS tfhr, 
                        src:timestamp::datetime AS timestamp, 
                        src:tmud::varchar AS tmud, 
                        src:tmud_ref_compnr::integer AS tmud_ref_compnr, 
                        src:totf::numeric(38, 17) AS totf, 
                        src:txta::integer AS txta, 
                        src:txta_ref_compnr::integer AS txta_ref_compnr, 
                        src:username::varchar AS username, 
                        src:wast::integer AS wast, 
                        src:wast_kw::varchar AS wast_kw, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:compnr,
                src:cprj,
                src:cpla,
                src:cact,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:compnr,
                src:cprj,
                src:cpla,
                src:cact  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_TPPSS200 as strm))