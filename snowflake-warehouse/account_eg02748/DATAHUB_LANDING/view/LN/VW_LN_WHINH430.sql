CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_WHINH430 AS SELECT
                        src:aclr::integer AS aclr, 
                        src:aclr_kw::varchar AS aclr_kw, 
                        src:adin::varchar AS adin, 
                        src:bolp::integer AS bolp, 
                        src:bolp_kw::varchar AS bolp_kw, 
                        src:bptc::varchar AS bptc, 
                        src:bptc_ref_compnr::integer AS bptc_ref_compnr, 
                        src:carr::varchar AS carr, 
                        src:carr_ref_compnr::integer AS carr_ref_compnr, 
                        src:ccty::varchar AS ccty, 
                        src:ccty_ref_compnr::integer AS ccty_ref_compnr, 
                        src:cdat::datetime AS cdat, 
                        src:cdec::varchar AS cdec, 
                        src:cdec_ref_compnr::integer AS cdec_ref_compnr, 
                        src:cdun::varchar AS cdun, 
                        src:cdun_ref_compnr::integer AS cdun_ref_compnr, 
                        src:cham::numeric(38, 17) AS cham, 
                        src:cntr::varchar AS cntr, 
                        src:compnr::integer AS compnr, 
                        src:corn::object AS corn, 
                        src:cpro::object AS cpro, 
                        src:crte::varchar AS crte, 
                        src:crte_ref_compnr::integer AS crte_ref_compnr, 
                        src:curr::varchar AS curr, 
                        src:curr_ref_compnr::integer AS curr_ref_compnr, 
                        src:cwun::varchar AS cwun, 
                        src:cwun_ref_compnr::integer AS cwun_ref_compnr, 
                        src:daby::varchar AS daby, 
                        src:daby_ref_compnr::integer AS daby_ref_compnr, 
                        src:dacc::integer AS dacc, 
                        src:dacc_kw::varchar AS dacc_kw, 
                        src:dadt::datetime AS dadt, 
                        src:darq::integer AS darq, 
                        src:darq_kw::varchar AS darq_kw, 
                        src:delc::varchar AS delc, 
                        src:delc_ref_compnr::integer AS delc_ref_compnr, 
                        src:deleted::boolean AS deleted, 
                        src:delp::integer AS delp, 
                        src:delp_kw::varchar AS delp_kw, 
                        src:depc::integer AS depc, 
                        src:depc_ref_compnr::integer AS depc_ref_compnr, 
                        src:dlpt::varchar AS dlpt, 
                        src:dpth::numeric(38, 17) AS dpth, 
                        src:eacu::varchar AS eacu, 
                        src:eamt::numeric(38, 17) AS eamt, 
                        src:erdt::datetime AS erdt, 
                        src:exre::object AS exre, 
                        src:flsp::numeric(38, 17) AS flsp, 
                        src:frsm::integer AS frsm, 
                        src:frsm_kw::varchar AS frsm_kw, 
                        src:fval::numeric(38, 17) AS fval, 
                        src:fxwt::integer AS fxwt, 
                        src:fxwt_kw::varchar AS fxwt_kw, 
                        src:hazm::integer AS hazm, 
                        src:hazm_kw::varchar AS hazm_kw, 
                        src:hght::numeric(38, 17) AS hght, 
                        src:hubc::integer AS hubc, 
                        src:hubc_kw::varchar AS hubc_kw, 
                        src:huid::varchar AS huid, 
                        src:huid_ref_compnr::integer AS huid_ref_compnr, 
                        src:ibpd::integer AS ibpd, 
                        src:ibpd_kw::varchar AS ibpd_kw, 
                        src:iedi::integer AS iedi, 
                        src:iedi_ref_compnr::integer AS iedi_ref_compnr, 
                        src:incp::integer AS incp, 
                        src:invd::datetime AS invd, 
                        src:invn::integer AS invn, 
                        src:ispr::varchar AS ispr, 
                        src:itbp::varchar AS itbp, 
                        src:itbp_ref_compnr::integer AS itbp_ref_compnr, 
                        src:koch::integer AS koch, 
                        src:koch_kw::varchar AS koch_kw, 
                        src:llsq::integer AS llsq, 
                        src:load::varchar AS load, 
                        src:load_cntr_ref_compnr::integer AS load_cntr_ref_compnr, 
                        src:load_ref_compnr::integer AS load_ref_compnr, 
                        src:manl::integer AS manl, 
                        src:manl_kw::varchar AS manl_kw, 
                        src:mapr::integer AS mapr, 
                        src:mapr_kw::varchar AS mapr_kw, 
                        src:minv::integer AS minv, 
                        src:minv_kw::varchar AS minv_kw, 
                        src:motv::varchar AS motv, 
                        src:motv_ref_compnr::integer AS motv_ref_compnr, 
                        src:ntwt::numeric(38, 17) AS ntwt, 
                        src:ofbp::varchar AS ofbp, 
                        src:ofbp_ref_compnr::integer AS ofbp_ref_compnr, 
                        src:oshc::integer AS oshc, 
                        src:oshc_kw::varchar AS oshc_kw, 
                        src:pclp::integer AS pclp, 
                        src:pclp_kw::varchar AS pclp_kw, 
                        src:pcsp::integer AS pcsp, 
                        src:pcsp_kw::varchar AS pcsp_kw, 
                        src:pdat::datetime AS pdat, 
                        src:pddt::datetime AS pddt, 
                        src:pfpr::integer AS pfpr, 
                        src:pfpr_kw::varchar AS pfpr_kw, 
                        src:picm::integer AS picm, 
                        src:pitm::varchar AS pitm, 
                        src:pitm_ref_compnr::integer AS pitm_ref_compnr, 
                        src:prdn::varchar AS prdn, 
                        src:prdn_ref_compnr::integer AS prdn_ref_compnr, 
                        src:prdt::datetime AS prdt, 
                        src:psdd::integer AS psdd, 
                        src:psdd_kw::varchar AS psdd_kw, 
                        src:psde::integer AS psde, 
                        src:psde_kw::varchar AS psde_kw, 
                        src:psts::integer AS psts, 
                        src:psts_kw::varchar AS psts_kw, 
                        src:ptpa::varchar AS ptpa, 
                        src:ptpa_ref_compnr::integer AS ptpa_ref_compnr, 
                        src:qpac::numeric(38, 17) AS qpac, 
                        src:refs::object AS refs, 
                        src:risk::varchar AS risk, 
                        src:rule::varchar AS rule, 
                        src:rule_ref_compnr::integer AS rule_ref_compnr, 
                        src:runn::varchar AS runn, 
                        src:saby::varchar AS saby, 
                        src:saby_ref_compnr::integer AS saby_ref_compnr, 
                        src:sacc::integer AS sacc, 
                        src:sacc_kw::varchar AS sacc_kw, 
                        src:sadt::datetime AS sadt, 
                        src:sanl::integer AS sanl, 
                        src:sanl_kw::varchar AS sanl_kw, 
                        src:sarq::integer AS sarq, 
                        src:sarq_kw::varchar AS sarq_kw, 
                        src:scsh::integer AS scsh, 
                        src:scsh_kw::varchar AS scsh_kw, 
                        src:sdsh::integer AS sdsh, 
                        src:sdsh_kw::varchar AS sdsh_kw, 
                        src:sdtf::datetime AS sdtf, 
                        src:sdtt::datetime AS sdtt, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:seri::varchar AS seri, 
                        src:sfad::varchar AS sfad, 
                        src:sfad_ref_compnr::integer AS sfad_ref_compnr, 
                        src:sfco::varchar AS sfco, 
                        src:sfcp::integer AS sfcp, 
                        src:sflp::integer AS sflp, 
                        src:sflp_kw::varchar AS sflp_kw, 
                        src:sfsi::varchar AS sfsi, 
                        src:sfsi_ref_compnr::integer AS sfsi_ref_compnr, 
                        src:sfty::integer AS sfty, 
                        src:sfty_kw::varchar AS sfty_kw, 
                        src:shpm::varchar AS shpm, 
                        src:shrf::varchar AS shrf, 
                        src:shst::integer AS shst, 
                        src:shst_kw::varchar AS shst_kw, 
                        src:shvc::integer AS shvc, 
                        src:shvc_kw::varchar AS shvc_kw, 
                        src:shvd::datetime AS shvd, 
                        src:shvl::integer AS shvl, 
                        src:shvl_kw::varchar AS shvl_kw, 
                        src:shvo::integer AS shvo, 
                        src:shvo_kw::varchar AS shvo_kw, 
                        src:slsh::integer AS slsh, 
                        src:slsh_kw::varchar AS slsh_kw, 
                        src:sqdl::integer AS sqdl, 
                        src:sqdl_kw::varchar AS sqdl_kw, 
                        src:sqdp::integer AS sqdp, 
                        src:sqdp_kw::varchar AS sqdp_kw, 
                        src:srsh::integer AS srsh, 
                        src:srsh_kw::varchar AS srsh_kw, 
                        src:stad::varchar AS stad, 
                        src:stad_dlpt_ref_compnr::integer AS stad_dlpt_ref_compnr, 
                        src:stad_ref_compnr::integer AS stad_ref_compnr, 
                        src:stat::integer AS stat, 
                        src:stat_kw::varchar AS stat_kw, 
                        src:stco::varchar AS stco, 
                        src:stcp::integer AS stcp, 
                        src:stsi::varchar AS stsi, 
                        src:stsi_ref_compnr::integer AS stsi_ref_compnr, 
                        src:stty::integer AS stty, 
                        src:stty_kw::varchar AS stty_kw, 
                        src:suba::integer AS suba, 
                        src:suba_kw::varchar AS suba_kw, 
                        src:taxp::varchar AS taxp, 
                        src:taxs::varchar AS taxs, 
                        src:tcap::integer AS tcap, 
                        src:tcap_kw::varchar AS tcap_kw, 
                        src:tccp::integer AS tccp, 
                        src:tccp_kw::varchar AS tccp_kw, 
                        src:text::integer AS text, 
                        src:text_ref_compnr::integer AS text_ref_compnr, 
                        src:timestamp::datetime AS timestamp, 
                        src:trcd::varchar AS trcd, 
                        src:trnr::object AS trnr, 
                        src:ttyp::varchar AS ttyp, 
                        src:username::varchar AS username, 
                        src:volm::numeric(38, 17) AS volm, 
                        src:wdep::varchar AS wdep, 
                        src:wdth::numeric(38, 17) AS wdth, 
                        src:wght::numeric(38, 17) AS wght, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:shpm,
                src:compnr,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:shpm,
                src:compnr  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_WHINH430 as strm))