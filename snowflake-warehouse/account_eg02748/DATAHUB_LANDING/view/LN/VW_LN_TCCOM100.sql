CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_TCCOM100 AS SELECT
                        src:beid::object AS beid, 
                        src:bpid::varchar AS bpid, 
                        src:bprl::integer AS bprl, 
                        src:bprl_kw::varchar AS bprl_kw, 
                        src:bptx::varchar AS bptx, 
                        src:bptx_ref_compnr::integer AS bptx_ref_compnr, 
                        src:btbv::integer AS btbv, 
                        src:btbv_kw::varchar AS btbv_kw, 
                        src:cadr::varchar AS cadr, 
                        src:cadr_ref_compnr::integer AS cadr_ref_compnr, 
                        src:cbcl::varchar AS cbcl, 
                        src:cbcl_ref_compnr::integer AS cbcl_ref_compnr, 
                        src:ccnt::varchar AS ccnt, 
                        src:ccnt_ref_compnr::integer AS ccnt_ref_compnr, 
                        src:ccur::varchar AS ccur, 
                        src:ccur_ref_compnr::integer AS ccur_ref_compnr, 
                        src:cdf_bsrm::integer AS cdf_bsrm, 
                        src:cdf_bsrm_kw::varchar AS cdf_bsrm_kw, 
                        src:cdf_cond::datetime AS cdf_cond, 
                        src:cdf_crtl::integer AS cdf_crtl, 
                        src:cdf_crtl_kw::varchar AS cdf_crtl_kw, 
                        src:cdf_emno::integer AS cdf_emno, 
                        src:cdf_emno_kw::varchar AS cdf_emno_kw, 
                        src:cdf_exdt::datetime AS cdf_exdt, 
                        src:cdf_hsst::integer AS cdf_hsst, 
                        src:cdf_hsst_kw::varchar AS cdf_hsst_kw, 
                        src:cdf_rrdt::datetime AS cdf_rrdt, 
                        src:cdf_wfst::integer AS cdf_wfst, 
                        src:cdf_wfst_kw::varchar AS cdf_wfst_kw, 
                        src:cint::integer AS cint, 
                        src:cint_kw::varchar AS cint_kw, 
                        src:clan::varchar AS clan, 
                        src:clan_ref_compnr::integer AS clan_ref_compnr, 
                        src:clcd::integer AS clcd, 
                        src:clcd_kw::varchar AS clcd_kw, 
                        src:cmid::object AS cmid, 
                        src:coff::integer AS coff, 
                        src:coff_kw::varchar AS coff_kw, 
                        src:compnr::integer AS compnr, 
                        src:crdt::datetime AS crdt, 
                        src:crid::integer AS crid, 
                        src:csto::integer AS csto, 
                        src:csto_kw::varchar AS csto_kw, 
                        src:ctit::varchar AS ctit, 
                        src:ctit_ref_compnr::integer AS ctit_ref_compnr, 
                        src:deleted::boolean AS deleted, 
                        src:ecmp::integer AS ecmp, 
                        src:edyn::integer AS edyn, 
                        src:edyn_kw::varchar AS edyn_kw, 
                        src:endt::datetime AS endt, 
                        src:fact::integer AS fact, 
                        src:fact_kw::varchar AS fact_kw, 
                        src:foid::integer AS foid, 
                        src:fovn::varchar AS fovn, 
                        src:icod::integer AS icod, 
                        src:icod_kw::varchar AS icod_kw, 
                        src:icst::integer AS icst, 
                        src:icst_kw::varchar AS icst_kw, 
                        src:imag::varchar AS imag, 
                        src:inet::object AS inet, 
                        src:inrl::integer AS inrl, 
                        src:inrl_kw::varchar AS inrl_kw, 
                        src:iscn::integer AS iscn, 
                        src:lgid::object AS lgid, 
                        src:lmdt::datetime AS lmdt, 
                        src:lmus::varchar AS lmus, 
                        src:lvdt::datetime AS lvdt, 
                        src:nama::object AS nama, 
                        src:prbp::varchar AS prbp, 
                        src:prbp_ref_compnr::integer AS prbp_ref_compnr, 
                        src:prst::integer AS prst, 
                        src:prst_kw::varchar AS prst_kw, 
                        src:seak::object AS seak, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:sml1::object AS sml1, 
                        src:sml2::object AS sml2, 
                        src:sml3::object AS sml3, 
                        src:sml4::object AS sml4, 
                        src:sml5::object AS sml5, 
                        src:smt1::integer AS smt1, 
                        src:smt1_kw::varchar AS smt1_kw, 
                        src:smt2::integer AS smt2, 
                        src:smt2_kw::varchar AS smt2_kw, 
                        src:smt3::integer AS smt3, 
                        src:smt3_kw::varchar AS smt3_kw, 
                        src:smt4::integer AS smt4, 
                        src:smt4_kw::varchar AS smt4_kw, 
                        src:smt5::integer AS smt5, 
                        src:smt5_kw::varchar AS smt5_kw, 
                        src:sndr::integer AS sndr, 
                        src:sndr_kw::varchar AS sndr_kw, 
                        src:stdt::datetime AS stdt, 
                        src:tefx::varchar AS tefx, 
                        src:telp::varchar AS telp, 
                        src:tfci::varchar AS tfci, 
                        src:tfcy::varchar AS tfcy, 
                        src:tfex::varchar AS tfex, 
                        src:tfln::varchar AS tfln, 
                        src:timestamp::datetime AS timestamp, 
                        src:tlci::varchar AS tlci, 
                        src:tlcy::varchar AS tlcy, 
                        src:tlex::varchar AS tlex, 
                        src:tlln::varchar AS tlln, 
                        src:txta::integer AS txta, 
                        src:txta_ref_compnr::integer AS txta_ref_compnr, 
                        src:username::varchar AS username, 
                        src:usid::varchar AS usid, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:compnr,
                src:bpid,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:compnr,
                src:bpid  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_TCCOM100 as strm))