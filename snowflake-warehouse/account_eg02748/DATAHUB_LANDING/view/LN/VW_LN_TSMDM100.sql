CREATE OR REPLACE VIEW DATAHUB_LANDING.VW_LN_TSMDM100 AS SELECT
                        src:cbwc::integer AS cbwc, 
                        src:cbwc_kw::varchar AS cbwc_kw, 
                        src:clrt::varchar AS clrt, 
                        src:clrt_ref_compnr::integer AS clrt_ref_compnr, 
                        src:cmwc::varchar AS cmwc, 
                        src:compnr::integer AS compnr, 
                        src:cste::varchar AS cste, 
                        src:cste_ref_compnr::integer AS cste_ref_compnr, 
                        src:cvat::varchar AS cvat, 
                        src:cvat_ref_compnr::integer AS cvat_ref_compnr, 
                        src:cwar::varchar AS cwar, 
                        src:cwar_ref_compnr::integer AS cwar_ref_compnr, 
                        src:cwoc::varchar AS cwoc, 
                        src:cwoc_ref_compnr::integer AS cwoc_ref_compnr, 
                        src:cwrh::varchar AS cwrh, 
                        src:cwrh_ref_compnr::integer AS cwrh_ref_compnr, 
                        src:deleted::boolean AS deleted, 
                        src:dste::varchar AS dste, 
                        src:dste_ref_compnr::integer AS dste_ref_compnr, 
                        src:fwrh::varchar AS fwrh, 
                        src:fwrh_ref_compnr::integer AS fwrh_ref_compnr, 
                        src:grca::varchar AS grca, 
                        src:grca_snca_ref_compnr::integer AS grca_snca_ref_compnr, 
                        src:grcl::varchar AS grcl, 
                        src:grcl_sncl_ref_compnr::integer AS grcl_sncl_ref_compnr, 
                        src:grcq::varchar AS grcq, 
                        src:grcq_sncq_ref_compnr::integer AS grcq_sncq_ref_compnr, 
                        src:grfc::varchar AS grfc, 
                        src:grfc_snfc_ref_compnr::integer AS grfc_snfc_ref_compnr, 
                        src:grfq::varchar AS grfq, 
                        src:grfq_snfq_ref_compnr::integer AS grfq_snfq_ref_compnr, 
                        src:grfr::varchar AS grfr, 
                        src:grfr_snfr_ref_compnr::integer AS grfr_snfr_ref_compnr, 
                        src:grmq::varchar AS grmq, 
                        src:grmq_snmq_ref_compnr::integer AS grmq_snmq_ref_compnr, 
                        src:grms::varchar AS grms, 
                        src:grms_snms_ref_compnr::integer AS grms_snms_ref_compnr, 
                        src:grrn::varchar AS grrn, 
                        src:grrn_ref_compnr::integer AS grrn_ref_compnr, 
                        src:grrn_srrn_ref_compnr::integer AS grrn_srrn_ref_compnr, 
                        src:grrq::varchar AS grrq, 
                        src:grrq_snrq_ref_compnr::integer AS grrq_snrq_ref_compnr, 
                        src:grrr::varchar AS grrr, 
                        src:grrr_ref_compnr::integer AS grrr_ref_compnr, 
                        src:grrr_srrr_ref_compnr::integer AS grrr_srrr_ref_compnr, 
                        src:grsb::varchar AS grsb, 
                        src:grsb_snsb_ref_compnr::integer AS grsb_snsb_ref_compnr, 
                        src:grsc::varchar AS grsc, 
                        src:grsc_snsc_ref_compnr::integer AS grsc_snsc_ref_compnr, 
                        src:grso::varchar AS grso, 
                        src:grso_snso_ref_compnr::integer AS grso_snso_ref_compnr, 
                        src:grsq::varchar AS grsq, 
                        src:grsq_snsq_ref_compnr::integer AS grsq_snsq_ref_compnr, 
                        src:grwo::varchar AS grwo, 
                        src:grwo_snwo_ref_compnr::integer AS grwo_snwo_ref_compnr, 
                        src:lcip::varchar AS lcip, 
                        src:lcip_ref_compnr::integer AS lcip_ref_compnr, 
                        src:lcop::varchar AS lcop, 
                        src:lcop_ref_compnr::integer AS lcop_ref_compnr, 
                        src:mwrh::varchar AS mwrh, 
                        src:mwrh_ref_compnr::integer AS mwrh_ref_compnr, 
                        src:ngsc::varchar AS ngsc, 
                        src:ngsc_srsc_ref_compnr::integer AS ngsc_srsc_ref_compnr, 
                        src:pddp::varchar AS pddp, 
                        src:pddp_ref_compnr::integer AS pddp_ref_compnr, 
                        src:qtim::numeric(38, 17) AS qtim, 
                        src:rste::varchar AS rste, 
                        src:rste_ref_compnr::integer AS rste_ref_compnr, 
                        src:sequencenumber::integer AS sequencenumber, 
                        src:sfsi::varchar AS sfsi, 
                        src:sfsi_ref_compnr::integer AS sfsi_ref_compnr, 
                        src:site::varchar AS site, 
                        src:site_ref_compnr::integer AS site_ref_compnr, 
                        src:slrt::varchar AS slrt, 
                        src:slrt_ref_compnr::integer AS slrt_ref_compnr, 
                        src:snca::varchar AS snca, 
                        src:sncl::varchar AS sncl, 
                        src:sncq::varchar AS sncq, 
                        src:snfc::varchar AS snfc, 
                        src:snfq::varchar AS snfq, 
                        src:snfr::varchar AS snfr, 
                        src:snmq::varchar AS snmq, 
                        src:snms::varchar AS snms, 
                        src:snrq::varchar AS snrq, 
                        src:snsb::varchar AS snsb, 
                        src:snsc::varchar AS snsc, 
                        src:snso::varchar AS snso, 
                        src:snsq::varchar AS snsq, 
                        src:snwo::varchar AS snwo, 
                        src:srep::varchar AS srep, 
                        src:srep_ref_compnr::integer AS srep_ref_compnr, 
                        src:srrn::varchar AS srrn, 
                        src:srrr::varchar AS srrr, 
                        src:srsc::varchar AS srsc, 
                        src:srtp::integer AS srtp, 
                        src:srtp_kw::varchar AS srtp_kw, 
                        src:timestamp::datetime AS timestamp, 
                        src:username::varchar AS username, 
                        src:wctp::integer AS wctp, 
                        src:wctp_kw::varchar AS wctp_kw, 
                        src:whip::varchar AS whip, 
                        src:whip_ref_compnr::integer AS whip_ref_compnr, 
                        src:whop::varchar AS whop, 
                        src:whop_ref_compnr::integer AS whop_ref_compnr, 
            CASE
                WHEN 'LN' = 'LN'
                THEN src:"deleted"::BOOLEAN
                WHEN 'LN' = 'IPS'
                THEN src:"DATALAKE_DELETED"::BOOLEAN
                ELSE src:"_DELETED"::BOOLEAN
            END as ETL_DELETED,
            etl_load_datetime,
            etl_load_metadatafilename,
            ETL_RANK,
            IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) as ETL_RANK_TIMESTAMP
            FROM 
            (
            select 
                src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROWNUMBER as ETL_RANK
                from
                (
                    SELECT
    
                        
                src:cwoc,
                src:compnr,
            src:sequencenumber
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:cwoc,
                src:compnr  ORDER BY 
            src:sequencenumber desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_LANDING.LN_TSMDM100 as strm))