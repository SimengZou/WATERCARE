SELECT DISTINCT CASE WHEN TABLE_SCHEMA = 'DATAHUB_TARGET' THEN 'IPS' ELSE REPLACE(TABLE_SCHEMA, 'TARGET_', '') END AS "SOURCE"
FROM ${var.ENVIRONMENT}_WCC_DATAWAREHOUSE.INFORMATION_SCHEMA.TABLES T
WHERE TABLE_TYPE = 'BASE TABLE' 
    AND (TABLE_SCHEMA = 'DATAHUB_TARGET' OR TABLE_SCHEMA LIKE 'TARGET_%') 
    AND TABLE_SCHEMA NOT LIKE '%HISTORY%'
    AND SOURCE = :source_system
UNION
SELECT DISTINCT REPLACE(TABLE_SCHEMA, 'TARGET_', '') AS "SOURCE"
FROM WATERLAKE_${var.ENVIRONMENT}.INFORMATION_SCHEMA.TABLES T
WHERE TABLE_TYPE = 'BASE TABLE' 
    AND TABLE_SCHEMA LIKE 'TARGET_%' 
    AND TABLE_SCHEMA NOT LIKE '%HISTORY%'
    AND SOURCE = :source_system