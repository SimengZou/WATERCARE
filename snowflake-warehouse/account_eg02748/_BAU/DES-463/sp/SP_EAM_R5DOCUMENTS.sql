
                    
                create or replace procedure DATAHUB_INTEGRATION.EAM_TARGET_MERGE_R5DOCUMENTS()
                  returns varchar not null
                  language javascript
                  as
                  $$
  
                //  Variables
                  
                  var debug = "True";                                 // do we want debug messages?
                  var result = "";                                    // return status of this proc call
                  const process_name = Object.keys(this)[0];          // name of currently executing process
                  var debug_statement = "";                           // debug message statement
                  var number_of_rows_inserted = 0;                             // track number of rows we have inserted
                var number_of_rows_updated = 0;                             // track number of rows we have updated
                
              //  Step 1.

              //  Select MAX process ID for this process
                  
                  var log_sql_command;
                  log_sql_command = "select MAX(process_execution_id) as max_id from datahub_logging.etl_log_ingestion_process ";
                  log_sql_command += "where process_name = '" + process_name + "'";
                  
                  var log_result_set = snowflake.execute({sqlText: log_sql_command});         // execute select from log table
                  log_result_set.next();                                                      // expecting only 1 row as this is a MAX() query
                  var process_execution_id = log_result_set.getColumnValue(1);                // and only 1 return value

                  //  Increment MAX process ID to log a new run of this process
                  
                  if(process_execution_id === undefined)                                      // test if return value is NULL - first execution of this process
                      {process_execution_id = 1;}
                  else
                      {process_execution_id = process_execution_id + 1;}
                  
                  //  log debug message
                  if( debug === "True" ) 
                      {
                      debug_statement = "call datahub_logging.sp_etl_log_ingestion_process_debug('" + process_name + "','Started process, new ID = " + process_execution_id.toString() + "');";
                      snowflake.execute({sqlText: debug_statement}); 
                      }

              //  Step 2.

              //  Start execution - log start

                  log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('Insert','" + process_name + "','Running','Started process execution.', " + process_execution_id.toString() + ",0,0);";
                  snowflake.execute({sqlText: log_sql_command});

                snowflake.execute( {sqlText: "begin transaction;"} );
                  try
                      {
                          

                      //  log debug message
                      if( debug === "True" ) 
                          {
                          debug_statement = "call datahub_logging.sp_etl_log_ingestion_process_debug('" + process_name + "','Begin Transaction');";
                          snowflake.execute({sqlText: debug_statement}); 
                          }      
                      var sql_command = `      
                                merge into  "DATAHUB_TARGET"."EAM_R5DOCUMENTS" as target using (
                                  
                      
                  
                    SELECT * FROM (SELECT
                    
                    
                        strm.DOC_CODE,
                        strm.DOC_DESC,
                        strm.DOC_CLASS,
                        strm.DOC_ORIGCODE,
                        strm.DOC_REVNUMBER,
                        strm.DOC_REVISION,
                        strm.DOC_PARENT,
                        strm.DOC_ORIGIN,
                        strm.DOC_PAGES,
                        strm.DOC_SIZE,
                        strm.DOC_CABINET,
                        strm.DOC_FILENAME,
                        strm.DOC_FILETYPE,
                        strm.DOC_EXPIR,
                        strm.DOC_SUPPLIER,
                        strm.DOC_WARSTART,
                        strm.DOC_WARRANTY,
                        strm.DOC_DURATION,
                        strm.DOC_THRESHOLD,
                        strm.DOC_MANUFACTURER,
                        strm.DOC_ORG,
                        strm.DOC_CLASS_ORG,
                        strm.DOC_SUPPLIER_ORG,
                        strm.DOC_TYPE,
                        strm.DOC_RTYPE,
                        strm.DOC_FILESIZE,
                        strm.DOC_LOCKUSER,
                        strm.DOC_UPDATECOUNT,
                        strm.DOC_LABCHARGE,
                        strm.DOC_MATCHARGE,
                        strm.DOC_HIRCHARGE,
                        strm.DOC_DMACHARGE,
                        strm.DOC_SERVICECHARGE,
                        strm.DOC_TOOLCHARGE,
                        strm.DOC_NOTUSED,
                        strm.DOC_ORIGFILENAME,
                        strm.DOC_UPLOADED,
                        strm.DOC_WARRANTYTYPE,
                        strm.DOC_CONTROLNUMBER,
                        strm.DOC_AGREEMENTTYPE,
                        strm.DOC_ONSITEREPAIR,
                        strm.DOC_LOANERPROVIDED,
                        strm.DOC_RENEWALALERTEMAIL,
                        strm.DOC_STARTDATEBASIS,
                        strm.DOC_FIXEDLABORRATE,
                        strm.DOC_FIXEDLABORAMOUNT,
                        strm.DOC_FIXEDSTOCKAMOUNT,
                        strm.DOC_MAXLABORAMOUNT,
                        strm.DOC_MAXSTOCKAMOUNT,
                        strm.DOC_EXCLUDEPMWORKORDER,
                        strm.DOC_PARTLISTREQUIRED,
                        strm.DOC_RMAREQUIRED,
                        strm.DOC_UDFCHAR01,
                        strm.DOC_UDFCHAR02,
                        strm.DOC_UDFCHAR03,
                        strm.DOC_UDFCHAR04,
                        strm.DOC_UDFCHAR05,
                        strm.DOC_UDFCHAR06,
                        strm.DOC_UDFCHAR07,
                        strm.DOC_UDFCHAR08,
                        strm.DOC_UDFCHAR09,
                        strm.DOC_UDFCHAR10,
                        strm.DOC_UDFCHAR11,
                        strm.DOC_UDFCHAR12,
                        strm.DOC_UDFCHAR13,
                        strm.DOC_UDFCHAR14,
                        strm.DOC_UDFCHAR15,
                        strm.DOC_UDFCHAR16,
                        strm.DOC_UDFCHAR17,
                        strm.DOC_UDFCHAR18,
                        strm.DOC_UDFCHAR19,
                        strm.DOC_UDFCHAR20,
                        strm.DOC_UDFCHAR21,
                        strm.DOC_UDFCHAR22,
                        strm.DOC_UDFCHAR23,
                        strm.DOC_UDFCHAR24,
                        strm.DOC_UDFCHAR25,
                        strm.DOC_UDFCHAR26,
                        strm.DOC_UDFCHAR27,
                        strm.DOC_UDFCHAR28,
                        strm.DOC_UDFCHAR29,
                        strm.DOC_UDFCHAR30,
                        strm.DOC_UDFNUM01,
                        strm.DOC_UDFNUM02,
                        strm.DOC_UDFNUM03,
                        strm.DOC_UDFNUM04,
                        strm.DOC_UDFNUM05,
                        strm.DOC_UDFDATE01,
                        strm.DOC_UDFDATE02,
                        strm.DOC_UDFDATE03,
                        strm.DOC_UDFDATE04,
                        strm.DOC_UDFDATE05,
                        strm.DOC_UDFCHKBOX01,
                        strm.DOC_UDFCHKBOX02,
                        strm.DOC_UDFCHKBOX03,
                        strm.DOC_UDFCHKBOX04,
                        strm.DOC_UDFCHKBOX05,
                        strm.DOC_CONTENT,
                        strm.DOC_IDMTYPE,
                        strm.DOC_TITLE,
                        strm.DOC_DATEEFFECTIVE,
                        strm.DOC_DATEEXPIRED,
                        strm.DOC_LASTSAVED,
                        strm.DOC_ISPROFILEPICTURE,
                        strm.DOC_ISMOBILELOG,
                        strm.ETL_LASTSAVED,
                        strm.ETL_DELETED,
                        strm.etl_load_datetime,
                      strm.etl_load_metadatafilename,
                      ROW_NUMBER() OVER (PARTITION BY 
                                        strm.DOC_CODE  ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                      
                     FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5DOCUMENTS as  strm
                     )   
                WHERE ROWNUMBER=1  
               
                     ) as src on
                                ((target.DOC_CODE=src.DOC_CODE) OR (target.DOC_CODE IS NULL AND src.DOC_CODE IS NULL))
                    when matched and src.ETL_DELETED=TRUE THEN DELETE
                    when matched then update set
                                target.DOC_CODE=src.DOC_CODE,
                                target.DOC_DESC=src.DOC_DESC,
                                target.DOC_CLASS=src.DOC_CLASS,
                                target.DOC_ORIGCODE=src.DOC_ORIGCODE,
                                target.DOC_REVNUMBER=src.DOC_REVNUMBER,
                                target.DOC_REVISION=src.DOC_REVISION,
                                target.DOC_PARENT=src.DOC_PARENT,
                                target.DOC_ORIGIN=src.DOC_ORIGIN,
                                target.DOC_PAGES=src.DOC_PAGES,
                                target.DOC_SIZE=src.DOC_SIZE,
                                target.DOC_CABINET=src.DOC_CABINET,
                                target.DOC_FILENAME=src.DOC_FILENAME,
                                target.DOC_FILETYPE=src.DOC_FILETYPE,
                                target.DOC_EXPIR=src.DOC_EXPIR,
                                target.DOC_SUPPLIER=src.DOC_SUPPLIER,
                                target.DOC_WARSTART=src.DOC_WARSTART,
                                target.DOC_WARRANTY=src.DOC_WARRANTY,
                                target.DOC_DURATION=src.DOC_DURATION,
                                target.DOC_THRESHOLD=src.DOC_THRESHOLD,
                                target.DOC_MANUFACTURER=src.DOC_MANUFACTURER,
                                target.DOC_ORG=src.DOC_ORG,
                                target.DOC_CLASS_ORG=src.DOC_CLASS_ORG,
                                target.DOC_SUPPLIER_ORG=src.DOC_SUPPLIER_ORG,
                                target.DOC_TYPE=src.DOC_TYPE,
                                target.DOC_RTYPE=src.DOC_RTYPE,
                                target.DOC_FILESIZE=src.DOC_FILESIZE,
                                target.DOC_LOCKUSER=src.DOC_LOCKUSER,
                                target.DOC_UPDATECOUNT=src.DOC_UPDATECOUNT,
                                target.DOC_LABCHARGE=src.DOC_LABCHARGE,
                                target.DOC_MATCHARGE=src.DOC_MATCHARGE,
                                target.DOC_HIRCHARGE=src.DOC_HIRCHARGE,
                                target.DOC_DMACHARGE=src.DOC_DMACHARGE,
                                target.DOC_SERVICECHARGE=src.DOC_SERVICECHARGE,
                                target.DOC_TOOLCHARGE=src.DOC_TOOLCHARGE,
                                target.DOC_NOTUSED=src.DOC_NOTUSED,
                                target.DOC_ORIGFILENAME=src.DOC_ORIGFILENAME,
                                target.DOC_UPLOADED=src.DOC_UPLOADED,
                                target.DOC_WARRANTYTYPE=src.DOC_WARRANTYTYPE,
                                target.DOC_CONTROLNUMBER=src.DOC_CONTROLNUMBER,
                                target.DOC_AGREEMENTTYPE=src.DOC_AGREEMENTTYPE,
                                target.DOC_ONSITEREPAIR=src.DOC_ONSITEREPAIR,
                                target.DOC_LOANERPROVIDED=src.DOC_LOANERPROVIDED,
                                target.DOC_RENEWALALERTEMAIL=src.DOC_RENEWALALERTEMAIL,
                                target.DOC_STARTDATEBASIS=src.DOC_STARTDATEBASIS,
                                target.DOC_FIXEDLABORRATE=src.DOC_FIXEDLABORRATE,
                                target.DOC_FIXEDLABORAMOUNT=src.DOC_FIXEDLABORAMOUNT,
                                target.DOC_FIXEDSTOCKAMOUNT=src.DOC_FIXEDSTOCKAMOUNT,
                                target.DOC_MAXLABORAMOUNT=src.DOC_MAXLABORAMOUNT,
                                target.DOC_MAXSTOCKAMOUNT=src.DOC_MAXSTOCKAMOUNT,
                                target.DOC_EXCLUDEPMWORKORDER=src.DOC_EXCLUDEPMWORKORDER,
                                target.DOC_PARTLISTREQUIRED=src.DOC_PARTLISTREQUIRED,
                                target.DOC_RMAREQUIRED=src.DOC_RMAREQUIRED,
                                target.DOC_UDFCHAR01=src.DOC_UDFCHAR01,
                                target.DOC_UDFCHAR02=src.DOC_UDFCHAR02,
                                target.DOC_UDFCHAR03=src.DOC_UDFCHAR03,
                                target.DOC_UDFCHAR04=src.DOC_UDFCHAR04,
                                target.DOC_UDFCHAR05=src.DOC_UDFCHAR05,
                                target.DOC_UDFCHAR06=src.DOC_UDFCHAR06,
                                target.DOC_UDFCHAR07=src.DOC_UDFCHAR07,
                                target.DOC_UDFCHAR08=src.DOC_UDFCHAR08,
                                target.DOC_UDFCHAR09=src.DOC_UDFCHAR09,
                                target.DOC_UDFCHAR10=src.DOC_UDFCHAR10,
                                target.DOC_UDFCHAR11=src.DOC_UDFCHAR11,
                                target.DOC_UDFCHAR12=src.DOC_UDFCHAR12,
                                target.DOC_UDFCHAR13=src.DOC_UDFCHAR13,
                                target.DOC_UDFCHAR14=src.DOC_UDFCHAR14,
                                target.DOC_UDFCHAR15=src.DOC_UDFCHAR15,
                                target.DOC_UDFCHAR16=src.DOC_UDFCHAR16,
                                target.DOC_UDFCHAR17=src.DOC_UDFCHAR17,
                                target.DOC_UDFCHAR18=src.DOC_UDFCHAR18,
                                target.DOC_UDFCHAR19=src.DOC_UDFCHAR19,
                                target.DOC_UDFCHAR20=src.DOC_UDFCHAR20,
                                target.DOC_UDFCHAR21=src.DOC_UDFCHAR21,
                                target.DOC_UDFCHAR22=src.DOC_UDFCHAR22,
                                target.DOC_UDFCHAR23=src.DOC_UDFCHAR23,
                                target.DOC_UDFCHAR24=src.DOC_UDFCHAR24,
                                target.DOC_UDFCHAR25=src.DOC_UDFCHAR25,
                                target.DOC_UDFCHAR26=src.DOC_UDFCHAR26,
                                target.DOC_UDFCHAR27=src.DOC_UDFCHAR27,
                                target.DOC_UDFCHAR28=src.DOC_UDFCHAR28,
                                target.DOC_UDFCHAR29=src.DOC_UDFCHAR29,
                                target.DOC_UDFCHAR30=src.DOC_UDFCHAR30,
                                target.DOC_UDFNUM01=src.DOC_UDFNUM01,
                                target.DOC_UDFNUM02=src.DOC_UDFNUM02,
                                target.DOC_UDFNUM03=src.DOC_UDFNUM03,
                                target.DOC_UDFNUM04=src.DOC_UDFNUM04,
                                target.DOC_UDFNUM05=src.DOC_UDFNUM05,
                                target.DOC_UDFDATE01=src.DOC_UDFDATE01,
                                target.DOC_UDFDATE02=src.DOC_UDFDATE02,
                                target.DOC_UDFDATE03=src.DOC_UDFDATE03,
                                target.DOC_UDFDATE04=src.DOC_UDFDATE04,
                                target.DOC_UDFDATE05=src.DOC_UDFDATE05,
                                target.DOC_UDFCHKBOX01=src.DOC_UDFCHKBOX01,
                                target.DOC_UDFCHKBOX02=src.DOC_UDFCHKBOX02,
                                target.DOC_UDFCHKBOX03=src.DOC_UDFCHKBOX03,
                                target.DOC_UDFCHKBOX04=src.DOC_UDFCHKBOX04,
                                target.DOC_UDFCHKBOX05=src.DOC_UDFCHKBOX05,
                                target.DOC_CONTENT=src.DOC_CONTENT,
                                target.DOC_IDMTYPE=src.DOC_IDMTYPE,
                                target.DOC_TITLE=src.DOC_TITLE,
                                target.DOC_DATEEFFECTIVE=src.DOC_DATEEFFECTIVE,
                                target.DOC_DATEEXPIRED=src.DOC_DATEEXPIRED,
                                target.DOC_LASTSAVED=src.DOC_LASTSAVED,
                                target.DOC_ISPROFILEPICTURE=src.DOC_ISPROFILEPICTURE,
                                target.DOC_ISMOBILELOG=src.DOC_ISMOBILELOG,
                  target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                        target.etl_load_datetime=CURRENT_TIMESTAMP,
                      target.etl_load_metadatafilename=src.etl_load_metadatafilename 
  when not matched and (src.ETL_DELETED=FALSE OR src.ETL_DELETED IS NULL)  then insert ( 
                                DOC_CODE, 
                                DOC_DESC, 
                                DOC_CLASS, 
                                DOC_ORIGCODE, 
                                DOC_REVNUMBER, 
                                DOC_REVISION, 
                                DOC_PARENT, 
                                DOC_ORIGIN, 
                                DOC_PAGES, 
                                DOC_SIZE, 
                                DOC_CABINET, 
                                DOC_FILENAME, 
                                DOC_FILETYPE, 
                                DOC_EXPIR, 
                                DOC_SUPPLIER, 
                                DOC_WARSTART, 
                                DOC_WARRANTY, 
                                DOC_DURATION, 
                                DOC_THRESHOLD, 
                                DOC_MANUFACTURER, 
                                DOC_ORG, 
                                DOC_CLASS_ORG, 
                                DOC_SUPPLIER_ORG, 
                                DOC_TYPE, 
                                DOC_RTYPE, 
                                DOC_FILESIZE, 
                                DOC_LOCKUSER, 
                                DOC_UPDATECOUNT, 
                                DOC_LABCHARGE, 
                                DOC_MATCHARGE, 
                                DOC_HIRCHARGE, 
                                DOC_DMACHARGE, 
                                DOC_SERVICECHARGE, 
                                DOC_TOOLCHARGE, 
                                DOC_NOTUSED, 
                                DOC_ORIGFILENAME, 
                                DOC_UPLOADED, 
                                DOC_WARRANTYTYPE, 
                                DOC_CONTROLNUMBER, 
                                DOC_AGREEMENTTYPE, 
                                DOC_ONSITEREPAIR, 
                                DOC_LOANERPROVIDED, 
                                DOC_RENEWALALERTEMAIL, 
                                DOC_STARTDATEBASIS, 
                                DOC_FIXEDLABORRATE, 
                                DOC_FIXEDLABORAMOUNT, 
                                DOC_FIXEDSTOCKAMOUNT, 
                                DOC_MAXLABORAMOUNT, 
                                DOC_MAXSTOCKAMOUNT, 
                                DOC_EXCLUDEPMWORKORDER, 
                                DOC_PARTLISTREQUIRED, 
                                DOC_RMAREQUIRED, 
                                DOC_UDFCHAR01, 
                                DOC_UDFCHAR02, 
                                DOC_UDFCHAR03, 
                                DOC_UDFCHAR04, 
                                DOC_UDFCHAR05, 
                                DOC_UDFCHAR06, 
                                DOC_UDFCHAR07, 
                                DOC_UDFCHAR08, 
                                DOC_UDFCHAR09, 
                                DOC_UDFCHAR10, 
                                DOC_UDFCHAR11, 
                                DOC_UDFCHAR12, 
                                DOC_UDFCHAR13, 
                                DOC_UDFCHAR14, 
                                DOC_UDFCHAR15, 
                                DOC_UDFCHAR16, 
                                DOC_UDFCHAR17, 
                                DOC_UDFCHAR18, 
                                DOC_UDFCHAR19, 
                                DOC_UDFCHAR20, 
                                DOC_UDFCHAR21, 
                                DOC_UDFCHAR22, 
                                DOC_UDFCHAR23, 
                                DOC_UDFCHAR24, 
                                DOC_UDFCHAR25, 
                                DOC_UDFCHAR26, 
                                DOC_UDFCHAR27, 
                                DOC_UDFCHAR28, 
                                DOC_UDFCHAR29, 
                                DOC_UDFCHAR30, 
                                DOC_UDFNUM01, 
                                DOC_UDFNUM02, 
                                DOC_UDFNUM03, 
                                DOC_UDFNUM04, 
                                DOC_UDFNUM05, 
                                DOC_UDFDATE01, 
                                DOC_UDFDATE02, 
                                DOC_UDFDATE03, 
                                DOC_UDFDATE04, 
                                DOC_UDFDATE05, 
                                DOC_UDFCHKBOX01, 
                                DOC_UDFCHKBOX02, 
                                DOC_UDFCHKBOX03, 
                                DOC_UDFCHKBOX04, 
                                DOC_UDFCHKBOX05, 
                                DOC_CONTENT, 
                                DOC_IDMTYPE, 
                                DOC_TITLE, 
                                DOC_DATEEFFECTIVE, 
                                DOC_DATEEXPIRED, 
                                DOC_LASTSAVED, 
                                DOC_ISPROFILEPICTURE, 
                                DOC_ISMOBILELOG,
                      ETL_LASTSAVED,
                       
                        etl_load_datetime,
                      etl_load_metadatafilename) values (
                                 src.DOC_CODE,
                                 src.DOC_DESC,
                                 src.DOC_CLASS,
                                 src.DOC_ORIGCODE,
                                 src.DOC_REVNUMBER,
                                 src.DOC_REVISION,
                                 src.DOC_PARENT,
                                 src.DOC_ORIGIN,
                                 src.DOC_PAGES,
                                 src.DOC_SIZE,
                                 src.DOC_CABINET,
                                 src.DOC_FILENAME,
                                 src.DOC_FILETYPE,
                                 src.DOC_EXPIR,
                                 src.DOC_SUPPLIER,
                                 src.DOC_WARSTART,
                                 src.DOC_WARRANTY,
                                 src.DOC_DURATION,
                                 src.DOC_THRESHOLD,
                                 src.DOC_MANUFACTURER,
                                 src.DOC_ORG,
                                 src.DOC_CLASS_ORG,
                                 src.DOC_SUPPLIER_ORG,
                                 src.DOC_TYPE,
                                 src.DOC_RTYPE,
                                 src.DOC_FILESIZE,
                                 src.DOC_LOCKUSER,
                                 src.DOC_UPDATECOUNT,
                                 src.DOC_LABCHARGE,
                                 src.DOC_MATCHARGE,
                                 src.DOC_HIRCHARGE,
                                 src.DOC_DMACHARGE,
                                 src.DOC_SERVICECHARGE,
                                 src.DOC_TOOLCHARGE,
                                 src.DOC_NOTUSED,
                                 src.DOC_ORIGFILENAME,
                                 src.DOC_UPLOADED,
                                 src.DOC_WARRANTYTYPE,
                                 src.DOC_CONTROLNUMBER,
                                 src.DOC_AGREEMENTTYPE,
                                 src.DOC_ONSITEREPAIR,
                                 src.DOC_LOANERPROVIDED,
                                 src.DOC_RENEWALALERTEMAIL,
                                 src.DOC_STARTDATEBASIS,
                                 src.DOC_FIXEDLABORRATE,
                                 src.DOC_FIXEDLABORAMOUNT,
                                 src.DOC_FIXEDSTOCKAMOUNT,
                                 src.DOC_MAXLABORAMOUNT,
                                 src.DOC_MAXSTOCKAMOUNT,
                                 src.DOC_EXCLUDEPMWORKORDER,
                                 src.DOC_PARTLISTREQUIRED,
                                 src.DOC_RMAREQUIRED,
                                 src.DOC_UDFCHAR01,
                                 src.DOC_UDFCHAR02,
                                 src.DOC_UDFCHAR03,
                                 src.DOC_UDFCHAR04,
                                 src.DOC_UDFCHAR05,
                                 src.DOC_UDFCHAR06,
                                 src.DOC_UDFCHAR07,
                                 src.DOC_UDFCHAR08,
                                 src.DOC_UDFCHAR09,
                                 src.DOC_UDFCHAR10,
                                 src.DOC_UDFCHAR11,
                                 src.DOC_UDFCHAR12,
                                 src.DOC_UDFCHAR13,
                                 src.DOC_UDFCHAR14,
                                 src.DOC_UDFCHAR15,
                                 src.DOC_UDFCHAR16,
                                 src.DOC_UDFCHAR17,
                                 src.DOC_UDFCHAR18,
                                 src.DOC_UDFCHAR19,
                                 src.DOC_UDFCHAR20,
                                 src.DOC_UDFCHAR21,
                                 src.DOC_UDFCHAR22,
                                 src.DOC_UDFCHAR23,
                                 src.DOC_UDFCHAR24,
                                 src.DOC_UDFCHAR25,
                                 src.DOC_UDFCHAR26,
                                 src.DOC_UDFCHAR27,
                                 src.DOC_UDFCHAR28,
                                 src.DOC_UDFCHAR29,
                                 src.DOC_UDFCHAR30,
                                 src.DOC_UDFNUM01,
                                 src.DOC_UDFNUM02,
                                 src.DOC_UDFNUM03,
                                 src.DOC_UDFNUM04,
                                 src.DOC_UDFNUM05,
                                 src.DOC_UDFDATE01,
                                 src.DOC_UDFDATE02,
                                 src.DOC_UDFDATE03,
                                 src.DOC_UDFDATE04,
                                 src.DOC_UDFDATE05,
                                 src.DOC_UDFCHKBOX01,
                                 src.DOC_UDFCHKBOX02,
                                 src.DOC_UDFCHKBOX03,
                                 src.DOC_UDFCHKBOX04,
                                 src.DOC_UDFCHKBOX05,
                                 src.DOC_CONTENT,
                                 src.DOC_IDMTYPE,
                                 src.DOC_TITLE,
                                 src.DOC_DATEEFFECTIVE,
                                 src.DOC_DATEEXPIRED,
                                 src.DOC_LASTSAVED,
                                 src.DOC_ISPROFILEPICTURE,
                                 src.DOC_ISMOBILELOG,
                       src.ETL_LASTSAVED,
                        CURRENT_TIMESTAMP,
                      src.etl_load_metadatafilename);`;    snowflake.execute( {sqlText: 
`
  merge into  "DATAHUB_TARGET_HISTORY"."EAM_DELETED_R5DOCUMENTS" as target using (
    
     
     SELECT * FROM (SELECT
    
    
                        strm.DOC_CODE,
                        strm.DOC_DESC,
                        strm.DOC_CLASS,
                        strm.DOC_ORIGCODE,
                        strm.DOC_REVNUMBER,
                        strm.DOC_REVISION,
                        strm.DOC_PARENT,
                        strm.DOC_ORIGIN,
                        strm.DOC_PAGES,
                        strm.DOC_SIZE,
                        strm.DOC_CABINET,
                        strm.DOC_FILENAME,
                        strm.DOC_FILETYPE,
                        strm.DOC_EXPIR,
                        strm.DOC_SUPPLIER,
                        strm.DOC_WARSTART,
                        strm.DOC_WARRANTY,
                        strm.DOC_DURATION,
                        strm.DOC_THRESHOLD,
                        strm.DOC_MANUFACTURER,
                        strm.DOC_ORG,
                        strm.DOC_CLASS_ORG,
                        strm.DOC_SUPPLIER_ORG,
                        strm.DOC_TYPE,
                        strm.DOC_RTYPE,
                        strm.DOC_FILESIZE,
                        strm.DOC_LOCKUSER,
                        strm.DOC_UPDATECOUNT,
                        strm.DOC_LABCHARGE,
                        strm.DOC_MATCHARGE,
                        strm.DOC_HIRCHARGE,
                        strm.DOC_DMACHARGE,
                        strm.DOC_SERVICECHARGE,
                        strm.DOC_TOOLCHARGE,
                        strm.DOC_NOTUSED,
                        strm.DOC_ORIGFILENAME,
                        strm.DOC_UPLOADED,
                        strm.DOC_WARRANTYTYPE,
                        strm.DOC_CONTROLNUMBER,
                        strm.DOC_AGREEMENTTYPE,
                        strm.DOC_ONSITEREPAIR,
                        strm.DOC_LOANERPROVIDED,
                        strm.DOC_RENEWALALERTEMAIL,
                        strm.DOC_STARTDATEBASIS,
                        strm.DOC_FIXEDLABORRATE,
                        strm.DOC_FIXEDLABORAMOUNT,
                        strm.DOC_FIXEDSTOCKAMOUNT,
                        strm.DOC_MAXLABORAMOUNT,
                        strm.DOC_MAXSTOCKAMOUNT,
                        strm.DOC_EXCLUDEPMWORKORDER,
                        strm.DOC_PARTLISTREQUIRED,
                        strm.DOC_RMAREQUIRED,
                        strm.DOC_UDFCHAR01,
                        strm.DOC_UDFCHAR02,
                        strm.DOC_UDFCHAR03,
                        strm.DOC_UDFCHAR04,
                        strm.DOC_UDFCHAR05,
                        strm.DOC_UDFCHAR06,
                        strm.DOC_UDFCHAR07,
                        strm.DOC_UDFCHAR08,
                        strm.DOC_UDFCHAR09,
                        strm.DOC_UDFCHAR10,
                        strm.DOC_UDFCHAR11,
                        strm.DOC_UDFCHAR12,
                        strm.DOC_UDFCHAR13,
                        strm.DOC_UDFCHAR14,
                        strm.DOC_UDFCHAR15,
                        strm.DOC_UDFCHAR16,
                        strm.DOC_UDFCHAR17,
                        strm.DOC_UDFCHAR18,
                        strm.DOC_UDFCHAR19,
                        strm.DOC_UDFCHAR20,
                        strm.DOC_UDFCHAR21,
                        strm.DOC_UDFCHAR22,
                        strm.DOC_UDFCHAR23,
                        strm.DOC_UDFCHAR24,
                        strm.DOC_UDFCHAR25,
                        strm.DOC_UDFCHAR26,
                        strm.DOC_UDFCHAR27,
                        strm.DOC_UDFCHAR28,
                        strm.DOC_UDFCHAR29,
                        strm.DOC_UDFCHAR30,
                        strm.DOC_UDFNUM01,
                        strm.DOC_UDFNUM02,
                        strm.DOC_UDFNUM03,
                        strm.DOC_UDFNUM04,
                        strm.DOC_UDFNUM05,
                        strm.DOC_UDFDATE01,
                        strm.DOC_UDFDATE02,
                        strm.DOC_UDFDATE03,
                        strm.DOC_UDFDATE04,
                        strm.DOC_UDFDATE05,
                        strm.DOC_UDFCHKBOX01,
                        strm.DOC_UDFCHKBOX02,
                        strm.DOC_UDFCHKBOX03,
                        strm.DOC_UDFCHKBOX04,
                        strm.DOC_UDFCHKBOX05,
                        strm.DOC_CONTENT,
                        strm.DOC_IDMTYPE,
                        strm.DOC_TITLE,
                        strm.DOC_DATEEFFECTIVE,
                        strm.DOC_DATEEXPIRED,
                        strm.DOC_LASTSAVED,
                        strm.DOC_ISPROFILEPICTURE,
                        strm.DOC_ISMOBILELOG,
                        strm.ETL_LASTSAVED,
                        strm.ETL_DELETED,
                        strm.etl_load_datetime,
                      strm.etl_load_metadatafilename,
                      ROW_NUMBER() OVER (PARTITION BY 
                                        strm.DOC_CODE  ORDER BY strm.ETL_LASTSAVED desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                      
                     FROM DATAHUB_INTEGRATION.VW_STREAM_EAM_R5DOCUMENTS as  strm
                     WHERE strm.ETL_DELETED=TRUE 
                     )   
                WHERE ROWNUMBER=1  
         
                     ) as src on
                                ((target.DOC_CODE=src.DOC_CODE) OR (target.DOC_CODE IS NULL AND src.DOC_CODE IS NULL))
                    when matched then update set
                                target.DOC_CODE=src.DOC_CODE,
                                target.DOC_DESC=src.DOC_DESC,
                                target.DOC_CLASS=src.DOC_CLASS,
                                target.DOC_ORIGCODE=src.DOC_ORIGCODE,
                                target.DOC_REVNUMBER=src.DOC_REVNUMBER,
                                target.DOC_REVISION=src.DOC_REVISION,
                                target.DOC_PARENT=src.DOC_PARENT,
                                target.DOC_ORIGIN=src.DOC_ORIGIN,
                                target.DOC_PAGES=src.DOC_PAGES,
                                target.DOC_SIZE=src.DOC_SIZE,
                                target.DOC_CABINET=src.DOC_CABINET,
                                target.DOC_FILENAME=src.DOC_FILENAME,
                                target.DOC_FILETYPE=src.DOC_FILETYPE,
                                target.DOC_EXPIR=src.DOC_EXPIR,
                                target.DOC_SUPPLIER=src.DOC_SUPPLIER,
                                target.DOC_WARSTART=src.DOC_WARSTART,
                                target.DOC_WARRANTY=src.DOC_WARRANTY,
                                target.DOC_DURATION=src.DOC_DURATION,
                                target.DOC_THRESHOLD=src.DOC_THRESHOLD,
                                target.DOC_MANUFACTURER=src.DOC_MANUFACTURER,
                                target.DOC_ORG=src.DOC_ORG,
                                target.DOC_CLASS_ORG=src.DOC_CLASS_ORG,
                                target.DOC_SUPPLIER_ORG=src.DOC_SUPPLIER_ORG,
                                target.DOC_TYPE=src.DOC_TYPE,
                                target.DOC_RTYPE=src.DOC_RTYPE,
                                target.DOC_FILESIZE=src.DOC_FILESIZE,
                                target.DOC_LOCKUSER=src.DOC_LOCKUSER,
                                target.DOC_UPDATECOUNT=src.DOC_UPDATECOUNT,
                                target.DOC_LABCHARGE=src.DOC_LABCHARGE,
                                target.DOC_MATCHARGE=src.DOC_MATCHARGE,
                                target.DOC_HIRCHARGE=src.DOC_HIRCHARGE,
                                target.DOC_DMACHARGE=src.DOC_DMACHARGE,
                                target.DOC_SERVICECHARGE=src.DOC_SERVICECHARGE,
                                target.DOC_TOOLCHARGE=src.DOC_TOOLCHARGE,
                                target.DOC_NOTUSED=src.DOC_NOTUSED,
                                target.DOC_ORIGFILENAME=src.DOC_ORIGFILENAME,
                                target.DOC_UPLOADED=src.DOC_UPLOADED,
                                target.DOC_WARRANTYTYPE=src.DOC_WARRANTYTYPE,
                                target.DOC_CONTROLNUMBER=src.DOC_CONTROLNUMBER,
                                target.DOC_AGREEMENTTYPE=src.DOC_AGREEMENTTYPE,
                                target.DOC_ONSITEREPAIR=src.DOC_ONSITEREPAIR,
                                target.DOC_LOANERPROVIDED=src.DOC_LOANERPROVIDED,
                                target.DOC_RENEWALALERTEMAIL=src.DOC_RENEWALALERTEMAIL,
                                target.DOC_STARTDATEBASIS=src.DOC_STARTDATEBASIS,
                                target.DOC_FIXEDLABORRATE=src.DOC_FIXEDLABORRATE,
                                target.DOC_FIXEDLABORAMOUNT=src.DOC_FIXEDLABORAMOUNT,
                                target.DOC_FIXEDSTOCKAMOUNT=src.DOC_FIXEDSTOCKAMOUNT,
                                target.DOC_MAXLABORAMOUNT=src.DOC_MAXLABORAMOUNT,
                                target.DOC_MAXSTOCKAMOUNT=src.DOC_MAXSTOCKAMOUNT,
                                target.DOC_EXCLUDEPMWORKORDER=src.DOC_EXCLUDEPMWORKORDER,
                                target.DOC_PARTLISTREQUIRED=src.DOC_PARTLISTREQUIRED,
                                target.DOC_RMAREQUIRED=src.DOC_RMAREQUIRED,
                                target.DOC_UDFCHAR01=src.DOC_UDFCHAR01,
                                target.DOC_UDFCHAR02=src.DOC_UDFCHAR02,
                                target.DOC_UDFCHAR03=src.DOC_UDFCHAR03,
                                target.DOC_UDFCHAR04=src.DOC_UDFCHAR04,
                                target.DOC_UDFCHAR05=src.DOC_UDFCHAR05,
                                target.DOC_UDFCHAR06=src.DOC_UDFCHAR06,
                                target.DOC_UDFCHAR07=src.DOC_UDFCHAR07,
                                target.DOC_UDFCHAR08=src.DOC_UDFCHAR08,
                                target.DOC_UDFCHAR09=src.DOC_UDFCHAR09,
                                target.DOC_UDFCHAR10=src.DOC_UDFCHAR10,
                                target.DOC_UDFCHAR11=src.DOC_UDFCHAR11,
                                target.DOC_UDFCHAR12=src.DOC_UDFCHAR12,
                                target.DOC_UDFCHAR13=src.DOC_UDFCHAR13,
                                target.DOC_UDFCHAR14=src.DOC_UDFCHAR14,
                                target.DOC_UDFCHAR15=src.DOC_UDFCHAR15,
                                target.DOC_UDFCHAR16=src.DOC_UDFCHAR16,
                                target.DOC_UDFCHAR17=src.DOC_UDFCHAR17,
                                target.DOC_UDFCHAR18=src.DOC_UDFCHAR18,
                                target.DOC_UDFCHAR19=src.DOC_UDFCHAR19,
                                target.DOC_UDFCHAR20=src.DOC_UDFCHAR20,
                                target.DOC_UDFCHAR21=src.DOC_UDFCHAR21,
                                target.DOC_UDFCHAR22=src.DOC_UDFCHAR22,
                                target.DOC_UDFCHAR23=src.DOC_UDFCHAR23,
                                target.DOC_UDFCHAR24=src.DOC_UDFCHAR24,
                                target.DOC_UDFCHAR25=src.DOC_UDFCHAR25,
                                target.DOC_UDFCHAR26=src.DOC_UDFCHAR26,
                                target.DOC_UDFCHAR27=src.DOC_UDFCHAR27,
                                target.DOC_UDFCHAR28=src.DOC_UDFCHAR28,
                                target.DOC_UDFCHAR29=src.DOC_UDFCHAR29,
                                target.DOC_UDFCHAR30=src.DOC_UDFCHAR30,
                                target.DOC_UDFNUM01=src.DOC_UDFNUM01,
                                target.DOC_UDFNUM02=src.DOC_UDFNUM02,
                                target.DOC_UDFNUM03=src.DOC_UDFNUM03,
                                target.DOC_UDFNUM04=src.DOC_UDFNUM04,
                                target.DOC_UDFNUM05=src.DOC_UDFNUM05,
                                target.DOC_UDFDATE01=src.DOC_UDFDATE01,
                                target.DOC_UDFDATE02=src.DOC_UDFDATE02,
                                target.DOC_UDFDATE03=src.DOC_UDFDATE03,
                                target.DOC_UDFDATE04=src.DOC_UDFDATE04,
                                target.DOC_UDFDATE05=src.DOC_UDFDATE05,
                                target.DOC_UDFCHKBOX01=src.DOC_UDFCHKBOX01,
                                target.DOC_UDFCHKBOX02=src.DOC_UDFCHKBOX02,
                                target.DOC_UDFCHKBOX03=src.DOC_UDFCHKBOX03,
                                target.DOC_UDFCHKBOX04=src.DOC_UDFCHKBOX04,
                                target.DOC_UDFCHKBOX05=src.DOC_UDFCHKBOX05,
                                target.DOC_CONTENT=src.DOC_CONTENT,
                                target.DOC_IDMTYPE=src.DOC_IDMTYPE,
                                target.DOC_TITLE=src.DOC_TITLE,
                                target.DOC_DATEEFFECTIVE=src.DOC_DATEEFFECTIVE,
                                target.DOC_DATEEXPIRED=src.DOC_DATEEXPIRED,
                                target.DOC_LASTSAVED=src.DOC_LASTSAVED,
                                target.DOC_ISPROFILEPICTURE=src.DOC_ISPROFILEPICTURE,
                                target.DOC_ISMOBILELOG=src.DOC_ISMOBILELOG,
                  target.ETL_LASTSAVED=src.ETL_LASTSAVED,
                        target.etl_load_datetime=CURRENT_TIMESTAMP,
                      target.etl_load_metadatafilename=src.etl_load_metadatafilename 
  when not matched then insert ( 
                                DOC_CODE, 
                                DOC_DESC, 
                                DOC_CLASS, 
                                DOC_ORIGCODE, 
                                DOC_REVNUMBER, 
                                DOC_REVISION, 
                                DOC_PARENT, 
                                DOC_ORIGIN, 
                                DOC_PAGES, 
                                DOC_SIZE, 
                                DOC_CABINET, 
                                DOC_FILENAME, 
                                DOC_FILETYPE, 
                                DOC_EXPIR, 
                                DOC_SUPPLIER, 
                                DOC_WARSTART, 
                                DOC_WARRANTY, 
                                DOC_DURATION, 
                                DOC_THRESHOLD, 
                                DOC_MANUFACTURER, 
                                DOC_ORG, 
                                DOC_CLASS_ORG, 
                                DOC_SUPPLIER_ORG, 
                                DOC_TYPE, 
                                DOC_RTYPE, 
                                DOC_FILESIZE, 
                                DOC_LOCKUSER, 
                                DOC_UPDATECOUNT, 
                                DOC_LABCHARGE, 
                                DOC_MATCHARGE, 
                                DOC_HIRCHARGE, 
                                DOC_DMACHARGE, 
                                DOC_SERVICECHARGE, 
                                DOC_TOOLCHARGE, 
                                DOC_NOTUSED, 
                                DOC_ORIGFILENAME, 
                                DOC_UPLOADED, 
                                DOC_WARRANTYTYPE, 
                                DOC_CONTROLNUMBER, 
                                DOC_AGREEMENTTYPE, 
                                DOC_ONSITEREPAIR, 
                                DOC_LOANERPROVIDED, 
                                DOC_RENEWALALERTEMAIL, 
                                DOC_STARTDATEBASIS, 
                                DOC_FIXEDLABORRATE, 
                                DOC_FIXEDLABORAMOUNT, 
                                DOC_FIXEDSTOCKAMOUNT, 
                                DOC_MAXLABORAMOUNT, 
                                DOC_MAXSTOCKAMOUNT, 
                                DOC_EXCLUDEPMWORKORDER, 
                                DOC_PARTLISTREQUIRED, 
                                DOC_RMAREQUIRED, 
                                DOC_UDFCHAR01, 
                                DOC_UDFCHAR02, 
                                DOC_UDFCHAR03, 
                                DOC_UDFCHAR04, 
                                DOC_UDFCHAR05, 
                                DOC_UDFCHAR06, 
                                DOC_UDFCHAR07, 
                                DOC_UDFCHAR08, 
                                DOC_UDFCHAR09, 
                                DOC_UDFCHAR10, 
                                DOC_UDFCHAR11, 
                                DOC_UDFCHAR12, 
                                DOC_UDFCHAR13, 
                                DOC_UDFCHAR14, 
                                DOC_UDFCHAR15, 
                                DOC_UDFCHAR16, 
                                DOC_UDFCHAR17, 
                                DOC_UDFCHAR18, 
                                DOC_UDFCHAR19, 
                                DOC_UDFCHAR20, 
                                DOC_UDFCHAR21, 
                                DOC_UDFCHAR22, 
                                DOC_UDFCHAR23, 
                                DOC_UDFCHAR24, 
                                DOC_UDFCHAR25, 
                                DOC_UDFCHAR26, 
                                DOC_UDFCHAR27, 
                                DOC_UDFCHAR28, 
                                DOC_UDFCHAR29, 
                                DOC_UDFCHAR30, 
                                DOC_UDFNUM01, 
                                DOC_UDFNUM02, 
                                DOC_UDFNUM03, 
                                DOC_UDFNUM04, 
                                DOC_UDFNUM05, 
                                DOC_UDFDATE01, 
                                DOC_UDFDATE02, 
                                DOC_UDFDATE03, 
                                DOC_UDFDATE04, 
                                DOC_UDFDATE05, 
                                DOC_UDFCHKBOX01, 
                                DOC_UDFCHKBOX02, 
                                DOC_UDFCHKBOX03, 
                                DOC_UDFCHKBOX04, 
                                DOC_UDFCHKBOX05, 
                                DOC_CONTENT, 
                                DOC_IDMTYPE, 
                                DOC_TITLE, 
                                DOC_DATEEFFECTIVE, 
                                DOC_DATEEXPIRED, 
                                DOC_LASTSAVED, 
                                DOC_ISPROFILEPICTURE, 
                                DOC_ISMOBILELOG,
                      ETL_LASTSAVED,
                       
                        etl_load_datetime,
                      etl_load_metadatafilename,
etl_is_deleted,ETL_DELETED) values (
                                 src.DOC_CODE,
                                 src.DOC_DESC,
                                 src.DOC_CLASS,
                                 src.DOC_ORIGCODE,
                                 src.DOC_REVNUMBER,
                                 src.DOC_REVISION,
                                 src.DOC_PARENT,
                                 src.DOC_ORIGIN,
                                 src.DOC_PAGES,
                                 src.DOC_SIZE,
                                 src.DOC_CABINET,
                                 src.DOC_FILENAME,
                                 src.DOC_FILETYPE,
                                 src.DOC_EXPIR,
                                 src.DOC_SUPPLIER,
                                 src.DOC_WARSTART,
                                 src.DOC_WARRANTY,
                                 src.DOC_DURATION,
                                 src.DOC_THRESHOLD,
                                 src.DOC_MANUFACTURER,
                                 src.DOC_ORG,
                                 src.DOC_CLASS_ORG,
                                 src.DOC_SUPPLIER_ORG,
                                 src.DOC_TYPE,
                                 src.DOC_RTYPE,
                                 src.DOC_FILESIZE,
                                 src.DOC_LOCKUSER,
                                 src.DOC_UPDATECOUNT,
                                 src.DOC_LABCHARGE,
                                 src.DOC_MATCHARGE,
                                 src.DOC_HIRCHARGE,
                                 src.DOC_DMACHARGE,
                                 src.DOC_SERVICECHARGE,
                                 src.DOC_TOOLCHARGE,
                                 src.DOC_NOTUSED,
                                 src.DOC_ORIGFILENAME,
                                 src.DOC_UPLOADED,
                                 src.DOC_WARRANTYTYPE,
                                 src.DOC_CONTROLNUMBER,
                                 src.DOC_AGREEMENTTYPE,
                                 src.DOC_ONSITEREPAIR,
                                 src.DOC_LOANERPROVIDED,
                                 src.DOC_RENEWALALERTEMAIL,
                                 src.DOC_STARTDATEBASIS,
                                 src.DOC_FIXEDLABORRATE,
                                 src.DOC_FIXEDLABORAMOUNT,
                                 src.DOC_FIXEDSTOCKAMOUNT,
                                 src.DOC_MAXLABORAMOUNT,
                                 src.DOC_MAXSTOCKAMOUNT,
                                 src.DOC_EXCLUDEPMWORKORDER,
                                 src.DOC_PARTLISTREQUIRED,
                                 src.DOC_RMAREQUIRED,
                                 src.DOC_UDFCHAR01,
                                 src.DOC_UDFCHAR02,
                                 src.DOC_UDFCHAR03,
                                 src.DOC_UDFCHAR04,
                                 src.DOC_UDFCHAR05,
                                 src.DOC_UDFCHAR06,
                                 src.DOC_UDFCHAR07,
                                 src.DOC_UDFCHAR08,
                                 src.DOC_UDFCHAR09,
                                 src.DOC_UDFCHAR10,
                                 src.DOC_UDFCHAR11,
                                 src.DOC_UDFCHAR12,
                                 src.DOC_UDFCHAR13,
                                 src.DOC_UDFCHAR14,
                                 src.DOC_UDFCHAR15,
                                 src.DOC_UDFCHAR16,
                                 src.DOC_UDFCHAR17,
                                 src.DOC_UDFCHAR18,
                                 src.DOC_UDFCHAR19,
                                 src.DOC_UDFCHAR20,
                                 src.DOC_UDFCHAR21,
                                 src.DOC_UDFCHAR22,
                                 src.DOC_UDFCHAR23,
                                 src.DOC_UDFCHAR24,
                                 src.DOC_UDFCHAR25,
                                 src.DOC_UDFCHAR26,
                                 src.DOC_UDFCHAR27,
                                 src.DOC_UDFCHAR28,
                                 src.DOC_UDFCHAR29,
                                 src.DOC_UDFCHAR30,
                                 src.DOC_UDFNUM01,
                                 src.DOC_UDFNUM02,
                                 src.DOC_UDFNUM03,
                                 src.DOC_UDFNUM04,
                                 src.DOC_UDFNUM05,
                                 src.DOC_UDFDATE01,
                                 src.DOC_UDFDATE02,
                                 src.DOC_UDFDATE03,
                                 src.DOC_UDFDATE04,
                                 src.DOC_UDFDATE05,
                                 src.DOC_UDFCHKBOX01,
                                 src.DOC_UDFCHKBOX02,
                                 src.DOC_UDFCHKBOX03,
                                 src.DOC_UDFCHKBOX04,
                                 src.DOC_UDFCHKBOX05,
                                 src.DOC_CONTENT,
                                 src.DOC_IDMTYPE,
                                 src.DOC_TITLE,
                                 src.DOC_DATEEFFECTIVE,
                                 src.DOC_DATEEXPIRED,
                                 src.DOC_LASTSAVED,
                                 src.DOC_ISPROFILEPICTURE,
                                 src.DOC_ISMOBILELOG,
                       src.ETL_LASTSAVED,
                        CURRENT_TIMESTAMP,
                      src.etl_load_metadatafilename
                      ,case when ETL_DELETED=TRUE then TRUE else FALSE end 
                      ,ETL_DELETED);
`
   } );
       
            
  //  Get number of rows inserted
        
        try
            {
            
            var sqlStmt = snowflake.createStatement( {sqlText:  sql_command} );
            var rs = sqlStmt.execute();
            var number_of_rows_inserted = sqlStmt.getNumRowsInserted();
         //   var number_of_rows_updated =  sqlStmt.getNumRowsUpdated(); 
            var number_of_rows_updated =  sqlStmt.getNumRowsUpdated();
            
            }
         catch (err)
         {

            
            if( debug === "True" ) 
            {
            debug_statement = "call datahub_logging.sp_etl_log_ingestion_process_debug('" + process_name + "','Failed to get number of rows inserted, err = " + err + "');";
            snowflake.execute({sqlText: debug_statement}); 
            }
			
						
			//  Create a log entry to say INSERT STATEMENT failed
        
	        log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Failed','Failed to insert the rows. Quitting.', " + process_execution_id.toString() + ",0,0);";
	        snowflake.execute({sqlText: log_sql_command});
	        return "Failed"; 
         }

         
        snowflake.execute ({sqlText: "commit"});

        log_sql_command = "call datahub_logging.sp_etl_log_ingestion_process('UpdateEnd','" + process_name + "','Success','Completed process execution.', " + process_execution_id.toString() + "," + number_of_rows_inserted.toString()+ "," +  number_of_rows_updated.toString() + ");";
        snowflake.execute({sqlText: log_sql_command});

        result = "Success"; 

        //  log debug message
        if( debug === "True" ) 
            {
            debug_statement = "call datahub_logging.sp_etl_log_ingestion_process_debug('" + process_name + "','Commit Transaction');";
            snowflake.execute({sqlText: debug_statement}); 
            }

        }       

        catch (err)  {
            snowflake.execute( {sqlText: "rollback;"} );
            return "Failed: " + err;   // Return a success/error indicator.
            }


  return result;
  $$;
