CREATE OR REPLACE VIEW DATAHUB_INTEGRATION.VW_STREAM_EAM_R5PARTS
            AS
            SELECT
                src:"PAR_ASMLEVEL"::varchar AS PAR_ASMLEVEL, 
                src:"PAR_AVGPRICE"::numeric(38, 10) AS PAR_AVGPRICE, 
                src:"PAR_BASEPRICE"::numeric(38, 10) AS PAR_BASEPRICE, 
                src:"PAR_BUYER"::varchar AS PAR_BUYER, 
                src:"PAR_BYASSET"::varchar AS PAR_BYASSET, 
                src:"PAR_BYLOT"::varchar AS PAR_BYLOT, 
                src:"PAR_CALSTANDARD"::varchar AS PAR_CALSTANDARD, 
                src:"PAR_CATEGORY"::varchar AS PAR_CATEGORY, 
                src:"PAR_CLASS"::varchar AS PAR_CLASS, 
                src:"PAR_CLASS_ORG"::varchar AS PAR_CLASS_ORG, 
                src:"PAR_CODE"::varchar AS PAR_CODE, 
                src:"PAR_CODESTRUCTURE"::varchar AS PAR_CODESTRUCTURE, 
                src:"PAR_COMMODITY"::varchar AS PAR_COMMODITY, 
                src:"PAR_COMPLEVEL"::varchar AS PAR_COMPLEVEL, 
                src:"PAR_CONDITION"::varchar AS PAR_CONDITION, 
                src:"PAR_CONDITIONTPL"::varchar AS PAR_CONDITIONTPL, 
                src:"PAR_CONDITIONTPL_ORG"::varchar AS PAR_CONDITIONTPL_ORG, 
                src:"PAR_COREVALUE"::numeric(38, 10) AS PAR_COREVALUE, 
                src:"PAR_CREATED"::datetime AS PAR_CREATED, 
                src:"PAR_CREATEDBY"::varchar AS PAR_CREATEDBY, 
                src:"PAR_DESC"::varchar AS PAR_DESC, 
                src:"PAR_DOCUMOTO_BOOKID"::varchar AS PAR_DOCUMOTO_BOOKID, 
                src:"PAR_DOCUMOTO_PART"::varchar AS PAR_DOCUMOTO_PART, 
                src:"PAR_FUGITIVEEMISSIONGAS"::varchar AS PAR_FUGITIVEEMISSIONGAS, 
                src:"PAR_IMPORTANCE"::varchar AS PAR_IMPORTANCE, 
                src:"PAR_INSMETHOD"::varchar AS PAR_INSMETHOD, 
                src:"PAR_INSPECT"::varchar AS PAR_INSPECT, 
                src:"PAR_INTERFACE"::datetime AS PAR_INTERFACE, 
                src:"PAR_KIT"::varchar AS PAR_KIT, 
                src:"PAR_LASTPRICE"::numeric(38, 10) AS PAR_LASTPRICE, 
                src:"PAR_LASTSAVED"::datetime AS PAR_LASTSAVED,  
                src:"PAR_LASTSAVED"::datetime as ETL_LASTSAVED,
                src:"PAR_LASTSTATUSUPDATE"::datetime AS PAR_LASTSTATUSUPDATE, 
                src:"PAR_LONGDESCRIPTION"::varchar AS PAR_LONGDESCRIPTION, 
                src:"PAR_MATERIALTYPE"::varchar AS PAR_MATERIALTYPE, 
                src:"PAR_NOTUSED"::varchar AS PAR_NOTUSED, 
                src:"PAR_ORG"::varchar AS PAR_ORG, 
                src:"PAR_PARENTPART"::varchar AS PAR_PARENTPART, 
                src:"PAR_PREFSUP"::varchar AS PAR_PREFSUP, 
                src:"PAR_PREFSUPPRICE"::numeric(38, 10) AS PAR_PREFSUPPRICE, 
                src:"PAR_PREFSUP_ORG"::varchar AS PAR_PREFSUP_ORG, 
                src:"PAR_PREFUOM"::varchar AS PAR_PREFUOM, 
                src:"PAR_PREVENTREORDERS"::varchar AS PAR_PREVENTREORDERS, 
                src:"PAR_PROFILEPICTURE"::varchar AS PAR_PROFILEPICTURE, 
                src:"PAR_REPAIRABLE"::varchar AS PAR_REPAIRABLE, 
                src:"PAR_SAFETYREVIEWED"::datetime AS PAR_SAFETYREVIEWED, 
                src:"PAR_SAFETYREVIEWEDBY"::varchar AS PAR_SAFETYREVIEWEDBY, 
                src:"PAR_SAFETYREVIEWEDNAME"::varchar AS PAR_SAFETYREVIEWEDNAME, 
                src:"PAR_SAFETYREVIEWEDTYPE"::varchar AS PAR_SAFETYREVIEWEDTYPE, 
                src:"PAR_SAFETYREVIEWREQUIRED"::datetime AS PAR_SAFETYREVIEWREQUIRED, 
                src:"PAR_SAVEHISTORY"::varchar AS PAR_SAVEHISTORY, 
                src:"PAR_SOURCECODE"::varchar AS PAR_SOURCECODE, 
                src:"PAR_SOURCESYSTEM"::varchar AS PAR_SOURCESYSTEM, 
                src:"PAR_STDPRICE"::numeric(38, 10) AS PAR_STDPRICE, 
                src:"PAR_SUBCOMMODITY"::varchar AS PAR_SUBCOMMODITY, 
                src:"PAR_SYSLEVEL"::varchar AS PAR_SYSLEVEL, 
                src:"PAR_TAX"::varchar AS PAR_TAX, 
                src:"PAR_TOOL"::varchar AS PAR_TOOL, 
                src:"PAR_TRACKBYCONDITION"::varchar AS PAR_TRACKBYCONDITION, 
                src:"PAR_TRACKRTYPE"::varchar AS PAR_TRACKRTYPE, 
                src:"PAR_TRACKTYPE"::varchar AS PAR_TRACKTYPE, 
                src:"PAR_UDFCHAR01"::varchar AS PAR_UDFCHAR01, 
                src:"PAR_UDFCHAR02"::varchar AS PAR_UDFCHAR02, 
                src:"PAR_UDFCHAR03"::varchar AS PAR_UDFCHAR03, 
                src:"PAR_UDFCHAR04"::varchar AS PAR_UDFCHAR04, 
                src:"PAR_UDFCHAR05"::varchar AS PAR_UDFCHAR05, 
                src:"PAR_UDFCHAR06"::varchar AS PAR_UDFCHAR06, 
                src:"PAR_UDFCHAR07"::varchar AS PAR_UDFCHAR07, 
                src:"PAR_UDFCHAR08"::varchar AS PAR_UDFCHAR08, 
                src:"PAR_UDFCHAR09"::varchar AS PAR_UDFCHAR09, 
                src:"PAR_UDFCHAR10"::varchar AS PAR_UDFCHAR10, 
                src:"PAR_UDFCHAR11"::varchar AS PAR_UDFCHAR11, 
                src:"PAR_UDFCHAR12"::varchar AS PAR_UDFCHAR12, 
                src:"PAR_UDFCHAR13"::varchar AS PAR_UDFCHAR13, 
                src:"PAR_UDFCHAR14"::varchar AS PAR_UDFCHAR14, 
                src:"PAR_UDFCHAR15"::varchar AS PAR_UDFCHAR15, 
                src:"PAR_UDFCHAR16"::varchar AS PAR_UDFCHAR16, 
                src:"PAR_UDFCHAR17"::varchar AS PAR_UDFCHAR17, 
                src:"PAR_UDFCHAR18"::varchar AS PAR_UDFCHAR18, 
                src:"PAR_UDFCHAR19"::varchar AS PAR_UDFCHAR19, 
                src:"PAR_UDFCHAR20"::varchar AS PAR_UDFCHAR20, 
                src:"PAR_UDFCHAR21"::varchar AS PAR_UDFCHAR21, 
                src:"PAR_UDFCHAR22"::varchar AS PAR_UDFCHAR22, 
                src:"PAR_UDFCHAR23"::varchar AS PAR_UDFCHAR23, 
                src:"PAR_UDFCHAR24"::varchar AS PAR_UDFCHAR24, 
                src:"PAR_UDFCHAR25"::varchar AS PAR_UDFCHAR25, 
                src:"PAR_UDFCHAR26"::varchar AS PAR_UDFCHAR26, 
                src:"PAR_UDFCHAR27"::varchar AS PAR_UDFCHAR27, 
                src:"PAR_UDFCHAR28"::varchar AS PAR_UDFCHAR28, 
                src:"PAR_UDFCHAR29"::varchar AS PAR_UDFCHAR29, 
                src:"PAR_UDFCHAR30"::varchar AS PAR_UDFCHAR30, 
                src:"PAR_UDFCHKBOX01"::varchar AS PAR_UDFCHKBOX01, 
                src:"PAR_UDFCHKBOX02"::varchar AS PAR_UDFCHKBOX02, 
                src:"PAR_UDFCHKBOX03"::varchar AS PAR_UDFCHKBOX03, 
                src:"PAR_UDFCHKBOX04"::varchar AS PAR_UDFCHKBOX04, 
                src:"PAR_UDFCHKBOX05"::varchar AS PAR_UDFCHKBOX05, 
                src:"PAR_UDFDATE01"::datetime AS PAR_UDFDATE01, 
                src:"PAR_UDFDATE02"::datetime AS PAR_UDFDATE02, 
                src:"PAR_UDFDATE03"::datetime AS PAR_UDFDATE03, 
                src:"PAR_UDFDATE04"::datetime AS PAR_UDFDATE04, 
                src:"PAR_UDFDATE05"::datetime AS PAR_UDFDATE05, 
                src:"PAR_UDFNOTE01"::varchar AS PAR_UDFNOTE01, 
                src:"PAR_UDFNOTE02"::varchar AS PAR_UDFNOTE02, 
                src:"PAR_UDFNUM01"::numeric(38, 10) AS PAR_UDFNUM01, 
                src:"PAR_UDFNUM02"::numeric(38, 10) AS PAR_UDFNUM02, 
                src:"PAR_UDFNUM03"::numeric(38, 10) AS PAR_UDFNUM03, 
                src:"PAR_UDFNUM04"::numeric(38, 10) AS PAR_UDFNUM04, 
                src:"PAR_UDFNUM05"::numeric(38, 10) AS PAR_UDFNUM05, 
                src:"PAR_UOM"::varchar AS PAR_UOM, 
                src:"PAR_UPDATECOUNT"::numeric(38, 10) AS PAR_UPDATECOUNT, 
                src:"PAR_UPDATED"::datetime AS PAR_UPDATED, 
                src:"PAR_UPDATEDBY"::varchar AS PAR_UPDATEDBY, 
                src:"PAR_WARDAYS"::numeric(38, 10) AS PAR_WARDAYS, 
                src:"_DELETED"::boolean AS _DELETED, 
                src:"_DELETED"::BOOLEAN as ETL_DELETED, 
                etl_load_datetime,
                etl_load_metadatafilename
                FROM 
                (
                select 
                    src,
                    etl_load_datetime,
                    etl_load_metadatafilename
                    from
                    (
                        SELECT
     
                            
                src:"PAR_CODE"::varchar,
                src:"PAR_ORG"::varchar,
                src:"PAR_LASTSAVED"::datetime
                ,src,
                etl_load_datetime,
                etl_load_metadatafilename,
                ROW_NUMBER() OVER (PARTITION BY 
                                        
                src:"PAR_CODE"::varchar,
                src:"PAR_ORG"::varchar  ORDER BY 
                src:"PAR_LASTSAVED"::datetime desc,IFNULL(TRY_TO_TIMESTAMP(replace(right(replace(lower(etl_load_metadatafilename),'.json'),23),'_','-'), 'yyyy-mm-dd-HH-MI-SS-FF') ,etl_load_datetime) desc) as ROWNUMBER
                FROM DATAHUB_INTEGRATION.STREAM_EAM_R5PARTS as strm

)
    WHERE
    ROWNUMBER=1)
                ; 